<?xml version="1.0" encoding="utf-8"?>
<search>
  
    
    <entry>
      <title><![CDATA[å‘½ä»¤è¡Œçš„è‰ºæœ¯ï¼ˆè½¬ï¼‰]]></title>
      <url>%2F2017%2F05%2F05%2Fthe-art-of-command-line%2F</url>
      <content type="text"><![CDATA[ðŸŒÄŒeÅ¡tina âˆ™ Deutsch âˆ™ Î•Î»Î»Î·Î½Î¹ÎºÎ¬ âˆ™ English âˆ™ EspaÃ±ol âˆ™ FranÃ§ais âˆ™ Indonesia âˆ™ Italiano âˆ™ æ—¥æœ¬èªž âˆ™ í•œêµ­ì–´ âˆ™ PortuguÃªs âˆ™ RomÃ¢nÄƒ âˆ™ Ð ÑƒÑÑÐºÐ¸Ð¹ âˆ™ SlovenÅ¡Äina âˆ™ Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ° âˆ™ ç®€ä½“ä¸­æ–‡ âˆ™ ç¹é«”ä¸­æ–‡ The Art of Command Line Meta Basics Everyday use Processing files and data System debugging One-liners Obscure but useful OS X only Windows only More resources Disclaimer 1curl -s &apos;https://raw.githubusercontent.com/jlevy/the-art-of-command-line/master/README.md&apos; | egrep -o &apos;`\w+`&apos; | tr -d &apos;`&apos; | cowsay -W50 Fluency on the command line is a skill often neglected or considered arcane, but it improves your flexibility and productivity as an engineer in both obvious and subtle ways. This is a selection of notes and tips on using the command-line that weâ€™ve found useful when working on Linux. Some tips are elementary, and some are fairly specific, sophisticated, or obscure. This page is not long, but if you can use and recall all the items here, you know a lot. This work is the result of many authors and translators.Some of thisoriginallyappearedon Quora,but it has since moved to GitHub, where people more talented than the original author have made numerous improvements.Please submit a question if you have a question related to the command line. Please contribute if you see an error or something that could be better! MetaScope: This guide is both for beginners and the experienced. The goals are breadth (everything important), specificity (give concrete examples of the most common case), and brevity (avoid things that arenâ€™t essential or digressions you can easily look up elsewhere). Every tip is essential in some situation or significantly saves time over alternatives. This is written for Linux, with the exception of the â€œOS X onlyâ€œ and â€œWindows onlyâ€œ sections. Many of the other items apply or can be installed on other Unices or OS X (or even Cygwin). The focus is on interactive Bash, though many tips apply to other shells and to general Bash scripting. It includes both â€œstandardâ€ Unix commands as well as ones that require special package installs â€“ so long as they are important enough to merit inclusion. Notes: To keep this to one page, content is implicitly included by reference. Youâ€™re smart enough to look up more detail elsewhere once you know the idea or command to Google. Use apt-get, yum, dnf, pacman, pip or brew (as appropriate) to install new programs. Use Explainshell to get a helpful breakdown of what commands, options, pipes etc. do. Basics Learn basic Bash. Actually, type man bash and at least skim the whole thing; itâ€™s pretty easy to follow and not that long. Alternate shells can be nice, but Bash is powerful and always available (learning only zsh, fish, etc., while tempting on your own laptop, restricts you in many situations, such as using existing servers). Learn at least one text-based editor well. Ideally Vim (vi), as thereâ€™s really no competition for random editing in a terminal (even if you use Emacs, a big IDE, or a modern hipster editor most of the time). Know how to read documentation with man (for the inquisitive, man man lists the section numbers, e.g. 1 is â€œregularâ€ commands, 5 is files/conventions, and 8 are for administration). Find man pages with apropos. Know that some commands are not executables, but Bash builtins, and that you can get help on them with help and help -d. You can find out whether a command is an executable, shell builtin or an alias by using type command. Learn about redirection of output and input using &gt; and &lt; and pipes using |. Know &gt; overwrites the output file and &gt;&gt; appends. Learn about stdout and stderr. Learn about file glob expansion with * (and perhaps ? and [â€¦]) and quoting and the difference between double &quot; and single &#39; quotes. (See more on variable expansion below.) Be familiar with Bash job management: &amp;, ctrl-z, ctrl-c, jobs, fg, bg, kill, etc. Know ssh, and the basics of passwordless authentication, via ssh-agent, ssh-add, etc. Basic file management: ls and ls -l (in particular, learn what every column in ls -l means), less, head, tail and tail -f (or even better, less +F), ln and ln -s (learn the differences and advantages of hard versus soft links), chown, chmod, du (for a quick summary of disk usage: du -hs *). For filesystem management, df, mount, fdisk, mkfs, lsblk. Learn what an inode is (ls -i or df -i). Basic network management: ip or ifconfig, dig, traceroute, route. Learn and use a version control management system, such as git. Know regular expressions well, and the various flags to grep/egrep. The -i, -o, -v, -A, -B, and -C options are worth knowing. Learn to use apt-get, yum, dnf or pacman (depending on distro) to find and install packages. And make sure you have pip to install Python-based command-line tools (a few below are easiest to install via pip). Everyday use In Bash, use Tab to complete arguments or list all available commands and ctrl-r to search through command history (after pressing, type to search, press ctrl-r repeatedly to cycle through more matches, press Enter to execute the found command, or hit the right arrow to put the result in the current line to allow editing). In Bash, use ctrl-w to delete the last word, and ctrl-u to delete the content from current cursor back to the start of the line. Use alt-b and alt-f to move by word, ctrl-a to move cursor to beginning of line, ctrl-e to move cursor to end of line, ctrl-k to kill to the end of the line, ctrl-l to clear the screen. See man readline for all the default keybindings in Bash. There are a lot. For example alt-. cycles through previous arguments, and alt-* expands a glob. Alternatively, if you love vi-style key-bindings, use set -o vi (and set -o emacs to put it back). For editing long commands, after setting your editor (for example export EDITOR=vim), ctrl-x ctrl-e will open the current command in an editor for multi-line editing. Or in vi style, escape-v. To see recent commands, use history. Follow with !n (where n is the command number) to execute again. There are also many abbreviations you can use, the most useful probably being !$ for last argument and !! for last command (see â€œHISTORY EXPANSIONâ€ in the man page). However, these are often easily replaced with ctrl-r and alt-.. Go to your home directory with cd. Access files relative to your home directory with the ~ prefix (e.g. ~/.bashrc). In sh scripts refer to the home directory as $HOME. To go back to the previous working directory: cd -. If you are halfway through typing a command but change your mind, hit alt-# to add a # at the beginning and enter it as a comment (or use ctrl-a, #, enter). You can then return to it later via command history. Use xargs (or parallel). Itâ€™s very powerful. Note you can control how many items execute per line (-L) as well as parallelism (-P). If youâ€™re not sure if itâ€™ll do the right thing, use xargs echo first. Also, -I{} is handy. Examples: 12find . -name '*.py' | xargs grep some_functioncat hosts | xargs -I&#123;&#125; ssh root@&#123;&#125; hostname pstree -p is a helpful display of the process tree. Use pgrep and pkill to find or signal processes by name (-f is helpful). Know the various signals you can send processes. For example, to suspend a process, use kill -STOP [pid]. For the full list, see man 7 signal Use nohup or disown if you want a background process to keep running forever. Check what processes are listening via netstat -lntp or ss -plat (for TCP; add -u for UDP). See also lsof and fuser for open sockets and files. See uptime or w to know how long the system has been running. Use alias to create shortcuts for commonly used commands. For example, alias ll=&#39;ls -latr&#39; creates a new alias ll. Save aliases, shell settings, and functions you commonly use in ~/.bashrc, and arrange for login shells to source it. This will make your setup available in all your shell sessions. Put the settings of environment variables as well as commands that should be executed when you login in ~/.bash_profile. Separate configuration will be needed for shells you launch from graphical environment logins and cron jobs. Synchronize your configuration files (e.g. .bashrc and .bash_profile) among various computers with Git. Understand that care is needed when variables and filenames include whitespace. Surround your Bash variables with quotes, e.g. &quot;$FOO&quot;. Prefer the -0 or -print0 options to enable null characters to delimit filenames, e.g. locate -0 pattern | xargs -0 ls -al or find / -print0 -type d | xargs -0 ls -al. To iterate on filenames containing whitespace in a for loop, set your IFS to be a newline only using IFS=$&#39;\n&#39;. In Bash scripts, use set -x (or the variant set -v, which logs raw input, including unexpanded variables and comments) for debugging output. Use strict modes unless you have a good reason not to: Use set -e to abort on errors (nonzero exit code). Use set -u to detect unset variable usages. Consider set -o pipefail too, to on errors within pipes, too (though read up on it more if you do, as this topic is a bit subtle). For more involved scripts, also use trap on EXIT or ERR. A useful habit is to start a script like this, which will make it detect and abort on common errors and print a message: 12set -euo pipefailtrap "echo 'error: Script failed: see failed command above'" ERR In Bash scripts, subshells (written with parentheses) are convenient ways to group commands. A common example is to temporarily move to a different working directory, e.g. 123# do something in current dir(cd /some/other/dir &amp;&amp; other-command)# continue in original dir In Bash, note there are lots of kinds of variable expansion. Checking a variable exists: ${name:?error message}. For example, if a Bash script requires a single argument, just write input_file=${1:?usage: $0 input_file}. Using a default value if a variable is empty: ${name:-default}. If you want to have an additional (optional) parameter added to the previous example, you can use something like output_file=${2:-logfile}. If $2 is omitted and thus empty, output_file will be set to logfile. Arithmetic expansion: i=$(( (i + 1) % 5 )). Sequences: {1..10}. Trimming of strings: ${var%suffix} and ${var#prefix}. For example if var=foo.pdf, then echo ${var%.pdf}.txt prints foo.txt. Brace expansion using {â€¦} can reduce having to re-type similar text and automate combinations of items. This is helpful in examples like mv foo.{txt,pdf} some-dir (which moves both files), cp somefile{,.bak} (which expands to cp somefile somefile.bak) or mkdir -p test-{a,b,c}/subtest-{1,2,3} (which expands all possible combinations and creates a directory tree). The output of a command can be treated like a file via &lt;(some command). For example, compare local /etc/hosts with a remote one: 1diff /etc/hosts &lt;(ssh somehost cat /etc/hosts) When writing scripts you may want to put all of your code in curly braces. If the closing brace is missing, your script will be prevented from executing due to a syntax error. This makes sense when your script is going to be downloaded from the web, since it prevents partially downloaded scripts from executing: 123&#123; # Your code here&#125; Know about â€œhere documentsâ€ in Bash, as in cat &lt;&lt;EOF .... In Bash, redirect both standard output and standard error via: some-command &gt;logfile 2&gt;&amp;1 or some-command &amp;&gt;logfile. Often, to ensure a command does not leave an open file handle to standard input, tying it to the terminal you are in, it is also good practice to add &lt;/dev/null. Use man ascii for a good ASCII table, with hex and decimal values. For general encoding info, man unicode, man utf-8, and man latin1 are helpful. Use screen or tmux to multiplex the screen, especially useful on remote ssh sessions and to detach and re-attach to a session. byobu can enhance screen or tmux providing more information and easier management. A more minimal alternative for session persistence only is dtach. In ssh, knowing how to port tunnel with -L or -D (and occasionally -R) is useful, e.g. to access web sites from a remote server. It can be useful to make a few optimizations to your ssh configuration; for example, this ~/.ssh/config contains settings to avoid dropped connections in certain network environments, uses compression (which is helpful with scp over low-bandwidth connections), and multiplex channels to the same server with a local control file: 1234567TCPKeepAlive=yesServerAliveInterval=15ServerAliveCountMax=6Compression=yesControlMaster autoControlPath /tmp/%r@%h:%pControlPersist yes A few other options relevant to ssh are security sensitive and should be enabled with care, e.g. per subnet or host or in trusted networks: StrictHostKeyChecking=no, ForwardAgent=yes Consider mosh an alternative to ssh that uses UDP, avoiding dropped connections and adding convenience on the road (requires server-side setup). To get the permissions on a file in octal form, which is useful for system configuration but not available in ls and easy to bungle, use something like 1stat -c '%A %a %n' /etc/timezone For interactive selection of values from the output of another command, use percol or fzf. For interaction with files based on the output of another command (like git), use fpp (PathPicker). For a simple web server for all files in the current directory (and subdirs), available to anyone on your network, use:python -m SimpleHTTPServer 7777 (for port 7777 and Python 2) and python -m http.server 7777 (for port 7777 and Python 3). For running a command as another user, use sudo. Defaults to running as root; use -u to specify another user. Use -i to login as that user (you will be asked for your password). For switching the shell to another user, use su username or su - username. The latter with â€œ-â€œ gets an environment as if another user just logged in. Omitting the username defaults to root. You will be asked for the password of the user you are switching to. Know about the 128K limit on command lines. This â€œArgument list too longâ€ error is common when wildcard matching large numbers of files. (When this happens alternatives like find and xargs may help.) For a basic calculator (and of course access to Python in general), use the python interpreter. For example, 12&gt;&gt;&gt; 2+35 Processing files and data To locate a file by name in the current directory, find . -iname &#39;*something*&#39; (or similar). To find a file anywhere by name, use locate something (but bear in mind updatedb may not have indexed recently created files). For general searching through source or data files (more advanced than grep -r), use ag. To convert HTML to text: lynx -dump -stdin For Markdown, HTML, and all kinds of document conversion, try pandoc. If you must handle XML, xmlstarlet is old but good. For JSON, use jq. For YAML, use shyaml. For Excel or CSV files, csvkit provides in2csv, csvcut, csvjoin, csvgrep, etc. For Amazon S3, s3cmd is convenient and s4cmd is faster. Amazonâ€™s aws and the improved saws are essential for other AWS-related tasks. Know about sort and uniq, including uniqâ€™s -u and -d options â€“ see one-liners below. See also comm. Know about cut, paste, and join to manipulate text files. Many people use cut but forget about join. Know about wc to count newlines (-l), characters (-m), words (-w) and bytes (-c). Know about tee to copy from stdin to a file and also to stdout, as in ls -al | tee file.txt. For more complex calculations, including grouping, reversing fields, and statistical calculations, consider datamash. Know that locale affects a lot of command line tools in subtle ways, including sorting order (collation) and performance. Most Linux installations will set LANG or other locale variables to a local setting like US English. But be aware sorting will change if you change locale. And know i18n routines can make sort or other commands run many times slower. In some situations (such as the set operations or uniqueness operations below) you can safely ignore slow i18n routines entirely and use traditional byte-based sort order, using export LC_ALL=C. You can set a specific commandâ€™s environment by prefixing its invocation with the environment variable settings, as in TZ=Pacific/Fiji date. Know basic awk and sed for simple data munging. For example, summing all numbers in the third column of a text file: awk &#39;{ x += $3 } END { print x }&#39;. This is probably 3X faster and 3X shorter than equivalent Python. To replace all occurrences of a string in place, in one or more files: 1perl -pi.bak -e 's/old-string/new-string/g' my-files-*.txt To rename multiple files and/or search and replace within files, try repren. (In some cases the rename command also allows multiple renames, but be careful as its functionality is not the same on all Linux distributions.) 123456# Full rename of filenames, directories, and contents foo -&gt; bar:repren --full --preserve-case --from foo --to bar .# Recover backup files whatever.bak -&gt; whatever:repren --renames --from '(.*)\.bak' --to '\1' *.bak# Same as above, using rename, if available:rename 's/\.bak$//' *.bak As the man page says, rsync really is a fast and extraordinarily versatile file copying tool. Itâ€™s known for synchronizing between machines but is equally useful locally. When security restrictions allow, using rsync instead of scp allows recovery of a transfer without restarting from scratch. It also is among the fastest ways to delete large numbers of files: 1mkdir empty &amp;&amp; rsync -r --delete empty/ some-dir &amp;&amp; rmdir some-dir Use shuf to shuffle or select random lines from a file. Know sortâ€˜s options. For numbers, use -n, or -h for handling human-readable numbers (e.g. from du -h). Know how keys work (-t and -k). In particular, watch out that you need to write -k1,1 to sort by only the first field; -k1 means sort according to the whole line. Stable sort (sort -s) can be useful. For example, to sort first by field 2, then secondarily by field 1, you can use sort -k1,1 | sort -s -k2,2. If you ever need to write a tab literal in a command line in Bash (e.g. for the -t argument to sort), press ctrl-v [Tab] or write $&#39;\t&#39; (the latter is better as you can copy/paste it). The standard tools for patching source code are diff and patch. See also diffstat for summary statistics of a diff and sdiff for a side-by-side diff. Note diff -r works for entire directories. Use diff -r tree1 tree2 | diffstat for a summary of changes. Use vimdiff to compare and edit files. For binary files, use hd, hexdump or xxd for simple hex dumps and bvi, hexedit or biew for binary editing. Also for binary files, strings (plus grep, etc.) lets you find bits of text. For binary diffs (delta compression), use xdelta3. To convert text encodings, try iconv. Or uconv for more advanced use; it supports some advanced Unicode things. For example, this command lowercases and removes all accents (by expanding and dropping them): 1uconv -f utf-8 -t utf-8 -x '::Any-Lower; ::Any-NFD; [:Nonspacing Mark:] &gt;; ::Any-NFC; ' &lt; input.txt &gt; output.txt To split files into pieces, see split (to split by size) and csplit (to split by a pattern). To manipulate date and time expressions, use dateadd, datediff, strptime etc. from dateutils. Use zless, zmore, zcat, and zgrep to operate on compressed files. File attributes are settable via chattr and offer a lower-level alternative to file permissions. For example, to protect against accidental file deletion the immutable flag: sudo chattr +i /critical/directory/or/file Use getfacl and setfacl to save and restore file permissions. For example: 12getfacl -R /some/path &gt; permissions.txtsetfacl --restore=permissions.txt To create empty files quickly, use truncate (creates sparse file), fallocate (ext4, xfs, btrfs and ocfs2 filesystems), xfs_mkfile (almost any filesystems, comes in xfsprogs package), mkfile (for Unix-like systems like Solaris, Mac OS). System debugging For web debugging, curl and curl -I are handy, or their wget equivalents, or the more modern httpie. To know current cpu/disk status, the classic tools are top (or the better htop), iostat, and iotop. Use iostat -mxz 15 for basic CPU and detailed per-partition disk stats and performance insight. For network connection details, use netstat and ss. For a quick overview of whatâ€™s happening on a system, dstat is especially useful. For broadest overview with details, use glances. To know memory status, run and understand the output of free and vmstat. In particular, be aware the â€œcachedâ€ value is memory held by the Linux kernel as file cache, so effectively counts toward the â€œfreeâ€ value. Java system debugging is a different kettle of fish, but a simple trick on Oracleâ€™s and some other JVMs is that you can run kill -3 &lt;pid&gt; and a full stack trace and heap summary (including generational garbage collection details, which can be highly informative) will be dumped to stderr/logs. The JDKâ€™s jps, jstat, jstack, jmap are useful. SJK tools are more advanced. Use mtr as a better traceroute, to identify network issues. For looking at why a disk is full, ncdu saves time over the usual commands like du -sh *. To find which socket or process is using bandwidth, try iftop or nethogs. The ab tool (comes with Apache) is helpful for quick-and-dirty checking of web server performance. For more complex load testing, try siege. For more serious network debugging, wireshark, tshark, or ngrep. Know about strace and ltrace. These can be helpful if a program is failing, hanging, or crashing, and you donâ€™t know why, or if you want to get a general idea of performance. Note the profiling option (-c), and the ability to attach to a running process (-p). Use trace child option (-f) to avoid missing important calls. Know about ldd to check shared libraries etc. Know how to connect to a running process with gdb and get its stack traces. Use /proc. Itâ€™s amazingly helpful sometimes when debugging live problems. Examples: /proc/cpuinfo, /proc/meminfo, /proc/cmdline, /proc/xxx/cwd, /proc/xxx/exe, /proc/xxx/fd/, /proc/xxx/smaps (where xxx is the process id or pid). When debugging why something went wrong in the past, sar can be very helpful. It shows historic statistics on CPU, memory, network, etc. For deeper systems and performance analyses, look at stap (SystemTap), perf, and sysdig. Check what OS youâ€™re on with uname or uname -a (general Unix/kernel info) or lsb_release -a (Linux distro info). Use dmesg whenever somethingâ€™s acting really funny (it could be hardware or driver issues). If you delete a file and it doesnâ€™t free up expected disk space as reported by du, check whether the file is in use by a process:lsof | grep deleted | grep &quot;filename-of-my-big-file&quot; One-linersA few examples of piecing together commands: It is remarkably helpful sometimes that you can do set intersection, union, and difference of text files via sort/uniq. Suppose a and b are text files that are already uniqued. This is fast, and works on files of arbitrary size, up to many gigabytes. (Sort is not limited by memory, though you may need to use the -T option if /tmp is on a small root partition.) See also the note about LC_ALL above and sortâ€˜s -u option (left out for clarity below). 123cat a b | sort | uniq &gt; c # c is a union bcat a b | sort | uniq -d &gt; c # c is a intersect bcat a b b | sort | uniq -u &gt; c # c is set difference a - b Use grep . * to quickly examine the contents of all files in a directory (so each line is paired with the filename), or head -100 * (so each file has a heading). This can be useful for directories filled with config settings like those in /sys, /proc, /etc. Summing all numbers in the third column of a text file (this is probably 3X faster and 3X less code than equivalent Python): 1awk '&#123; x += $3 &#125; END &#123; print x &#125;' myfile To see sizes/dates on a tree of files, this is like a recursive ls -l but is easier to read than ls -lR: 1find . -type f -ls Say you have a text file, like a web server log, and a certain value that appears on some lines, such as an acct_id parameter that is present in the URL. If you want a tally of how many requests for each acct_id: 1cat access.log | egrep -o 'acct_id=[0-9]+' | cut -d= -f2 | sort | uniq -c | sort -rn To continuously monitor changes, use watch, e.g. check changes to files in a directory with watch -d -n 2 &#39;ls -rtlh | tail&#39; or to network settings while troubleshooting your wifi settings with watch -d -n 2 ifconfig. Run this function to get a random tip from this document (parses Markdown and extracts an item): 1234567function taocl() &#123; curl -s https://raw.githubusercontent.com/jlevy/the-art-of-command-line/master/README.md | pandoc -f markdown -t html | xmlstarlet fo --html --dropdtd | xmlstarlet sel -t -v "(html/body/ul/li[count(p)&gt;0])[$RANDOM mod last()+1]" | xmlstarlet unesc | fmt -80&#125; Obscure but useful expr: perform arithmetic or boolean operations or evaluate regular expressions m4: simple macro processor yes: print a string a lot cal: nice calendar env: run a command (useful in scripts) printenv: print out environment variables (useful in debugging and scripts) look: find English words (or lines in a file) beginning with a string cut, paste and join: data manipulation fmt: format text paragraphs pr: format text into pages/columns fold: wrap lines of text column: format text fields into aligned, fixed-width columns or tables expand and unexpand: convert between tabs and spaces nl: add line numbers seq: print numbers bc: calculator factor: factor integers gpg: encrypt and sign files toe: table of terminfo entries nc: network debugging and data transfer socat: socket relay and tcp port forwarder (similar to netcat) slurm: network traffic visualization dd: moving data between files or devices file: identify type of a file tree: display directories and subdirectories as a nesting tree; like ls but recursive stat: file info time: execute and time a command timeout: execute a command for specified amount of time and stop the process when the specified amount of time completes. lockfile: create semaphore file that can only be removed by rm -f logrotate: rotate, compress and mail logs. watch: run a command repeatedly, showing results and/or highlighting changes tac: print files in reverse shuf: random selection of lines from a file comm: compare sorted files line by line pv: monitor the progress of data through a pipe strings: extract text from binary files tr: character translation or manipulation iconv or uconv: conversion for text encodings split and csplit: splitting files sponge: read all input before writing it, useful for reading from then writing to the same file, e.g., grep -v something some-file | sponge some-file units: unit conversions and calculations; converts furlongs per fortnight to twips per blink (see also /usr/share/units/definitions.units) apg: generates random passwords xz: high-ratio file compression ldd: dynamic library info nm: symbols from object files ab: benchmarking web servers strace: system call debugging mtr: better traceroute for network debugging cssh: visual concurrent shell rsync: sync files and folders over SSH or in local file system wireshark and tshark: packet capture and network debugging ngrep: grep for the network layer host and dig: DNS lookups lsof: process file descriptor and socket info dstat: useful system stats glances: high level, multi-subsystem overview iostat: Disk usage stats mpstat: CPU usage stats vmstat: Memory usage stats htop: improved version of top last: login history w: whoâ€™s logged on id: user/group identity info sar: historic system stats iftop or nethogs: network utilization by socket or process ss: socket statistics dmesg: boot and system error messages sysctl: view and configure Linux kernel parameters at run time hdparm: SATA/ATA disk manipulation/performance lsblk: list block devices: a tree view of your disks and disk partitions lshw, lscpu, lspci, lsusb, dmidecode: hardware information, including CPU, BIOS, RAID, graphics, devices, etc. lsmod and modinfo: List and show details of kernel modules. fortune, ddate, and sl: um, well, it depends on whether you consider steam locomotives and Zippy quotations â€œusefulâ€ OS X onlyThese are items relevant only on OS X. Package management with brew (Homebrew) and/or port (MacPorts). These can be used to install on OS X many of the above commands. Copy output of any command to a desktop app with pbcopy and paste input from one with pbpaste. To enable the Option key in OS X Terminal as an alt key (such as used in the commands above like alt-b, alt-f, etc.), open Preferences -&gt; Profiles -&gt; Keyboard and select â€œUse Option as Meta keyâ€. To open a file with a desktop app, use open or open -a /Applications/Whatever.app. Spotlight: Search files with mdfind and list metadata (such as photo EXIF info) with mdls. Be aware OS X is based on BSD Unix, and many commands (for example ps, ls, tail, awk, sed) have many subtle variations from Linux, which is largely influenced by System V-style Unix and GNU tools. You can often tell the difference by noting a man page has the heading â€œBSD General Commands Manual.â€ In some cases GNU versions can be installed, too (such as gawk and gsed for GNU awk and sed). If writing cross-platform Bash scripts, avoid such commands (for example, consider Python or perl) or test carefully. To get OS X release information, use sw_vers. Windows onlyThese items are relevant only on Windows. On Windows 10, you can use Bash on Ubuntu on Windows, which provides a familiar Bash environment with Unix command line utilities. On the plus side, this allows Linux programs to run on Windows. On the other hand this does not support the running of Windows programs from the Bash prompt. Access the power of the Unix shell under Microsoft Windows by installing Cygwin. Most of the things described in this document will work out of the box. Install additional Unix programs with the Cygwinâ€™s package manager. Use mintty as your command-line window. Access the Windows clipboard through /dev/clipboard. Run cygstart to open an arbitrary file through its registered application. Access the Windows registry with regtool. Note that a C:\ Windows drive path becomes /cygdrive/c under Cygwin, and that Cygwinâ€™s / appears under C:\cygwin on Windows. Convert between Cygwin and Windows-style file paths with cygpath. This is most useful in scripts that invoke Windows programs. You can perform and script most Windows system administration tasks from the command line by learning and using wmic. Another option to get Unix look and feel under Windows is Cash. Note that only very few Unix commands and command-line options are available in this environment. An alternative option to get GNU developer tools (such as GCC) on Windows is MinGW and its MSYS package, which provides utilities such as bash, gawk, make and grep. MSYS doesnâ€™t have all the features compared to Cygwin. MinGW is particularly useful for creating native Windows ports of Unix tools. More resources awesome-shell: A curated list of shell tools and resources. awesome-osx-command-line: A more in-depth guide for the OS X command line. Strict mode for writing better shell scripts. shellcheck: A shell script static analysis tool. Essentially, lint for bash/sh/zsh. Filenames and Pathnames in Shell: The sadly complex minutiae on how to handle filenames correctly in shell scripts. Data Science at the Command Line: More commands and tools helpful for doing data science, from the book of the same name DisclaimerWith the exception of very small tasks, code is written so others can read it. With power comes responsibility. The fact you can do something in Bash doesnâ€™t necessarily mean you should! ;) License This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Linux IOæ¨¡å¼åŠ selectã€pollã€epollè¯¦è§£ï¼ˆè½¬ï¼‰]]></title>
      <url>%2F2017%2F04%2F22%2Flinux-IO-select-poll-epoll%2F</url>
      <content type="text"><![CDATA[è½¬è‡ªhttps://segmentfault.com/a/1190000003063859 æ¦‚å¿µè¯´æ˜Žåœ¨è¿›è¡Œè§£é‡Šä¹‹å‰ï¼Œé¦–å…ˆè¦è¯´æ˜Žå‡ ä¸ªæ¦‚å¿µï¼š ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ è¿›ç¨‹åˆ‡æ¢ è¿›ç¨‹çš„é˜»å¡ž æ–‡ä»¶æè¿°ç¬¦ ç¼“å­˜ I/O ç”¨æˆ·ç©ºé—´ä¸Žå†…æ ¸ç©ºé—´çŽ°åœ¨æ“ä½œç³»ç»Ÿéƒ½æ˜¯é‡‡ç”¨è™šæ‹Ÿå­˜å‚¨å™¨ï¼Œé‚£ä¹ˆå¯¹32ä½æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå®ƒçš„å¯»å€ç©ºé—´ï¼ˆè™šæ‹Ÿå­˜å‚¨ç©ºé—´ï¼‰ä¸º4Gï¼ˆ2çš„32æ¬¡æ–¹ï¼‰ã€‚æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å†…æ ¸ï¼Œç‹¬ç«‹äºŽæ™®é€šçš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥è®¿é—®å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚ç¡¬ä»¶è®¾å¤‡çš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†ä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æŽ¥æ“ä½œå†…æ ¸ï¼ˆkernelï¼‰ï¼Œä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œæ“å¿ƒç³»ç»Ÿå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºå†…æ ¸ç©ºé—´ï¼Œä¸€éƒ¨åˆ†ä¸ºç”¨æˆ·ç©ºé—´ã€‚é’ˆå¯¹linuxæ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œå°†æœ€é«˜çš„1Gå­—èŠ‚ï¼ˆä»Žè™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œä¾›å†…æ ¸ä½¿ç”¨ï¼Œç§°ä¸ºå†…æ ¸ç©ºé—´ï¼Œè€Œå°†è¾ƒä½Žçš„3Gå­—èŠ‚ï¼ˆä»Žè™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ï¼Œä¾›å„ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œç§°ä¸ºç”¨æˆ·ç©ºé—´ã€‚ è¿›ç¨‹åˆ‡æ¢ä¸ºäº†æŽ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸Žå†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚ ä»Žä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚ æ›´æ–°PCBä¿¡æ¯ã€‚ æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡žç­‰é˜Ÿåˆ—ã€‚ é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCBã€‚ æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æž„ã€‚ æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡ã€‚ æ³¨ï¼šæ€»è€Œè¨€ä¹‹å°±æ˜¯å¾ˆè€—èµ„æºï¼Œå…·ä½“çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šè¿›ç¨‹åˆ‡æ¢ è¿›ç¨‹çš„é˜»å¡žæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œç”±äºŽæœŸå¾…çš„æŸäº›äº‹ä»¶æœªå‘ç”Ÿï¼Œå¦‚è¯·æ±‚ç³»ç»Ÿèµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œçš„å®Œæˆã€æ–°æ•°æ®å°šæœªåˆ°è¾¾æˆ–æ— æ–°å·¥ä½œåšç­‰ï¼Œåˆ™ç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡žåŽŸè¯­(Block)ï¼Œä½¿è‡ªå·±ç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºé˜»å¡žçŠ¶æ€ã€‚å¯è§ï¼Œè¿›ç¨‹çš„é˜»å¡žæ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œä¹Ÿå› æ­¤åªæœ‰å¤„äºŽè¿è¡Œæ€çš„è¿›ç¨‹ï¼ˆèŽ·å¾—CPUï¼‰ï¼Œæ‰å¯èƒ½å°†å…¶è½¬ä¸ºé˜»å¡žçŠ¶æ€ã€‚å½“è¿›ç¨‹è¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œæ˜¯ä¸å ç”¨CPUèµ„æºçš„ã€‚ æ–‡ä»¶æè¿°ç¬¦fdæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile descriptorï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªç”¨äºŽè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µã€‚ æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéžè´Ÿæ•´æ•°ã€‚å®žé™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªçŽ°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›žä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºŽUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚ ç¼“å­˜ I/Oç¼“å­˜ I/O åˆè¢«ç§°ä½œæ ‡å‡† I/Oï¼Œå¤§å¤šæ•°æ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤ I/O æ“ä½œéƒ½æ˜¯ç¼“å­˜ I/Oã€‚åœ¨ Linux çš„ç¼“å­˜ I/O æœºåˆ¶ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† I/O çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆ page cache ï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åŽæ‰ä¼šä»Žæ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚ ç¼“å­˜ I/O çš„ç¼ºç‚¹ï¼šæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­éœ€è¦åœ¨åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´å’Œå†…æ ¸è¿›è¡Œå¤šæ¬¡æ•°æ®æ‹·è´æ“ä½œï¼Œè¿™äº›æ•°æ®æ‹·è´æ“ä½œæ‰€å¸¦æ¥çš„ CPU ä»¥åŠå†…å­˜å¼€é”€æ˜¯éžå¸¸å¤§çš„ã€‚ IOæ¨¡å¼åˆšæ‰è¯´äº†ï¼Œå¯¹äºŽä¸€æ¬¡IOè®¿é—®ï¼ˆä»¥readä¸¾ä¾‹ï¼‰ï¼Œæ•°æ®ä¼šå…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­ï¼Œç„¶åŽæ‰ä¼šä»Žæ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ã€‚æ‰€ä»¥è¯´ï¼Œå½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»åŽ†ä¸¤ä¸ªé˜¶æ®µï¼š ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready) å°†æ•°æ®ä»Žå†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process) æ­£å¼å› ä¸ºè¿™ä¸¤ä¸ªé˜¶æ®µï¼Œlinuxç³»ç»Ÿäº§ç”Ÿäº†ä¸‹é¢äº”ç§ç½‘ç»œæ¨¡å¼çš„æ–¹æ¡ˆã€‚ é˜»å¡ž I/Oï¼ˆblocking IOï¼‰ éžé˜»å¡ž I/Oï¼ˆnonblocking IOï¼‰ I/O å¤šè·¯å¤ç”¨ï¼ˆ IO multiplexingï¼‰ ä¿¡å·é©±åŠ¨ I/Oï¼ˆ signal driven IOï¼‰ å¼‚æ­¥ I/Oï¼ˆasynchronous IOï¼‰ æ³¨ï¼šç”±äºŽsignal driven IOåœ¨å®žé™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥æˆ‘è¿™åªæåŠå‰©ä¸‹çš„å››ç§IO Modelã€‚ é˜»å¡ž I/Oï¼ˆblocking IOï¼‰åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingï¼Œä¸€ä¸ªå…¸åž‹çš„è¯»æ“ä½œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ï¼ˆå¯¹äºŽç½‘ç»œIOæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚æ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ã€‚è¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®è¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºä¸­æ˜¯éœ€è¦ä¸€ä¸ªè¿‡ç¨‹çš„ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡žï¼ˆå½“ç„¶ï¼Œæ˜¯è¿›ç¨‹è‡ªå·±é€‰æ‹©çš„é˜»å¡žï¼‰ã€‚å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»Žkernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åŽkernelè¿”å›žç»“æžœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚ æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚ éžé˜»å¡ž I/Oï¼ˆnonblocking IOï¼‰linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š å½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æžœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›žä¸€ä¸ªerrorã€‚ä»Žç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåŽï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æžœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æžœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼ŒäºŽæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åŽè¿”å›žã€‚ æ‰€ä»¥ï¼Œnonblocking IOçš„ç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿›ç¨‹éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚ I/O å¤šè·¯å¤ç”¨ï¼ˆIO multiplexingï¼‰IO multiplexingå°±æ˜¯æˆ‘ä»¬è¯´çš„selectï¼Œpollï¼Œepollï¼Œæœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚select/epollçš„å¥½å¤„å°±åœ¨äºŽå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿žæŽ¥çš„IOã€‚å®ƒçš„åŸºæœ¬åŽŸç†å°±æ˜¯selectï¼Œpollï¼Œepollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚ å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›žã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»Žkernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚ æ‰€ä»¥ï¼ŒI/O å¤šè·¯å¤ç”¨çš„ç‰¹ç‚¹æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ä¸€ä¸ªè¿›ç¨‹èƒ½åŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œè¿™äº›æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¥—æŽ¥å­—æè¿°ç¬¦ï¼‰å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¿›å…¥è¯»å°±ç»ªçŠ¶æ€ï¼Œselect()å‡½æ•°å°±å¯ä»¥è¿”å›žã€‚ è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®žå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®žä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºŽå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚ æ‰€ä»¥ï¼Œå¦‚æžœå¤„ç†çš„è¿žæŽ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºŽå•ä¸ªè¿žæŽ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºŽèƒ½å¤„ç†æ›´å¤šçš„è¿žæŽ¥ã€‚ï¼‰ åœ¨IO multiplexing Modelä¸­ï¼Œå®žé™…ä¸­ï¼Œå¯¹äºŽæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®žæ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚ å¼‚æ­¥ I/Oï¼ˆasynchronous IOï¼‰Linuxä¸‹çš„asynchronous IOå…¶å®žç”¨å¾—å¾ˆå°‘ã€‚å…ˆçœ‹ä¸€ä¸‹å®ƒçš„æµç¨‹ï¼š ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åŽï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹åŽ»åšå…¶å®ƒçš„äº‹ã€‚è€Œå¦ä¸€æ–¹é¢ï¼Œä»Žkernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åŽï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›žï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åŽï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åŽå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åŽï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚ æ€»ç»“blockingå’Œnon-blockingçš„åŒºåˆ«è°ƒç”¨blocking IOä¼šä¸€ç›´blockä½å¯¹åº”çš„è¿›ç¨‹ç›´åˆ°æ“ä½œå®Œæˆï¼Œè€Œnon-blocking IOåœ¨kernelè¿˜å‡†å¤‡æ•°æ®çš„æƒ…å†µä¸‹ä¼šç«‹åˆ»è¿”å›žã€‚ synchronous IOå’Œasynchronous IOçš„åŒºåˆ«åœ¨è¯´æ˜Žsynchronous IOå’Œasynchronous IOçš„åŒºåˆ«ä¹‹å‰ï¼Œéœ€è¦å…ˆç»™å‡ºä¸¤è€…çš„å®šä¹‰ã€‚POSIXçš„å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes; An asynchronous I/O operation does not cause the requesting process to be blocked; ä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºŽsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡žã€‚æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œä¹‹å‰æ‰€è¿°çš„blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±žäºŽsynchronous IOã€‚ æœ‰äººä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéžå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®žçš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„recvfromè¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œrecvfromè¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æžœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»Žkernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚ è€Œasynchronous IOåˆ™ä¸ä¸€æ ·ï¼Œå½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åŽï¼Œå°±ç›´æŽ¥è¿”å›žå†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚ å„ä¸ªIO Modelçš„æ¯”è¾ƒå¦‚å›¾æ‰€ç¤ºï¼š é€šè¿‡ä¸Šé¢çš„å›¾ç‰‡ï¼Œå¯ä»¥å‘çŽ°non-blocking IOå’Œasynchronous IOçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜Žæ˜¾çš„ã€‚åœ¨non-blocking IOä¸­ï¼Œè™½ç„¶è¿›ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸ä¼šè¢«blockï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ±‚è¿›ç¨‹åŽ»ä¸»åŠ¨çš„checkï¼Œå¹¶ä¸”å½“æ•°æ®å‡†å¤‡å®Œæˆä»¥åŽï¼Œä¹Ÿéœ€è¦è¿›ç¨‹ä¸»åŠ¨çš„å†æ¬¡è°ƒç”¨recvfromæ¥å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚è€Œasynchronous IOåˆ™å®Œå…¨ä¸åŒã€‚å®ƒå°±åƒæ˜¯ç”¨æˆ·è¿›ç¨‹å°†æ•´ä¸ªIOæ“ä½œäº¤ç»™äº†ä»–äººï¼ˆkernelï¼‰å®Œæˆï¼Œç„¶åŽä»–äººåšå®ŒåŽå‘ä¿¡å·é€šçŸ¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦åŽ»æ£€æŸ¥IOæ“ä½œçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸»åŠ¨çš„åŽ»æ‹·è´æ•°æ®ã€‚ I/O å¤šè·¯å¤ç”¨ä¹‹selectã€pollã€epollè¯¦è§£selectï¼Œpollï¼Œepolléƒ½æ˜¯IOå¤šè·¯å¤ç”¨çš„æœºåˆ¶ã€‚I/Oå¤šè·¯å¤ç”¨å°±æ˜¯é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ä½†selectï¼Œpollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåŽè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡žçš„ï¼Œè€Œå¼‚æ­¥I/Oåˆ™æ— éœ€è‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œå¼‚æ­¥I/Oçš„å®žçŽ°ä¼šè´Ÿè´£æŠŠæ•°æ®ä»Žå†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚ï¼ˆè¿™é‡Œå•°å—¦ä¸‹ï¼‰ select1int select (int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout); select å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åŽselectå‡½æ•°ä¼šé˜»å¡žï¼Œç›´åˆ°æœ‰æè¿°å‰¯å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æžœç«‹å³è¿”å›žè®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›žã€‚å½“selectå‡½æ•°è¿”å›žåŽï¼Œå¯ä»¥ é€šè¿‡éåŽ†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚ selectç›®å‰å‡ ä¹Žåœ¨æ‰€æœ‰çš„å¹³å°ä¸Šæ”¯æŒï¼Œå…¶è‰¯å¥½è·¨å¹³å°æ”¯æŒä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªä¼˜ç‚¹ã€‚selectçš„ä¸€ ä¸ªç¼ºç‚¹åœ¨äºŽå•ä¸ªè¿›ç¨‹èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œåœ¨Linuxä¸Šä¸€èˆ¬ä¸º1024ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰ç”šè‡³é‡æ–°ç¼–è¯‘å†…æ ¸çš„æ–¹å¼æå‡è¿™ä¸€é™åˆ¶ï¼Œä½† æ˜¯è¿™æ ·ä¹Ÿä¼šé€ æˆæ•ˆçŽ‡çš„é™ä½Žã€‚ poll1int poll (struct pollfd *fds, unsigned int nfds, int timeout); ä¸åŒä¸Žselectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ª pollfdçš„æŒ‡é’ˆå®žçŽ°ã€‚ 12345struct pollfd &#123; int fd; /* file descriptor */ short events; /* requested events to watch */ short revents; /* returned events witnessed */&#125;; pollfdç»“æž„åŒ…å«äº†è¦ç›‘è§†çš„eventå’Œå‘ç”Ÿçš„eventï¼Œä¸å†ä½¿ç”¨selectâ€œå‚æ•°-å€¼â€ä¼ é€’çš„æ–¹å¼ã€‚åŒæ—¶ï¼Œpollfdå¹¶æ²¡æœ‰æœ€å¤§æ•°é‡é™åˆ¶ï¼ˆä½†æ˜¯æ•°é‡è¿‡å¤§åŽæ€§èƒ½ä¹Ÿæ˜¯ä¼šä¸‹é™ï¼‰ã€‚ å’Œselectå‡½æ•°ä¸€æ ·ï¼Œpollè¿”å›žåŽï¼Œéœ€è¦è½®è¯¢pollfdæ¥èŽ·å–å°±ç»ªçš„æè¿°ç¬¦ã€‚ ä»Žä¸Šé¢çœ‹ï¼Œselectå’Œpolléƒ½éœ€è¦åœ¨è¿”å›žåŽï¼Œé€šè¿‡éåŽ†æ–‡ä»¶æè¿°ç¬¦æ¥èŽ·å–å·²ç»å°±ç»ªçš„socketã€‚äº‹å®žä¸Šï¼ŒåŒæ—¶è¿žæŽ¥çš„å¤§é‡å®¢æˆ·ç«¯åœ¨ä¸€æ—¶åˆ»å¯èƒ½åªæœ‰å¾ˆå°‘çš„å¤„äºŽå°±ç»ªçŠ¶æ€ï¼Œå› æ­¤éšç€ç›‘è§†çš„æè¿°ç¬¦æ•°é‡çš„å¢žé•¿ï¼Œå…¶æ•ˆçŽ‡ä¹Ÿä¼šçº¿æ€§ä¸‹é™ã€‚ epollepollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢žå¼ºç‰ˆæœ¬ã€‚ç›¸å¯¹äºŽselectå’Œpollæ¥è¯´ï¼Œepollæ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epollä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„copyåªéœ€ä¸€æ¬¡ã€‚ epollæ“ä½œè¿‡ç¨‹epollæ“ä½œè¿‡ç¨‹éœ€è¦ä¸‰ä¸ªæŽ¥å£ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š 123int epoll_create(int size)ï¼›//åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout); int epoll_create(int size);å‡½æ•°åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§ï¼Œè¿™ä¸ªå‚æ•°ä¸åŒäºŽselect()ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç»™å‡ºæœ€å¤§ç›‘å¬çš„fd+1çš„å€¼ï¼Œå‚æ•°sizeå¹¶ä¸æ˜¯é™åˆ¶äº†epollæ‰€èƒ½ç›‘å¬çš„æè¿°ç¬¦æœ€å¤§ä¸ªæ•°ï¼Œåªæ˜¯å¯¹å†…æ ¸åˆå§‹åˆ†é…å†…éƒ¨æ•°æ®ç»“æž„çš„ä¸€ä¸ªå»ºè®®ã€‚å½“åˆ›å»ºå¥½epollå¥æŸ„åŽï¼Œå®ƒå°±ä¼šå ç”¨ä¸€ä¸ªfdå€¼ï¼Œåœ¨linuxä¸‹å¦‚æžœæŸ¥çœ‹/proc/è¿›ç¨‹id/fd/ï¼Œæ˜¯èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªfdçš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®ŒepollåŽï¼Œå¿…é¡»è°ƒç”¨close()å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´fdè¢«è€—å°½ã€‚ int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);å‡½æ•°æ˜¯å¯¹æŒ‡å®šæè¿°ç¬¦fdæ‰§è¡Œopæ“ä½œã€‚ epfdï¼šæ˜¯epoll_create()çš„è¿”å›žå€¼ã€‚ opï¼šè¡¨ç¤ºopæ“ä½œï¼Œç”¨ä¸‰ä¸ªå®æ¥è¡¨ç¤ºï¼šæ·»åŠ EPOLL_CTL_ADDï¼Œåˆ é™¤EPOLL_CTL_DELï¼Œä¿®æ”¹EPOLL_CTL_MODã€‚åˆ†åˆ«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å¯¹fdçš„ç›‘å¬äº‹ä»¶ã€‚ fdï¼šæ˜¯éœ€è¦ç›‘å¬çš„fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ epoll_eventï¼šæ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹ï¼Œstruct epoll_eventç»“æž„å¦‚ä¸‹ï¼š 12345678910111213struct epoll_event &#123; __uint32_t events; /* Epoll events */ epoll_data_t data; /* User data variable */&#125;;//eventså¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆï¼šEPOLLIN ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­ï¼‰ï¼›EPOLLOUTï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™ï¼›EPOLLPRIï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰ï¼›EPOLLERRï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ï¼›EPOLLHUPï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ï¼›EPOLLETï¼š å°†EPOLLè®¾ä¸ºè¾¹ç¼˜è§¦å‘(Edge Triggered)æ¨¡å¼ï¼Œè¿™æ˜¯ç›¸å¯¹äºŽæ°´å¹³è§¦å‘(Level Triggered)æ¥è¯´çš„ã€‚EPOLLONESHOTï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åŽï¼Œå¦‚æžœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œ int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);å‡½æ•°ç­‰å¾…epfdä¸Šçš„ioäº‹ä»¶ï¼Œæœ€å¤šè¿”å›žmaxeventsä¸ªäº‹ä»¶ã€‚å‚æ•°eventsç”¨æ¥ä»Žå†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºŽåˆ›å»ºepoll_create()æ—¶çš„sizeï¼Œå‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ0ä¼šç«‹å³è¿”å›žï¼Œ-1å°†ä¸ç¡®å®šï¼Œä¹Ÿæœ‰è¯´æ³•è¯´æ˜¯æ°¸ä¹…é˜»å¡žï¼‰ã€‚è¯¥å‡½æ•°è¿”å›žéœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›ž0è¡¨ç¤ºå·²è¶…æ—¶ã€‚ å·¥ä½œæ¨¡å¼epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆlevel triggerï¼‰å’ŒETï¼ˆedge triggerï¼‰ã€‚LTæ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼ŒLTæ¨¡å¼ä¸ŽETæ¨¡å¼çš„åŒºåˆ«å¦‚ä¸‹ï¼šLTæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ETæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æžœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚ LTæ¨¡å¼LT(level triggered)æ˜¯ç¼ºçœçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒblockå’Œno-block socket.åœ¨è¿™ç§åšæ³•ä¸­ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åŽä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„fdè¿›è¡ŒIOæ“ä½œã€‚å¦‚æžœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ã€‚ ETæ¨¡å¼ET(edge-triggered)æ˜¯é«˜é€Ÿå·¥ä½œæ–¹å¼ï¼Œåªæ”¯æŒno-block socketã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»Žæœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡epollå‘Šè¯‰ä½ ã€‚ç„¶åŽå®ƒä¼šå‡è®¾ä½ çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªï¼Œå¹¶ä¸”ä¸ä¼šå†ä¸ºé‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘é€æ›´å¤šçš„å°±ç»ªé€šçŸ¥ï¼Œç›´åˆ°ä½ åšäº†æŸäº›æ“ä½œå¯¼è‡´é‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸å†ä¸ºå°±ç»ªçŠ¶æ€äº†(æ¯”å¦‚ï¼Œä½ åœ¨å‘é€ï¼ŒæŽ¥æ”¶æˆ–è€…æŽ¥æ”¶è¯·æ±‚ï¼Œæˆ–è€…å‘é€æŽ¥æ”¶çš„æ•°æ®å°‘äºŽä¸€å®šé‡æ—¶å¯¼è‡´äº†ä¸€ä¸ªEWOULDBLOCK é”™è¯¯ï¼‰ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æžœä¸€ç›´ä¸å¯¹è¿™ä¸ªfdä½œIOæ“ä½œ(ä»Žè€Œå¯¼è‡´å®ƒå†æ¬¡å˜æˆæœªå°±ç»ª)ï¼Œå†…æ ¸ä¸ä¼šå‘é€æ›´å¤šçš„é€šçŸ¥(only once) ETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆçŽ‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚epollå·¥ä½œåœ¨ETæ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éžé˜»å¡žå¥—æŽ¥å£ï¼Œä»¥é¿å…ç”±äºŽä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡žè¯»/é˜»å¡žå†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚ æ€»ç»“å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š æˆ‘ä»¬å·²ç»æŠŠä¸€ä¸ªç”¨æ¥ä»Žç®¡é“ä¸­è¯»å–æ•°æ®çš„æ–‡ä»¶å¥æŸ„(RFD)æ·»åŠ åˆ°epollæè¿°ç¬¦ è¿™ä¸ªæ—¶å€™ä»Žç®¡é“çš„å¦ä¸€ç«¯è¢«å†™å…¥äº†2KBçš„æ•°æ® è°ƒç”¨epoll_wait(2)ï¼Œå¹¶ä¸”å®ƒä¼šè¿”å›žRFDï¼Œè¯´æ˜Žå®ƒå·²ç»å‡†å¤‡å¥½è¯»å–æ“ä½œ ç„¶åŽæˆ‘ä»¬è¯»å–äº†1KBçš„æ•°æ® è°ƒç”¨epoll_wait(2)â€¦â€¦ LTæ¨¡å¼ï¼šå¦‚æžœæ˜¯LTæ¨¡å¼ï¼Œé‚£ä¹ˆåœ¨ç¬¬5æ­¥è°ƒç”¨epoll_wait(2)ä¹‹åŽï¼Œä»ç„¶èƒ½å—åˆ°é€šçŸ¥ã€‚ ETæ¨¡å¼ï¼šå¦‚æžœæˆ‘ä»¬åœ¨ç¬¬1æ­¥å°†RFDæ·»åŠ åˆ°epollæè¿°ç¬¦çš„æ—¶å€™ä½¿ç”¨äº†EPOLLETæ ‡å¿—ï¼Œé‚£ä¹ˆåœ¨ç¬¬5æ­¥è°ƒç”¨epoll_wait(2)ä¹‹åŽå°†æœ‰å¯èƒ½ä¼šæŒ‚èµ·ï¼Œå› ä¸ºå‰©ä½™çš„æ•°æ®è¿˜å­˜åœ¨äºŽæ–‡ä»¶çš„è¾“å…¥ç¼“å†²åŒºå†…ï¼Œè€Œä¸”æ•°æ®å‘å‡ºç«¯è¿˜åœ¨ç­‰å¾…ä¸€ä¸ªé’ˆå¯¹å·²ç»å‘å‡ºæ•°æ®çš„åé¦ˆä¿¡æ¯ã€‚åªæœ‰åœ¨ç›‘è§†çš„æ–‡ä»¶å¥æŸ„ä¸Šå‘ç”Ÿäº†æŸä¸ªäº‹ä»¶çš„æ—¶å€™ ET å·¥ä½œæ¨¡å¼æ‰ä¼šæ±‡æŠ¥äº‹ä»¶ã€‚å› æ­¤åœ¨ç¬¬5æ­¥çš„æ—¶å€™ï¼Œè°ƒç”¨è€…å¯èƒ½ä¼šæ”¾å¼ƒç­‰å¾…ä»åœ¨å­˜åœ¨äºŽæ–‡ä»¶è¾“å…¥ç¼“å†²åŒºå†…çš„å‰©ä½™æ•°æ®ã€‚ å½“ä½¿ç”¨epollçš„ETæ¨¡åž‹æ¥å·¥ä½œæ—¶ï¼Œå½“äº§ç”Ÿäº†ä¸€ä¸ªEPOLLINäº‹ä»¶åŽï¼Œ è¯»æ•°æ®çš„æ—¶å€™éœ€è¦è€ƒè™‘çš„æ˜¯å½“recv()è¿”å›žçš„å¤§å°å¦‚æžœç­‰äºŽè¯·æ±‚çš„å¤§å°ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ç¼“å†²åŒºè¿˜æœ‰æ•°æ®æœªè¯»å®Œï¼Œä¹Ÿæ„å‘³ç€è¯¥æ¬¡äº‹ä»¶è¿˜æ²¡æœ‰å¤„ç†å®Œï¼Œæ‰€ä»¥è¿˜éœ€è¦å†æ¬¡è¯»å–ï¼š 1234567891011121314151617181920212223while(rs)&#123; buflen = recv(activeevents[i].data.fd, buf, sizeof(buf), 0); if(buflen &lt; 0)&#123; // ç”±äºŽæ˜¯éžé˜»å¡žçš„æ¨¡å¼,æ‰€ä»¥å½“errnoä¸ºEAGAINæ—¶,è¡¨ç¤ºå½“å‰ç¼“å†²åŒºå·²æ— æ•°æ®å¯è¯» // åœ¨è¿™é‡Œå°±å½“ä½œæ˜¯è¯¥æ¬¡äº‹ä»¶å·²å¤„ç†å¤„. if(errno == EAGAIN)&#123; break; &#125; else&#123; return; &#125; &#125; else if(buflen == 0)&#123; // è¿™é‡Œè¡¨ç¤ºå¯¹ç«¯çš„socketå·²æ­£å¸¸å…³é—­. &#125; if(buflen == sizeof(buf)&#123; rs = 1; // éœ€è¦å†æ¬¡è¯»å– &#125; else&#123; rs = 0; &#125;&#125; Linuxä¸­çš„EAGAINå«ä¹‰ LinuxçŽ¯å¢ƒä¸‹å¼€å‘ç»å¸¸ä¼šç¢°åˆ°å¾ˆå¤šé”™è¯¯(è®¾ç½®errno)ï¼Œå…¶ä¸­EAGAINæ˜¯å…¶ä¸­æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªé”™è¯¯(æ¯”å¦‚ç”¨åœ¨éžé˜»å¡žæ“ä½œä¸­)ã€‚ ä»Žå­—é¢ä¸Šæ¥çœ‹ï¼Œæ˜¯æç¤ºå†è¯•ä¸€æ¬¡ã€‚è¿™ä¸ªé”™è¯¯ç»å¸¸å‡ºçŽ°åœ¨å½“åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›éžé˜»å¡ž(non-blocking)æ“ä½œ(å¯¹æ–‡ä»¶æˆ–socket)çš„æ—¶å€™ã€‚ ä¾‹å¦‚ï¼Œä»¥ O_NONBLOCKçš„æ ‡å¿—æ‰“å¼€æ–‡ä»¶/socket/FIFOï¼Œå¦‚æžœä½ è¿žç»­åšreadæ“ä½œè€Œæ²¡æœ‰æ•°æ®å¯è¯»ã€‚æ­¤æ—¶ç¨‹åºä¸ä¼šé˜»å¡žèµ·æ¥ç­‰å¾…æ•°æ®å‡†å¤‡å°±ç»ªè¿”å›žï¼Œreadå‡½æ•°ä¼šè¿”å›žä¸€ä¸ªé”™è¯¯EAGAINï¼Œæç¤ºä½ çš„åº”ç”¨ç¨‹åºçŽ°åœ¨æ²¡æœ‰æ•°æ®å¯è¯»è¯·ç¨åŽå†è¯•ã€‚ åˆä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨(æ¯”å¦‚fork)å› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„èµ„æº(æ¯”å¦‚è™šæ‹Ÿå†…å­˜)è€Œæ‰§è¡Œå¤±è´¥ï¼Œè¿”å›žEAGAINæç¤ºå…¶å†è°ƒç”¨ä¸€æ¬¡(ä¹Ÿè®¸ä¸‹æ¬¡å°±èƒ½æˆåŠŸ)ã€‚ ä»£ç æ¼”ç¤º123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#define IPADDRESS &quot;127.0.0.1&quot;#define PORT 8787#define MAXSIZE 1024#define LISTENQ 5#define FDSIZE 1000#define EPOLLEVENTS 100listenfd = socket_bind(IPADDRESS,PORT);struct epoll_event events[EPOLLEVENTS];//åˆ›å»ºä¸€ä¸ªæè¿°ç¬¦epollfd = epoll_create(FDSIZE);//æ·»åŠ ç›‘å¬æè¿°ç¬¦äº‹ä»¶add_event(epollfd,listenfd,EPOLLIN);//å¾ªçŽ¯ç­‰å¾…for ( ; ; )&#123; //è¯¥å‡½æ•°è¿”å›žå·²ç»å‡†å¤‡å¥½çš„æè¿°ç¬¦äº‹ä»¶æ•°ç›® ret = epoll_wait(epollfd,events,EPOLLEVENTS,-1); //å¤„ç†æŽ¥æ”¶åˆ°çš„è¿žæŽ¥ handle_events(epollfd,events,ret,listenfd,buf);&#125;//äº‹ä»¶å¤„ç†å‡½æ•°static void handle_events(int epollfd,struct epoll_event *events,int num,int listenfd,char *buf)&#123; int i; int fd; //è¿›è¡ŒéåŽ†;è¿™é‡Œåªè¦éåŽ†å·²ç»å‡†å¤‡å¥½çš„ioäº‹ä»¶ã€‚numå¹¶ä¸æ˜¯å½“åˆepoll_createæ—¶çš„FDSIZEã€‚ for (i = 0;i &lt; num;i++) &#123; fd = events[i].data.fd; //æ ¹æ®æè¿°ç¬¦çš„ç±»åž‹å’Œäº‹ä»¶ç±»åž‹è¿›è¡Œå¤„ç† if ((fd == listenfd) &amp;&amp;(events[i].events &amp; EPOLLIN)) handle_accpet(epollfd,listenfd); else if (events[i].events &amp; EPOLLIN) do_read(epollfd,fd,buf); else if (events[i].events &amp; EPOLLOUT) do_write(epollfd,fd,buf); &#125;&#125;//æ·»åŠ äº‹ä»¶static void add_event(int epollfd,int fd,int state)&#123; struct epoll_event ev; ev.events = state; ev.data.fd = fd; epoll_ctl(epollfd,EPOLL_CTL_ADD,fd,&amp;ev);&#125;//å¤„ç†æŽ¥æ”¶åˆ°çš„è¿žæŽ¥static void handle_accpet(int epollfd,int listenfd)&#123; int clifd; struct sockaddr_in cliaddr; socklen_t cliaddrlen; clifd = accept(listenfd,(struct sockaddr*)&amp;cliaddr,&amp;cliaddrlen); if (clifd == -1) perror(&quot;accpet error:&quot;); else &#123; printf(&quot;accept a new client: %s:%d\n&quot;,inet_ntoa(cliaddr.sin_addr),cliaddr.sin_port); //æ·»åŠ ä¸€ä¸ªå®¢æˆ·æè¿°ç¬¦å’Œäº‹ä»¶ add_event(epollfd,clifd,EPOLLIN); &#125; &#125;//è¯»å¤„ç†static void do_read(int epollfd,int fd,char *buf)&#123; int nread; nread = read(fd,buf,MAXSIZE); if (nread == -1) &#123; perror(&quot;read error:&quot;); close(fd); //è®°ä½close fd delete_event(epollfd,fd,EPOLLIN); //åˆ é™¤ç›‘å¬ &#125; else if (nread == 0) &#123; fprintf(stderr,&quot;client close.\n&quot;); close(fd); //è®°ä½close fd delete_event(epollfd,fd,EPOLLIN); //åˆ é™¤ç›‘å¬ &#125; else &#123; printf(&quot;read message is : %s&quot;,buf); //ä¿®æ”¹æè¿°ç¬¦å¯¹åº”çš„äº‹ä»¶ï¼Œç”±è¯»æ”¹ä¸ºå†™ modify_event(epollfd,fd,EPOLLOUT); &#125; &#125;//å†™å¤„ç†static void do_write(int epollfd,int fd,char *buf) &#123; int nwrite; nwrite = write(fd,buf,strlen(buf)); if (nwrite == -1)&#123; perror(&quot;write error:&quot;); close(fd); //è®°ä½close fd delete_event(epollfd,fd,EPOLLOUT); //åˆ é™¤ç›‘å¬ &#125;else&#123; modify_event(epollfd,fd,EPOLLIN); &#125; memset(buf,0,MAXSIZE); &#125;//åˆ é™¤äº‹ä»¶static void delete_event(int epollfd,int fd,int state) &#123; struct epoll_event ev; ev.events = state; ev.data.fd = fd; epoll_ctl(epollfd,EPOLL_CTL_DEL,fd,&amp;ev);&#125;//ä¿®æ”¹äº‹ä»¶static void modify_event(int epollfd,int fd,int state)&#123; struct epoll_event ev; ev.events = state; ev.data.fd = fd; epoll_ctl(epollfd,EPOLL_CTL_MOD,fd,&amp;ev);&#125;//æ³¨ï¼šå¦å¤–ä¸€ç«¯æˆ‘å°±çœäº† epollæ€»ç»“åœ¨ select/pollä¸­ï¼Œè¿›ç¨‹åªæœ‰åœ¨è°ƒç”¨ä¸€å®šçš„æ–¹æ³•åŽï¼Œå†…æ ¸æ‰å¯¹æ‰€æœ‰ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ‰«æï¼Œè€Œepolläº‹å…ˆé€šè¿‡epoll_ctl()æ¥æ³¨å†Œä¸€ ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä¸€æ—¦åŸºäºŽæŸä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªæ—¶ï¼Œå†…æ ¸ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›žè°ƒæœºåˆ¶ï¼Œè¿…é€Ÿæ¿€æ´»è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå½“è¿›ç¨‹è°ƒç”¨epoll_wait() æ—¶ä¾¿å¾—åˆ°é€šçŸ¥ã€‚(æ­¤å¤„åŽ»æŽ‰äº†éåŽ†æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯é€šè¿‡ç›‘å¬å›žè°ƒçš„çš„æœºåˆ¶ã€‚è¿™æ­£æ˜¯epollçš„é­…åŠ›æ‰€åœ¨ã€‚) epollçš„ä¼˜ç‚¹ä¸»è¦æ˜¯ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š ç›‘è§†çš„æè¿°ç¬¦æ•°é‡ä¸å—é™åˆ¶ï¼Œå®ƒæ‰€æ”¯æŒçš„FDä¸Šé™æ˜¯æœ€å¤§å¯ä»¥æ‰“å¼€æ–‡ä»¶çš„æ•°ç›®ï¼Œè¿™ä¸ªæ•°å­—ä¸€èˆ¬è¿œå¤§äºŽ2048,ä¸¾ä¸ªä¾‹å­,åœ¨1GBå†…å­˜çš„æœºå™¨ä¸Šå¤§çº¦æ˜¯10ä¸‡å·¦ å³ï¼Œå…·ä½“æ•°ç›®å¯ä»¥cat /proc/sys/fs/file-maxå¯Ÿçœ‹,ä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ•°ç›®å’Œç³»ç»Ÿå†…å­˜å…³ç³»å¾ˆå¤§ã€‚selectçš„æœ€å¤§ç¼ºç‚¹å°±æ˜¯è¿›ç¨‹æ‰“å¼€çš„fdæ˜¯æœ‰æ•°é‡é™åˆ¶çš„ã€‚è¿™å¯¹ äºŽè¿žæŽ¥æ•°é‡æ¯”è¾ƒå¤§çš„æœåŠ¡å™¨æ¥è¯´æ ¹æœ¬ä¸èƒ½æ»¡è¶³ã€‚è™½ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å¤šè¿›ç¨‹çš„è§£å†³æ–¹æ¡ˆ( Apacheå°±æ˜¯è¿™æ ·å®žçŽ°çš„)ï¼Œä¸è¿‡è™½ç„¶linuxä¸Šé¢åˆ›å»ºè¿›ç¨‹çš„ä»£ä»·æ¯”è¾ƒå°ï¼Œä½†ä»æ—§æ˜¯ä¸å¯å¿½è§†çš„ï¼ŒåŠ ä¸Šè¿›ç¨‹é—´æ•°æ®åŒæ­¥è¿œæ¯”ä¸ä¸Šçº¿ç¨‹é—´åŒæ­¥çš„é«˜æ•ˆï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯ä¸€ç§å®Œç¾Žçš„æ–¹æ¡ˆã€‚ IOçš„æ•ˆçŽ‡ä¸ä¼šéšç€ç›‘è§†fdçš„æ•°é‡çš„å¢žé•¿è€Œä¸‹é™ã€‚epollä¸åŒäºŽselectå’Œpollè½®è¯¢çš„æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡æ¯ä¸ªfdå®šä¹‰çš„å›žè°ƒå‡½æ•°æ¥å®žçŽ°çš„ã€‚åªæœ‰å°±ç»ªçš„fdæ‰ä¼šæ‰§è¡Œå›žè°ƒå‡½æ•°ã€‚ å¦‚æžœæ²¡æœ‰å¤§é‡çš„idle -connectionæˆ–è€…dead-connectionï¼Œepollçš„æ•ˆçŽ‡å¹¶ä¸ä¼šæ¯”select/pollé«˜å¾ˆå¤šï¼Œä½†æ˜¯å½“é‡åˆ°å¤§é‡çš„idle- connectionï¼Œå°±ä¼šå‘çŽ°epollçš„æ•ˆçŽ‡å¤§å¤§é«˜äºŽselect/pollã€‚ å‚è€ƒç”¨æˆ·ç©ºé—´ä¸Žå†…æ ¸ç©ºé—´ï¼Œè¿›ç¨‹ä¸Šä¸‹æ–‡ä¸Žä¸­æ–­ä¸Šä¸‹æ–‡è¿›ç¨‹åˆ‡æ¢ç»´åŸºç™¾ç§‘-æ–‡ä»¶æè¿°ç¬¦Linux ä¸­ç›´æŽ¥ I/O æœºåˆ¶çš„ä»‹ç»IO - åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡žï¼Œéžé˜»å¡žï¼ˆäº¡ç¾Šè¡¥ç‰¢ç¯‡ï¼‰Linuxä¸­select pollå’Œepollçš„åŒºåˆ«IOå¤šè·¯å¤ç”¨ä¹‹selectæ€»ç»“IOå¤šè·¯å¤ç”¨ä¹‹pollæ€»ç»“IOå¤šè·¯å¤ç”¨ä¹‹epollæ€»ç»“]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[å¸¸ç”¨å“ˆå¸Œå‡½æ•°]]></title>
      <url>%2F2017%2F04%2F22%2Fhash-functions%2F</url>
      <content type="text"><![CDATA[SDBM Hash123456789101112unsigned int SDBMHash(char *str)&#123; unsigned int hash = 0; while (*str) &#123; // equivalent to: hash = 65599*hash + (*str++); hash = (*str++) + (hash &lt;&lt; 6) + (hash &lt;&lt; 16) - hash; &#125; return (hash &amp; 0x7FFFFFFF);&#125; RS Hash1234567891011121314unsigned int RSHash(char *str)&#123; unsigned int b = 378551; unsigned int a = 63689; unsigned int hash = 0; while (*str) &#123; hash = hash * a + (*str++); a *= b; &#125; return (hash &amp; 0x7FFFFFFF);&#125; JS Hash1234567891011unsigned int JSHash(char *str)&#123; unsigned int hash = 1315423911; while (*str) &#123; hash ^= ((hash &lt;&lt; 5) + (*str++) + (hash &gt;&gt; 2)); &#125; return (hash &amp; 0x7FFFFFFF);&#125; P. J. Weinberger Hash123456789101112131415161718192021unsigned int PJWHash(char *str)&#123; unsigned int BitsInUnignedInt = (unsigned int)(sizeof(unsigned int) * 8); unsigned int ThreeQuarters = (unsigned int)((BitsInUnignedInt * 3) / 4); unsigned int OneEighth = (unsigned int)(BitsInUnignedInt / 8); unsigned int HighBits = (unsigned int)(0xFFFFFFFF) &lt;&lt; (BitsInUnignedInt - OneEighth); unsigned int hash = 0; unsigned int test = 0; while (*str) &#123; hash = (hash &lt;&lt; OneEighth) + (*str++); if ((test = hash &amp; HighBits) != 0) &#123; hash = ((hash ^ (test &gt;&gt; ThreeQuarters)) &amp; (~HighBits)); &#125; &#125; return (hash &amp; 0x7FFFFFFF);&#125; ELF Hash1234567891011121314151617unsigned int ELFHash(char *str)&#123; unsigned int hash = 0; unsigned int x = 0; while (*str) &#123; hash = (hash &lt;&lt; 4) + (*str++); if ((x = hash &amp; 0xF0000000L) != 0) &#123; hash ^= (x &gt;&gt; 24); hash &amp;= ~x; &#125; &#125; return (hash &amp; 0x7FFFFFFF);&#125; BKDR Hash123456789101112unsigned int BKDRHash(char *str)&#123; unsigned int seed = 131; // 31 131 1313 13131 131313 etc.. unsigned int hash = 0; while (*str) &#123; hash = hash * seed + (*str++); &#125; return (hash &amp; 0x7FFFFFFF);&#125; DJB Hash1234567891011unsigned int DJBHash(char *str)&#123; unsigned int hash = 5381; while (*str) &#123; hash += (hash &lt;&lt; 5) + (*str++); &#125; return (hash &amp; 0x7FFFFFFF);&#125; AP Hash12345678910111213141516171819unsigned int APHash(char *str)&#123; unsigned int hash = 0; int i; for (i=0; *str; i++) &#123; if ((i &amp; 1) == 0) &#123; hash ^= ((hash &lt;&lt; 7) ^ (*str++) ^ (hash &gt;&gt; 3)); &#125; else &#123; hash ^= (~((hash &lt;&lt; 11) ^ (*str++) ^ (hash &gt;&gt; 5))); &#125; &#125; return (hash &amp; 0x7FFFFFFF);&#125;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 108 [Convert Sorted Array to Binary Search Tree]]]></title>
      <url>%2F2017%2F04%2F01%2Fleetcode-108%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Convert Sorted Array to Binary Search Tree é¢˜ç›®æè¿° ç»™å®šä¸€ä¸ªç”±å°åˆ°å¤§æŽ’å¥½åºçš„æ•°ç»„ï¼Œè¦æ±‚å°†æ¯ä¸ªæ•°ç»„çš„å€¼ä½œä¸ºä¸€ä¸ªç»“ç‚¹çš„å€¼ï¼Œå°†ç»“ç‚¹æž„å»ºæˆä¸€æ£µå¹³è¡¡çš„äºŒå‰æŽ’åºæ ‘ã€‚ è§£é¢˜æ€è·¯ å¦‚æžœäºŒå‰æ ‘æ˜¯å¹³è¡¡çš„ï¼Œåˆ™å®ƒçš„ä»»æ„ä¸€ä¸ªç»“ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„é«˜åº¦å·®ä¸è¶…è¿‡1 æ•°ç»„æ˜¯ç”±å°åˆ°å¤§æœ‰åºçš„ï¼Œå¯ä»¥è€ƒè™‘ç”¨äºŒåˆ†æ³•æ‰¾åˆ°ä¸­é—´å…ƒç´ ä½œä¸ºæ ¹ç»“ç‚¹çš„å€¼ï¼Œå†æŠŠæ ¹ç»“ç‚¹çš„å·¦å³ä¸¤è¾¹çœ‹æˆä¸¤ä¸ªå­æ•°ç»„ï¼Œå·¦å­æ•°ç»„çš„å…ƒç´ éƒ½æ¯”æ ¹ç»“ç‚¹çš„å€¼å°ï¼Œå³å­æ•°ç»„çš„å…ƒç´ éƒ½æ¯”æ ¹ç»“ç‚¹çš„å€¼å¤§ã€‚è‹¥åŽŸæ•°ç»„çš„å…ƒç´ ä¸ªæ•°æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆæ ¹ç»“ç‚¹çš„å€¼åˆšå¥½æ˜¯ä½äºŽä¸­é—´çš„å…ƒç´ ï¼Œå·¦å³å­æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ç›¸åŒï¼›è‹¥åŽŸæ•°ç»„çš„å…ƒç´ ä¸ªæ•°æ˜¯å¶æ•°ï¼Œé‚£ä¹ˆæ ¹ç»“ç‚¹çš„å€¼åˆ™æ˜¯ä¸­é—´åå·¦çš„å…ƒç´ æˆ–ä¸­é—´åå³çš„å…ƒç´ ï¼Œå·¦å³å­æ•°ç»„çš„å…ƒç´ ä¸ªæ•°å·®å€¼ä¸º1ã€‚ç»§ç»­å¯¹å·¦å³å­æ•°ç»„è¿›è¡Œé€’å½’å¤„ç†ï¼Œç›´åˆ°ä¸èƒ½å†åˆ’åˆ† ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ€åŽä¸€å±‚å¾—åˆ°æ ‘å¿…ç„¶æ˜¯å¹³è¡¡çš„ï¼Œæ ¹ç»“ç‚¹çš„çˆ¶ç»“ç‚¹å¯¹åº”çš„æ ‘ä¹Ÿæ˜¯å¹³è¡¡çš„ï¼Œè¿›è€Œå¯ä»¥æŽ¨æ–­å‡ºæœ€ç»ˆæž„å»ºå‡ºæ¥çš„äºŒå‰æ ‘æ˜¯äºŒå‰å¹³è¡¡æ ‘ã€‚å¦å¤–ï¼Œåœ¨æ¯æ¬¡æž„å»ºè¿‡ç¨‹ä¸­éƒ½å¯ä»¥ä¿è¯å·¦å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½æ¯”æ ¹ç»“ç‚¹å°ï¼Œå³å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½æ¯”æ ¹ç»“ç‚¹å¤§ï¼Œå› æ­¤æœ€ç»ˆæž„å»ºå‡ºæ¥çš„äºŒå‰æ ‘æ˜¯äºŒå‰æŽ’åºæ ‘ è‹¥åŽŸæ•°ç»„å…ƒç´ ä¸ªæ•°ä¸ºnï¼Œåˆ™å¤„ç†è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n) C++ä»£ç 12345678910111213141516171819202122232425262728/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: TreeNode* sortedArrayToBST(vector&lt;int&gt;&amp; nums) &#123; return convert(nums, 0, nums.size() - 1); &#125; TreeNode* convert(vector&lt;int&gt;&amp; nums, int begin, int end) &#123; if (begin &gt; end) &#123; return NULL; &#125; if (begin == end) &#123; return new TreeNode(nums[begin]); &#125; int mid = ((begin + end) &gt;&gt; 1); TreeNode* node = new TreeNode(nums[mid]); node-&gt;left = convert(nums, begin, mid - 1); node-&gt;right = convert(nums, mid + 1, end); return node; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 117 [Populating Next Right Pointers in Each Node II]]]></title>
      <url>%2F2017%2F04%2F01%2Fleetcode-117%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Populating Next Right Pointers in Each Node II é¢˜ç›®æè¿° ç»™å®šä¸€é¢—äºŒå‰æ ‘ï¼Œè¦æ±‚å°†æ¯ä¸ªç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å®ƒå³ä¾§çš„ç»“ç‚¹ï¼Œè‹¥å®ƒå³ä¾§æ²¡æœ‰ç»“ç‚¹ï¼Œåˆ™æŒ‡å‘NULLï¼Œå¤„ç†è¿‡ç¨‹åªèƒ½ä½¿ç”¨å¸¸é‡å¤æ‚åº¦çš„ç©ºé—´ã€‚ è§£é¢˜æ€è·¯ æœ¬é¢˜ä¸Žé¢˜ç›®116ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºŽç»™å®šçš„äºŒå‰æ ‘æ˜¯æ™®é€šçš„ï¼Œé™¤äº†äºŒå‰æ ‘çš„åŸºæœ¬ç‰¹å¾ä¹‹å¤–ï¼Œæ²¡æœ‰å…¶ä»–å¯ä»¥åˆ©ç”¨çš„ç‰¹ç‚¹ è‹¥ä¸é™åˆ¶ä½¿ç”¨çš„ç©ºé—´çš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡éåŽ†ï¼ŒæŠŠæ¯ä¸€å±‚æœ€è¿‘ä¸€æ¬¡è¢«è®¿é—®çš„ç»“ç‚¹è®°å½•ä¸‹æ¥ï¼Œæ¯æ¬¡è®¿é—®åˆ°åŒä¸€å±‚çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œå°±æŠŠè®°å½•çš„åŒå±‚çš„ç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å½“å‰ç»“ç‚¹ï¼Œå†æŠŠå½“å‰ç»“ç‚¹ä½œä¸ºæœ¬å±‚æœ€è¿‘ä¸€æ¬¡è¢«è®¿é—®çš„ç»“ç‚¹è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·éåŽ†å®Œä¹‹åŽnextæŒ‡é’ˆä¹Ÿå°±æž„å»ºå®Œæ¯•äº† å¯¹äºŽé™åˆ¶ç©ºé—´å¤æ‚åº¦çš„æ¡ä»¶ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡æ—¶é—´æ¢ç©ºé—´çš„æ–¹å¼æ¥è§£å†³ã€‚è§£å†³çš„æ–¹å¼æ˜¯æ¯ä¸€æ¬¡éåŽ†ï¼Œç›®æ ‡ä»…é’ˆå¯¹ç‰¹å®šæŸä¸€å±‚çš„ç»“ç‚¹ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š å‡å¦‚æ ¹ç»“ç‚¹æ·±åº¦ä¸º0ï¼Œå¶ç»“ç‚¹æœ€æ·±çš„æ·±åº¦ä¸ºhï¼Œåœ¨è¿›è¡Œæ¯ä¸€è½®éåŽ†ä¹‹å‰ï¼Œå°†è¾…åŠ©è®°å½•æœ¬å±‚ä¸Šä¸€æ¬¡è®¿é—®çš„ç»“ç‚¹çš„æŒ‡é’ˆç½®ä¸ºNULL è¿›è¡Œä¸€è½®éåŽ†æ—¶ï¼Œä»Žæ ¹ç»“ç‚¹å¼€å§‹ï¼Œè‹¥å½“å‰ç»“ç‚¹çš„æ·±åº¦ä¸Žæœ¬æ¬¡éåŽ†çš„ç›®æ ‡å±‚çš„æ·±åº¦ä¸€è‡´ï¼Œåˆ™å¯¹åº”æ›´æ–°nextæŒ‡é’ˆä¸Žè¾…åŠ©æŒ‡é’ˆï¼Œå¯¹äºŽæ·±åº¦è¶…è¿‡ç›®æ ‡çš„ç»“ç‚¹ä¸éœ€è¦éåŽ† æ¯ä¸€è½®éåŽ†ç»“æŸä¹‹åŽï¼Œè‹¥è¾…åŠ©æŒ‡é’ˆä¸ä¸ºNULLï¼Œè¯´æ˜Žéœ€è¦ç»§ç»­ä¸‹ä¸€è½®éåŽ† ç»è¿‡hè½®éåŽ†ä¹‹åŽï¼ŒnextæŒ‡é’ˆå³æž„å»ºå®Œæ¯• å‡è®¾äºŒå‰æ ‘é«˜åº¦ä¸ºhï¼Œåˆ™å¤„ç†è¿‡ç¨‹å¯¹æ ‘éåŽ†äº†hè½®ï¼Œè®¾ 0 &lt; i &lt;= hï¼Œåˆ™ç¬¬iè½®æœ€å¤šéåŽ† sum(2^0 + 2^1 + â€¦ + 2^(i-1)) ä¸ªç»“ç‚¹ï¼Œç¬¬iè½®éåŽ†çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(2^i)ï¼Œå› æ­¤æœ€ç»ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(h * 2^h) C++ä»£ç 1234567891011121314151617181920212223242526272829303132333435/** * Definition for binary tree with next pointer. * struct TreeLinkNode &#123; * int val; * TreeLinkNode *left, *right, *next; * TreeLinkNode(int x) : val(x), left(NULL), right(NULL), next(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: void travel(TreeLinkNode* node, int height, TreeLinkNode** lastNode, int level) &#123; if (!node) &#123; return; &#125; if (height == level) &#123; if (*lastNode) &#123; (*lastNode)-&gt;next = node; &#125; *lastNode = node; return; &#125; travel(node-&gt;left, height + 1, lastNode, level); travel(node-&gt;right, height + 1, lastNode, level); &#125; void connect(TreeLinkNode *root) &#123; TreeLinkNode* lastNode = NULL; int level = 0; do &#123; lastNode = NULL; travel(root, 0, &amp;lastNode, level); level++; &#125; while (lastNode); &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 116 [Populating Next Right Pointers in Each Node]]]></title>
      <url>%2F2017%2F04%2F01%2Fleetcode-116%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Populating Next Right Pointers in Each Node é¢˜ç›®æè¿° ç»™å®šä¸€é¢—å®Œç¾ŽäºŒå‰æ ‘ï¼Œè¦æ±‚å°†æ¯ä¸ªç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å®ƒå³ä¾§çš„ç»“ç‚¹ï¼Œè‹¥å®ƒå³ä¾§æ²¡æœ‰ç»“ç‚¹ï¼Œåˆ™æŒ‡å‘NULLï¼Œå¤„ç†è¿‡ç¨‹åªèƒ½ä½¿ç”¨å¸¸é‡å¤æ‚åº¦çš„ç©ºé—´ã€‚ è§£é¢˜æ€è·¯ å¯¹äºŽä»»æ„ä¸¤ä¸ªåœ¨å®Œç¾ŽäºŒå‰æ ‘ä¸Šå·¦å³ç›¸é‚»çš„ç»“ç‚¹ï¼Œå®ƒä»¬å¿…å®šæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªè§„åˆ™ä¹‹ä¸€ï¼š å®ƒä»¬æœ‰åŒä¸€ä¸ªçˆ¶ç»“ç‚¹ï¼Œå³ä»»æ„ä¸€ä¸ªç»“ç‚¹çš„å·¦å³å­ç»“ç‚¹å¿…ç„¶æ˜¯ç›¸é‚»çš„ ä¸¤ä¸ªç»“ç‚¹çš„çˆ¶ç»“ç‚¹ç›¸é‚»ï¼Œå¹¶ä¸”ä½äºŽå·¦ä¾§çš„ç»“ç‚¹æ˜¯å®ƒçš„çˆ¶ç»“ç‚¹çš„å³å­ç»“ç‚¹ï¼Œä½äºŽå³ä¾§çš„ç»“ç‚¹æ˜¯å®ƒçš„çˆ¶ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ æ—¢ç„¶ç¡®å®šäº†å·¦å³ç›¸é‚»çš„ç»“ç‚¹çš„ç‰¹å¾ï¼Œé‚£ä¹ˆåªéœ€è¦ä»Žæ ¹ç»“ç‚¹å¼€å§‹éåŽ†æ ‘çš„æ‰€æœ‰ç»“ç‚¹å¹¶å¯¹åº”å¤„ç†å³å¯ï¼Œå¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š å¯¹äºŽæ¯ä¸ªç»“ç‚¹ï¼Œè‹¥å·¦å­ç»“ç‚¹å­˜åœ¨ï¼Œé‚£ä¹ˆå³å­ç»“ç‚¹ä¹Ÿå¿…ç„¶å­˜åœ¨ï¼Œåˆ™å°†å·¦å­ç»“ç‚¹çš„nextæŒ‡é’ˆæŒ‡å‘å³å­ç»“ç‚¹ å¯¹äºŽæ¯ä¸ªç»“ç‚¹ï¼Œè‹¥å®ƒçš„å·¦å­ç»“ç‚¹ä¹Ÿå­˜åœ¨å³å­ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒçš„å³å­ç»“ç‚¹ä¹Ÿå­˜åœ¨å·¦å­ç»“ç‚¹ï¼Œåˆ™å°†å®ƒçš„å·¦å­ç»“ç‚¹çš„å³å­ç»“ç‚¹çš„nextæŒ‡é’ˆï¼ŒæŒ‡å‘å®ƒçš„å³å­ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ å¤„ç†è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç»“ç‚¹éƒ½è¢«éåŽ†äº†ä¸€æ¬¡ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦æ˜¯O(n) C++ä»£ç 1234567891011121314151617181920/** * Definition for binary tree with next pointer. * struct TreeLinkNode &#123; * int val; * TreeLinkNode *left, *right, *next; * TreeLinkNode(int x) : val(x), left(NULL), right(NULL), next(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: void connect(TreeLinkNode *root) &#123; if (!root) return; if (root-&gt;next &amp;&amp; root-&gt;right) root-&gt;right-&gt;next = root-&gt;next-&gt;left; if (root-&gt;left) &#123; root-&gt;left-&gt;next = root-&gt;right; connect(root-&gt;left); connect(root-&gt;right); &#125; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 95 [Unique Binary Search Trees II]]]></title>
      <url>%2F2017%2F04%2F01%2Fleetcode-95%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Unique Binary Search Trees II é¢˜ç›®æè¿° ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œè¦æ±‚è¿”å›žæ‰€æœ‰ç”±å€¼ä¸º1-nçš„ç»“ç‚¹ç»„æˆçš„äºŒå‰æŽ’åºæ ‘ã€‚ è§£é¢˜æ€è·¯ é¦–å…ˆéœ€è¦è€ƒè™‘nçš„å–å€¼ï¼Œè‹¥å–å€¼ä¸å¤§äºŽ0ï¼Œåˆ™ä¸ä¼šå½¢æˆä»»ä½•äºŒå‰æ ‘ å¯¹äºŽn&gt;0çš„æƒ…å†µï¼Œå¯ä»¥ç”¨åˆ†æ²»çš„æ€æƒ³æ¥å¤„ç†ï¼Œæ¯ä¸ªç»“ç‚¹è½®æµä½œä¸ºæ ¹ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒçš„å·¦å­æ ‘å°±æ˜¯ç”±æ‰€æœ‰æ¯”è¯¥ç»“ç‚¹çš„å€¼å°çš„å…¶ä»–ç»“ç‚¹æž„æˆçš„ï¼Œå®ƒçš„å³å­æ ‘å°±æ˜¯ç”±æ‰€æœ‰æ¯”è¯¥ç»“ç‚¹å¤§çš„å€¼æž„æˆçš„ å¯¹äºŽå·¦å­æ ‘ä¸Žå³å­æ ‘ï¼Œåˆå¯ä»¥è½®æµä»¥æŸä¸ªç»“ç‚¹ä½œä¸ºæ ¹ç»“ç‚¹ï¼Œä¸€ç›´åˆ°æ— æ³•å†åˆ†ä¸ºæ­¢ ç”±äºŽå·¦å­æ ‘å¯èƒ½æœ‰aç§å½¢å¼ï¼Œå³å­æ ‘ä¹Ÿå¯èƒ½æœ‰bç§å½¢å¼ï¼Œæ‰€ä»¥ä»¥æŸä¸ªç»“ç‚¹ä¸ºæ ¹çš„æ ‘çš„é›†åˆå…¶å®žéœ€è¦å¯¹å·¦å³å­æ ‘çš„æƒ…å†µè¿›è¡Œä¸€ä¸€åŒ¹é…ï¼Œæœ€ç»ˆå¯ä»¥å¾—å‡ºa*bç§å½¢å¼ éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ç§æƒ…å†µï¼Œå­æ ‘ä¸ºç©ºæˆ–è€…ä»…æœ‰ä¸€ä¸ªç»“ç‚¹ï¼Œè¿™ä¸¤ç§æƒ…å†µå®žè´¨éƒ½åŒ…å«äº†ä¸€ç§å½¢å¼ï¼Œéœ€è¦åŒç­‰è€ƒè™‘ æ¯æ¬¡ä»¥æŸä¸ªç»“ç‚¹ä¸ºæ ¹è¿›è¡Œè®¡ç®—ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ï¼Œå¯¹nä¸ªç»“ç‚¹è¿›è¡Œè®¡ç®—ï¼Œæ—¶é—´å¤æ‚åº¦å³ä¸ºO(n * log n) C++ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: vector&lt;TreeNode*&gt; generateTrees(int n) &#123; vector&lt;TreeNode*&gt; result; if (n &lt; 1) &#123; return result; &#125; return generateTreesOfRange(1, n); &#125; vector&lt;TreeNode*&gt; generateTreesOfRange(int beg, int end) &#123; vector&lt;TreeNode*&gt; result; if (beg &gt; end) &#123; result.push_back(NULL); return result; &#125; for (int i = beg; i &lt;= end; ++i) &#123; vector&lt;TreeNode*&gt; leftTrees = generateTreesOfRange(beg, i - 1); vector&lt;TreeNode*&gt; rightTrees = generateTreesOfRange(i + 1, end); for (int j = 0; j &lt; leftTrees.size(); ++j) &#123; for (int k = 0; k &lt; rightTrees.size(); ++k) &#123; TreeNode* root = new TreeNode(i); root-&gt;left = leftTrees[j]; root-&gt;right = rightTrees[k]; result.push_back(root); &#125; &#125; &#125; return result; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 113 [Path Sum II]]]></title>
      <url>%2F2017%2F03%2F29%2Fleetcode-113%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Path Sum II é¢˜ç›®æè¿° ç»™å®šä¸€æ£µäºŒå‰æ ‘ä¸Žä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¦æ±‚æŸ¥æ‰¾å‡ºæ‰€æœ‰ä»Žæ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯å¾„ï¼Œè¿™äº›è·¯å¾„ä¸Šçš„æ‰€æœ‰ç»“ç‚¹çš„å’Œç­‰äºŽç»™å®šçš„å€¼ã€‚ è§£é¢˜æ€è·¯ é¢˜ç›®é»˜è®¤æ¡ä»¶ ä¸éœ€è¦è€ƒè™‘å­è·¯å¾„ç»“ç‚¹çš„å’Œå¯èƒ½æº¢å‡ºçš„æƒ…å†µ æœ¬é¢˜ä¸»è¦å…³æ³¨ç‚¹åœ¨äºŽä¸‰ä¸ªæ–¹é¢ å¦‚ä½•åˆ¤æ–­æŸä¸ªç»“ç‚¹æ˜¯ä¸æ˜¯å¶å­ç»“ç‚¹ å¦‚æžœè¯¥ç»“ç‚¹æ²¡æœ‰å·¦å­ç»“ç‚¹ä¸Žå³å­ç»“ç‚¹ï¼Œåˆ™è¯¥ç»“ç‚¹æ˜¯å¶å­ç»“ç‚¹ï¼Œæ ¹ç»“ç‚¹ä¹Ÿå¯èƒ½æ˜¯å¶å­ç»“ç‚¹ è‹¥é‡‡ç”¨é€’å½’çš„æ–¹å¼ï¼Œå¦‚ä½•å‡å°‘å†…å­˜ç©ºé—´çš„ä½¿ç”¨ å­˜æ”¾ä¸´æ—¶è·¯å¾„çš„vectorï¼Œåœ¨æ•´ä¸ªéåŽ†è¿‡ç¨‹éƒ½ä½¿ç”¨å¼•ç”¨æ¥ä¼ é€’è¯¥ä¸´æ—¶è·¯å¾„ï¼Œæ¯ä¸ªç»“ç‚¹å¤„ç†ä¹‹åŽéœ€è¦æ¸…ç†å¯¹è¯¥è·¯å¾„çš„å˜æ›´ å­˜æ”¾ç»“æžœçš„vectorï¼Œåœ¨æ•´ä¸ªéåŽ†è¿‡ç¨‹ä¸­åŒæ ·ä½¿ç”¨å¼•ç”¨æ¥ä¼ é€’ å¦‚ä½•åˆ¤æ–­æŸæ¡è·¯å¾„æ»¡è¶³æ¡ä»¶ åœ¨éåŽ†è¿‡ç¨‹ä¸­ï¼Œç”¨ä¸€ä¸ªå˜é‡å®žæ—¶è®°å½•ä¸´æ—¶è·¯å¾„çš„å€¼ï¼Œè‹¥æŸä¸ªç»“ç‚¹æ˜¯å¶å­ç»“ç‚¹ï¼Œå¹¶ä¸”è¯¥å˜é‡çš„å€¼ä¸Žç»™å®šå€¼ç›¸ç­‰ï¼Œåˆ™å½“å‰çš„ä¸´æ—¶è·¯å¾„æ»¡è¶³æ¡ä»¶ï¼Œå¯åŠ å…¥å­˜æ”¾ç»“æžœçš„vectorä¸­ C++ä»£ç 12345678910111213141516171819202122232425262728293031323334353637/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: vector&lt;vector&lt;int&gt;&gt; pathSum(TreeNode* root, int sum) &#123; vector&lt;vector&lt;int&gt;&gt; result; vector&lt;int&gt; subPath; if (root) &#123; calculatePathSum(root, sum, subPath, 0, result); &#125; return result; &#125; void calculatePathSum(TreeNode* node, int sum, vector&lt;int&gt;&amp; subPath, int subSum, vector&lt;vector&lt;int&gt;&gt;&amp; result) &#123; subPath.push_back(node-&gt;val); subSum += node-&gt;val; if (!node-&gt;left &amp;&amp; !node-&gt;right) &#123; if (sum == subSum) &#123; result.push_back(subPath); &#125; &#125; if (node-&gt;left) &#123; calculatePathSum(node-&gt;left, sum, subPath, subSum, result); &#125; if (node-&gt;right) &#123; calculatePathSum(node-&gt;right, sum, subPath, subSum, result); &#125; subSum -= node-&gt;val; subPath.pop_back(); &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 538 [Convert BST to Greater Tree]]]></title>
      <url>%2F2017%2F03%2F29%2Fleetcode-538%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Convert BST to Greater Tree é¢˜ç›®æè¿° ç»™å®šä¸€é¢—äºŒå‰æŽ’åºæ ‘ï¼Œå¯¹äºŽæ¯ä¸ªç»“ç‚¹ï¼Œè¦æ±‚è®¡ç®—å‡ºæ‰€æœ‰æ¯”å®ƒçš„å€¼å¤§çš„ç»“ç‚¹çš„å€¼çš„å’Œï¼Œå¹¶ä¸”å°†è¿™ä¸ªè®¡ç®—å‡ºæ¥çš„å’ŒåŠ åˆ°è¯¥ç»“ç‚¹ä¸Šé¢ã€‚ è§£é¢˜æ€è·¯ é¦–å…ˆéœ€è¦ç¡®å®šå¦‚ä½•æ‰¾åˆ°æ‰€æœ‰æ¯”æŸä¸ªç»“ç‚¹çš„å€¼å¤§çš„å…¶ä»–æ‰€æœ‰ç»“ç‚¹ã€‚åœ¨äºŒå‰æŽ’åºæ ‘ä¸­ï¼Œçˆ¶ç»“ç‚¹çš„å€¼æ€»æ˜¯å¤§äºŽå·¦å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼ï¼Œä¸”å°äºŽå³å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼ã€‚æ‰€ä»¥æ¯”æŸä¸ªç»“ç‚¹çš„å€¼å¤§çš„æ‰€æœ‰ç»“ç‚¹ï¼Œä¹Ÿå°±æ˜¯åœ¨å…ˆåºéåŽ†ä¸­ä½äºŽå®ƒä¹‹åŽçš„æ‰€æœ‰ç»“ç‚¹ã€‚ æœ¬é¢˜çš„è¦æ±‚æ˜¯å°†è¿™äº›ç»“ç‚¹çš„å€¼çš„å’ŒåŠ åˆ°è¯¥ç»“ç‚¹ä¸Šé¢ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦é€ä¸ªæŸ¥æ‰¾ç»“ç‚¹ï¼Œå†é€ä¸ªåŠ ä¸ŠåŽ»ï¼Œæ•´ä½“å¤„ç†å°±å¯ä»¥äº†ã€‚å¯¹äºŽæ¯ä¸ªç»“ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•çˆ¶ç»“ç‚¹ä¼ ä¸‹æ¥çš„å¢žé‡ï¼ˆç®€è¿°ä¸ºâ€œçˆ¶å¢žé‡â€ï¼‰ï¼Œå®ƒè‡ªèº«å˜æ›´å‰çš„å€¼ï¼ˆç®€è¿°ä¸ºâ€œåŽŸå€¼â€ï¼‰ï¼Œå·¦å­æ ‘æ‰€æœ‰ç»“ç‚¹å˜æ›´ä¹‹å‰çš„å€¼çš„å’Œï¼ˆç®€è¿°ä¸ºâ€œå·¦ä¾§æ€»å’Œâ€ï¼‰ï¼Œå³å­æ ‘æ‰€æœ‰ç»“ç‚¹å˜æ›´ä¹‹å‰çš„å€¼çš„å’Œï¼ˆç®€è¿°ä¸ºâ€œå³ä¾§æ€»å’Œâ€ï¼‰ï¼Œç„¶åŽå°†â€œåŽŸå€¼+å³ä¾§æ€»å’Œ+çˆ¶å¢žé‡â€ä½œä¸ºå¢žé‡åŠ åˆ°å·¦å­æ ‘çš„æ¯ä¸ªç»“ç‚¹ä¸Šé¢ï¼Œå°†â€œçˆ¶å¢žé‡â€ä½œä¸ºå¢žé‡åŠ åˆ°å³å­æ ‘çš„æ¯ä¸ªç»“ç‚¹ä¸Šï¼Œå†å°†â€œå³ä¾§æ€»å’Œ+çˆ¶å¢žé‡â€ä½œä¸ºå¢žé‡åŠ åˆ°è‡ªèº«ä¸Šé¢ã€‚å¤„ç†å·¦å³ç»“ç‚¹çš„æµç¨‹ä¸Žå…¶çˆ¶ç»“ç‚¹æ˜¯ä¸€è‡´çš„ï¼Œé€’å½’å¤„ç†å³å¯ã€‚ å˜æ›´ç»“ç‚¹çš„å€¼ä»¥åŠè®¡ç®—å½“å‰çš„æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼çš„æ€»å’Œï¼Œè¿™ä¸¤ä¸ªæµç¨‹å¯ä»¥åœ¨ä¸€æ¬¡éåŽ†ä¸­å®Œæˆï¼Œé€šè¿‡ä¸åŒçš„å˜é‡æ¥è®°å½•å˜æ›´å‰åŽçš„å€¼å³å¯ã€‚ C++ä»£ç 12345678910111213141516171819202122232425262728293031/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: TreeNode* convertBST(TreeNode* root) &#123; int rootOriginSum, rootNewSum; convertNode(root, rootOriginSum, 0, rootNewSum); return root; &#125; void convertNode(TreeNode* node, int&amp; originSum, int delta, int&amp; newSum) &#123; if (!node) &#123; originSum = 0; newSum = 0; return; &#125; int rightOriginSum, rightNewSum; convertNode(node-&gt;right, rightOriginSum, delta, rightNewSum); int leftOriginSum, leftNewSum; convertNode(node-&gt;left, leftOriginSum, delta + node-&gt;val + rightOriginSum, leftNewSum); originSum = node-&gt;val + leftOriginSum + rightOriginSum; node-&gt;val += delta + rightOriginSum; newSum = node-&gt;val + leftNewSum + rightNewSum; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 222 [Count Complete Tree Nodes]]]></title>
      <url>%2F2017%2F03%2F20%2Fleetcode-222%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Count Complete Tree Nodes é¢˜ç›®æè¿° ç»™å®šä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œè¦æ±‚è®¡ç®—å®ƒçš„æ€»ç»“ç‚¹æ•°ã€‚å®Œå…¨äºŒå‰æ ‘æŒ‡çš„æ˜¯é™¤äº†æœ€åŽä¸€å±‚ä¹‹å¤–ï¼Œå…¶ä»–æ¯ä¸€å±‚éƒ½æ˜¯å®Œæ•´çš„ï¼Œæœ€åŽä¸€å±‚å¯èƒ½ä¸æ˜¯å®Œæ•´çš„ï¼Œä½†æ˜¯è¿™ä¸€å±‚çš„ç»“ç‚¹å…¨éƒ¨èšé›†åœ¨å·¦ä¾§ï¼Œå› æ­¤å®Œå…¨äºŒå‰æ ‘çš„ç»“ç‚¹æ•°è½åœ¨(1ï¼Œ2^h)è¿™ä¸ªåŒºé—´å†…ã€‚ è§£é¢˜æ€è·¯ ä¸€å¼€å§‹æˆ‘ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼æ¥å¤„ç†ï¼Œå®Œå…¨äºŒå‰æ ‘æ˜¯ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œåªè¦æŠŠå®ƒçš„ç»“ç‚¹å…¨éƒ¨éåŽ†ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¾—åˆ°ç»“æžœï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç›´æŽ¥è¶…æ—¶äº† æŽ¥ç€æˆ‘æ”¹è¿›äº†è®¡ç®—æ–¹å¼ï¼Œä»Žæœ€å³ä¾§å¼€å§‹éåŽ†ï¼Œå½“å‘çŽ°æœ€åŽä¸€å±‚æŸä¸ªä½ç½®æœ‰ç»“ç‚¹çš„æ—¶å€™å°±åœæ­¢ã€‚è¿™ç§æ–¹æ³•åœ¨å¹³å‡æƒ…å†µä¸‹åªéœ€è¦éåŽ†ä¸€åŠçš„ç»“ç‚¹ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦è¿˜æ˜¯O(n)ï¼Œè¿˜æ˜¯è¶…æ—¶ æ—¶é—´å¤æ‚åº¦ä¸ºO(n)è¡Œä¸é€šï¼Œåªèƒ½è€ƒè™‘O(log n)çš„ç®—æ³•ï¼Œè€ŒO(log n)çš„æ—¶é—´å¤æ‚åº¦ä¸€èˆ¬å¯¹åº”ç€äºŒåˆ†æ³•ã€‚å¯¹äºŽè¿™ä¸ªé¢˜ç›®ï¼Œå¯ä»¥é€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾æœ€åŽä¸€å±‚çš„æœ€åŽä¸€ä¸ªç»“ç‚¹çš„ä½ç½®ï¼Œè¿›è€Œè®¡ç®—å‡ºæ€»ç»“ç‚¹æ•°ï¼Œå…·ä½“çš„ç®—æ³•å¦‚ä¸‹ï¼š é¦–å…ˆè®¡ç®—æ ‘çš„é«˜åº¦ï¼Œç”±æ ¹ç»“ç‚¹ä¸€ç›´å¾€å·¦åç§»ï¼Œè®¡ç®—åç§»æ¬¡æ•°å³å¯ï¼Œè¿™ä¸€æ­¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(log n) é™¤äº†æ ‘ä¸ºç©ºæˆ–è€…ä»…æœ‰æ ¹ç»“ç‚¹çš„æƒ…å†µï¼Œå®Œå…¨äºŒå‰æ ‘çš„å€’æ•°ç¬¬äºŒå±‚è‚¯å®šæ˜¯å®Œæ•´çš„ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å€’æ•°ç¬¬äºŒå±‚çš„ç»“ç‚¹æ¥åˆ¤æ–­æœ€åŽä¸€å±‚çš„ç»“ç‚¹çš„åˆ†å¸ƒæƒ…å†µ ä»Žæ ¹ç»“ç‚¹å¼€å§‹å¤„ç†ï¼Œä»¥å½“å‰ç»“ç‚¹ä¸ºä¸­é—´çº¿ï¼Œå°†ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„äºŒå‰æ ‘åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå–å€’æ•°ç¬¬äºŒå±‚ä¸­ï¼Œå·¦åŠéƒ¨åˆ†æœ€é è¿‘ä¸­é—´çº¿çš„ç»“ç‚¹ï¼Œå³ä¹‹å‰æè¿°çš„äºŒåˆ†çš„æ–¹å¼ã€‚è¿™ä¸ªå¤„äºŽâ€œäºŒåˆ†ä½ç½®åå·¦â€çš„ç»“ç‚¹ï¼Œç§°ä¹‹ä¸ºâ€œäºŒåˆ†ç»“ç‚¹â€ï¼Œå¿…ç„¶æ˜¯å½“å‰ç»“ç‚¹çš„å·¦å­æ ‘ï¼ˆä¸è€ƒè™‘åŽŸæ ‘æœ€åŽä¸€å±‚ï¼‰çš„æœ€å³è¾¹çš„ç»“ç‚¹ å¦‚æžœâ€œäºŒåˆ†ç»“ç‚¹â€æœ‰å³å­ç»“ç‚¹ï¼Œè¯´æ˜Žä¸Šè¿°çš„å·¦åŠéƒ¨åˆ†æ˜¯å®Œæ•´çš„ï¼Œç»§ç»­è€ƒè™‘å³åŠéƒ¨åˆ†ï¼Œå°†å½“å‰ç»“ç‚¹å‘å®ƒçš„å³ç»“ç‚¹åç§» å¦‚æžœâ€œäºŒåˆ†ç»“ç‚¹â€æ²¡æœ‰å³å­ç»“ç‚¹ï¼Œè¯´æ˜Žä¸Šè¿°çš„å·¦åŠéƒ¨åˆ†ä¸æ˜¯å®Œæ•´çš„ï¼Œå³åŠéƒ¨åˆ†æœ€åŽä¸€å±‚çš„ç»“ç‚¹å…¨éƒ¨ç¼ºå¤±ï¼Œè®°å½•å¯¹åº”çš„ç¼ºå¤±ç»“ç‚¹æ•°ä¹‹åŽï¼Œå°†å½“å‰ç»“ç‚¹å‘å®ƒçš„å·¦ç»“ç‚¹åç§» å¯¹æ–°çš„å½“å‰ç»“ç‚¹è¿›è¡Œå¤„ç†ï¼Œç›´åˆ°å½“å‰ç»“ç‚¹ä½äºŽå€’æ•°ç¬¬äºŒå±‚ï¼Œè¿™ç§æƒ…å†µä¸‹ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„æ ‘ï¼ˆä¸è€ƒè™‘åŽŸæ ‘æœ€åŽä¸€å±‚ï¼‰ä»…æœ‰ä¸€ä¸ªç»“ç‚¹ï¼Œæ— æ³•æ‹†åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œå› æ­¤ç›´æŽ¥æ ¹æ®å®ƒçš„å·¦å³å­ç»“ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œå¯¹åº”è®°å½•ç¼ºå¤±çš„ç»“ç‚¹æ•°å³å¯ å€’æ•°ç¬¬äºŒå±‚å¤„ç†å®Œä¹‹åŽï¼Œå¤„ç†æµç¨‹ç»“æŸï¼Œè®¡ç®—ç›¸åŒé«˜åº¦çš„æ»¡äºŒå‰æ ‘çš„ç»“ç‚¹æ•°ï¼Œç”¨å®ƒå‡åŽ»ç¼ºå¤±çš„ç»“ç‚¹æ•°ï¼Œå³ä¸ºæ‰€æ±‚çš„å®Œå…¨äºŒå‰æ ‘çš„ç»“ç‚¹æ•° C++ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */#include &lt;math&gt;class Solution &#123;public: int countNodes(TreeNode* root) &#123; // è®¡ç®—æ ‘çš„é«˜åº¦ int height = 0; TreeNode* tmp = root; while (tmp) &#123; height++; tmp = tmp-&gt;left; &#125; // è®°å½•ç¼ºå°‘çš„ç»“ç‚¹æ•° int numRightEmpty = 0; TreeNode* node = root; TreeNode* curNode; int level = 1; int curLevel; // ä»Žæ ¹ç»“ç‚¹å¼€å§‹éåŽ†ï¼Œç›´åˆ°å½“å‰ç»“ç‚¹ä¸ºç©ºï¼Œæˆ–è€…å·²éåŽ†åˆ°æœ€åŽä¸€å±‚ while (node &amp;&amp; level &lt; height) &#123; // å¦‚æžœå½“å‰ç»“ç‚¹ä½äºŽå€’æ•°ç¬¬äºŒå±‚ï¼Œåˆ™å¤„ç†å®Œå®ƒçš„å­ç»“ç‚¹çš„æƒ…å†µä¹‹åŽå³å¯ç»“æŸ if (level == height - 1) &#123; numRightEmpty += node-&gt;right ? 0 : node-&gt;left ? 1 : 2; break; &#125; // ä»¥å½“å‰ç»“ç‚¹ä½ç½®ä¸ºä¸­é—´çº¿ï¼ŒæŸ¥æ‰¾å€’æ•°ç¬¬äºŒå±‚é‡Œé¢ï¼Œä¸­é—´çº¿åå·¦çš„æœ€åŽä¸€ä¸ªå…ƒç´  // æŸ¥æ‰¾æ–¹æ³•ä¸ºå½“å‰ç»“ç‚¹å‘å·¦ä¸‹æ–¹åç§»ï¼Œå†ä¸€ç›´å‘å³ä¸‹æ–¹åç§»ï¼Œç›´åˆ°å€’æ•°ç¬¬äºŒå±‚ä¸ºæ­¢ curNode = node-&gt;left; curLevel = level + 1; while (curLevel &lt; height - 1) &#123; curNode = curNode-&gt;right; curLevel++; &#125; // å¦‚æžœä¸­é—´çº¿åå·¦çš„æœ€åŽä¸€ä¸ªå…ƒç´ æœ‰å³å­ç»“ç‚¹ï¼Œåˆ™éœ€è¦å°†å½“å‰ç»“ç‚¹é‡ç½®ä¸ºå®ƒçš„å³å­ç»“ç‚¹ // å¦‚æžœä¸­é—´çº¿åå·¦çš„æœ€åŽä¸€ä¸ªå…ƒç´ æ²¡æœ‰å³å­ç»“ç‚¹ï¼Œé‚£ä¹ˆè¯´æ˜Žå½“å‰ç»“ç‚¹ç¼ºå°‘äº†å³åŠè¾¹çš„å¶å­ç»“ç‚¹ï¼Œå¯¹åº”å¤„ç†ä¹‹åŽï¼Œå°†å½“å‰ç»“ç‚¹é‡ç½®ä¸ºå®ƒçš„å·¦å­ç»“ç‚¹ if (curNode-&gt;right) &#123; node = node-&gt;right; &#125; else &#123; numRightEmpty += (int)pow(2.0, (double)(height - level - 1)); node = node-&gt;left; &#125; level++; &#125; // æ€»çš„ç»“ç‚¹æ•°ä¸ºï¼ˆ2^h - 1 - ç¼ºå°‘çš„ç»“ç‚¹æ•°ï¼‰ return (int)pow(2.0, (double)(height)) - 1 - numRightEmpty; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 98 [Validate Binary Search Tree]]]></title>
      <url>%2F2017%2F03%2F19%2Fleetcode-98%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Validate Binary Search Tree é¢˜ç›®æè¿° åˆ¤æ–­ç»™å®šçš„äºŒå‰æ ‘æ˜¯ä¸æ˜¯äºŒå‰æŽ’åºæ ‘ï¼Œå‡å®šäºŒå‰æŽ’åºæ ‘æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š ä»»æ„ä¸€ä¸ªç»“ç‚¹çš„å·¦å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½æ¯”è¯¥ç»“ç‚¹å° ä»»æ„ä¸€ä¸ªç»“ç‚¹çš„å³å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½æ¯”è¯¥ç»“ç‚¹å¤§ å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æŽ’åºæ ‘ï¼ˆé€’å½’å®šä¹‰ï¼‰ è§£é¢˜æ€è·¯ æ ¹æ®äºŒå‰æŽ’åºæ ‘çš„å®šä¹‰ï¼Œä»Žæ ¹ç»“ç‚¹å‡ºå‘ï¼ŒéªŒè¯ä»¥æ¯ä¸€ä¸ªç»“ç‚¹ä¸ºæ ¹çš„æ ‘æ˜¯å¦æ»¡è¶³æ¡ä»¶ å¯¹æ¯ä¸€ä¸ªè¢«éåŽ†çš„ç»“ç‚¹ï¼Œè‹¥å·¦å­ç»“ç‚¹ä¸ä¸ºç©ºï¼Œåˆ™æŸ¥æ‰¾å·¦å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„æœ€å¤§å€¼ï¼Œè‹¥è¯¥å€¼ä¸å°äºŽå½“å‰ç»“ç‚¹çš„å€¼ï¼Œåˆ™è¯´æ˜Žå½“å‰æ ‘ä¸æ˜¯äºŒå‰æŽ’åºæ ‘ï¼Œå¦åˆ™ç»§ç»­æŸ¥æ‰¾å³å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„æœ€å°å€¼ï¼Œè‹¥è¯¥å€¼ä¸å¤§äºŽå½“å‰ç»“ç‚¹çš„å€¼ï¼Œåˆ™åŒæ ·è¯´æ˜Žå½“å‰æ ‘ä¸æ˜¯äºŒå‰æŽ’åºæ ‘ å®žé™…ä»£ç å®žçŽ°ä½¿ç”¨é€’å½’çš„æ–¹å¼ï¼Œæœ€å¤§å€¼è¢«åˆå§‹åŒ–ä¸ºæ•´åž‹çš„æœ€å°å€¼ï¼Œæœ€å°å€¼è¢«åˆå§‹åŒ–ä¸ºæ•´åž‹çš„æœ€å¤§å€¼ï¼Œç”±ä¸Šå±‚è°ƒç”¨æ—¶ä¼ å…¥ C++ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: bool isValidBST(TreeNode* root) &#123; if (!root) &#123; return true; &#125; int max = INT_MIN; int min = INT_MAX; return travel(root, max, min); &#125; bool travel(TreeNode* node, int&amp; max, int&amp; min) &#123; max = node-&gt;val &gt; max ? node-&gt;val : max; min = node-&gt;val &lt; min ? node-&gt;val : min; int tmpmax, tmpmin; if (node-&gt;left) &#123; tmpmax = INT_MIN; tmpmin = INT_MAX; if (!travel(node-&gt;left, tmpmax, tmpmin)) &#123; return false; &#125; else if (tmpmax &gt;= node-&gt;val) &#123; return false; &#125; max = tmpmax &gt; max ? tmpmax : max; min = tmpmin &lt; min ? tmpmin : min; &#125; if (node-&gt;right) &#123; tmpmax = INT_MIN; tmpmin = INT_MAX; if (!travel(node-&gt;right, tmpmax, tmpmin)) &#123; return false; &#125; else if (tmpmin &lt;= node-&gt;val) &#123; return false; &#125; max = tmpmax &gt; max ? tmpmax : max; min = tmpmin &lt; min ? tmpmin : min; &#125; return true; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 129 [Sum Root to Leaf Numbers]]]></title>
      <url>%2F2017%2F03%2F19%2Fleetcode-129%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Sum Root to Leaf Numbers é¢˜ç›®æè¿° ç»™å®šä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒçš„ç»“ç‚¹çš„å€¼éƒ½åœ¨0-9ä¹‹é—´ï¼Œæ¯ä¸€æ¡ä»Žæ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è·¯å¾„éƒ½å¯ä»¥ä»£è¡¨ä¸€ä¸ªæ•°å­—ã€‚æ¯”å¦‚å¦‚æžœæŸæ¡è·¯å¾„æ˜¯1-&gt;2-&gt;3ï¼Œé‚£ä¹ˆå®ƒä»£è¡¨çš„æ•°å­—åˆ™æ˜¯123ã€‚è¦æ±‚æ‰¾å‡ºç»™å®šçš„äºŒå‰æ ‘çš„æ‰€æœ‰ä¸Šè¿°è·¯å¾„ï¼Œè¿”å›žè¿™äº›è·¯å¾„ä»£è¡¨çš„æ•°å­—ä¹‹å’Œã€‚ è§£é¢˜æ€è·¯ æ ¹æ®é¢˜ç›®ä¸­å¯¹è·¯å¾„çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯æ¡è·¯å¾„ä»£è¡¨çš„æ•°å­—ä¸­ï¼Œæ ¹ç»“ç‚¹çš„æ•°å­—ä½äºŽæœ€å·¦è¾¹ï¼Œå¶å­ç»“ç‚¹çš„æ•°å­—ä½äºŽæœ€å³è¾¹ï¼Œæ¯ä¸ªç»“ç‚¹çš„æ•°å­—éƒ½ä½äºŽå®ƒçš„å­ç»“ç‚¹å·¦è¾¹ä»¥åŠå®ƒçš„çˆ¶ç»“ç‚¹å³è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç»“ç‚¹çš„è¿›ä½éƒ½æ¯”å®ƒçš„å­ç»“ç‚¹å¤šä¸€ä½ï¼Œæ¯”å®ƒçš„çˆ¶ç»“ç‚¹å°‘ä¸€ä½ æœ¬é¢˜çš„è§£æ³•ï¼š ä»Žæ ¹ç»“ç‚¹çš„å¼€å§‹éåŽ† éåŽ†ç»“ç‚¹çš„æ—¶å€™ï¼Œå°†ä¹‹å‰çš„æ•°å­—è¿›ä¸€ä½ï¼ˆä¹˜ä»¥10ï¼‰ï¼Œå†åŠ ä¸Šå½“å‰ç»“ç‚¹çš„æ•°å­—ï¼Œå°±æ˜¯ä»Žæ ¹ç»“ç‚¹åˆ°å½“å‰ç»“ç‚¹ä¸ºæ­¢çš„å­è·¯å¾„ä»£è¡¨çš„æ•°å­— è‹¥å½“å‰éåŽ†çš„ç»“ç‚¹æ˜¯å¶å­ç»“ç‚¹ï¼ˆæ²¡æœ‰ä»»ä½•å­ç»“ç‚¹ï¼‰ï¼Œé‚£ä¹ˆå½“å‰å­è·¯å¾„å³æ˜¯æ‰€æ±‚çš„è·¯å¾„ä¹‹ä¸€ï¼Œå°†ä¸Šä¸€æ­¥è®¡ç®—å¾—åˆ°çš„æ•°å­—åŠ åˆ°æ€»å’Œä¹‹ä¸­ è‹¥å½“å‰éåŽ†çš„ç»“ç‚¹ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ™ç»§ç»­éåŽ†å®ƒçš„å­ç»“ç‚¹ï¼Œå°†ä¹‹å‰è®¡ç®—çš„æ•°å­—ä¼ é€’ä¸‹åŽ» éåŽ†å®Œæ‰€æœ‰ç»“ç‚¹ä¹‹åŽï¼Œæ‰€æ±‚çš„æ€»å’Œä¹Ÿå°±è®¡ç®—å®Œæˆäº† è¿™ä¸ªè§£æ³•å¯¹æ¯ä¸ªç»“ç‚¹éƒ½è®¿é—®äº†ä¸€æ¬¡ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œnä¸ºäºŒå‰æ ‘çš„ç»“ç‚¹æ€»æ•° C++ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */#include &lt;stack&gt;class Solution &#123;public: int kthSmallest(TreeNode* root, int k) &#123; int num = 0; stack&lt;TreeNode*&gt; s; s.push(root); TreeNode* node = root; while (node || !s.empty()) &#123; if (node &amp;&amp; node-&gt;left) &#123; s.push(node-&gt;left); node = node-&gt;left; continue; &#125; node = s.top(); if (++num == k) &#123; return node-&gt;val; &#125; s.pop(); if (node-&gt;right) &#123; s.push(node-&gt;right); &#125; node = node-&gt;right; &#125; return root-&gt;val; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 230 [Kth Smallest Element in a BST]]]></title>
      <url>%2F2017%2F03%2F19%2Fleetcode-230%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Kth Smallest Element in a BST é¢˜ç›®æè¿° ç»™å®šä¸€æ£µäºŒå‰æŽ’åºæ ‘ï¼Œè¦æ±‚å†™ä¸€ä¸ªç”¨äºŽæŸ¥æ‰¾ç¬¬Kå°çš„å…ƒç´ çš„å‡½æ•°ï¼Œ1&lt;=k&lt;=æ€»ç»“ç‚¹æ•°ã€‚ è§£é¢˜æ€è·¯ äºŒå‰æŽ’åºæ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ä»¥ä»»æ„ä¸€ä¸ªç»“ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„æ ‘ï¼Œå®ƒçš„å·¦å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½ä¸å¤§äºŽè¯¥ç»“ç‚¹çš„å€¼ï¼Œå®ƒçš„å³å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹çš„å€¼éƒ½ä¸å°äºŽè¯¥ç»“ç‚¹çš„å€¼ äºŒå‰æ ‘çš„å…ˆåºéåŽ†ï¼Œå³å…ˆè®¿é—®å·¦å­ç»“ç‚¹ï¼Œå†è®¿é—®æœ¬èº«ï¼Œæœ€åŽè®¿é—®å³å­ç»“ç‚¹ï¼Œå¯¹åº”åˆ°äºŒå‰æŽ’åºæ ‘ï¼Œå¾—å‡ºçš„è®¿é—®é¡ºåºæ˜¯ä¸¥æ ¼éžé€’å‡çš„ã€‚å› æ­¤é¢˜ç›®è¦æ±‚çš„ç¬¬Kå°çš„å…ƒç´ ï¼Œå³å¯¹äºŒå‰æŽ’åºæ ‘è¿›è¡Œå…ˆåºéåŽ†å¾—åˆ°çš„ç¬¬Kä¸ªç»“ç‚¹çš„å€¼ äºŒå‰æ ‘éåŽ†ä¸€èˆ¬æœ‰é€’å½’å’Œè¿­ä»£ä¸¤ç§æ–¹æ³•ï¼Œé€’å½’ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæˆ‘é‡‡ç”¨è¿­ä»£çš„æ–¹æ³•å®žçŽ° é¢˜ç›®æ¡ä»¶æ˜Žç¡®è¯´æ˜ŽK&gt;=1ï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘æ ¹ç»“ç‚¹çš„ç©ºçš„æƒ…å†µ C++ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */#include &lt;stack&gt;class Solution &#123;public: int kthSmallest(TreeNode* root, int k) &#123; int num = 0; stack&lt;TreeNode*&gt; s; s.push(root); TreeNode* node = root; while (node || !s.empty()) &#123; if (node &amp;&amp; node-&gt;left) &#123; s.push(node-&gt;left); node = node-&gt;left; continue; &#125; node = s.top(); if (++num == k) &#123; return node-&gt;val; &#125; s.pop(); if (node-&gt;right) &#123; s.push(node-&gt;right); &#125; node = node-&gt;right; &#125; return root-&gt;val; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 337 [House Robber III]]]></title>
      <url>%2F2017%2F03%2F16%2Fleetcode-337%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ House Robber III é¢˜ç›®æè¿° å°å·è¿›å…¥ä¸€ç‰‡åŒºåŸŸå‡†å¤‡å†ä¸€æ¬¡è¡Œçªƒï¼Œè¿™ç‰‡åŒºåŸŸä»…æœ‰ä¸€ä¸ªå…¥å£ï¼Œç§°ä¸ºrootã€‚åœ¨rootå…¥å£æ—è¾¹ï¼Œæ¯ä¸ªæˆ¿å±‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªâ€œçˆ¶æˆ¿å±‹â€ã€‚èªæ˜Žçš„å°å·å‘çŽ°è¿™ç‰‡åŒºåŸŸå†…æ‰€æœ‰çš„æˆ¿å±‹å½¢æˆäº†ä¸€æ£µäºŒå‰æ ‘ã€‚å¦å¤–ï¼Œå¦‚æžœåŒä¸€ä¸ªæ™šä¸Šï¼Œä¸¤é—´ç›´æŽ¥ç›¸è¿žçš„æˆ¿å±‹è¢«é—¯å…¥çš„è¯ï¼Œè‡ªåŠ¨æŠ¥è­¦å™¨å°±ä¼šå¯åŠ¨ã€‚çŽ°å·²çŸ¥æ¯ä¸ªæˆ¿å±‹é‡Œé¢çš„é‡‘é¢ï¼Œè¦æ±‚è®¡ç®—å‡ºå°å·åœ¨ä¸æƒŠåŠ¨è­¦å¯Ÿçš„æƒ…å†µä¸‹ï¼Œä»Šæ™šæœ€å¤šå¯ä»¥å·åˆ°å¤šå°‘é’±ã€‚ è§£é¢˜æ€è·¯ æŠ½è±¡ä¸€ä¸‹é¢˜ç›®è¦æ±‚ï¼Œå…¶å®žæœ¬é¢˜è¦è®¡ç®—çš„æ˜¯äºŒå‰æ ‘æŸäº›ç»“ç‚¹çš„å’Œçš„æœ€å¤§å€¼ï¼Œè¿™äº›ç»“ç‚¹éœ€è¦æ»¡è¶³çš„æ¡ä»¶æ˜¯ä¸¤ä¸¤ä¸ç›´æŽ¥ç›¸è¿žã€‚ ç®€å•åˆ†æžå¯ä»¥å¾—å‡ºï¼Œå¯¹äºŽä»»æ„ä¸€ä¸ªäºŒå‰æ ‘ç»“ç‚¹ï¼Œå¯ä»¥åˆ†ä¸¤ç§æƒ…å†µè€ƒè™‘ï¼š å®ƒæ˜¯è¢«é€‰ä¸­çš„ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒçš„å·¦å³å­ç»“ç‚¹éƒ½ä¸æ˜¯è¢«é€‰ä¸­çš„ç»“ç‚¹ å®ƒä¸æ˜¯è¢«é€‰ä¸­çš„ç»“ç‚¹ï¼Œè¿™ç§åœºæ™¯å¯å†ç»†åˆ†ï¼š å·¦å­ç»“ç‚¹è¢«é€‰ä¸­ï¼Œå³å­ç»“ç‚¹ä¹Ÿè¢«é€‰ä¸­ å·¦å­ç»“ç‚¹è¢«é€‰ä¸­ï¼Œå³å­ç»“ç‚¹ä¸è¢«é€‰ä¸­ å·¦å­ç»“ç‚¹ä¸è¢«é€‰ä¸­ï¼Œå³å­ç»“ç‚¹è¢«é€‰ä¸­ å·¦å­ç»“ç‚¹ä¸è¢«é€‰ä¸­ï¼Œå³å­ç»“ç‚¹ä¹Ÿä¸è¢«é€‰ä¸­ å·¦å³å­ç»“ç‚¹çš„æƒ…å†µï¼Œå¯ä»¥é€’å½’å¤„ç† ä»Žæ ¹ç»“ç‚¹å‡ºå‘ï¼Œå¯¹äºŽæ¯ä¸ªç»“ç‚¹æ ¹æ®ä¸Šè¿°åˆ†æžè¿›è¡ŒéåŽ†ï¼Œå³å¯å¾—å‡ºç»“æžœã€‚ç†è®ºä¸Šï¼Œæ¯ä¸ªç»“ç‚¹æœ‰ä¸¤ç§çŠ¶æ€ï¼ˆè¢«é€‰ä¸­ä¸Žä¸è¢«é€‰ä¸­ï¼‰ï¼Œè‹¥ç»“ç‚¹æ•°ä¸ºnï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(2^n)ï¼Œä½†æ˜¯å¯¹äºŽçˆ¶ç»“ç‚¹è¢«é€‰ä¸­çš„æƒ…å†µï¼Œå­ç»“ç‚¹å¾ˆå¤šåœºæ™¯å…¶å®žä¸éœ€è¦è€ƒè™‘ï¼ˆç§°ä¸ºå‰ªæžï¼‰ï¼Œæœ€ç»ˆæ—¶é—´å¤æ‚åº¦è¿œä¸åŠO(2^n)ã€‚å¦å¤–éœ€è¦è€ƒè™‘ç»“ç‚¹å€¼ä¸ºè´Ÿçš„æƒ…å†µï¼Œæ¯ä¸ªç»“ç‚¹åœ¨éåŽ†æ—¶ï¼Œåº”è¯¥å–0ä½œä¸ºåˆå§‹å€¼ã€‚ C++ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: int rob(TreeNode* root) &#123; int max_sum = 0; // æ ¹ç»“ç‚¹ä¸ºç©ºï¼Œç›´æŽ¥è¿”å›ž0 if (!root) &#123; return max_sum; &#125; // æ ¹ç»“ç‚¹è¢«é€‰ä¸­çš„æƒ…å†µ int tmp = travel(root, true) + root-&gt;val; if (tmp &gt; max_sum) &#123; max_sum = tmp; &#125; // æ ¹ç»“ç‚¹æœªè¢«é€‰ä¸­çš„æƒ…å†µ tmp = travel(root, false); if (tmp &gt; max_sum) &#123; max_sum = tmp; &#125; return max_sum; &#125; // éåŽ†æŸä¸ªç»“ç‚¹ï¼ŒèŽ·å–å®ƒçš„å·¦å³å­ç»“ç‚¹å„ç§æƒ…å†µçš„å’Œçš„æœ€å¤§å€¼ int travel(TreeNode* node, bool cur_state) &#123; int tmp; // è®¡ç®—å·¦ç»“ç‚¹å„ç§æƒ…å†µçš„æœ€å¤§å€¼ int max_left = 0; if (node-&gt;left) &#123; // ä¸é€‰ä¸­å·¦å­ç»“ç‚¹çš„æƒ…å†µ tmp = travel(node-&gt;left, false); if (tmp &gt; max_left) &#123; max_left = tmp; &#125; // è‹¥å½“å‰ç»“ç‚¹æœªè¢«é€‰ä¸­ï¼Œåˆ™è€ƒè™‘é€‰ä¸­å·¦å­ç»“ç‚¹çš„æƒ…å†µ if (!cur_state) &#123; tmp = travel(node-&gt;left, true) + node-&gt;left-&gt;val; if (tmp &gt; max_left) &#123; max_left = tmp; &#125; &#125; &#125; // è®¡ç®—å³ç»“ç‚¹å„ç§æƒ…å†µçš„æœ€å¤§å€¼ int max_right = 0; if (node-&gt;right) &#123; // ä¸é€‰ä¸­å³å­ç»“ç‚¹çš„æƒ…å†µ tmp = travel(node-&gt;right, false); if (tmp &gt; max_right) &#123; max_right = tmp; &#125; // è‹¥å½“å‰ç»“ç‚¹æœªè¢«é€‰ä¸­ï¼Œåˆ™è€ƒè™‘é€‰ä¸­å³å­ç»“ç‚¹çš„æƒ…å†µ if (!cur_state) &#123; tmp = travel(node-&gt;right, true) + node-&gt;right-&gt;val; if (tmp &gt; max_right) &#123; max_right = tmp; &#125; &#125; &#125; // è¿”å›žå·¦å³å­ç»“ç‚¹æœ€å¤§å€¼ä¹‹å’Œ return max_left + max_right; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 236 [Lowest Common Ancestor of a Binary Tree]]]></title>
      <url>%2F2017%2F03%2F13%2Fleetcode-236%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Lowest Common Ancestor of a Binary Tree é¢˜ç›®æè¿° ç»™å®šä¸€é¢—äºŒå‰æ ‘ï¼ŒæŸ¥æ‰¾ä¸¤ä¸ªç»“ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ï¼šäºŒå‰æ ‘é‡Œé¢åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªç»™å®šåŽä»£ç»“ç‚¹çš„é«˜åº¦æœ€ä½Žçš„ç»“ç‚¹ï¼Œä¸€ä¸ªç»“ç‚¹å¯ä»¥ä½œä¸ºå®ƒè‡ªå·±çš„ç¥–å…ˆç»“ç‚¹ã€‚ è§£é¢˜æ€è·¯ ä¸€å¼€å§‹çš„æ€è·¯ åªè¦æ ¹ç»“ç‚¹ä¸ä¸ºNULLï¼Œé‚£ä¹ˆå®ƒè‚¯å®šæ˜¯ä»»æ„ä¸¤ä¸ªç»“ç‚¹çš„å…¬å…±ç¥–å…ˆã€‚ä»Žæ ¹ç»“ç‚¹å‡ºå‘åˆ°è¾¾ä¸¤ä¸ªç»™å®šç»“ç‚¹ï¼Œå¯ä»¥å¾—åˆ°ä¸¤æ¡è·¯å¾„ï¼ˆç±»ä¼¼é“¾è¡¨ï¼‰ï¼Œè¿™ä¸¤æ¡è·¯å¾„çš„èµ·å§‹ç»“ç‚¹éƒ½æ˜¯æ ¹ç»“ç‚¹ï¼Œæ²¿ç€è·¯å¾„é€ä¸ªå¯¹æ¯”ï¼Œå®ƒä»¬æœ€åŽä¸€ä¸ªå…¬å…±ç»“ç‚¹å°±æ˜¯å¾…æŸ¥æ‰¾çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚å®žé™…å¤„ç†çš„æ—¶å€™ï¼Œä¸éœ€è¦ä»¥é“¾è¡¨çš„æ–¹å¼ç”Ÿæˆä¸€æ¡è·¯å¾„ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ä½¿ç”¨åŒ…å«boolå…ƒç´ çš„vectorè®°å½•æ¯æ¬¡å‘å·¦è¿˜æ˜¯å‘å³èµ°ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥è¡¨ç¤ºè·¯å¾„ä¿¡æ¯ã€‚ è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºŽéœ€è¦ä½¿ç”¨é¢å¤–çš„å­˜å‚¨æ¥è®°å½•è·¯å¾„ä¿¡æ¯ï¼Œåœ¨è®¡ç®—èµ„æºè¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¾—åˆ°ç»“æžœï¼Œä½†æœ¬é¢˜çš„ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åŒ…å«çº¦10000ä¸ªç»“ç‚¹ï¼Œæµ‹è¯•æ—¶ç›´æŽ¥æŠ¥â€Runtime Errorâ€ï¼Œå› æ­¤è¿™ç§æ€è·¯ä¸èƒ½ä½œä¸ºæœ¬é¢˜çš„æ­£ç¡®è§£æ³•ã€‚ å‚è€ƒåˆ«äººçš„æ€è·¯ åœ¨Solutionsé‡Œçœ‹åˆ°åˆ«äººå‘è¡¨çš„éžå¸¸ç®€æ´çš„é€’å½’è§£æ³•ï¼Œåªæœ‰4è¡Œï¼ŒçœŸçš„éžå¸¸ç²¾å¦™ï¼Œå¹¶ä¸”ä¸éœ€è¦é¢å¤–çš„å˜é‡å­˜å‚¨ç©ºé—´ã€‚ è¿™ç§è§£æ³•çš„æ€è·¯å¦‚ä¸‹ï¼š æŠŠæ ¹ç»“ç‚¹ä½œä¸ºå½“å‰ç»“ç‚¹ï¼ŒæŸ¥æ‰¾ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„æ ‘ã€‚æŸ¥æ‰¾ç»“æžœå¯ä»¥åˆ†ä¸ºå››ç§ï¼š ä¸¤ä¸ªç»™å®šç»“ç‚¹éƒ½åœ¨å½“å‰çš„æ ‘é‡Œ åªæœ‰ç¬¬ä¸€ä¸ªç»“ç‚¹åœ¨å½“å‰çš„æ ‘é‡Œ åªæœ‰ç¬¬äºŒä¸ªç»“ç‚¹åœ¨å½“å‰çš„æ ‘é‡Œ ä¸¤ä¸ªç»™å®šç»“ç‚¹éƒ½ä¸åœ¨å½“å‰çš„æ ‘é‡Œ å¦‚æžœå½“å‰ç»“ç‚¹ä¸ºNULLï¼Œåˆ™è¡¨ç¤ºæŸ¥æ‰¾ç»“æžœä¸ºä¸Šè¿°ç¬¬å››ç§ï¼Œè¿”å›žNULLï¼›å¦‚æžœå½“å‰ç»“ç‚¹æ˜¯ç»™å®šçš„ç¬¬ä¸€ä¸ªç»“ç‚¹ï¼Œåˆ™è¡¨ç¤ºæŸ¥æ‰¾ç»“æžœä¸ºä¸Šè¿°ç¬¬äºŒç§ï¼Œè¿”å›žå½“å‰ç»“ç‚¹ï¼›å¦‚æžœå½“å‰ç»“ç‚¹æ˜¯ç»™å®šçš„ç¬¬äºŒä¸ªç»“ç‚¹ï¼Œåˆ™è¡¨ç¤ºæŸ¥æ‰¾ç»“æžœä¸ºä¸Šè¿°ç¬¬ä¸‰ç§ï¼Œè¿”å›žå½“å‰ç»“ç‚¹ï¼›å¦‚æžœå‰é¢å‡ ç§æƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆå°±éœ€è¦æŸ¥æ‰¾å®ƒçš„å·¦å³å­æ ‘äº†ï¼Œå·¦å³å­æ ‘çš„æŸ¥æ‰¾è§„åˆ™è·Ÿæœ¬æ­¥éª¤ä¸€æ¨¡ä¸€æ ·ï¼ŒæŸ¥æ‰¾ç»“æžœåŒæ ·å¯ä»¥åˆ†ä¸ºå››ç§ï¼š åœ¨å·¦å­æ ‘ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªç»™å®šç»“ç‚¹ï¼Œå·¦å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ä¸ºNULLï¼›åœ¨å³å­æ ‘ä¸­ä¹Ÿæ‰¾åˆ°äº†ä¸€ä¸ªç»™å®šç»“ç‚¹ï¼Œå³å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ä¸ºNULLã€‚è¿™ç§æƒ…å†µè¯´æ˜Žæœ€è¿‘å…¬å…±ç¥–å…ˆå°±æ˜¯å½“å‰ç»“ç‚¹ï¼ˆå·¦å³å­æ ‘çš„çˆ¶ç»“ç‚¹ï¼‰ï¼Œè¿”å›žå½“å‰ç»“ç‚¹ åœ¨å·¦å­æ ‘ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªç»™å®šç»“ç‚¹ï¼Œå·¦å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ä¸ºNULLï¼›åœ¨å³å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°ç»™å®šç»“ç‚¹ï¼Œå³å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ºNULLã€‚è¿™ç§æƒ…å†µè¯´æ˜Žæœ€è¿‘å…¬å…±ç¥–å…ˆå¿…ç„¶åœ¨å½“å‰ç»“ç‚¹ä¸Šæ–¹ï¼Œè¿”å›žå·¦å­æ ‘æŸ¥æ‰¾ç»“æžœ åœ¨å³å­æ ‘ä¸­æ‰¾åˆ°äº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªç»™å®šç»“ç‚¹ï¼Œå³å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ä¸ºNULLï¼›åœ¨å·¦å­æ ‘ä¸­æ²¡æœ‰æ‰¾åˆ°ç»™å®šç»“ç‚¹ï¼Œå·¦å­æ ‘æŸ¥æ‰¾ç»“æžœä¸ºNULLã€‚è¿™ç§æƒ…å†µè¯´æ˜Žæœ€è¿‘å…¬å…±ç¥–å…ˆå¿…ç„¶åœ¨å½“å‰ç»“ç‚¹ä¸Šæ–¹ï¼Œè¿”å›žå³å­æ ‘æŸ¥æ‰¾ç»“æžœ åœ¨å·¦å³å­æ ‘ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°ç»™å®šç»“ç‚¹ï¼ŒæŸ¥æ‰¾ç»“æžœéƒ½ä¸ºNULLã€‚è¿™ç§æƒ…å†µè¯´æ˜Žå½“å‰çš„æ ‘ä¸åŒ…å«ä»»ä½•æŒ‡å®šç»“ç‚¹ï¼Œè¿”å›žNULL ä¸Šä¸€æ­¥éª¤çš„å››ç§æŸ¥æ‰¾ç»“æžœä¸­ï¼Œç¬¬2å’Œç¬¬3ç§éƒ½éœ€è¦è¿”å›žå­æ ‘çš„æŸ¥æ‰¾ç»“æžœï¼Œè€Œä¸æ˜¯è¿”å›žå½“å‰ç»“ç‚¹çš„å¤„ç†ç»“æžœï¼Œå¦åˆ™ä¼šå¯¼è‡´æœ€ç»ˆæ‰¾åˆ°çš„éƒ½æ˜¯æ ¹ç»“ç‚¹ C++ä»£ç 123456789101112131415161718/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: TreeNode* lowestCommonAncestor(TreeNode* root, TreeNode* p, TreeNode* q) &#123; if (!root || root == p || root == q) return root; TreeNode* left = lowestCommonAncestor(root-&gt;left, p, q); TreeNode* right = lowestCommonAncestor(root-&gt;right, p, q); return left &amp;&amp; right ? root : left ? left : right ? right : NULL; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[LeetCode 450 [Delete Node in a BST]]]></title>
      <url>%2F2017%2F03%2F11%2Fleetcode-450%2F</url>
      <content type="text"><![CDATA[é¢˜ç›®é“¾æŽ¥ Delete Node in a BST é¢˜ç›®æè¿° ç»™å®šä¸€é¢—äºŒå‰æŽ’åºæ ‘çš„æ ¹ç»“ç‚¹ä»¥åŠä¸€ä¸ªå€¼ï¼Œè¦æ±‚åˆ é™¤äºŒå‰æŽ’åºæ ‘ä¸­åŒ…å«è¯¥å€¼çš„ç»“ç‚¹ï¼ŒåŒæ—¶è¿”å›žè¯¥æ ‘çš„æœ€æ–°çš„æ ¹ç»“ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤å¯ä»¥é€šè¿‡ä¸¤ä¸ªæ­¥éª¤æ¥å®Œæˆï¼Œä¸€æ˜¯æŸ¥æ‰¾è¯¥ç»“ç‚¹ï¼ŒäºŒæ˜¯åˆ é™¤è¯¥ç»“ç‚¹ï¼ˆå¦‚æžœå­˜åœ¨çš„è¯ï¼‰ã€‚æ—¶é—´å¤æ‚åº¦å¿…é¡»æ˜¯O(h)ï¼Œhè¡¨ç¤ºæ ‘çš„é«˜åº¦ã€‚ è§£é¢˜æ€è·¯ é¢˜ç›®é»˜è®¤æ¡ä»¶ è‹¥éžç‰¹æ®Šè¯´æ˜Žï¼ŒäºŒå‰æŽ’åºæ ‘ä¸å­˜åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªç»“ç‚¹åŒ…å«åŒä¸ªå€¼çš„æƒ…å†µã€‚ æŸ¥æ‰¾â€œå¾…åˆ é™¤ç»“ç‚¹â€çš„æ­¥éª¤ ä»Žæ ¹ç»“ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œå°†å½“å‰ç»“ç‚¹çš„å€¼ä¸Žç»™å®šçš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æžœå½“å‰ç»“ç‚¹çš„å€¼æ¯”è¾ƒå¤§ï¼Œåˆ™å°†å½“å‰ç»“ç‚¹çš„å·¦ç»“ç‚¹è®¾ç½®ä¸ºæ–°çš„å½“å‰ç»“ç‚¹ï¼›å¦‚æžœå½“å‰ç»“ç‚¹çš„å€¼æ¯”è¾ƒå°ï¼Œåˆ™å°†å½“å‰ç»“ç‚¹çš„å³ç»“ç‚¹è®¾ç½®ä¸ºæ–°çš„å½“å‰ç»“ç‚¹ï¼›å¦‚æžœå€¼ç›¸ç­‰ï¼Œåˆ™è¯´æ˜Žå½“å‰ç»“ç‚¹å³ä¸ºç›®æ ‡ï¼Œç»“æŸæŸ¥æ‰¾è¿‡ç¨‹ã€‚ è‹¥å½“å‰ç»“ç‚¹ä¸ºNULLï¼Œä¹Ÿç»“æŸæŸ¥æ‰¾è¿‡ç¨‹ã€‚ æŸ¥æ‰¾è¿‡ç¨‹éœ€è¦è®°å½•â€œå¾…åˆ é™¤ç»“ç‚¹â€çš„çˆ¶ç»“ç‚¹ï¼ŒåŒæ—¶è¿˜è¦è®°å½•å®ƒæ˜¯çˆ¶ç»“ç‚¹çš„å·¦å­©å­è¿˜æ˜¯å³å­©å­ï¼ˆä¸‹æ–‡ä½¿ç”¨â€œæ–¹å‘â€æ¥è¡¨ç¤ºè¿™ä¸ªä¿¡æ¯ï¼‰ã€‚ åˆ é™¤â€œå¾…åˆ é™¤ç»“ç‚¹â€çš„æ­¥éª¤ è‹¥ç¬¬ä¸€æ­¥æŸ¥æ‰¾ä¸åˆ°â€œå¾…åˆ é™¤ç»“ç‚¹â€ï¼Œåˆ™ä¸éœ€è¦æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œè¿”å›žå½“å‰çš„æ ¹ç»“ç‚¹å³å¯ã€‚ è‹¥æ‰¾åˆ°äº†è¦â€œå¾…åˆ é™¤ç»“ç‚¹â€ï¼Œåˆ™éœ€è¦åˆ†ä»¥ä¸‹å‡ ç§æƒ…å†µè€ƒè™‘ æƒ…å†µ1ï¼šâ€œå¾…åˆ é™¤ç»“ç‚¹â€æ²¡æœ‰ä»»ä½•å­ç»“ç‚¹ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€æ˜¯æ ¹ç»“ç‚¹ï¼ˆå³å®ƒçš„çˆ¶ç»“ç‚¹ä¸ºNULLï¼‰ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼Œè¿”å›žNULLï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€ä¸æ˜¯æ ¹ç»“ç‚¹ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼ŒåŒæ—¶å°†å®ƒçš„çˆ¶ç»“ç‚¹çš„å¯¹åº”æ–¹å‘çš„å­ç»“ç‚¹ç½®ä¸ºNULLï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ æƒ…å†µ2ï¼šâ€œå¾…åˆ é™¤ç»“ç‚¹â€åªæœ‰å·¦å­ç»“ç‚¹ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€æ˜¯æ ¹ç»“ç‚¹ï¼ˆå³å®ƒçš„çˆ¶ç»“ç‚¹ä¸ºNULLï¼‰ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼Œè¿”å›žå®ƒçš„å·¦å­ç»“ç‚¹ï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€ä¸æ˜¯æ ¹ç»“ç‚¹ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼ŒåŒæ—¶å°†å®ƒçš„çˆ¶ç»“ç‚¹çš„å¯¹åº”æ–¹å‘çš„å­ç»“ç‚¹ç½®ä¸ºå®ƒçš„å·¦ç»“ç‚¹ï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ æƒ…å†µ3ï¼šå¾…åˆ é™¤çš„ç»“ç‚¹åªæœ‰å³å­ç»“ç‚¹ï¼ˆä¸Žæƒ…å†µ2éžå¸¸ç±»ä¼¼ï¼‰ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€æ˜¯æ ¹ç»“ç‚¹ï¼ˆå³å®ƒçš„çˆ¶ç»“ç‚¹ä¸ºNULLï¼‰ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼Œè¿”å›žå®ƒçš„å³å­ç»“ç‚¹ï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ å¦‚æžœâ€œå¾…åˆ é™¤ç»“ç‚¹â€ä¸æ˜¯æ ¹ç»“ç‚¹ï¼Œé‚£ä¹ˆé‡Šæ”¾è¯¥ç»“ç‚¹ï¼ŒåŒæ—¶å°†å®ƒçš„çˆ¶ç»“ç‚¹çš„å¯¹åº”æ–¹å‘çš„å­ç»“ç‚¹ç½®ä¸ºå®ƒçš„å³ç»“ç‚¹ï¼Œç»“æŸåˆ é™¤è¿‡ç¨‹ æƒ…å†µ4ï¼šâ€œå¾…åˆ é™¤ç»“ç‚¹â€åŒæ—¶åŒ…å«å·¦å³å­ç»“ç‚¹ è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾ä¸€ä¸ªæœ€åˆé€‚çš„ç»“ç‚¹ï¼ˆä¸‹æ–‡ä½¿ç”¨â€œå¾…äº¤æ¢ç»“ç‚¹â€æ¥è¡¨ç¤ºå®ƒï¼‰æ¥å–ä»£â€œå¾…åˆ é™¤ç»“ç‚¹â€çš„ä½ç½®ã€‚äºŒå‰æŽ’åºæ ‘çš„ç‰¹æ€§å°±æ˜¯æ¯ä¸€ä¸ªç»“ç‚¹éƒ½æ¯”å®ƒå·¦å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹å¤§ï¼ŒåŒæ—¶æ¯”å®ƒå³å­æ ‘çš„æ‰€æœ‰ç»“ç‚¹å°ã€‚å› æ­¤â€œå¾…äº¤æ¢ç»“ç‚¹â€è¦ä¹ˆæ˜¯å·¦å­æ ‘ä¸­å€¼æœ€å¤§çš„ç»“ç‚¹ï¼Œè¦ä¹ˆæ˜¯å³å­æ ‘ä¸­å€¼æœ€å°çš„ç»“ç‚¹ã€‚åŽç»­æè¿°ä½¿ç”¨å³å­æ ‘ä¸­å€¼æœ€å°çš„ç»“ç‚¹ä½œä¸ºâ€œå¾…äº¤æ¢ç»“ç‚¹â€ï¼Œå·¦å­æ ‘ä¸­å€¼æœ€å¤§çš„ç»“ç‚¹ç†è®ºä¸Šæ»¡è¶³é¢˜ç›®è¦æ±‚ï¼Œä½†æˆ‘æœªå®žé™…æµ‹è¯•ã€‚ æŸ¥æ‰¾â€œå¾…äº¤æ¢ç»“ç‚¹â€çš„æ­¥éª¤ ä»Žâ€œå¾…åˆ é™¤ç»“ç‚¹â€çš„å³å­ç»“ç‚¹å¼€å§‹ï¼ŒæŸ¥æ‰¾ä»¥å®ƒä¸ºæ ¹çš„å­æ ‘ä¸­å€¼æœ€å°çš„ç»“ç‚¹ï¼ŒæŸ¥æ‰¾è¿‡ç¨‹åŒæ ·éœ€è¦è®°å½•å½“å‰ç»“ç‚¹çš„çˆ¶ç»“ç‚¹åŠæ–¹å‘ äºŒå‰æŽ’åºæ ‘ä¸­å€¼æœ€å°çš„ç»“ç‚¹å¿…å®šä½äºŽæœ€å·¦ä¾§ï¼Œå› æ­¤åªè¦å½“å‰ç»“ç‚¹å­˜åœ¨å·¦å­ç»“ç‚¹ï¼Œåˆ™æŒç»­å°†å·¦å­ç»“ç‚¹ç½®ä¸ºæ–°çš„å½“å‰ç»“ç‚¹å³å¯ æœ€åŽä¸€ä¸ªä¸åŒ…å«å·¦å­ç»“ç‚¹çš„å½“å‰ç»“ç‚¹ï¼Œå°±æ˜¯â€œå¾…äº¤æ¢ç»“ç‚¹â€ â€œå¾…äº¤æ¢ç»“ç‚¹â€æ˜¯å¿…å®šå­˜åœ¨çš„ï¼Œæ—¢ç„¶æ‰¾åˆ°äº†ï¼Œå°±å¯ä»¥å¼€å§‹åˆ é™¤æ­¥éª¤äº†ã€‚é¢˜ç›®å¹¶æœªè¦æ±‚å®žé™…åˆ é™¤è¯¥ç»“ç‚¹ï¼Œå› æ­¤é€šè¿‡å˜æ›´è¯¥ç»“ç‚¹çš„å€¼ä¹Ÿå¯ä»¥å®žçŽ°ç±»ä¼¼åŠŸèƒ½ã€‚è¿™é‡Œè¦åšçš„ï¼Œåªæ˜¯ç®€å•åœ°æŠŠâ€œå¾…äº¤æ¢ç»“ç‚¹â€çš„å€¼èµ‹ç»™â€œå¾…åˆ é™¤ç»“ç‚¹â€ã€‚ æœ€åŽè¦å¤„ç†â€œå¾…äº¤æ¢ç»“ç‚¹â€ï¼Œä¸Šæ–‡åªè¯´äº†å®ƒä¸åŒ…å«å·¦å­ç»“ç‚¹ï¼Œå› æ­¤è¦è€ƒè™‘å®ƒæ˜¯å¦å­˜åœ¨å³ç»“ç‚¹ã€‚å¦‚æžœå®ƒå­˜åœ¨å³ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒçš„çˆ¶ç»“ç‚¹çš„å¯¹åº”æ–¹å‘çš„å­ç»“ç‚¹å°±æ˜¯å®ƒçš„å³ç»“ç‚¹ï¼Œå¦åˆ™å®ƒçš„çˆ¶ç»“ç‚¹çš„å¯¹åº”æ–¹å‘çš„å­ç»“ç‚¹å°±æ˜¯NULLã€‚æœ€åŽæŠŠâ€œå¾…äº¤æ¢ç»“ç‚¹â€é‡Šæ”¾äº†å³å¯ã€‚ C++ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596/** * Definition for a binary tree node. * struct TreeNode &#123; * int val; * TreeNode *left; * TreeNode *right; * TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125; * &#125;; */class Solution &#123;public: TreeNode* deleteNode(TreeNode* root, int key) &#123; TreeNode* node2Del = root; TreeNode* parentOfNode2Del = NULL; int direction = 0; // find the node 2 delete and its parent while (node2Del) &#123; if (node2Del-&gt;val == key) &#123; break; &#125; else if (node2Del-&gt;val &gt; key) &#123; parentOfNode2Del = node2Del; node2Del = node2Del-&gt;left; direction = -1; &#125; else &#123; parentOfNode2Del = node2Del; node2Del = node2Del-&gt;right; direction = 1; &#125; &#125; // node to delete not found, do nothng and return root if (!node2Del) &#123; return root; &#125; if (!node2Del-&gt;left &amp;&amp; !node2Del-&gt;right) &#123; // node to delete has no child // node to delete is root if (!parentOfNode2Del) &#123; delete root; return NULL; &#125; // node to delete is not root delete node2Del; if (direction &lt; 0) &#123; parentOfNode2Del-&gt;left = NULL; &#125; else &#123; parentOfNode2Del-&gt;right = NULL; &#125; &#125; else if (node2Del-&gt;left &amp;&amp; !node2Del-&gt;right) &#123; // node to delete has only left child // node to delete is root if (!parentOfNode2Del) &#123; delete root; return root-&gt;left; &#125; // node to delete is not root if (direction &lt; 0) &#123; parentOfNode2Del-&gt;left = node2Del-&gt;left; &#125; else &#123; parentOfNode2Del-&gt;right = node2Del-&gt;left; &#125; delete node2Del; &#125; else if (node2Del-&gt;right &amp;&amp; !node2Del-&gt;left) &#123; // node to delete has only right child // node to delete is root if (!parentOfNode2Del) &#123; delete root; return root-&gt;right; &#125; // node to delete is not root if (direction &lt; 0) &#123; parentOfNode2Del-&gt;left = node2Del-&gt;right; &#125; else &#123; parentOfNode2Del-&gt;right = node2Del-&gt;right; &#125; delete node2Del; &#125; else &#123; // node to delete has both left and right child // find the least value of right sub tree TreeNode* node2Switch = node2Del-&gt;right; TreeNode* parentOfNode2Switch = node2Del; int directionSwitch = 1; while (node2Switch-&gt;left) &#123; parentOfNode2Switch = node2Switch; node2Switch = node2Switch-&gt;left; directionSwitch = -1; &#125; // switch value node2Del-&gt;val = node2Switch-&gt;val; if (directionSwitch &lt; 0) &#123; parentOfNode2Switch-&gt;left = node2Switch-&gt;right; &#125; else &#123; parentOfNode2Switch-&gt;right = node2Switch-&gt;right; &#125; delete node2Switch; &#125; return root; &#125;&#125;;]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€Šç•ªèŒ„å·¥ä½œæ³•å›¾è§£ã€‹è¯»åŽæ„Ÿ&å®žè·µç»åŽ†]]></title>
      <url>%2F2017%2F03%2F07%2Ftomato-working-method%2F</url>
      <content type="text"><![CDATA[ä¸€ç›´ä»¥æ¥æˆ‘éƒ½è§‰å¾—è‡ªå·±çš„å·¥ä½œæ•ˆçŽ‡ä¸é«˜ï¼Œå› æ­¤æ‰¾äº†å‡ æœ¬æå‡æ•ˆçŽ‡ä¸Žç®¡ç†æ—¶é—´çš„ä¹¦æ¥å•ƒï¼Œè¿™æœ¬ã€Šç•ªèŒ„å·¥ä½œæ³•å›¾è§£ã€‹ï¼Œæ˜¯æˆ‘ç¬¬ä¸€æœ¬å®Œæ•´çœ‹å®Œçš„æå‡æ•ˆçŽ‡çš„ä¹¦ç±ã€‚ ä½œè€…åœ¨ä¹¦ä¸­ä»‹ç»äº†äººè„‘æ˜¯å¦‚ä½•å¤„ç†äº‹æƒ…çš„ï¼Œä¹Ÿåˆ—ä¸¾äº†å¾ˆå¤šé’ˆå¯¹å…·ä½“åœºæ™¯çš„åº”å¯¹æ–¹å¼ï¼ŒåŒæ—¶æå‡ºäº†å¦‚ä½•é€šè¿‡â€œç•ªèŒ„å·¥ä½œæ³•â€ä¸€æ­¥ä¸€æ­¥è®©è‡ªå·±çš„å·¥ä½œæ—¶é—´å˜å¾—è§„å¾‹ä¸Žå¯è¿½è¸ªã€‚è¿™é‡Œå…ˆæŠ›å‡ºæˆ‘ä»Žæœ¬ä¹¦èŽ·å–çš„ä¸¤ä¸ªä¸»è¦è§‚ç‚¹ï¼š ä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼Œå°½é‡é¿å…è¢«æ‰“æ–­ï¼› æ´»åŠ¨æ¸…å•+ä»Šæ—¥å¾…åŠž+æ¯å¤©å›žé¡¾+å¯è§†åŒ–ã€‚ ä¸‹é¢æ˜¯æˆ‘å¯¹è¿™ä¸¤ä¸ªè§‚ç‚¹çš„ç†è§£ï¼Œå¦‚æžœä½ çŽ°åœ¨æ­£é¢ä¸´ç€å·¥ä½œæ•ˆçŽ‡ä¸é«˜çš„é—®é¢˜ï¼Œä¹Ÿè®¸æˆ‘çš„ç†è§£å¯ä»¥å¸®åŠ©åˆ°ä½ ã€‚ æˆ‘è®¤ä¸ºå­¦ä¹ ä¸Žå·¥ä½œæ•ˆçŽ‡ä¸é«˜ï¼Œä¸€ä¸ªåŽŸå› å°±æ˜¯ä¸ä¸“æ³¨ï¼Œå¦ä¸€ä¸ªåŽŸå› å°±æ˜¯æ²¡æœ‰æŒç»­æŠ•å…¥ã€‚ ä¸ºä»€ä¹ˆå­¦ç”Ÿæ—¶ä»£çš„æˆ‘å¯ä»¥åŒæ—¶å­¦ä¹ å¾ˆå¤šç§‘ç›®çš„çŸ¥è¯†ï¼Œç”šè‡³èƒ½ä»¥åœ¨è€ƒè¯•å‰èŠ±ä¸€ä¸¤å¤©æŠ±ä½›è„šï¼Œå°±å‡ ä¹ŽæŠŠæ•´æœ¬ä¹¦çš„å†…å®¹éƒ½è®°ä¸‹æ¥ï¼Ÿè¿™é‡Œä¸è®¨è®ºè€ƒè¯•å‰æŠ±ä½›è„šè¿™ç§æ–¹å¼æ˜¯å¦åˆç†ï¼Œä»…ä»Žç»“æžœæ¥çœ‹ï¼Œåº”å¯¹è€ƒè¯•åº”è¯¥æ˜¯è¶³å¤Ÿçš„ã€‚æˆ‘è®¤ä¸ºå­¦ç”Ÿæ—¶ä»£æˆ‘ä»¬èƒ½åšåˆ°è¿™æ ·ï¼Œæ— å¤–ä¹Žæˆ‘ä»¬ä¸“æ³¨äºŽå­¦ä¹ åŠæŒç»­æŠ•å…¥ã€‚ä¸“æ³¨ä½“çŽ°åœ¨å­¦ä¹ æŸä¸€ç§‘ç›®çš„çŸ¥è¯†æˆ–è€…å®ŒæˆæŸä¸€ç§‘ç›®çš„ä½œä¸šï¼Œåœ¨ä¸€å°æ®µæˆ–ä¸€å¤§æ®µæ—¶é—´å†…ï¼Œæˆ‘ä»¬æ˜¯ä¸“æ³¨åœ¨è¿™ä»¶äº‹æƒ…ä¸Šé¢çš„ã€‚è€ŒæŒç»­æŠ•å…¥æ—¶é—´ï¼Œåˆ™ä½“çŽ°åœ¨æˆ‘ä»¬è¿žç»­ä¸€ä¸ªå­¦æœŸï¼Œç”šè‡³è¿žç»­ä¸€å¹´éƒ½åœ¨å­¦ä¹ ä¸Žå·©å›ºæŸä¸€ç§‘ç›®çš„çŸ¥è¯†ã€‚ è¸å…¥èŒåœºä¹‹åŽï¼Œæˆ‘ä»¬çš„é‡å¿ƒè‡ªç„¶ä»Žå­¦ä¹ è½¬å˜ä¸ºå·¥ä½œã€‚é‚£ä¹ˆå·¥ä½œå¦‚ä½•åšåˆ°ä¸“æ³¨ä¸ŽæŒç»­æŠ•å…¥ï¼Ÿæˆ‘è®¤ä¸ºä¸“æ³¨å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€æ˜¯â€œä¸€æ¬¡åªåšä¸€ä»¶äº‹â€ï¼ŒäºŒæ˜¯â€œå°½é‡é¿å…è¢«æ‰“æ–­â€ï¼Œå³è§‚ç‚¹ä¸€ã€‚ ä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼šå¯èƒ½å·¥ä½œçš„äº‹æƒ…å¾ˆå¤šï¼Œä½†æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œæ€»èƒ½æ‰¾å‡ºä¸€ä»¶å½“å‰æœ€åº”è¯¥åšçš„äº‹ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‰¾å‡ºè¿™ä»¶äº‹ï¼Œå¼€å§‹åšè¿™ä»¶äº‹æƒ…ï¼Œåœ¨è¿™ä»¶äº‹æƒ…å‘Šä¸€æ®µè½ä¹‹å‰ï¼Œä¸è€ƒè™‘å…¶ä»–äº‹æƒ…ã€‚ å°½é‡é¿å…è¢«æ‰“æ–­ï¼šå·¥ä½œè¢«æ‰“æ–­æ˜¯å¾ˆæ­£å¸¸çš„äº‹ï¼Œä¸‹å±žæ‰¾ä½ æ±‡æŠ¥è¿›åº¦ï¼Œä¸Šçº§æ‰¾ä½ äº†è§£è¿›åº¦ï¼ŒåŒäº‹æ‰¾ä½ å¯¹é½æ–¹æ¡ˆï¼Œå®¢æˆ·æ‰¾ä½ å’¨è¯¢é—®é¢˜ï¼Œç­‰ç­‰ã€‚æˆ‘ç›¸ä¿¡ç»å¤§å¤šæ•°äººéƒ½æ— æ³•å®Œå…¨é¿å…å·¥ä½œè¢«æ‰“æ–­ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½åšçš„åªèƒ½æ˜¯å°½é‡é¿å…ã€‚å…·ä½“æ–¹æ³•è§ä»è§æ™ºï¼Œæˆ‘çš„åº”å¯¹æ–¹æ³•æ˜¯å¦‚æžœèƒ½æŽ¨åˆ™æŽ¨ï¼ˆæœ‰äº›äº‹æƒ…å…¶å®žä¸éœ€è¦äº²åŠ›äº²ä¸ºï¼‰ï¼Œèƒ½å»¶åˆ™å»¶ï¼ˆæœ‰äº›äº‹æƒ…å…¶å®žä¸æ˜¯é‚£ä¹ˆç´§æ€¥ï¼Œæ™šå‡ ä¸ªå°æ—¶å¤„ç†æ²¡ä»€ä¹ˆé—®é¢˜ï¼‰ï¼Œå®šæœŸå¤„ç†é‚®ä»¶ä¸Žå†…éƒ¨é€šè®¯å·¥å…·ï¼Œå®šæœŸå¤„ç†æ‰‹æœºä¿¡æ¯ã€‚å¯¹äºŽå®žåœ¨æ— æ³•é¿å…çš„æƒ…å†µï¼Œåœä¸‹æ‰‹ä¸Šçš„äº‹æƒ…ï¼Œä¿å­˜å¥½å½“å‰è¿›åº¦ï¼Œæœ€å¥½èƒ½è®°å½•ä¸‹æ¥ï¼ŒæŽ¥ç€åšæ–°çš„äº‹æƒ…ã€‚å¦‚æžœæ¡ä»¶å…è®¸ï¼Œè·Ÿå¯¹æ–¹æ²Ÿé€šä»¥åŽå°½é‡åœ¨ç‰¹å®šæ—¶é—´æ‰¾ä½ ã€‚ ä¸€ç›´ä»¥æ¥ï¼Œæˆ‘éƒ½é è‡ªå·±çš„å¤§è„‘è®°ä½ä»€ä¹ˆæ—¶å€™è¯¥åšä»€ä¹ˆäº‹æƒ…ï¼Œå­¦ç”Ÿæ—¶ä»£æˆ‘ä»¬ä¸€èˆ¬åªéœ€è¦æŠŠæ‰€æœ‰çš„ç§‘ç›®è½®è¯¢ä¸€éï¼ŒåŸºæœ¬å°±å¯ä»¥ç¡®å®šä¸ä¼šæœ‰é—æ¼çš„äº‹æƒ…ï¼Œä½†å·¥ä½œä¹‹åŽï¼Œå„ç§å¤§å°äº‹æƒ…éƒ½éœ€è¦å®Œæˆï¼Œåªèƒ½å¤§è„‘è®°ä½çš„æˆ‘ï¼Œè‡ªç„¶å¿˜è®°äº†æŸäº›äº‹æƒ…ï¼Œç”šè‡³æ‰¿è¯ºåˆ«äººçš„äº‹æƒ…éƒ½æ²¡æœ‰å®Œæˆã€‚è¿™æ ·çš„åšæ³•å…¶å®žæ˜¯ä¸ªæ¶æ€§å¾ªçŽ¯ï¼Œä¹‹å‰è¢«å¿˜è®°çš„äº‹æƒ…ä¼šä¸æ–­æˆä¸ºæ‰“æ–­ä½ å½“å‰å·¥ä½œçš„æ¥æºã€‚ å¦‚ä½•åº”å¯¹è¿™ç§å›°å¢ƒï¼Ÿæˆ‘è®¤ä¸ºæœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯æŠŠè¦åšçš„æ¯ä¸€ä»¶äº‹æƒ…è®°ä¸‹æ¥ï¼Œåˆ†æ¸…ç´§æ€¥ä¸Žé‡è¦ç¨‹åº¦ï¼Œç„¶åŽä¸€ä»¶ä¸€ä»¶å®Œæˆã€‚æ ¹æ®ä¹¦ä¸­æè¿°çš„æ–¹æ³•ï¼Œæˆ‘å®žé™…è®°å½•äº†ä¸¤ä»½æ¸…å•ï¼Œä¸€æ˜¯â€œæ´»åŠ¨æ¸…å•â€ï¼ŒäºŒæ˜¯â€œä»Šæ—¥å¾…åŠžâ€ï¼Œå³è§‚ç‚¹äºŒçš„å‰åŠéƒ¨åˆ†ã€‚ â€œæ´»åŠ¨æ¸…å•â€ç”¨äºŽè®°å½•æ¯ä¸€ä»¶æˆ‘è¦å¤„ç†çš„äº‹æƒ…ï¼Œåœ¨æ¯å¤©å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œè¿™ä»½æ¸…å•ä¼šä¸æ–­æ›´æ–°ï¼Œæˆ‘ä¸ä»…è®°å½•è¦åšä»€ä¹ˆäº‹æƒ…ï¼Œè¿˜ä¼šæ ‡æ³¨è¿™ä»¶äº‹æƒ…çš„ç´§æ€¥ä¸Žé‡è¦ç¨‹åº¦ã€ç›¸å…³äººç­‰ä¿¡æ¯ï¼Œç¡®ä¿æˆ‘åŽé¢çœ‹åˆ°å®ƒçš„æ—¶å€™çŸ¥é“æˆ‘å…·ä½“è¦åšä»€ä¹ˆã€‚â€œä»Šæ—¥å¾…åŠžâ€åˆ™ç”¨äºŽè®°å½•æˆ‘ä»Šå¤©è¦åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ‘ä¼šåœ¨å¼€å§‹æ¯å¤©çš„å·¥ä½œä¹‹å‰ï¼Œä»Žæ´»åŠ¨æ¸…å•é‡Œé¢é€‰æ‹©ä¸€äº›æˆ‘ä»Šå¤©è¦å®Œæˆçš„äº‹æƒ…æ”¾åˆ°â€œä»Šæ—¥å¾…åŠžâ€ã€‚å¦‚æžœé‡åˆ°ä¸€äº›ç´§æ€¥çš„äº‹æƒ…ä¸€å®šè¦åœ¨ä»Šå¤©å®Œæˆï¼Œæˆ‘ä¹Ÿä¼šæŠŠå®ƒåŠ å…¥â€œä»Šæ—¥å¾…åŠžâ€ï¼Œä½†æ˜¯ä¼šæ ‡æ³¨è¿™äº›æ„æ–™ä¹‹å¤–çš„äº‹æƒ…ï¼Œè¦åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹å®Œæˆã€‚ é‚£ä¹ˆå¦‚ä½•è¡¡é‡å·¥ä½œæ•ˆçŽ‡å‘¢ï¼Ÿæˆ‘æ˜¯é€šè¿‡â€œç•ªèŒ„æ—¶é—´â€æ¥è®°å½•æˆ‘çš„å·¥ä½œå¹¶ä¸”è¡¡é‡æ•ˆçŽ‡çš„ã€‚ â€œç•ªèŒ„å·¥ä½œæ³•â€å¾ˆæ ¸å¿ƒçš„ä¸€ä¸ªå·¥å…·ï¼Œå°±æ˜¯â€œç•ªèŒ„æ—¶é—´â€ï¼Œå®ƒå…¶å®žå¾ˆç®€å•ã€‚ä¸€ä¸ªâ€œç•ªèŒ„æ—¶é—´â€ï¼Œç”±ä¸€ä¸ªâ€œç•ªèŒ„å·¥ä½œæ—¶é—´â€å’Œä¸€ä¸ªâ€œç•ªèŒ„ä¼‘æ¯æ—¶é—´â€æž„æˆï¼Œæ—¶é—´é•¿çŸ­å¯ä»¥æŒ‰ä¸ªäººä¹ æƒ¯ä¸Žå–œå¥½è®¾å®šï¼Œæ¯”è¾ƒæ ‡å‡†çš„æ˜¯25åˆ†é’Ÿå·¥ä½œæ—¶é—´+5åˆ†é’Ÿä¼‘æ¯æ—¶é—´ã€‚ä¸Šé¢æåˆ°ä¸€æ¬¡åªåšä¸€ä»¶äº‹ï¼Œé€‰å®šå¥½çŽ°åœ¨è¦åšçš„äº‹æƒ…ä¹‹åŽï¼ŒæŒç»­åœ°åœ¨æŽ¥ä¸‹æ¥çš„25åˆ†é’Ÿé‡Œåšè¿™ä»¶äº‹æƒ…ã€‚25åˆ†é’Ÿæ—¶é—´åˆ°ï¼Œè®°å½•å½“å‰çš„è¿›åº¦ï¼Œåœä¸‹æ¥ä¼‘æ¯5åˆ†é’Ÿï¼Œå¯ä»¥ç«™èµ·æ¥èµ°èµ°ï¼Œå–æ°´ï¼Œä¸ŠåŽ•æ‰€ï¼Œå¤„ç†ä¸é‡è¦çš„é‚®ä»¶ä¸Žé€šè®¯ä¿¡æ¯ç­‰ç­‰ã€‚ æˆ‘æ¯å¤©æŠŠâ€œæ´»åŠ¨æ¸…å•â€ä¸­çš„äº‹æƒ…è®°å½•åˆ°â€œä»Šæ—¥å¾…åŠžâ€çš„æ—¶å€™ï¼Œä¼šå¤§æ¦‚ä¼°ç®—æ¯ä¸€ä»¶äº‹æƒ…éœ€è¦è€—è´¹æˆ‘å¤šå°‘æ—¶é—´ï¼Œå³å¤šå°‘ä¸ªâ€œç•ªèŒ„æ—¶é—´â€ã€‚æ¯å®Œæˆä¸€ä¸ªâ€œç•ªèŒ„å·¥ä½œæ—¶é—´â€ï¼Œæˆ‘éƒ½ä¼šè®°å½•ä¸‹æ¥ï¼Œæœ€ç»ˆæ¯å¤©å®Œæˆçš„â€œç•ªèŒ„æ—¶é—´â€å°±å¯ä»¥ç”¨æ¥è¡¡é‡å½“å¤©çš„å·¥ä½œæ•ˆçŽ‡ã€‚å¦‚æžœæŸäº›äº‹æƒ…ä¸éœ€è¦25åˆ†é’Ÿå³å¯å®Œæˆï¼Œé‚£ä¹ˆæˆ‘ä¼šæŠŠè¿™äº›äº‹æƒ…åˆå¹¶èµ·æ¥åšï¼Œå¦‚æžœæŸäº›äº‹æƒ…è¦èŠ±è´¹å¾ˆå¤šä¸ª25åˆ†é’Ÿï¼Œé‚£ä¹ˆæˆ‘ä¼šè€ƒè™‘æŠŠè¿™äº›äº‹æƒ…å†æ‹†ç»†ï¼Œæ–¹ä¾¿æˆ‘ä¼°ç®—éœ€è¦èŠ±è´¹çš„æ—¶é—´ã€‚é•¿æ­¤ä»¥å¾€ï¼ŒæŠŠæ¯å¤©å®Œæˆçš„â€œç•ªèŒ„æ—¶é—´â€ç”»æˆè¡¨æ ¼ï¼Œå°±å¯ä»¥çœ‹å‡ºå·¥ä½œæ•ˆçŽ‡å˜åŒ–çš„è¶‹åŠ¿äº†ï¼Œè¿™ä¹Ÿæ˜¯è§‚ç‚¹äºŒçš„åŽåŠéƒ¨åˆ†æƒ³è¡¨è¾¾çš„æ„æ€ã€‚ è¿™ä¸ªæ–¹æ³•æˆ‘å®žè·µäº†ä¸¤å‘¨æ—¶é—´ï¼Œè™½ç„¶è¿˜ä¸å¤Ÿé•¿ä¹…ï¼Œä½†æ˜¯å·¥ä½œæ•ˆçŽ‡æœ‰æ˜Žæ˜¾æå‡ï¼Œæœ€ç®€å•æœ‰åŠ›çš„è¯´æ˜Žå°±æ˜¯æ¯å¤©éƒ½æœ‰ä¸å°‘ä»£ç äº§å‡ºï¼Œç¬¦åˆé¢„æœŸç›®æ ‡ã€‚ çœŸå¿ƒå»ºè®®æœ‰å·¥ä½œæ•ˆçŽ‡é—®é¢˜çš„æœ‹å‹ï¼Œè¯»ä¸€è¯»è¿™æœ¬ä¹¦ï¼Œè±†ç“£é“¾æŽ¥åœ¨æ­¤ ã€Šç•ªèŒ„å·¥ä½œæ³•å›¾è§£ã€‹ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ç…§ç‰‡é›†]]></title>
      <url>%2F2017%2F02%2F28%2Feveryday-picture%2F</url>
      <content type="text"><![CDATA[2017-0214th 10th 8th 5th 4th 1st 2017-0131th 27th 26th 24th 23rd 22nd 21st 19th 18th 16th 15th 13th 12th 11th 2016-1230th]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[é¢è¯•é¢˜æ•´ç†]]></title>
      <url>%2F2017%2F02%2F22%2Finterview-questions%2F</url>
      <content type="text"><![CDATA[ç¼–ç¨‹è¯­è¨€æŠ€æœ¯è¦ç‚¹C/C++Php PythonJavaGoShellé¢è¯•é¢˜ç›®Linuxç³»ç»Ÿå‘½ä»¤æŠ€æœ¯è¦ç‚¹ç›‘æŽ§æ–‡ä»¶æ“ä½œé¢è¯•é¢˜ç›®æ“ä½œç³»ç»ŸæŠ€æœ¯è¦ç‚¹è¿›ç¨‹ä¸Žçº¿ç¨‹åç¨‹Core dumpé¢è¯•é¢˜ç›®ç½‘ç»œæŠ€æœ¯è¦ç‚¹DNSHTTPTCP TIME_WAIT UDPé¢è¯•é¢˜ç›®WebæœåŠ¡å™¨æŠ€æœ¯è¦ç‚¹æœåŠ¡å™¨ç¼–ç¨‹æ¨¡åž‹ åŒæ­¥/å¼‚æ­¥ é˜»å¡ž/éžé˜»å¡ž select/poll/epoll Nginx æœåŠ¡å™¨æ¨¡åž‹ æ¨¡å—åŒ– Apache æœåŠ¡å™¨æ¨¡åž‹ å…¶ä»–è‡ªç ”server åŽŸç† ä¼˜ç¼ºç‚¹ é¢è¯•é¢˜ç›®å­˜å‚¨æŠ€æœ¯è¦ç‚¹MySQL å­˜å‚¨å¼•æ“Ž èšç°‡ç´¢å¼• äº‹åŠ¡éš”ç¦»çº§åˆ« ç´¢å¼•ä¼˜åŒ– TdSQL è‡ªåŠ¨åˆ†åº“åˆ†è¡¨ MongoDBRedis æ•°æ®ç±»åž‹ æŒä¹…åŒ– Memcachedé¢è¯•é¢˜ç›®åˆ†å¸ƒå¼ç³»ç»ŸæŠ€æœ¯è¦ç‚¹å¼‚å¸¸å¤„ç† ç½‘ç»œè¶…æ—¶ æœåŠ¡å¤±æ•ˆ åˆ†å¸ƒå¼äº‹åŠ¡ä¸¤é˜¶æ®µæäº¤/ä¸‰é˜¶æ®µæäº¤Paxosåè®®Raftåè®®RPCé¢è¯•é¢˜ç›®ä¸­é—´ä»¶æŠ€æœ¯è¦ç‚¹æ¶ˆæ¯é˜Ÿåˆ—è¿žæŽ¥æ± çº¿ç¨‹æ± é¢è¯•é¢˜ç›®é¡¹ç›®ç»åŽ†]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è°ˆè°ˆé‡æž„]]></title>
      <url>%2F2017%2F02%2F18%2Fsystem-reconstruction%2F</url>
      <content type="text"><![CDATA[æœ€è¿‘å‡ ä¸ªæœˆä¸“é—¨åœ¨åšç³»ç»Ÿé‡æž„ï¼Œå†™ç‚¹ä¸œè¥¿è®°å½•è‡ªå·±çš„å¿ƒå¾—ã€‚ é¦–å…ˆè¯´è¯´æˆ‘çš„ç»åŽ†ã€‚æ›´æ¢å›¢é˜Ÿä¹‹åŽï¼Œæˆ‘ä»ŽæŽ¥æ‰‹ç³»ç»Ÿåˆ°å¼€å§‹é‡æž„ï¼Œå¤§æ¦‚æœ‰ä¸€å¹´åŠçš„æ—¶é—´ï¼Œæ—¶é—´ä¸çŸ­ï¼Œå› æ­¤æˆ‘æŠŠå®ƒåˆ’åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µæ¥æè¿°ï¼š ç†Ÿæ‚‰é˜¶æ®µ æŽ¥æ‰‹ç³»ç»Ÿä¹‹åŽï¼Œç”±äºŽä¸šåŠ¡éœ€æ±‚æŽ’æœŸæ¯”è¾ƒæ€¥ï¼Œæˆ‘å¹¶æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å¯ä»¥é€šè¿‡é˜…è¯»ä»£ç ç†Ÿæ‚‰ç³»ç»Ÿçš„æ‰€æœ‰è®¾è®¡ä¸Žé€»è¾‘ï¼Œåªèƒ½æ‘¸ç€çŸ³å¤´è¿‡æ²³ã€‚æŽ¥åˆ°ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œå¾€å¾€éƒ½æ˜¯å…ˆäº†è§£éœ€æ±‚çš„å‰å› åŽæžœï¼Œç„¶åŽåœ¨å‰è¾ˆçš„æŒ‡å¯¼ä¸‹äº†è§£ç³»ç»Ÿå¯¹åº”éƒ¨åˆ†çš„å¤§è‡´å®žçŽ°ï¼Œç”±äºŽå‰æœŸåˆ†é…ç»™æˆ‘çš„éœ€æ±‚ä¸€èˆ¬éƒ½æ¯”è¾ƒå°ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘éƒ½æ˜¯å…ˆäº†è§£ç³»ç»Ÿç‰¹å®šéƒ¨åˆ†çš„é€»è¾‘ï¼Œç„¶åŽåŠ ä»¥ä¿®æ”¹ã€‚å¯¹ç³»ç»ŸæŽ¥è§¦å’Œå˜æ›´è¶Šæ¥è¶Šå¤šï¼ŒåŠ ä¸Šå‰è¾ˆçš„æŒ‡å¯¼ï¼Œæˆ‘å¯¹ç³»ç»Ÿçš„è®¾è®¡ä¸ŽåŠŸèƒ½ä¹Ÿæ¸æ¸ç†Ÿæ‚‰ã€‚è¿™ä¸€é˜¶æ®µå¤§æ¦‚æŒç»­äº†ä¸‰ä¸ªæœˆï¼Œè™½ç„¶æœ‰å¾ˆå¤šä¸šåŠ¡éœ€æ±‚ï¼Œæœ‰äº›éœ€æ±‚å¾ˆç´§æ€¥ï¼Œä½†æ¯•ç«Ÿæ˜¯æ–°äººï¼Œå¾ˆå¤šä¸šåŠ¡åŽ‹åŠ›æ²¡æœ‰é€ä¼ åˆ°æˆ‘è¿™é‡Œã€‚ æ”¹è¿›é˜¶æ®µ ç†Ÿæ‚‰ç³»ç»Ÿä¹‹åŽï¼Œæˆ‘å¼€å§‹æŽ¥è§¦æ›´å¤šéœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£éƒ¨åˆ†æ¨¡å—çš„åŽç»­è§„åˆ’ä¸ŽæŠ€æœ¯ä¼˜åŒ–ã€‚è¿™ä¸€é˜¶æ®µæˆ‘ä¸ä»…è¦è€ƒè™‘éœ€æ±‚çš„å®žçŽ°ï¼ŒåŒæ—¶è¦è€ƒè™‘å¦‚ä½•åˆç†åœ°å®žçŽ°ã€‚æ‰€ä»¥æˆ‘åšçš„æ›´å¤šçš„äº‹æƒ…æ˜¯æ¨¡å—åŠŸèƒ½ä¸Žè®¾è®¡çš„æ¢³ç†ï¼Œå°†è€¦åˆåœ¨ä¸€èµ·çš„åŠŸèƒ½æ‹†åˆ†æˆä¸åŒçš„å­æ¨¡å—ï¼Œå°†å®žçŽ°ä¸åˆç†çš„éƒ¨åˆ†é€»è¾‘é‡æ–°å®žçŽ°ï¼Œå½“ç„¶è¿™äº›äº‹æƒ…å¾ˆå¤šæ—¶å€™éƒ½æ˜¯è·Ÿéšéœ€æ±‚ä¸€èµ·å®Œæˆçš„ï¼Œåœ¨ä¸šåŠ¡å‘å±•è¿…é€Ÿçš„æ—¶å€™ï¼Œå¾ˆéš¾åœä¸‹æ¥ä¸“é—¨åšä¼˜åŒ–ã€‚ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€é˜¶æ®µï¼Œå›¢é˜Ÿå‘å±•ï¼Œæœ‰æ›´å¤šçš„æ–°äººåŠ å…¥ï¼Œæˆ‘å¼€å§‹å¸¦æ–°äººæŽ¥æ‰‹è¿™äº›æ¨¡å—ï¼Œè®©ä»–ä»¬é¡ºåˆ©è¿›å…¥â€œç†Ÿæ‚‰é˜¶æ®µâ€ã€‚è¿™ä¸€é˜¶æ®µå¤§æ¦‚æŒç»­äº†å…­ä¸ªæœˆï¼Œæˆ‘ä»Žæ–°äººå˜æˆäº†éƒ¨åˆ†ç³»ç»Ÿæ¨¡å—çš„ownerï¼Œå¯¹ç³»ç»Ÿçš„æ•´ä½“å®žçŽ°ä¸Žé€»è¾‘éƒ½æœ‰äº†è¶³å¤Ÿçš„äº†è§£ã€‚ è¸©å‘é˜¶æ®µ ä¸šåŠ¡å‘å±•è¶Šæ¥è¶Šå¿«ï¼Œéœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œç”±äºŽç³»ç»Ÿçš„å¤æ‚åº¦å¤ªé«˜ï¼Œå¾ˆå¤šæ—¶å€™åªèƒ½é€šè¿‡å¢žåŠ äººåŠ›æ¥è§£å†³é—®é¢˜ï¼Œè€Œæ–°äººå¯¹ç³»ç»Ÿäº†è§£ä¸æ·±å…¥ï¼Œå¯èƒ½è®©ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¯¼è‡´æ¶æ€§å¾ªçŽ¯ã€‚æˆ‘è·Ÿè€å¤§è¡¨æ˜Žæˆ‘æƒ³é‡æž„æ‰‹ä¸Šçš„éƒ¨åˆ†æ¨¡å—ï¼Œè¿™ä¸ªè®©æˆ‘æ­£å¼è¿›å…¥è¸©å‘é˜¶æ®µã€‚æˆ‘ä¹‹å‰æ²¡æœ‰å¤§è§„æ¨¡é‡æž„çš„ç»éªŒï¼Œæœ‰çš„åªæ˜¯ä¸€äº›å°è§„æ¨¡çš„é‡æ–°è®¾è®¡ä¸Žå®žçŽ°ï¼Œè¿™ä¸€æ¬¡ï¼Œæˆ‘å¸Œæœ›æ˜¯æŠŠæ¨¡å—éƒ¨åˆ†åŠŸèƒ½é‡æ–°å®žçŽ°ã€‚æˆ‘æŒ‰ç…§è‡ªå·±å¯¹ä¸šåŠ¡çš„äº†è§£ï¼Œä»¥è‡ªå·±è®¤ä¸ºåˆç†çš„æ–¹å¼ï¼ŒèŠ±äº†ä¸€ä¸ªå¤šæœˆæ—¶é—´å®Œæˆäº†ã€‚æ–°é€»è¾‘æµ‹è¯•å‘å¸ƒä¸Šçº¿ä¹‹åŽï¼Œæˆ‘ä»¬ä¸æ–­æŽ¥åˆ°å„ç§å’¨è¯¢ä¸ŽæŠ•è¯‰ï¼Œé—®é¢˜é›†ä¸­åœ¨æˆ‘é‡å†™çš„è¿™éƒ¨åˆ†åŠŸèƒ½ä¸Šé¢ï¼Œå¾ˆå¤šè¾¹ç¼˜åŠŸèƒ½æˆ‘å¹¶æ²¡æœ‰è€ƒè™‘æ¸…æ¥šï¼Œå¯¼è‡´çº¿ä¸Šæ•…éšœé¢‘çŽ°ã€‚æˆ‘åˆèŠ±äº†ä¸€ä¸ªå¤šæœˆæ—¶é—´å¤„ç†å„ç§æŠ•è¯‰ï¼Œä¿®å¤æ–°é€»è¾‘å¸¦æ¥çš„å„ç§é—®é¢˜ã€‚è¿™ä¸€é˜¶æ®µä¹ŸæŒç»­ä¸‰ä¸ªæœˆå·¦å³ï¼Œè¿™æ¬¡å¤±è´¥çš„é‡æž„ç»åŽ†è®©æˆ‘å­¦ä¹ åˆ°ä¸å°‘æ–°çš„ä¸œè¥¿ï¼Œå¤§æ¦‚å½’ç±»ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š (1) é‡æž„çš„å¤§å‰ææ˜¯ç³»ç»Ÿç¨³å®šè¿è¡Œï¼Œä¸èƒ½ä»¥ç‰ºç‰²ç³»ç»Ÿç¨³å®šæ€§ä¸ºä»£ä»· (2) é‡æž„çš„åŠŸèƒ½æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œä¸èƒ½åªé äººæ¥ä¿è¯ï¼Œè¦å»ºç«‹å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯æ–°é€»è¾‘ (3) åè®®è¦åšå¥½å…¼å®¹ä¸Žè½¬æ¢ï¼Œç³»ç»Ÿçš„é‡æž„æ˜¯ç³»ç»Ÿå†…éƒ¨çš„å˜åŒ–ï¼Œå¯¹å¤–æš´éœ²çš„æŽ¥å£åº”è¯¥æ˜¯ä¸å˜çš„ é‡æž„å‡†å¤‡é˜¶æ®µ è¸©å‘ä¹‹åŽï¼Œæˆ‘å‘çŽ°å¾ˆå¤šç³»ç»Ÿçš„è¾¹ç¼˜åŠŸèƒ½æˆ‘è¿˜æ— æ³•å®Œå…¨æŽŒæ¡ï¼Œæ‰€ä»¥æˆ‘åˆèŠ±äº†ç›¸å½“é•¿çš„æ—¶é—´æ¢³ç†çŽ°æœ‰ç³»ç»Ÿçš„é€»è¾‘ä¸Žå®žçŽ°ï¼ŒåŒæ—¶ç€æ‰‹å»ºç«‹å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚æ¯æ¬¡ç³»ç»Ÿå˜æ›´ï¼Œæˆ‘ä»¬éƒ½é¦–å…ˆåœ¨é¢„å‘å¸ƒçŽ¯å¢ƒä¸Šè·‘ä¸€éç”¨ä¾‹ï¼Œä¿è¯æ²¡é—®é¢˜ä¹‹åŽå†å‘å¸ƒä¸Šçº¿ã€‚ä½†æ˜¯ç³»ç»Ÿçš„è®¾è®¡ä¸Žå®žçŽ°çš„ä¸åˆç†ï¼Œè¿˜æ˜¯æˆä¸ºäº†æˆ‘ä»¬å›¢é˜Ÿå‰è¿›çš„é˜»åŠ›ï¼Œå›¢é˜Ÿå› æ­¤ä¸“é—¨æŠ½å‡ºéƒ¨åˆ†äººåŠ›è¿›è¡Œé‡æž„ã€‚ä»Žä¸Šä¸€æ¬¡å¤±è´¥çš„é‡æž„åˆ°ç«‹é¡¹é‡æ–°è¿›è¡Œé‡æž„ï¼Œæˆ‘ä»¬åˆç»åŽ†äº†å¤§æ¦‚å››ä¸ªå¤šæœˆã€‚ å…¶æ¬¡è¯´è¯´æˆ‘å¯¹é‡æž„çš„ç†è§£ã€‚æˆ‘è®¤ä¸ºé‡æž„å¹¶ä¸æ˜¯å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œé‡å†™ï¼Œå®ƒåº”è¯¥æ˜¯å¹³æ—¶å¯¹ç³»ç»Ÿä¸åˆç†çš„è®¾è®¡ä¸Žå®žçŽ°çš„ä¸æ–­æ”¹è¿›ã€‚ æŽ¥ç€è¯´è¯´ä¸ºä»€ä¹ˆè¦é‡æž„ã€‚æˆ‘è§‰å¾—é‡æž„çš„åŽŸå› æœ‰ä¸¤ä¸ªï¼Œå…¶ä¸€æ˜¯ç¨‹åºå‘˜çš„å¤©æ€§ï¼Œå…¶äºŒæ˜¯ç³»ç»Ÿçš„è®¾è®¡ä¸Žå˜æ›´ã€‚ ç¨‹åºå‘˜çš„å¤©æ€§ ä½œä¸ºç¨‹åºå‘˜ï¼Œæ— è®ºæ˜¯åˆšæ¯•ä¸šåŠ å…¥ç¬¬ä¸€å®¶å…¬å¸ï¼Œè¿˜æ˜¯å·¥ä½œä¹‹åŽè·³æ§½åˆ°å…¶ä»–å…¬å¸ï¼Œä»Žé›¶å¼€å§‹å¼€å‘ä¸€ä¸ªæ–°ç³»ç»Ÿçš„æœºçŽ‡æ˜¯æ¯”è¾ƒä½Žçš„ã€‚ä½œä¸ºæ–°äººï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å…ˆæŽ¥æ‰‹å¹¶ç†Ÿæ‚‰å½“å‰ç³»ç»Ÿï¼Œäº†è§£å®ƒçš„é€»è¾‘ä¸Žå®žçŽ°ï¼Œå¹¶é…åˆä¸šåŠ¡éœ€æ±‚ä¸æ–­å®Œå–„ç³»ç»Ÿçš„åŠŸèƒ½ä¸Žè®¾è®¡ã€‚ç»å¤§å¤šæ•°ç¨‹åºå‘˜éƒ½æ˜¯æœ‰è¿½æ±‚çš„ï¼Œå½“æˆ‘ä»¬è¶³å¤Ÿäº†è§£çŽ°æœ‰ç³»ç»Ÿä¹‹åŽï¼ŒçŽ°æœ‰ç³»ç»Ÿå®žçŽ°ä¸åˆç†çš„åœ°æ–¹å¿…ç„¶ä¼šæˆä¸ºæˆ‘ä»¬çš„çœ¼ä¸­é’‰ï¼Œæˆ‘ä»¬æ€»ä¼šæ‰¾æœºä¼šè¿›è¡Œé‡æž„ã€‚ ç³»ç»Ÿçš„è®¾è®¡ä¸Žå˜æ›´ æ²¡æœ‰ä¸€ä¸ªç³»ç»Ÿæ˜¯å®Œç¾Žçš„ï¼Œæˆ–è€…è¯´æ²¡æœ‰ä¸€ä¸ªç³»ç»Ÿåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œå°±èƒ½é¢„è§åˆ°ä»¥åŽçš„æ‰€æœ‰éœ€æ±‚åœºæ™¯ã€‚æœ‰çš„ç³»ç»Ÿå¯èƒ½åœ¨è®¾è®¡ä¸Žå®žçŽ°ä¹‹åˆå°±ç•™ä¸‹äº†éžå¸¸è¯¦å°½çš„æ–‡æ¡£è¯´æ˜Žï¼Œåœ¨ç›¸å½“é•¿çš„æ—¶é—´å†…ï¼ŒåŽæ¥è€…éƒ½å¯ä»¥åœ¨åŽŸæ¥çš„æ¡†æž¶ä¸Šåˆç†åœ°æ·»åŠ æ–°åŠŸèƒ½ã€‚è€Œæœ‰çš„ç³»ç»Ÿå¯èƒ½è¿žä»£ç æ³¨é‡Šéƒ½æžå°‘ï¼ŒåŽæ¥è€…å¾€å¾€å¿½ç•¥åŽŸæ¥è®¾è®¡çš„åˆè¡·ï¼ŒæŒ‰è‡ªå·±çš„ç†è§£æ¥å¼€å‘æ–°çš„åŠŸèƒ½ã€‚éšç€æŽ¥æ‰‹ç³»ç»Ÿçš„äººè¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿçš„åŠŸèƒ½è¶Šæ¥è¶Šå¤æ‚ï¼Œä¸€äº›é—®é¢˜é€æ¸æš´éœ²å‡ºæ¥ã€‚è¿™é‡Œåˆ—å‡ºå‡ ç±»å¯èƒ½ä¿ƒä½¿æˆ‘ä»¬è¿›è¡Œç³»ç»Ÿé‡æž„çš„é—®é¢˜ï¼š (1) ç³»ç»ŸåŽŸæœ¬çš„è®¾è®¡ä¸åˆç†ï¼Œå¯èƒ½æ˜¯æ•°æ®æ¨¡åž‹è®¾è®¡ä¸åˆç†ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»£ç æ¡†æž¶è®¾è®¡ä¸åˆç†ï¼Œæ€»ä¹‹è¿™äº›ä¸åˆç†çš„è®¾è®¡ä½¿å¾—å®žçŽ°æ–°çš„éœ€æ±‚ä¸Žç‰¹æ€§å˜å¾—ååˆ†å›°éš¾ã€‚ (2) ç³»ç»Ÿå¤æ‚åº¦å¤ªé«˜ï¼Œå„ç±»åŠŸèƒ½ä¸Žå®žçŽ°è€¦åˆåœ¨ä¸€èµ·ï¼Œä»»ä½•çš„å°ä¿®æ”¹éƒ½å¯èƒ½å½±å“åˆ°åˆ«çš„åŠŸèƒ½ï¼Œä»»ä½•çš„ç³»ç»Ÿå˜æ›´éƒ½å¯èƒ½å¯¼è‡´çŽ°ç½‘æ•…éšœï¼Œè¿™ä¸ªå°±åƒæˆ‘ä»¬å¸¸è¯´çš„â€œç³»ç»Ÿå·²ç»æ”¹ä¸åŠ¨äº†â€ã€‚ (3) ç³»ç»Ÿä½¿ç”¨çš„æŠ€æœ¯æˆ–æ¡†æž¶å¤ªæ—§ï¼Œæˆ–è€…å·²ç»æ²¡æœ‰å¾ˆå¥½çš„ç¤¾åŒºä¸Žå®˜æ–¹æ”¯æŒã€‚ æœ€åŽè¯´è¯´å¦‚ä½•è¿›è¡Œé‡æž„ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è¦æœ‰èƒ½åŠ›ä¿è¯é‡æž„ä¸ä¼šå½±å“æˆ‘ä»¬ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œï¼Œä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ˜¯å»ºç«‹å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æˆ‘ä»¬ç³»ç»Ÿçš„æ‰€æœ‰ä½¿ç”¨åœºæ™¯ï¼Œæ¯æ¬¡å˜æ›´å‰éƒ½ç»Ÿä¸€æ‰§è¡Œä¸€éã€‚å»ºè®®å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹çš„ä¸€ç§æ–¹æ³•æ˜¯å¯¹è¶³å¤Ÿé•¿æ—¶é—´å†…çº¿ä¸Šç³»ç»Ÿçš„è¯·æ±‚æ—¥å¿—è¿›è¡Œå½’ç±»ä¸Žè®°å½•ï¼Œç”¨å®žé™…çš„æ•°æ®ä¸Žè¯·æ±‚æ¨¡æ‹Ÿçº¿ä¸Šçš„è¡Œä¸ºã€‚ å…¶æ¬¡ï¼Œå¼€å§‹è®¾è®¡æ–°ç³»ç»Ÿï¼Œä»Žåº•å±‚æ•°æ®æ¨¡åž‹ï¼ˆæ•°æ®åº“ï¼‰ï¼Œåˆ°ç³»ç»Ÿå±‚æ¬¡ä¸ŽåŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼Œåˆ°æ¯ä¸ªæ¨¡å—çš„ä»£ç ç»“æž„ã€‚ å†æ¬¡ï¼Œåšå¥½æ–°è€ç³»ç»Ÿçš„å…¼å®¹ï¼Œè¿™é‡Œå¯èƒ½åŒ…æ‹¬æ•°æ®æ¨¡åž‹çš„å…¼å®¹ï¼Œæ¯”å¦‚æ•°æ®åŒå†™ã€æ–°è€æ•°æ®å¯¹è´¦ç­‰ï¼Œä¹ŸåŒ…æ‹¬ç³»ç»Ÿåè®®çš„å…¼å®¹ï¼Œæ¯”å¦‚æŠ½è±¡å‡ºç»Ÿä¸€çš„åè®®è½¬æ¢å±‚ç­‰ã€‚ å†æ¬¡ï¼Œåšå¥½æ–°ç³»ç»Ÿçš„éªŒè¯ï¼Œæ–°ç³»ç»Ÿåœ¨äººå·¥éªŒè¯é€šè¿‡ä¹‹åŽï¼Œå¿…é¡»é€šè¿‡ä¹‹å‰å»ºç«‹çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹çš„éªŒè¯ã€‚ æœ€åŽï¼Œæ–°ç³»ç»Ÿä¸Šçº¿ï¼Œå»ºç«‹å›žæ»šæœºåˆ¶ï¼Œè€ƒè™‘é€šè¿‡ç°åº¦ç­‰æ‰‹æ®µé™ä½Žåˆ‡æ¢é£Žé™©ã€‚ æˆ‘è®¡åˆ’æŽ¥ä¸‹æ¥è¯»ä¸€è¯»ã€Šé‡æž„ï¼šæ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹è¿™æœ¬ä¹¦ï¼Œå­¦ä¹ å¦‚ä½•æ›´å¥½åœ°è¿›è¡Œé‡æž„ã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[MapReduceè®ºæ–‡]]></title>
      <url>%2F2017%2F01%2F28%2Fmap-reduce%2F</url>
      <content type="text"><![CDATA[è‹±æ–‡ç‰ˆ MapReduce: Simplified Data Processing on Large ClustersJeffrey Dean and Sanjay Ghemawatjeff@google.com, sanjay@google.comGoogle, Inc AbstractMapReduce is a programming model and an associated implementation for processing and generating large data sets. Users specify a map function that processes a key/value pair to generate a set of intermediate key/value pairs, and a reduce function that merges all intermediate values associated with the same intermediate key. Many real world tasks are expressible in this model, as shown in the paper. Programs written in this functional style are automatically parallelized and executed on a large cluster of commodity machines. The run-time system takes care of the details of partitioning the input data, scheduling the programâ€™s execution across a set of machines, handling machine failures, and managing the required inter-machine communication. This allows programmers without any experience with parallel and distributed systems to easily utilize the resources of a large distributed system. Our implementation of MapReduce runs on a large cluster of commodity machines and is highly scalable: a typical MapReduce computation processes many terabytes of data on thousands of machines. Programmers find the system easy to use: hundreds of MapReduce programs have been implemented and upwards of one thousand MapReduce jobs are executed on Googleâ€™s clusters every day. 1 IntroductionOver the past five years, the authors and many others at Google have implemented hundreds of special-purpose computations that process large amounts of raw data, such as crawled documents, web request logs, etc., to compute various kinds of derived data, such as inverted indices, various representations of the graph structure of web documents, summaries of the number of pages crawled per host, the set of most frequent queries in a given day, etc. Most such computations are conceptually straightforward. However, the input data is usually large and the computations have to be distributed across hundreds or thousands of machines in order to finish in a reasonable amount of time. The issues of how to parallelize the computation, distribute the data, and handle failures conspire to obscure the original simple computation with large amounts of complex code to deal with these issues. As a reaction to this complexity, we designed a new abstraction that allows us to express the simple computations we were trying to perform but hides the messy details of parallelization, fault-tolerance, data distribution and load balancing in a library. Our abstraction is inspired by the map and reduce primitives present in Lisp and many other functional languages. We realized that most of our computations involved applying a map operation to each logical â€œrecordâ€ in our input in order to compute a set of intermediate key/value pairs, and then applying a reduce operation to all the values that shared the same key, in order to combine the derived data appropriately. Our use of a functional model with userspecified map and reduce operations allows us to parallelize large computations easily and to use re-execution as the primary mechanism for fault tolerance. The major contributions of this work are a simple and powerful interface that enables automatic parallelization and distribution of large-scale computations, combined with an implementation of this interface that achieves high performance on large clusters of commodity PCs. Section 2 describes the basic programming model and gives several examples. Section 3 describes an implementation of the MapReduce interface tailored towards our cluster-based computing environment. Section 4 describes several refinements of the programming model that we have found useful. Section 5 has performance measurements of our implementation for a variety of tasks. Section 6 explores the use of MapReduce within Google including our experiences in using it as the basis for a rewrite of our production indexing system. Section 7 discusses related and future work. 2 Programming ModelThe computation takes a set of input key/value pairs, and produces a set of output key/value pairs. The user of the MapReduce library expresses the computation as two functions: Map and Reduce. Map, written by the user, takes an input pair and produces a set of intermediate key/value pairs. The MapReduce library groups together all intermediate values associated with the same intermediate key I and passes them to the Reduce function. The Reduce function, also written by the user, accepts an intermediate key I and a set of values for that key. It merges together these values to form a possibly smaller set of values. Typically just zero or one output value is produced per Reduce invocation. The intermediate values are supplied to the userâ€™s reduce function via an iterator. This allows us to handle lists of values that are too large to fit in memory. 2.1 ExampleConsider the problem of counting the number of occurrences of each word in a large collection of documents. The user would write code similar to the following pseudo-code: 12345678910111213map(String key, String value): // key: document name // value: document contents for each word w in value: EmitIntermediate(w, &quot;1&quot;); reduce(String key, Iterator values): // key: a word // values: a list of counts int result = 0; for each v in values: result += ParseInt(v); Emit(AsString(result)); The map function emits each word plus an associated count of occurrences (just â€˜1â€™ in this simple example). The reduce function sums together all counts emitted for a particular word. In addition, the user writes code to fill in a mapreduce specification object with the names of the input and output files, and optional tuning parameters. The user then invokes the MapReduce function, passing it the specification object. The userâ€™s code is linked together with the MapReduce library (implemented in C++). Appendix A contains the full program text for this example. 2.2 TypesEven though the previous pseudo-code is written in terms of string inputs and outputs, conceptually the map and reduce functions supplied by the user have associated types: map (k1,v1) â†’ list(k2,v2)reduce (k2,list(v2)) â†’ list(v2) I.e., the input keys and values are drawn from a different domain than the output keys and values. Furthermore, the intermediate keys and values are from the same domain as the output keys and values. Our C++ implementation passes strings to and from the user-defined functions and leaves it to the user code to convert between strings and appropriate types. 2.3 More ExamplesHere are a few simple examples of interesting programs that can be easily expressed as MapReduce computations. Distributed Grep: The map function emits a line if it matches a supplied pattern. The reduce function is an identity function that just copies the supplied intermediate data to the output. Count of URL Access Frequency: The map function processes logs of web page requests and outputs (URL, 1). The reduce function adds together all values for the same URL and emits a (URL, total count) pair. Reverse Web-Link Graph: The map function outputs (target, source) pairs for each link to a target URL found in a page named source. The reduce function concatenates the list of all source URLs associated with a given target URL and emits the pair: (target, list(source)) Term-Vector per Host: A term vector summarizes the most important words that occur in a document or a set of documents as a list of (word, frequency) pairs. The map function emits a (hostname, term vector) pair for each input document (where the hostname is extracted from the URL of the document). The reduce function is passed all per-document term vectors for a given host. It adds these term vectors together, throwing away infrequent terms, and then emits a final (hostname, term vector) pair. Inverted Index: The map function parses each document, and emits a sequence of (word, document ID) pairs. The reduce function accepts all pairs for a given word, sorts the corresponding document IDs and emits a (word, list(document ID)) pair. The set of all output pairs forms a simple inverted index. It is easy to augment this computation to keep track of word positions. Distributed Sort: The map function extracts the key from each record, and emits a (key, record) pair. The reduce function emits all pairs unchanged. This computation depends on the partitioning facilities described in Section 4.1 and the ordering properties described in Section 4.2. 3 ImplementationMany different implementations of the MapReduce interface are possible. The right choice depends on the environment. For example, one implementation may be suitable for a small shared-memory machine, another for a large NUMA multi-processor, and yet another for an even larger collection of networked machines. This section describes an implementation targeted to the computing environment in wide use at Google: large clusters of commodity PCs connected together with switched Ethernet [4]. In our environment: Machines are typically dual-processor x86 processors running Linux, with 2-4 GB of memory per machine. Commodity networking hardware is used â€“ typically either 100 megabits/second or 1 gigabit/second at the machine level, but averaging considerably less in overall bisection bandwidth. A cluster consists of hundreds or thousands of machines, and therefore machine failures are common. Storage is provided by inexpensive IDE disks attached directly to individual machines. A distributed file system [8] developed in-house is used to manage the data stored on these disks. The file system uses replication to provide availability and reliability on top of unreliable hardware. Users submit jobs to a scheduling system. Each job consists of a set of tasks, and is mapped by the scheduler to a set of available machines within a cluster. 3.1 Execution OverviewFigure 1: Execution overview The Map invocations are distributed across multiple machines by automatically partitioning the input data into a set of M splits. The input splits can be processed in parallel by different machines. Reduce invocations are distributed by partitioning the intermediate key space into R pieces using a partitioning function (e.g., hash(key) mod R). The number of partitions (R) and the partitioning function are specified by the user. Figure 1 shows the overall flow of a MapReduce operation in our implementation. When the user program calls the MapReduce function, the following sequence of actions occurs (the numbered labels in Figure 1 correspond to the numbers in the list below): The MapReduce library in the user program first splits the input files into M pieces of typically 16 megabytes to 64 megabytes (MB) per piece (controllable by the user via an optional parameter). It then starts up many copies of the program on a cluster of machines. One of the copies of the program is special â€“ the master. The rest are workers that are assigned work by the master. There are M map tasks and R reduce tasks to assign. The master picks idle workers and assigns each one a map task or a reduce task. A worker who is assigned a map task reads the contents of the corresponding input split. It parses key/value pairs out of the input data and passes each pair to the user-defined Map function. The intermediate key/value pairs produced by the Map function are buffered in memory. Periodically, the buffered pairs are written to local disk, partitioned into R regions by the partitioning function. The locations of these buffered pairs on the local disk are passed back to the master, who is responsible for forwarding these locations to the reduce workers. When a reduce worker is notified by the master about these locations, it uses remote procedure calls to read the buffered data from the local disks of the map workers. When a reduce worker has read all intermediate data, it sorts it by the intermediate keys so that all occurrences of the same key are grouped together. The sorting is needed because typically many different keys map to the same reduce task. If the amount of intermediate data is too large to fit in memory, an external sort is used. The reduce worker iterates over the sorted intermediate data and for each unique intermediate key encountered, it passes the key and the corresponding set of intermediate values to the userâ€™s Reduce function. The output of the Reduce function is appended to a final output file for this reduce partition. When all map tasks and reduce tasks have been completed, the master wakes up the user program. At this point, the MapReduce call in the user program returns back to the user code. After successful completion, the output of the mapreduce execution is available in the R output files (one per reduce task, with file names as specified by the user). Typically, users do not need to combine these R output files into one file â€“ they often pass these files as input to another MapReduce call, or use them from another distributed application that is able to deal with input that is partitioned into multiple files. 3.2 Master Data StructuresThe master keeps several data structures. For each map task and reduce task, it stores the state (idle, in-progress, or completed), and the identity of the worker machine (for non-idle tasks). The master is the conduit through which the location of intermediate file regions is propagated from map tasks to reduce tasks. Therefore, for each completed map task, the master stores the locations and sizes of the R intermediate file regions produced by the map task. Updates to this location and size information are received as map tasks are completed. The information is pushed incrementally to workers that have in-progress reduce tasks. 3.3 Fault ToleranceSince the MapReduce library is designed to help process very large amounts of data using hundreds or thousands of machines, the library must tolerate machine failures gracefully. Worker FailureThe master pings every worker periodically. If no response is received from a worker in a certain amount of time, the master marks the worker as failed. Any map tasks completed by the worker are reset back to their initial idle state, and therefore become eligible for scheduling on other workers. Similarly, any map task or reduce task in progress on a failed worker is also reset to idle and becomes eligible for rescheduling. Completed map tasks are re-executed on a failure because their output is stored on the local disk(s) of the failed machine and is therefore inaccessible. Completed reduce tasks do not need to be re-executed since their output is stored in a global file system. When a map task is executed first by worker A and then later executed by worker B (because A failed), all workers executing reduce tasks are notified of the reexecution. Any reduce task that has not already read the data from worker A will read the data from worker B. MapReduce is resilient to large-scale worker failures. For example, during one MapReduce operation, network maintenance on a running cluster was causing groups of 80 machines at a time to become unreachable for several minutes. The MapReduce master simply re-executed the work done by the unreachable worker machines, and continued to make forward progress, eventually completing the MapReduce operation. Master FailureIt is easy to make the master write periodic checkpoints of the master data structures described above. If the master task dies, a new copy can be started from the last checkpointed state. However, given that there is only a single master, its failure is unlikely; therefore our current implementation aborts the MapReduce computation if the master fails. Clients can check for this condition and retry the MapReduce operation if they desire. Semantics in the Presence of FailuresWhen the user-supplied map and reduce operators are deterministic functions of their input values, our distributed implementation produces the same output as would have been produced by a non-faulting sequential execution of the entire program. We rely on atomic commits of map and reduce task outputs to achieve this property. Each in-progress task writes its output to private temporary files. A reduce task produces one such file, and a map task produces R such files (one per reduce task). When a map task completes, the worker sends a message to the master and includes the names of the R temporary files in the message. If the master receives a completion message for an already completed map task, it ignores the message. Otherwise, it records the names of R files in a master data structure. When a reduce task completes, the reduce worker atomically renames its temporary output file to the final output file. If the same reduce task is executed on multiple machines, multiple rename calls will be executed for the same final output file. We rely on the atomic rename operation provided by the underlying file system to guarantee that the final file system state contains just the data produced by one execution of the reduce task. The vast majority of our map and reduce operators are deterministic, and the fact that our semantics are equivalent to a sequential execution in this case makes it very easy for programmers to reason about their programâ€™s behavior. When the map and/or reduce operators are nondeterministic, we provide weaker but still reasonable semantics. In the presence of non-deterministic operators, the output of a particular reduce task R1 is equivalent to the output for R1 produced by a sequential execution of the non-deterministic program. However, the output for a different reduce task R2 may correspond to the output for R2 produced by a different sequential execution of the non-deterministic program. Consider map task M and reduce tasks R1 and R2. Let e(Ri) be the execution of Ri that committed (there is exactly one such execution). The weaker semantics arise because e(R1) may have read the output produced by one execution of M and e(R2) may have read the output produced by a different execution of M. 3.4 LocalityNetwork bandwidth is a relatively scarce resource in our computing environment. We conserve network bandwidth by taking advantage of the fact that the input data (managed by GFS [8]) is stored on the local disks of the machines that make up our cluster. GFS divides each file into 64 MB blocks, and stores several copies of each block (typically 3 copies) on different machines. The MapReduce master takes the location information of the input files into account and attempts to schedule a map task on a machine that contains a replica of the corresponding input data. Failing that, it attempts to schedule a map task near a replica of that taskâ€™s input data (e.g., on a worker machine that is on the same network switch as the machine containing the data). When running large MapReduce operations on a significant fraction of the workers in a cluster, most input data is read locally and consumes no network bandwidth. 3.5 Task GranularityWe subdivide the map phase into M pieces and the reduce phase into R pieces, as described above. Ideally, M and R should be much larger than the number of worker machines. Having each worker perform many different tasks improves dynamic load balancing, and also speeds up recovery when a worker fails: the many map tasks it has completed can be spread out across all the other worker machines. There are practical bounds on how large M and R can be in our implementation, since the master must make O(M + R) scheduling decisions and keeps O(M âˆ— R) state in memory as described above. (The constant factors for memory usage are small however: the O(M âˆ—R) piece of the state consists of approximately one byte of data per map task/reduce task pair.) Furthermore, R is often constrained by users because the output of each reduce task ends up in a separate output file. In practice, we tend to choose M so that each individual task is roughly 16 MB to 64 MB of input data (so that the locality optimization described above is most effective), and we make R a small multiple of the number of worker machines we expect to use. We often perform MapReduce computations with M = 200, 000 and R = 5, 000, using 2,000 worker machines. 3.6 Backup TasksOne of the common causes that lengthens the total time taken for a MapReduce operation is a â€œstragglerâ€: a machine that takes an unusually long time to complete one of the last few map or reduce tasks in the computation. Stragglers can arise for a whole host of reasons. For example, a machine with a bad disk may experience frequent correctable errors that slow its read performance from 30 MB/s to 1 MB/s. The cluster scheduling system may have scheduled other tasks on the machine, causing it to execute the MapReduce code more slowly due to competition for CPU, memory, local disk, or network bandwidth. A recent problem we experienced was a bug in machine initialization code that caused processor caches to be disabled: computations on affected machines slowed down by over a factor of one hundred. We have a general mechanism to alleviate the problem of stragglers. When a MapReduce operation is close to completion, the master schedules backup executions of the remaining in-progress tasks. The task is marked as completed whenever either the primary or the backup execution completes. We have tuned this mechanism so that it typically increases the computational resources used by the operation by no more than a few percent. We have found that this significantly reduces the time to complete large MapReduce operations. As an example, the sort program described in Section 5.3 takes 44% longer to complete when the backup task mechanism is disabled. 4 RefinementsAlthough the basic functionality provided by simply writing Map and Reduce functions is sufficient for most needs, we have found a few extensions useful. These are described in this section. 4.1 Partitioning FunctionThe users of MapReduce specify the number of reduce tasks/output files that they desire (R). Data gets partitioned across these tasks using a partitioning function on the intermediate key. A default partitioning function is provided that uses hashing (e.g. â€œhash(key) mod Râ€). This tends to result in fairly well-balanced partitions. In some cases, however, it is useful to partition data by some other function of the key. For example, sometimes the output keys are URLs, and we want all entries for a single host to end up in the same output file. To support situations like this, the user of the MapReduce library can provide a special partitioning function. For example, using â€œhash(Hostname(urlkey)) mod Râ€ as the partitioning function causes all URLs from the same host to end up in the same output file. 4.2 Ordering GuaranteesWe guarantee that within a given partition, the intermediate key/value pairs are processed in increasing key order. This ordering guarantee makes it easy to generate a sorted output file per partition, which is useful when the output file format needs to support efficient random access lookups by key, or users of the output find it convenient to have the data sorted. 4.3 Combiner FunctionIn some cases, there is significant repetition in the intermediate keys produced by each map task, and the userspecified Reduce function is commutative and associative. A good example of this is the word counting example in Section 2.1. Since word frequencies tend to follow a Zipf distribution, each map task will produce hundreds or thousands of records of the form (the, 1). All of these counts will be sent over the network to a single reduce task and then added together by the Reduce function to produce one number. We allow the user to specify an optional Combiner function that does partial merging of this data before it is sent over the network. The Combiner function is executed on each machine that performs a map task. Typically the same code is used to implement both the combiner and the reduce functions. The only difference between a reduce function and a combiner function is how the MapReduce library handles the output of the function. The output of a reduce function is written to the final output file. The output of a combiner function is written to an intermediate file that will be sent to a reduce task. Partial combining significantly speeds up certain classes of MapReduce operations. Appendix A contains an example that uses a combiner. 4.4 Input and Output TypesThe MapReduce library provides support for reading input data in several different formats. For example, â€œtextâ€ mode input treats each line as a key/value pair: the key is the offset in the file and the value is the contents of the line. Another common supported format stores a sequence of key/value pairs sorted by key. Each input type implementation knows how to split itself into meaningful ranges for processing as separate map tasks (e.g. text modeâ€™s range splitting ensures that range splits occur only at line boundaries). Users can add support for a new input type by providing an implementation of a simple reader interface, though most users just use one of a small number of predefined input types. A reader does not necessarily need to provide data read from a file. For example, it is easy to define a reader that reads records from a database, or from data structures mapped in memory. In a similar fashion, we support a set of output types for producing data in different formats and it is easy for user code to add support for new output types. 4.5 Side-effectsIn some cases, users of MapReduce have found it convenient to produce auxiliary files as additional outputs from their map and/or reduce operators. We rely on the application writer to make such side-effects atomic and idempotent. Typically the application writes to a temporary file and atomically renames this file once it has been fully generated. We do not provide support for atomic two-phase commits of multiple output files produced by a single task. Therefore, tasks that produce multiple output files with cross-file consistency requirements should be deterministic. This restriction has never been an issue in practice. 4.6 Skipping Bad RecordsSometimes there are bugs in user code that cause the Map or Reduce functions to crash deterministically on certain records. Such bugs prevent a MapReduce operation from completing. The usual course of action is to fix the bug, but sometimes this is not feasible; perhaps the bug is in a third-party library for which source code is unavailable. Also, sometimes it is acceptable to ignore a few records, for example when doing statistical analysis on a large data set. We provide an optional mode of execution where the MapReduce library detects which records cause deterministic crashes and skips these records in order to make forward progress. Each worker process installs a signal handler that catches segmentation violations and bus errors. Before invoking a user Map or Reduce operation, the MapReduce library stores the sequence number of the argument in a global variable. If the user code generates a signal, the signal handler sends a â€œlast gaspâ€ UDP packet that contains the sequence number to the MapReduce master. When the master has seen more than one failure on a particular record, it indicates that the record should be skipped when it issues the next re-execution of the corresponding Map or Reduce task. 4.7 Local ExecutionDebugging problems in Map or Reduce functions can be tricky, since the actual computation happens in a distributed system, often on several thousand machines, with work assignment decisions made dynamically by the master. To help facilitate debugging, profiling, and small-scale testing, we have developed an alternative implementation of the MapReduce library that sequentially executes all of the work for a MapReduce operation on the local machine. Controls are provided to the user so that the computation can be limited to particular map tasks. Users invoke their program with a special flag and can then easily use any debugging or testing tools they find useful (e.g. gdb). 4.8 Status InformationThe master runs an internal HTTP server and exports a set of status pages for human consumption. The status pages show the progress of the computation, such as how many tasks have been completed, how many are in progress, bytes of input, bytes of intermediate data, bytes of output, processing rates, etc. The pages also contain links to the standard error and standard output files generated by each task. The user can use this data to predict how long the computation will take, and whether or not more resources should be added to the computation. These pages can also be used to figure out when the computation is much slower than expected. In addition, the top-level status page shows which workers have failed, and which map and reduce tasks they were processing when they failed. This information is useful when attempting to diagnose bugs in the user code. 4.9 CountersThe MapReduce library provides a counter facility to count occurrences of various events. For example, user code may want to count total number of words processed or the number of German documents indexed, etc. To use this facility, user code creates a named counter object and then increments the counter appropriately in the Map and/or Reduce function. For example: 1234567Counter* uppercase;uppercase = GetCounter(&quot;uppercase&quot;);map(String name, String contents): for each word w in contents: if (IsCapitalized(w)): uppercase-&gt;Increment(); EmitIntermediate(w, &quot;1&quot;); The counter values from individual worker machines are periodically propagated to the master (piggybacked on the ping response). The master aggregates the counter values from successful map and reduce tasks and returns them to the user code when the MapReduce operation is completed. The current counter values are also displayed on the master status page so that a human can watch the progress of the live computation. When aggregating counter values, the master eliminates the effects of duplicate executions of the same map or reduce task to avoid double counting. (Duplicate executions can arise from our use of backup tasks and from re-execution of tasks due to failures.) Some counter values are automatically maintained by the MapReduce library, such as the number of input key/value pairs processed and the number of outputkey/value pairs produced. Users have found the counter facility useful for sanity checking the behavior of MapReduce operations. For example, in some MapReduce operations, the user code may want to ensure that the number of output pairs produced exactly equals the number of input pairs processed, or that the fraction of German documents processed is within some tolerable fraction of the total number of documents processed. 5 PerformanceIn this section we measure the performance of MapReduce on two computations running on a large cluster of machines. One computation searches through approximately one terabyte of data looking for a particular pattern. The other computation sorts approximately one terabyte of data. These two programs are representative of a large subset of the real programs written by users of MapReduce â€“ one class of programs shuffles data from one representation to another, and another class extracts a small amount of interesting data from a large data set. 5.1 Cluster ConfigurationAll of the programs were executed on a cluster that consisted of approximately 1800 machines. Each machine had two 2GHz Intel Xeon processors with HyperThreading enabled, 4GB of memory, two 160GB IDE disks, and a gigabit Ethernet link. The machines were arranged in a two-level tree-shaped switched network with approximately 100-200 Gbps of aggregate bandwidth available at the root. All of the machines were in the same hosting facility and therefore the round-trip time between any pair of machines was less than a millisecond. Out of the 4GB of memory, approximately 1-1.5GB was reserved by other tasks running on the cluster. The programs were executed on a weekend afternoon, when the CPUs, disks, and network were mostly idle. 5.2 GrepFigure 2: Data transfer rate over time The grep program scans through 1010 100-byte records, searching for a relatively rare three-character pattern (the pattern occurs in 92,337 records). The input is split into approximately 64MB pieces (M = 15000), and the entire output is placed in one file (R = 1). Figure 2 shows the progress of the computation over time. The Y-axis shows the rate at which the input data is scanned. The rate gradually picks up as more machines are assigned to this MapReduce computation, and peaks at over 30 GB/s when 1764 workers have been assigned. As the map tasks finish, the rate starts dropping and hits zero about 80 seconds into the computation. The entire computation takes approximately 150 seconds from start to finish. This includes about a minute of startup overhead. The overhead is due to the propagation of the program to all worker machines, and delays interacting with GFS to open the set of 1000 input files and to get the information needed for the locality optimization. 5.3 SortFigure 3: Data transfer rates over time for different executions of the sort program The sort program sorts 1010 100-byte records (approximately 1 terabyte of data). This program is modeled after the TeraSort benchmark [10]. The sorting program consists of less than 50 lines of user code. A three-line Map function extracts a 10-byte sorting key from a text line and emits the key and the original text line as the intermediate key/value pair. We used a built-in Identity function as the Reduce operator. This functions passes the intermediate key/value pair unchanged as the output key/value pair. The final sorted output is written to a set of 2-way replicated GFS files (i.e., 2 terabytes are written as the output of the program). As before, the input data is split into 64MB pieces (M = 15000). We partition the sorted output into 4000 files (R = 4000). The partitioning function uses the initial bytes of the key to segregate it into one of R pieces. Our partitioning function for this benchmark has builtin knowledge of the distribution of keys. In a general sorting program, we would add a pre-pass MapReduce operation that would collect a sample of the keys and use the distribution of the sampled keys to compute splitpoints for the final sorting pass. Figure 3 (a) shows the progress of a normal execution of the sort program. The top-left graph shows the rate at which input is read. The rate peaks at about 13 GB/s and dies off fairly quickly since all map tasks finish before 200 seconds have elapsed. Note that the input rate is less than for grep. This is because the sort map tasks spend about half their time and I/O bandwidth writing intermediate output to their local disks. The corresponding intermediate output for grep had negligible size. The middle-left graph shows the rate at which data is sent over the network from the map tasks to the reduce tasks. This shuffling starts as soon as the first map task completes. The first hump in the graph is for the first batch of approximately 1700 reduce tasks (the entire MapReduce was assigned about 1700 machines, and each machine executes at most one reduce task at a time). Roughly 300 seconds into the computation, some of these first batch of reduce tasks finish and we start shuffling data for the remaining reduce tasks. All of the shuffling is done about 600 seconds into the computation. The bottom-left graph shows the rate at which sorted data is written to the final output files by the reduce tasks. There is a delay between the end of the first shuffling period and the start of the writing period because the machines are busy sorting the intermediate data. The writes continue at a rate of about 2-4 GB/s for a while. All of the writes finish about 850 seconds into the computation. Including startup overhead, the entire computation takes 891 seconds. This is similar to the current best reported result of 1057 seconds for the TeraSort benchmark [18]. A few things to note: the input rate is higher than the shuffle rate and the output rate because of our locality optimization â€“ most data is read from a local disk and bypasses our relatively bandwidth constrained network. The shuffle rate is higher than the output rate because the output phase writes two copies of the sorted data (we make two replicas of the output for reliability and availability reasons). We write two replicas because that is the mechanism for reliability and availability provided by our underlying file system. Network bandwidth requirements for writing data would be reduced if the underlying file system used erasure coding [14] rather than replication. 5.4 Effect of Backup TasksIn Figure 3 (b), we show an execution of the sort program with backup tasks disabled. The execution flow is similar to that shown in Figure 3 (a), except that there is a very long tail where hardly any write activity occurs. After 960 seconds, all except 5 of the reduce tasks are completed. However these last few stragglers donâ€™t finish until 300 seconds later. The entire computation takes 1283 seconds, an increase of 44% in elapsed time. 5.5 Machine FailuresIn Figure 3 (c), we show an execution of the sort program where we intentionally killed 200 out of 1746 worker processes several minutes into the computation. The underlying cluster scheduler immediately restarted new worker processes on these machines (since only the processes were killed, the machines were still functioning properly). The worker deaths show up as a negative input rate since some previously completed map work disappears (since the corresponding map workers were killed) and needs to be redone. The re-execution of this map work happens relatively quickly. The entire computation finishes in 933 seconds including startup overhead (just an increase of 5% over the normal execution time). 6 ExperienceWe wrote the first version of the MapReduce library in February of 2003, and made significant enhancements to it in August of 2003, including the locality optimization, dynamic load balancing of task execution across worker machines, etc. Since that time, we have been pleasantly surprised at how broadly applicable the MapReduce library has been for the kinds of problems we work on. It has been used across a wide range of domains within Google, including: large-scale machine learning problems, clustering problems for the Google News and Froogle products, extraction of data used to produce reports of popular queries (e.g. Google Zeitgeist), extraction of properties of web pages for new experiments and products (e.g. extraction of geographical locations from a large corpus of web pages for localized search), and large-scale graph computations. Figure 4: MapReduce instances over time Table 1: MapReduce jobs run in August 2004 Figure 4 shows the significant growth in the number of separate MapReduce programs checked into our primary source code management system over time, from 0 in early 2003 to almost 900 separate instances as of late September 2004. MapReduce has been so successful because it makes it possible to write a simple program and run it efficiently on a thousand machines in the course of half an hour, greatly speeding up the development and prototyping cycle. Furthermore, it allows programmers who have no experience with distributed and/or parallel systems to exploit large amounts of resources easily. At the end of each job, the MapReduce library logs statistics about the computational resources used by the job. In Table 1, we show some statistics for a subset of MapReduce jobs run at Google in August 2004. 6.1 Large-Scale IndexingOne of our most significant uses of MapReduce to date has been a complete rewrite of the production indexing system that produces the data structures used for the Google web search service. The indexing system takes as input a large set of documents that have been retrieved by our crawling system, stored as a set of GFS files. The raw contents for these documents are more than 20 terabytes of data. The indexing process runs as a sequence of five to ten MapReduce operations. Using MapReduce (instead of the ad-hoc distributed passes in the prior version of the indexing system) has provided several benefits: â€¢ The indexing code is simpler, smaller, and easier to understand, because the code that deals with fault tolerance, distribution and parallelization is hidden within the MapReduce library. For example, the size of one phase of the computation dropped from approximately 3800 lines of C++ code to approximately 700 lines when expressed using MapReduce.â€¢ The performance of the MapReduce library is good enough that we can keep conceptually unrelated computations separate, instead of mixing them together to avoid extra passes over the data. This makes it easy to change the indexing process. For example, one change that took a few months to make in our old indexing system took only a few days to implement in the new system.â€¢ The indexing process has become much easier to operate, because most of the problems caused by machine failures, slow machines, and networking hiccups are dealt with automatically by the MapReduce library without operator intervention. Furthermore, it is easy to improve the performance of the indexing process by adding new machines to the indexing cluster. 7 Related WorkMany systems have provided restricted programming models and used the restrictions to parallelize the computation automatically. For example, an associative function can be computed over all prefixes of an N element array in log N time on N processors using parallel prefix computations [6, 9, 13]. MapReduce can be considered a simplification and distillation of some of these models based on our experience with large real-world computations. More significantly, we provide a fault-tolerant implementation that scales to thousands of processors. In contrast, most of the parallel processing systems have only been implemented on smaller scales and leave the details of handling machine failures to the programmer. Bulk Synchronous Programming [17] and some MPI primitives [11] provide higher-level abstractions that make it easier for programmers to write parallel programs. A key difference between these systems and MapReduce is that MapReduce exploits a restricted programming model to parallelize the user program automatically and to provide transparent fault-tolerance. Our locality optimization draws its inspiration from techniques such as active disks [12, 15], where computation is pushed into processing elements that are close to local disks, to reduce the amount of data sent across I/O subsystems or the network. We run on commodity processors to which a small number of disks are directly connected instead of running directly on disk controller processors, but the general approach is similar. Our backup task mechanism is similar to the eager scheduling mechanism employed in the Charlotte System [3]. One of the shortcomings of simple eager scheduling is that if a given task causes repeated failures, the entire computation fails to complete. We fix some instances of this problem with our mechanism for skipping bad records. The MapReduce implementation relies on an in-house cluster management system that is responsible for distributing and running user tasks on a large collection of shared machines. Though not the focus of this paper, the cluster management system is similar in spirit to other systems such as Condor [16]. The sorting facility that is a part of the MapReduce library is similar in operation to NOW-Sort [1]. Source machines (map workers) partition the data to be sorted and send it to one of R reduce workers. Each reduce worker sorts its data locally (in memory if possible). Of course NOW-Sort does not have the user-definable Map and Reduce functions that make our library widely applicable. River [2] provides a programming model where processes communicate with each other by sending data over distributed queues. Like MapReduce, the River system tries to provide good average case performance even in the presence of non-uniformities introduced by heterogeneous hardware or system perturbations. River achieves this by careful scheduling of disk and network transfers to achieve balanced completion times. MapReduce has a different approach. By restricting the programming model, the MapReduce framework is able to partition the problem into a large number of finegrained tasks. These tasks are dynamically scheduled on available workers so that faster workers process more tasks. The restricted programming model also allows us to schedule redundant executions of tasks near the end of the job which greatly reduces completion time in the presence of non-uniformities (such as slow or stuck workers). BAD-FS [5] has a very different programming model from MapReduce, and unlike MapReduce, is targeted to the execution of jobs across a wide-area network. However, there are two fundamental similarities. (1) Both systems use redundant execution to recover from data loss caused by failures. (2) Both use locality-aware scheduling to reduce the amount of data sent across congested network links. TACC [7] is a system designed to simplify construction of highly-available networked services. Like MapReduce, it relies on re-execution as a mechanism for implementing fault-tolerance. 8 ConclusionsThe MapReduce programming model has been successfully used at Google for many different purposes. We attribute this success to several reasons. First, the model is easy to use, even for programmers without experience with parallel and distributed systems, since it hides the details of parallelization, fault-tolerance, locality optimization, and load balancing. Second, a large variety of problems are easily expressible as MapReduce computations. For example, MapReduce is used for the generation of data for Googleâ€™s production web search service, for sorting, for data mining, for machine learning, and many other systems. Third, we have developed an implementation of MapReduce that scales to large clusters of machines comprising thousands of machines. The implementation makes efficient use of these machine resources and therefore is suitable for use on many of the large computational problems encountered at Google. We have learned several things from this work. First, restricting the programming model makes it easy to parallelize and distribute computations and to make such computations fault-tolerant. Second, network bandwidth is a scarce resource. A number of optimizations in our system are therefore targeted at reducing the amount of data sent across the network: the locality optimization allows us to read data from local disks, and writing a single copy of the intermediate data to local disk saves network bandwidth. Third, redundant execution can be used to reduce the impact of slow machines, and to handle machine failures and data loss. AcknowledgementsJosh Levenberg has been instrumental in revising and extending the user-level MapReduce API with a number of new features based on his experience with using MapReduce and other peopleâ€™s suggestions for enhancements. MapReduce reads its input from and writes its output to the Google File System [8]. We would like to thank Mohit Aron, Howard Gobioff, Markus Gutschke, David Kramer, Shun-Tak Leung, and Josh Redstone for their work in developing GFS. We would also like to thank Percy Liang and Olcan Sercinoglu for their work in developing the cluster management system used by MapReduce. Mike Burrows, Wilson Hsieh, Josh Levenberg, Sharon Perl, Rob Pike, and Debby Wallach provided helpful comments on earlier drafts of this paper. The anonymous OSDI reviewers, and our shepherd, Eric Brewer, provided many useful suggestions of areas where the paper could be improved. Finally, we thank all the users of MapReduce within Googleâ€™s engineering organization for providing helpful feedback, suggestions, and bug reports. References[1] Andrea C. Arpaci-Dusseau, Remzi H. Arpaci-Dusseau, David E. Culler, Joseph M. Hellerstein, and David A. Patterson. High-performance sorting on networks of workstations. In Proceedings of the 1997 ACM SIGMOD International Conference on Management of Data, Tucson, Arizona, May 1997. [2] Remzi H. Arpaci-Dusseau, Eric Anderson, Noah Treuhaft, David E. Culler, Joseph M. Hellerstein, David Patterson, and Kathy Yelick. Cluster I/O with River: Making the fast case common. In Proceedings of the Sixth Workshop on Input/Output in Parallel and Distributed Systems (IOPADS â€™99), pages 10â€“22, Atlanta, Georgia, May 1999. [3] Arash Baratloo, Mehmet Karaul, Zvi Kedem, and Peter Wyckoff. Charlotte: Metacomputing on the web. In Proceedings of the 9th International Conference on Parallel and Distributed Computing Systems, 1996. [4] Luiz A. Barroso, Jeffrey Dean, and Urs HÂ¨olzle. Web search for a planet: The Google cluster architecture. IEEE Micro, 23(2):22â€“28, April 2003. [5] John Bent, Douglas Thain, Andrea C.Arpaci-Dusseau, Remzi H. Arpaci-Dusseau, and Miron Livny. Explicit control in a batch-aware distributed file system. In Proceedings of the 1st USENIX Symposium on Networked Systems Design and Implementation NSDI, March 2004. [6] Guy E. Blelloch. Scans as primitive parallel operations. IEEE Transactions on Computers, C-38(11), November 1989. [7] Armando Fox, Steven D. Gribble, Yatin Chawathe, Eric A. Brewer, and Paul Gauthier. Cluster-based scalable network services. In Proceedings of the 16th ACM Symposium on Operating System Principles, pages 78â€“91, Saint-Malo, France, 1997. [8] Sanjay Ghemawat, Howard Gobioff, and Shun-Tak Leung. The Google file system. In 19th Symposium on Operating Systems Principles, pages 29â€“43, Lake George, New York, 2003. [9] S. Gorlatch. Systematic efficient parallelization of scan and other list homomorphisms. In L. Bouge, P. Fraigniaud, A. Mignotte, and Y. Robert, editors, Euro-Parâ€™96. Parallel Processing, Lecture Notes in Computer Science 1124, pages 401â€“408. Springer-Verlag, 1996. [10] Jim Gray. Sort benchmark home page. http://research.microsoft.com/barc/SortBenchmark/. [11] William Gropp, Ewing Lusk, and Anthony Skjellum. Using MPI: Portable Parallel Programming with the Message-Passing Interface. MIT Press, Cambridge, MA, 1999. [12] L. Huston, R. Sukthankar, R. Wickremesinghe, M. Satyanarayanan, G. R. Ganger, E. Riedel, and A. Ailamaki. Diamond: A storage architecture for early discard in interactive search. In Proceedings of the 2004 USENIX File and Storage Technologies FAST Conference, April 2004. [13] Richard E. Ladner and Michael J. Fischer. Parallel prefix computation. Journal of the ACM, 27(4):831â€“838, 1980. [14] Michael O. Rabin. Efficient dispersal of information for security, load balancing and fault tolerance. Journal of the ACM, 36(2):335â€“348, 1989. [15] Erik Riedel, Christos Faloutsos, Garth A. Gibson, and David Nagle. Active disks for large-scale data processing. IEEE Computer, pages 68â€“74, June 2001. [16] Douglas Thain, Todd Tannenbaum, and Miron Livny. Distributed computing in practice: The Condor experience. Concurrency and Computation: Practice and Experience, 2004. [17] L. G. Valiant. A bridging model for parallel computation. Communications of the ACM, 33(8):103â€“111, 1997. [18] Jim Wyllie. Spsort: How to sort a terabyte quickly. http://alme1.almaden.ibm.com/cs/spsort.pdf. A Word FrequencyThis section contains a program that counts the number of occurrences of each unique word in a set of input files specified on the command line. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586#include &quot;mapreduce/mapreduce.h&quot;// Userâ€™s map functionclass WordCounter : public Mapper &#123; public: virtual void Map(const MapInput&amp; input) &#123; const string&amp; text = input.value(); const int n = text.size(); for (int i = 0; i &lt; n; ) &#123; // Skip past leading whitespace while ((i &lt; n) &amp;&amp; isspace(text[i])) i++; // Find word end int start = i; while ((i &lt; n) &amp;&amp; !isspace(text[i])) i++; if (start &lt; i) Emit(text.substr(start,i-start),&quot;1&quot;); &#125; &#125;&#125;;REGISTER_MAPPER(WordCounter);// Userâ€™s reduce functionclass Adder : public Reducer &#123; virtual void Reduce(ReduceInput* input) &#123; // Iterate over all entries with the // same key and add the values int64 value = 0; while (!input-&gt;done()) &#123; value += StringToInt(input-&gt;value()); input-&gt;NextValue(); &#125; // Emit sum for input-&gt;key() Emit(IntToString(value)); &#125;&#125;;REGISTER_REDUCER(Adder);int main(int argc, char** argv) &#123; ParseCommandLineFlags(argc, argv); MapReduceSpecification spec; // Store list of input files into &quot;spec&quot; for (int i = 1; i &lt; argc; i++) &#123; MapReduceInput* input = spec.add_input(); input-&gt;set_format(&quot;text&quot;); input-&gt;set_filepattern(argv[i]); input-&gt;set_mapper_class(&quot;WordCounter&quot;); &#125; // Specify the output files: // /gfs/test/freq-00000-of-00100 // /gfs/test/freq-00001-of-00100 // ... MapReduceOutput* out = spec.output(); out-&gt;set_filebase(&quot;/gfs/test/freq&quot;); out-&gt;set_num_tasks(100); out-&gt;set_format(&quot;text&quot;); out-&gt;set_reducer_class(&quot;Adder&quot;); // Optional: do partial sums within map // tasks to save network bandwidth out-&gt;set_combiner_class(&quot;Adder&quot;); // Tuning parameters: use at most 2000 // machines and 100 MB of memory per task spec.set_machines(2000); spec.set_map_megabytes(100); spec.set_reduce_megabytes(100); // Now run it MapReduceResult result; if (!MapReduce(spec, &amp;result)) abort(); // Done: &apos;result&apos; structure contains info // about counters, time taken, number of // machines used, etc. return 0;&#125; ä¸­æ–‡ç‰ˆ MapReduce: è¶…å¤§æœºç¾¤ä¸Šçš„ç®€å•æ•°æ®å¤„ç†Jeffrey Dean and Sanjay Ghemawatjeff@google.com, sanjay@google.comè°·æ­Œ]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Google File System]]></title>
      <url>%2F2017%2F01%2F28%2Fgoogle-file-system%2F</url>
      <content type="text"><![CDATA[è½¬è‡ªhttp://blog.csdn.net/xuleicsu/article/details/526386 GFSæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºŽå¤§åž‹çš„ã€åˆ†å¸ƒå¼çš„ã€å¯¹å¤§é‡æ•°æ®è¿›è¡Œè®¿é—®çš„åº”ç”¨ã€‚å®ƒè¿è¡ŒäºŽå»‰ä»·çš„æ™®é€šç¡¬ä»¶ä¸Šï¼Œä½†å¯ä»¥æä¾›å®¹é”™åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç»™å¤§é‡çš„ç”¨æˆ·æä¾›æ€»ä½“æ€§èƒ½è¾ƒé«˜çš„æœåŠ¡ã€‚ è®¾è®¡æ¦‚è§ˆè®¾è®¡æƒ³æ³•GFSä¸Žè¿‡åŽ»çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰å¾ˆå¤šç›¸åŒçš„ç›®æ ‡ï¼Œä½†GFSçš„è®¾è®¡å—åˆ°äº†å½“å‰åŠé¢„æœŸçš„åº”ç”¨æ–¹é¢çš„å·¥ä½œé‡åŠæŠ€æœ¯çŽ¯å¢ƒçš„é©±åŠ¨ï¼Œè¿™åæ˜ äº†å®ƒä¸Žæ—©æœŸçš„æ–‡ä»¶ç³»ç»Ÿæ˜Žæ˜¾ä¸åŒçš„è®¾æƒ³ã€‚è¿™å°±éœ€è¦å¯¹ä¼ ç»Ÿçš„é€‰æ‹©è¿›è¡Œé‡æ–°æ£€éªŒå¹¶è¿›è¡Œå®Œå…¨ä¸åŒçš„è®¾è®¡è§‚ç‚¹çš„æŽ¢ç´¢ã€‚ GFSä¸Žä»¥å¾€çš„æ–‡ä»¶ç³»ç»Ÿçš„ä¸åŒçš„è§‚ç‚¹å¦‚ä¸‹ï¼š éƒ¨ä»¶é”™è¯¯ä¸å†è¢«å½“ä½œå¼‚å¸¸ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºå¸¸è§çš„æƒ…å†µåŠ ä»¥å¤„ç†ã€‚å› ä¸ºæ–‡ä»¶ç³»ç»Ÿç”±æˆç™¾ä¸Šåƒä¸ªç”¨äºŽå­˜å‚¨çš„æœºå™¨æž„æˆï¼Œè€Œè¿™äº›æœºå™¨æ˜¯ç”±å»‰ä»·çš„æ™®é€šéƒ¨ä»¶ç»„æˆå¹¶è¢«å¤§é‡çš„å®¢æˆ·æœºè®¿é—®ã€‚éƒ¨ä»¶çš„æ•°é‡å’Œè´¨é‡ä½¿å¾—ä¸€äº›æœºå™¨éšæ—¶éƒ½æœ‰å¯èƒ½æ— æ³•å·¥ä½œå¹¶ä¸”æœ‰ä¸€éƒ¨åˆ†è¿˜å¯èƒ½æ— æ³•æ¢å¤ã€‚æ‰€ä»¥å®žæ—¶åœ°ç›‘æŽ§ã€é”™è¯¯æ£€æµ‹ã€å®¹é”™ã€è‡ªåŠ¨æ¢å¤å¯¹ç³»ç»Ÿæ¥è¯´å¿…ä¸å¯å°‘ã€‚ æŒ‰ç…§ä¼ ç»Ÿçš„æ ‡å‡†ï¼Œæ–‡ä»¶éƒ½éžå¸¸å¤§ã€‚é•¿åº¦è¾¾å‡ ä¸ªGBçš„æ–‡ä»¶æ˜¯å¾ˆå¹³å¸¸çš„ã€‚æ¯ä¸ªæ–‡ä»¶é€šå¸¸åŒ…å«å¾ˆå¤šåº”ç”¨å¯¹è±¡ã€‚å½“ç»å¸¸è¦å¤„ç†å¿«é€Ÿå¢žé•¿çš„ã€åŒ…å«æ•°ä»¥ä¸‡è®¡çš„å¯¹è±¡ã€é•¿åº¦è¾¾TBçš„æ•°æ®é›†æ—¶ï¼Œæˆ‘ä»¬å¾ˆéš¾ç®¡ç†æˆåƒä¸Šä¸‡çš„KBè§„æ¨¡çš„æ–‡ä»¶å—ï¼Œå³ä½¿åº•å±‚æ–‡ä»¶ç³»ç»Ÿæä¾›æ”¯æŒã€‚å› æ­¤ï¼Œè®¾è®¡ä¸­æ“ä½œçš„å‚æ•°ã€å—çš„å¤§å°å¿…é¡»è¦é‡æ–°è€ƒè™‘ã€‚å¯¹å¤§åž‹çš„æ–‡ä»¶çš„ç®¡ç†ä¸€å®šè¦èƒ½åšåˆ°é«˜æ•ˆï¼Œå¯¹å°åž‹çš„æ–‡ä»¶ä¹Ÿå¿…é¡»æ”¯æŒï¼Œä½†ä¸å¿…ä¼˜åŒ–ã€‚ å¤§éƒ¨åˆ†æ–‡ä»¶çš„æ›´æ–°æ˜¯é€šè¿‡æ·»åŠ æ–°æ•°æ®å®Œæˆçš„ï¼Œè€Œä¸æ˜¯æ”¹å˜å·²å­˜åœ¨çš„æ•°æ®ã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­éšæœºçš„æ“ä½œåœ¨å®žè·µä¸­å‡ ä¹Žä¸å­˜åœ¨ã€‚ä¸€æ—¦å†™å®Œï¼Œæ–‡ä»¶å°±åªå¯è¯»ï¼Œå¾ˆå¤šæ•°æ®éƒ½æœ‰è¿™äº›ç‰¹æ€§ã€‚ä¸€äº›æ•°æ®å¯èƒ½ç»„æˆä¸€ä¸ªå¤§ä»“åº“ä»¥ä¾›æ•°æ®åˆ†æžç¨‹åºæ‰«æã€‚æœ‰äº›æ˜¯è¿è¡Œä¸­çš„ç¨‹åºè¿žç»­äº§ç”Ÿçš„æ•°æ®æµã€‚æœ‰äº›æ˜¯æ¡£æ¡ˆæ€§è´¨çš„æ•°æ®ï¼Œæœ‰äº›æ˜¯åœ¨æŸä¸ªæœºå™¨ä¸Šäº§ç”Ÿã€åœ¨å¦å¤–ä¸€ä¸ªæœºå™¨ä¸Šå¤„ç†çš„ä¸­é—´æ•°æ®ã€‚ç”±äºŽè¿™äº›å¯¹å¤§åž‹æ–‡ä»¶çš„è®¿é—®æ–¹å¼ï¼Œæ·»åŠ æ“ä½œæˆä¸ºæ€§èƒ½ä¼˜åŒ–å’ŒåŽŸå­æ€§ä¿è¯çš„ç„¦ç‚¹ã€‚è€Œåœ¨å®¢æˆ·æœºä¸­ç¼“å­˜æ•°æ®å—åˆ™å¤±åŽ»äº†å¸å¼•åŠ›ã€‚ å·¥ä½œé‡ä¸»è¦ç”±ä¸¤ç§è¯»æ“ä½œæž„æˆï¼šå¯¹å¤§é‡æ•°æ®çš„æµæ–¹å¼çš„è¯»æ“ä½œå’Œå¯¹å°‘é‡æ•°æ®çš„éšæœºæ–¹å¼çš„è¯»æ“ä½œã€‚åœ¨å‰ä¸€ç§è¯»æ“ä½œä¸­ï¼Œå¯èƒ½è¦è¯»å‡ ç™¾KBï¼Œé€šå¸¸è¾¾ 1MBå’Œæ›´å¤šã€‚æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·çš„è¿žç»­æ“ä½œé€šå¸¸ä¼šè¯»æ–‡ä»¶çš„ä¸€ä¸ªè¿žç»­çš„åŒºåŸŸã€‚éšæœºçš„è¯»æ“ä½œé€šå¸¸åœ¨ä¸€ä¸ªéšæœºçš„åç§»å¤„è¯»å‡ ä¸ªKBã€‚æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ç¨‹åºé€šå¸¸å°†å¯¹å°‘é‡æ•°æ®çš„è¯»æ“ä½œè¿›è¡Œåˆ†ç±»å¹¶è¿›è¡Œæ‰¹å¤„ç†ä»¥ä½¿å¾—è¯»æ“ä½œç¨³å®šåœ°å‘å‰æŽ¨è¿›ï¼Œè€Œä¸è¦è®©å®ƒæ¥æ¥å›žå›žçš„è¯»ã€‚ å·¥ä½œé‡è¿˜åŒ…å«è®¸å¤šå¯¹å¤§é‡æ•°æ®è¿›è¡Œçš„ã€è¿žç»­çš„ã€å‘æ–‡ä»¶æ·»åŠ æ•°æ®çš„å†™æ“ä½œã€‚æ‰€å†™çš„æ•°æ®çš„è§„æ¨¡å’Œè¯»ç›¸ä¼¼ã€‚ä¸€æ—¦å†™å®Œï¼Œæ–‡ä»¶å¾ˆå°‘æ”¹åŠ¨ã€‚åœ¨éšæœºä½ç½®å¯¹å°‘é‡æ•°æ®çš„å†™æ“ä½œä¹Ÿæ”¯æŒï¼Œä½†ä¸å¿…éžå¸¸é«˜æ•ˆã€‚ ç³»ç»Ÿå¿…é¡»é«˜æ•ˆåœ°å®žçŽ°å®šä¹‰å®Œå¥½çš„å¤§é‡å®¢æˆ·åŒæ—¶å‘åŒä¸€ä¸ªæ–‡ä»¶çš„æ·»åŠ æ“ä½œçš„è¯­ä¹‰ã€‚ ç³»ç»ŸæŽ¥å£GFSæä¾›äº†ä¸€ä¸ªç›¸ä¼¼åœ°æ–‡ä»¶ç³»ç»Ÿç•Œé¢ï¼Œè™½ç„¶å®ƒæ²¡æœ‰å‘POSIXé‚£æ ·å®žçŽ°æ ‡å‡†çš„APIã€‚æ–‡ä»¶åœ¨ç›®å½•ä¸­æŒ‰å±‚æ¬¡ç»„ç»‡èµ·æ¥å¹¶ç”±è·¯å¾„åæ ‡è¯†ã€‚ ä½“ç³»ç»“æž„ä¸€ä¸ªGFSé›†ç¾¤ç”±ä¸€ä¸ªmasterå’Œå¤§é‡çš„chunk serveræž„æˆï¼Œå¹¶è¢«è®¸å¤šå®¢æˆ·ï¼ˆclientï¼‰è®¿é—®ã€‚å¦‚å›¾1æ‰€ç¤ºã€‚masterå’Œchunk serveré€šå¸¸æ˜¯è¿è¡Œç”¨æˆ·å±‚æœåŠ¡è¿›ç¨‹çš„Linuxæœºå™¨ã€‚åªè¦èµ„æºå’Œå¯é æ€§å…è®¸ï¼Œchunk serverå’Œclientå¯ä»¥è¿è¡Œåœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šã€‚ æ–‡ä»¶è¢«åˆ†æˆå›ºå®šå¤§å°çš„å—ã€‚æ¯ä¸ªå—ç”±ä¸€ä¸ªä¸å˜çš„ã€å…¨å±€å”¯ä¸€çš„64ä½çš„chunkï¼handleæ ‡è¯†ï¼Œchunkï¼handleæ˜¯åœ¨å—åˆ›å»ºæ—¶ç”± masteråˆ†é…çš„ã€‚chunk serverå°†å—å½“ä½œLinuxæ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜å¹¶å¯ä»¥è¯»å’Œå†™ç”±chunkï¼handleå’Œä½åŒºé—´æŒ‡å®šçš„æ•°æ®ã€‚å‡ºäºŽå¯é æ€§è€ƒè™‘ï¼Œæ¯ä¸€ä¸ªå—è¢«å¤åˆ¶åˆ°å¤šä¸ªchunk serverä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¿å­˜3ä¸ªå‰¯æœ¬ï¼Œä½†è¿™å¯ä»¥ç”±ç”¨æˆ·æŒ‡å®šã€‚ masterç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿæ‰€ä»¥çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼ŒåŒ…æ‹¬åå­—ç©ºé—´ã€è®¿é—®æŽ§åˆ¶ä¿¡æ¯ã€ä»Žæ–‡ä»¶åˆ°å—çš„æ˜ å°„ä»¥åŠå—çš„å½“å‰ä½ç½®ã€‚å®ƒä¹ŸæŽ§åˆ¶ç³»ç»ŸèŒƒå›´çš„æ´»åŠ¨ï¼Œå¦‚å—ç§Ÿçº¦ï¼ˆleaseï¼‰ç®¡ç†ï¼Œå­¤å„¿å—çš„åžƒåœ¾æ”¶é›†ï¼Œchunk serveré—´çš„å—è¿ç§»ã€‚masterå®šæœŸé€šè¿‡HeartBeatæ¶ˆæ¯ä¸Žæ¯ä¸€ä¸ªchunk serveré€šä¿¡ï¼Œç»™chunk serverä¼ é€’æŒ‡ä»¤å¹¶æ”¶é›†å®ƒçš„çŠ¶æ€ã€‚ ä¸Žæ¯ä¸ªåº”ç”¨ç›¸è”çš„GFSå®¢æˆ·ä»£ç å®žçŽ°äº†æ–‡ä»¶ç³»ç»Ÿçš„APIå¹¶ä¸Žmasterå’Œchunk serveré€šä¿¡ä»¥ä»£è¡¨åº”ç”¨ç¨‹åºè¯»å’Œå†™æ•°æ®ã€‚å®¢æˆ·ä¸Žmasterçš„äº¤æ¢åªé™äºŽå¯¹å…ƒæ•°æ®ï¼ˆmetadataï¼‰çš„æ“ä½œï¼Œæ‰€æœ‰æ•°æ®æ–¹é¢çš„é€šä¿¡éƒ½ç›´æŽ¥å’Œchunk serverè”ç³»ã€‚ å®¢æˆ·å’Œchunk serveréƒ½ä¸ç¼“å­˜æ–‡ä»¶æ•°æ®ã€‚å› ä¸ºç”¨æˆ·ç¼“å­˜çš„ç›Šå¤„å¾®ä¹Žå…¶å¾®ï¼Œè¿™æ˜¯ç”±äºŽæ•°æ®å¤ªå¤šæˆ–å·¥ä½œé›†å¤ªå¤§è€Œæ— æ³•ç¼“å­˜ã€‚ä¸ç¼“å­˜æ•°æ®ç®€åŒ–äº†å®¢æˆ·ç¨‹åºå’Œæ•´ä¸ªç³»ç»Ÿï¼Œå› ä¸ºä¸å¿…è€ƒè™‘ç¼“å­˜çš„ä¸€è‡´æ€§é—®é¢˜ã€‚ä½†ç”¨æˆ·ç¼“å­˜å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚chunk serverä¹Ÿä¸å¿…ç¼“å­˜æ–‡ä»¶ï¼Œå› ä¸ºå—æ—¶ä½œä¸ºæœ¬åœ°æ–‡ä»¶å­˜å‚¨çš„ã€‚ å•masteråªæœ‰ä¸€ä¸ªmasterä¹Ÿæžå¤§çš„ç®€åŒ–äº†è®¾è®¡å¹¶ä½¿å¾—masterå¯ä»¥æ ¹æ®å…¨å±€æƒ…å†µä½œå‡ºå…ˆè¿›çš„å—æ”¾ç½®å’Œå¤åˆ¶å†³å®šã€‚ä½†æ˜¯æˆ‘ä»¬å¿…é¡»è¦å°†masterå¯¹è¯»å’Œå†™çš„å‚ä¸Žå‡è‡³æœ€å°‘ï¼Œè¿™æ ·å®ƒæ‰ä¸ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚clientä»Žæ¥ä¸ä¼šä»Žmasterè¯»å’Œå†™æ–‡ä»¶æ•°æ®ã€‚clientåªæ˜¯è¯¢é—®masterå®ƒåº”è¯¥å’Œå“ªä¸ª chunk serverè”ç³»ã€‚clientåœ¨ä¸€æ®µé™å®šçš„æ—¶é—´å†…å°†è¿™äº›ä¿¡æ¯ç¼“å­˜ï¼Œåœ¨åŽç»­çš„æ“ä½œä¸­clientç›´æŽ¥å’Œchunk serveräº¤äº’ã€‚ clientä½¿ç”¨å›ºå®šçš„å—å¤§å°å°†åº”ç”¨ç¨‹åºæŒ‡å®šçš„æ–‡ä»¶åå’Œå­—èŠ‚åç§»è½¬æ¢æˆæ–‡ä»¶çš„ä¸€ä¸ªå—ç´¢å¼•ï¼ˆchunk indexï¼‰ã€‚ ç»™masterå‘é€ä¸€ä¸ªåŒ…å«æ–‡ä»¶åå’Œå—ç´¢å¼•çš„è¯·æ±‚ã€‚ masterå›žåº”å¯¹åº”çš„chunk handleå’Œå‰¯æœ¬çš„ä½ç½®ï¼ˆå¤šä¸ªå‰¯æœ¬ï¼‰ã€‚ clientä»¥æ–‡ä»¶åå’Œå—ç´¢å¼•ä¸ºé”®ç¼“å­˜è¿™äº›ä¿¡æ¯ã€‚ï¼ˆhandleå’Œå‰¯æœ¬çš„ä½ç½®ï¼‰ã€‚ client å‘å…¶ä¸­ä¸€ä¸ªå‰¯æœ¬å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¾ˆå¯èƒ½æ˜¯æœ€è¿‘çš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¯·æ±‚æŒ‡å®šäº†chunk handleï¼ˆchunk serverä»¥chunk handleæ ‡è¯†chunkï¼‰å’Œå—å†…çš„ä¸€ä¸ªå­—èŠ‚åŒºé—´ã€‚ é™¤éžç¼“å­˜çš„ä¿¡æ¯ä¸å†æœ‰æ•ˆï¼ˆcache for a limited timeï¼‰æˆ–æ–‡ä»¶è¢«é‡æ–°æ‰“å¼€ï¼Œå¦åˆ™ä»¥åŽå¯¹åŒä¸€ä¸ªå—çš„è¯»æ“ä½œä¸å†éœ€è¦clientå’Œmasteré—´çš„äº¤äº’ã€‚ é€šå¸¸clientå¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­è¯¢é—®å¤šä¸ªchunkçš„åœ°å€ï¼Œè€Œmasterä¹Ÿå¯ä»¥å¾ˆå¿«å›žåº”è¿™äº›è¯·æ±‚ã€‚ å—è§„æ¨¡å—è§„æ¨¡æ˜¯è®¾è®¡ä¸­çš„ä¸€ä¸ªå…³é”®å‚æ•°ã€‚æˆ‘ä»¬é€‰æ‹©çš„æ˜¯64MBï¼Œè¿™æ¯”ä¸€èˆ¬çš„æ–‡ä»¶ç³»ç»Ÿçš„å—è§„æ¨¡è¦å¤§çš„å¤šã€‚æ¯ä¸ªå—çš„å‰¯æœ¬ä½œä¸ºä¸€ä¸ªæ™®é€šçš„Linuxæ–‡ä»¶å­˜å‚¨ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å¯ä»¥æ‰©å±•ã€‚å—è§„æ¨¡è¾ƒå¤§çš„å¥½å¤„æœ‰ï¼š å‡å°‘clientå’Œmasterä¹‹é—´çš„äº¤äº’ã€‚å› ä¸ºè¯»å†™åŒä¸€ä¸ªå—åªæ˜¯è¦åœ¨å¼€å§‹æ—¶å‘masterè¯·æ±‚å—ä½ç½®ä¿¡æ¯ã€‚å¯¹äºŽè¯»å†™å¤§åž‹æ–‡ä»¶è¿™ç§å‡å°‘å°¤ä¸ºé‡è¦ã€‚å³ä½¿å¯¹äºŽè®¿é—®å°‘é‡æ•°æ®çš„éšæœºè¯»æ“ä½œä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºä¸€ä¸ªè§„æ¨¡è¾¾å‡ ä¸ªTBçš„å·¥ä½œé›†ç¼“ç¼“å­˜å—ä½ç½®ä¿¡æ¯ã€‚ clientåœ¨ä¸€ä¸ªç»™å®šçš„å—ä¸Šå¾ˆå¯èƒ½æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œå’Œä¸€ä¸ªchunk serverä¿æŒè¾ƒé•¿æ—¶é—´çš„TCPè¿žæŽ¥å¯ä»¥å‡å°‘ç½‘ç»œè´Ÿè½½ã€‚ è¿™å‡å°‘äº†masterä¸Šä¿å­˜çš„å…ƒæ•°æ®ï¼ˆmetadataï¼‰çš„è§„æ¨¡ï¼Œä»Žè€Œä½¿å¾—å¯ä»¥å°†metadataæ”¾åœ¨å†…å­˜ä¸­ã€‚è¿™åˆä¼šå¸¦æ¥ä¸€äº›åˆ«çš„å¥½å¤„ã€‚ ä¸åˆ©çš„ä¸€é¢ï¼š ä¸€ä¸ªå°æ–‡ä»¶å¯èƒ½åªåŒ…å«ä¸€ä¸ªå—ï¼Œå¦‚æžœå¾ˆå¤šclientè®¿é—®æ”¹æ–‡ä»¶çš„è¯ï¼Œå­˜å‚¨è¿™äº›å—çš„chunk serverå°†æˆä¸ºè®¿é—®çš„çƒ­ç‚¹ã€‚ä½†åœ¨å®žé™…åº”ç”¨ä¸­ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸é¡ºåºåœ°è¯»åŒ…å«å¤šä¸ªå—çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªä¸»è¦é—®é¢˜ã€‚ å…ƒæ•°æ®ï¼ˆmetadataï¼‰masterå­˜å‚¨äº†ä¸‰ä¸­ç±»åž‹çš„metadataï¼šæ–‡ä»¶çš„åå­—ç©ºé—´å’Œå—çš„åå­—ç©ºé—´ï¼Œä»Žæ–‡ä»¶åˆ°å—çš„æ˜ å°„ï¼Œå—çš„å‰¯æœ¬çš„ä½ç½®ã€‚æ‰€æœ‰çš„metadataéƒ½æ”¾åœ¨å†…å­˜ä¸­ã€‚å‰ä¸¤ç§ç±»åž‹çš„metadataé€šè¿‡å‘æ“ä½œæ—¥å¿—ç™»è®°ä¿®æ”¹è€Œä¿æŒä¸å˜ï¼Œæ“ä½œæ—¥å¿—å­˜å‚¨åœ¨masterçš„æœ¬åœ°ç£ç›˜å¹¶åœ¨å‡ ä¸ªè¿œç¨‹æœºå™¨ä¸Šç•™æœ‰å‰¯æœ¬ã€‚ä½¿ç”¨æ—¥å¿—ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°ã€å¯é åœ°æ›´æ–°masterçš„çŠ¶æ€ï¼Œå³ä½¿åœ¨masterå´©æºƒçš„æƒ…å†µä¸‹ä¹Ÿä¸ä¼šæœ‰ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ç›¸åï¼Œmateråœ¨æ¯æ¬¡å¯åŠ¨ä»¥åŠå½“æœ‰chunk serveråŠ å…¥çš„æ—¶å€™è¯¢é—®æ¯ä¸ªchunk serverçš„æ‰€æ‹¥æœ‰çš„å—çš„æƒ…å†µã€‚ å†…å­˜æ•°æ®ç»“æž„å› ä¸ºmetadataå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥masterçš„æ“ä½œå¾ˆå¿«ã€‚è¿›ä¸€æ­¥ï¼Œmasterå¯ä»¥è½»æ˜“è€Œä¸”é«˜æ•ˆåœ°å®šæœŸåœ¨åŽå°æ‰«æå®ƒçš„æ•´ä¸ªçŠ¶æ€ã€‚è¿™ç§å®šæœŸåœ°æ‰«æè¢«ç”¨äºŽå®žçŽ°å—åžƒåœ¾æ”¶é›†ã€chunk serverå‡ºçŽ°æ•…éšœæ—¶çš„å‰¯æœ¬å¤åˆ¶ã€ä¸ºå¹³è¡¡è´Ÿè½½å’Œç£ç›˜ç©ºé—´è€Œè¿›è¡Œçš„å—è¿ç§»ã€‚ è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜å°±æ˜¯å—çš„æ•°é‡ä¹Ÿå³æ•´ä¸ªç³»ç»Ÿçš„å®¹é‡æ˜¯å¦å—é™ä¸Žmasterçš„å†…å­˜ã€‚å®žé™…ä¸Šï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚masterä¸ºæ¯ä¸ª 64MBçš„å—ç»´æŠ¤çš„metadataä¸è¶³64ä¸ªå­—èŠ‚ã€‚é™¤äº†æœ€åŽä¸€å—ï¼Œæ–‡ä»¶æ‰€æœ‰çš„å—éƒ½æ˜¯æ»¡çš„ã€‚ç±»ä¼¼çš„ï¼Œæ¯ä¸ªæ–‡ä»¶çš„åå­—ç©ºé—´æ•°æ®ä¹Ÿä¸è¶³64ä¸ªå­—èŠ‚ï¼Œå› ä¸ºæ–‡ä»¶åæ˜¯ä»¥ä¸€ç§äº‹å…ˆç¡®å®šçš„åŽ‹ç¼©æ–¹å¼å­˜å‚¨çš„.å¦‚æžœè¦æ”¯æŒæ›´å¤§çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆå¢žåŠ ä¸€äº›å†…å­˜çš„æ–¹æ³•å¯¹äºŽæˆ‘ä»¬å°†å…ƒæ•°æ®ï¼ˆmetadataï¼‰ä¿å­˜åœ¨å†…å­˜ç§æ‰€èŽ·å¾—çš„ç®€å•æ€§ã€å¯é æ€§ã€é«˜æ€§èƒ½å’Œçµæ´»æ€§æ¥è¯´ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¾ˆå°çš„ä»£ä»·ã€‚ å—ä½ç½®masterå¹¶ä¸ä¸ºchunk serveræ‰€æ‹¥æœ‰çš„å—çš„å‰¯æœ¬çš„ä¿å­˜ä¸€ä¸ªä¸å˜çš„è®°å½•ã€‚å®ƒåœ¨å¯åŠ¨æ—¶é€šè¿‡ç®€å•çš„æŸ¥è¯¢æ¥èŽ·å¾—è¿™äº›ä¿¡æ¯ã€‚masterå¯ä»¥ä¿æŒè¿™äº›ä¿¡æ¯çš„æ›´æ–°ï¼Œå› ä¸ºå®ƒæŽ§åˆ¶æ‰€æœ‰å—çš„æ”¾ç½®å¹¶é€šè¿‡HeartBeatæ¶ˆæ¯æ¥ç›‘æŽ§chunk serverçš„çŠ¶æ€ã€‚ è¿™æ ·åšçš„å¥½å¤„ï¼šå› ä¸ºchunk serverå¯èƒ½åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤ã€æ”¹å˜è·¯å¾„åã€å´©æºƒã€é‡å¯ç­‰ï¼Œä¸€ä¸ªé›†ç¾¤é‡æœ‰æˆç™¾ä¸ªserverï¼Œè¿™äº›äº‹ä»¶ç»å¸¸å‘ç”Ÿï¼Œè¿™ç§æ–¹æ³•å°±æŽ’é™¤äº†masterä¸Žchunk serverä¹‹é—´çš„åŒæ­¥é—®é¢˜ã€‚ å¦ä¸€ä¸ªåŽŸå› æ˜¯ï¼šåªæœ‰chunk serveræ‰èƒ½ç¡®å®šå®ƒè‡ªå·±åˆ°åº•æœ‰å“ªäº›å—ï¼Œç”±äºŽé”™è¯¯ï¼Œchunk serverä¸­çš„ä¸€äº›å—å¯èƒ½ä¼šå¾ˆè‡ªç„¶çš„æ¶ˆå¤±ï¼Œè¿™æ ·åœ¨masterä¸­å°±æ²¡æœ‰å¿…è¦ä¸ºæ­¤ä¿å­˜ä¸€ä¸ªä¸å˜çš„è®°å½•ã€‚ æ“ä½œæ—¥å¿—æ“ä½œæ—¥å¿—åŒ…å«äº†å¯¹metadataæ‰€ä½œçš„ä¿®æ”¹çš„åŽ†å²è®°å½•ã€‚å®ƒä½œä¸ºé€»è¾‘æ—¶é—´çº¿å®šä¹‰äº†å¹¶å‘æ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚æ–‡ä»¶ã€å—ä»¥åŠå®ƒä»¬çš„ç‰ˆæœ¬å·éƒ½ç”±å®ƒä»¬è¢«åˆ›å»ºæ—¶çš„é€»è¾‘æ—¶é—´è€Œå”¯ä¸€åœ°ã€æ°¸ä¹…åœ°è¢«æ ‡è¯†ã€‚ æ“ä½œæ—¥å¿—æ˜¯å¦‚æ­¤çš„é‡è¦ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°†å®ƒå¯é åœ°ä¿å­˜èµ·æ¥ï¼Œå¹¶ä¸”åªæœ‰åœ¨metadataçš„æ”¹å˜å›ºå®šä¸‹æ¥ä¹‹åŽæ‰å°†å˜åŒ–å‘ˆçŽ°ç»™ç”¨æˆ·ã€‚æ‰€ä»¥æˆ‘ä»¬å°†æ“ä½œæ—¥å¿—å¤åˆ¶åˆ°æ•°ä¸ªè¿œç¨‹çš„æœºå™¨ä¸Šï¼Œå¹¶ä¸”åªæœ‰åœ¨å°†ç›¸åº”çš„æ—¥å¿—è®°å½•å†™åˆ°æœ¬åœ°å’Œè¿œç¨‹çš„ç£ç›˜ä¸Šä¹‹åŽæ‰å›žç­”ç”¨æˆ·çš„è¯·æ±‚ã€‚ masterå¯ä»¥ç”¨æ“ä½œæ—¥å¿—æ¥æ¢å¤å®ƒçš„æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚ä¸ºäº†å°†å¯åŠ¨æ—¶é—´å‡è‡³æœ€å°ï¼Œæ—¥å¿—å°±å¿…é¡»è¦æ¯”è¾ƒå°ã€‚æ¯å½“æ—¥å¿—çš„é•¿åº¦å¢žé•¿åˆ°è¶…è¿‡ä¸€å®šçš„è§„æ¨¡åŽï¼Œmasterå°±è¦æ£€æŸ¥å®ƒçš„çŠ¶æ€ï¼Œå®ƒå¯ä»¥ä»Žæœ¬åœ°ç£ç›˜è£…å…¥æœ€è¿‘çš„æ£€æŸ¥ç‚¹æ¥æ¢å¤çŠ¶æ€ã€‚ åˆ›å»ºä¸€ä¸ªæ£€æŸ¥ç‚¹æ¯”è¾ƒè´¹æ—¶ï¼Œmasterçš„å†…éƒ¨çŠ¶æ€æ˜¯ä»¥ä¸€ç§åœ¨åˆ›å»ºä¸€ä¸ªæ£€æŸ¥ç‚¹æ—¶å¹¶ä¸è€½è¯¯å³å°†åˆ°æ¥çš„ä¿®æ”¹æ“ä½œçš„æ–¹å¼æ¥ç»„ç»‡çš„ã€‚masteråˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„æ—¥å­æ–‡ä»¶å¹¶åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­åˆ›å»ºæ£€æŸ¥ç‚¹ã€‚è¿™ä¸ªæ–°çš„æ£€æŸ¥ç‚¹è®°å½•äº†åˆ‡æ¢å‰æ‰€æœ‰çš„ä¿®æ”¹ã€‚åœ¨ä¸€ä¸ªæœ‰æ•°åä¸‡æ–‡ä»¶çš„é›†ç¾¤ä¸­ç”¨ä¸€åˆ†é’Ÿå·¦å³å°±èƒ½å®Œæˆã€‚åˆ›å»ºå®ŒåŽï¼Œå°†å®ƒå†™å…¥æœ¬åœ°å’Œè¿œç¨‹çš„ç£ç›˜ã€‚ æ•°æ®å®Œæ•´æ€§åå­—ç©ºé—´çš„ä¿®æ”¹å¿…é¡»æ˜¯åŽŸå­æ€§çš„ï¼Œå®ƒä»¬åªèƒ½æœ‰masterå¤„ç†ï¼šåå­—ç©ºé—´é”ä¿è¯äº†æ“ä½œçš„åŽŸå­æ€§å’Œæ­£ç¡®æ€§ï¼Œè€Œmasterçš„æ“ä½œæ—¥å¿—åœ¨å…¨å±€èŒƒå›´å†…å®šä¹‰äº†è¿™äº›æ“ä½œçš„é¡ºåºã€‚ æ–‡ä»¶åŒºé—´çš„çŠ¶æ€åœ¨ä¿®æ”¹ä¹‹åŽä¾èµ–äºŽä¿®æ”¹çš„ç±»åž‹ï¼Œä¸è®ºæ“ä½œæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œä¹Ÿä¸è®ºæ˜¯ä¸æ˜¯å¹¶å‘æ“ä½œã€‚å¦‚æžœä¸è®ºä»Žå“ªä¸ªå‰¯æœ¬ä¸Šè¯»ï¼Œæ‰€æœ‰çš„å®¢æˆ·éƒ½çœ‹åˆ°åŒæ ·çš„æ•°æ®ï¼Œé‚£ä¹ˆæ–‡ä»¶çš„è¿™ä¸ªåŒºåŸŸå°±æ˜¯ä¸€è‡´çš„ã€‚å¦‚æžœæ–‡ä»¶çš„åŒºåŸŸæ˜¯ä¸€è‡´çš„å¹¶ä¸”ç”¨æˆ·å¯ä»¥çœ‹åˆ°ä¿®æ”¹æ“ä½œæ‰€å†™çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å·²å®šä¹‰çš„ã€‚å¦‚æžœä¿®æ”¹æ˜¯åœ¨æ²¡æœ‰å¹¶å‘å†™æ“ä½œçš„å½±å“ä¸‹å®Œæˆçš„ï¼Œé‚£ä¹ˆå—å½±å“çš„åŒºåŸŸæ˜¯å·²å®šä¹‰çš„ï¼Œæ‰€æœ‰çš„clientéƒ½èƒ½çœ‹åˆ°å†™çš„å†…å®¹ã€‚æˆåŠŸçš„å¹¶å‘å†™æ“ä½œæ˜¯æœªå®šä¹‰ä½†å´æ˜¯ä¸€è‡´çš„ã€‚å¤±è´¥çš„ä¿®æ”¹å°†ä½¿åŒºé—´å¤„äºŽä¸ä¸€è‡´çš„çŠ¶æ€ã€‚ writeæ“ä½œåœ¨åº”ç”¨ç¨‹åºæŒ‡å®šçš„åç§»å¤„å†™å…¥æ•°æ®ï¼Œè€Œrecord appendæ“ä½œä½¿å¾—æ•°æ®ï¼ˆè®°å½•ï¼‰å³ä½¿åœ¨æœ‰å¹¶å‘ä¿®æ”¹æ“ä½œçš„æƒ…å†µä¸‹ä¹Ÿè‡³å°‘åŽŸå­æ€§çš„è¢«åŠ åˆ°GFSæŒ‡å®šçš„åç§»å¤„ï¼Œåç§»åœ°å€è¢«è¿”å›žç»™ç”¨æˆ·ã€‚ åœ¨ä¸€ç³»åˆ—æˆåŠŸçš„ä¿®æ”¹æ“ä½œåŽï¼Œæœ€åŽçš„ä¿®æ”¹æ“ä½œä¿è¯æ–‡ä»¶åŒºåŸŸæ˜¯å·²å®šä¹‰çš„ã€‚GFSé€šè¿‡å¯¹æ‰€æœ‰çš„å‰¯æœ¬æ‰§è¡ŒåŒæ ·é¡ºåºçš„ä¿®æ”¹æ“ä½œå¹¶ä¸”ä½¿ç”¨å—ç‰ˆæœ¬å·æ£€æµ‹è¿‡æ—¶çš„å‰¯æœ¬ï¼ˆç”±äºŽchunk serveré€€å‡ºè€Œå¯¼è‡´ä¸¢å¤±ä¿®æ”¹ï¼‰æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ å› ä¸ºç”¨æˆ·ç¼“å­˜äº†ä¼šä½ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨æ›´æ–°ç¼“å­˜ä¹‹å‰æœ‰å¯èƒ½ä»Žä¸€ä¸ªè¿‡æ—¶çš„å‰¯æœ¬ä¸­è¯»å–æ•°æ®ã€‚ä½†è¿™æœ‰ç¼“å­˜çš„æˆªæ­¢æ—¶é—´å’Œæ–‡ä»¶çš„é‡æ–°æ‰“å¼€è€Œå—åˆ°é™åˆ¶ã€‚ åœ¨ä¿®æ”¹æ“ä½œæˆåŠŸåŽï¼Œéƒ¨ä»¶æ•…éšœä»å¯ä»¥æ˜¯æ•°æ®å—åˆ°ç ´åã€‚GFSé€šè¿‡masterå’Œchunk serveré—´å®šæœŸçš„handshakeï¼Œå€ŸåŠ©æ ¡éªŒå’Œæ¥æ£€æµ‹å¯¹æ•°æ®çš„ç ´åã€‚ä¸€æ—¦æ£€æµ‹åˆ°ï¼Œå°±ä»Žä¸€ä¸ªæœ‰æ•ˆçš„å‰¯æœ¬å°½å¿«é‡æ–°å­˜å‚¨ã€‚åªæœ‰åœ¨GFSæ£€æµ‹å‰ï¼Œæ‰€æœ‰çš„å‰¯æœ¬éƒ½å¤±æ•ˆï¼Œè¿™ä¸ªå—æ‰ä¼šä¸¢å¤±ã€‚ ç³»ç»Ÿäº¤äº’ç§Ÿçº¦ï¼ˆleaseï¼‰å’Œä¿®æ”¹é¡ºåºæ•°æ®æµæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å……åˆ†åˆ©ç”¨æ¯ä¸ªæœºå™¨çš„ç½‘ç»œå¸¦å®½ï¼Œé¿å…ç½‘ç»œç“¶é¢ˆå’Œå»¶è¿Ÿã€‚ä¸ºäº†æœ‰æ•ˆçš„åˆ©ç”¨ç½‘ç»œï¼Œæˆ‘ä»¬å°†æ•°æ®æµå’ŒæŽ§åˆ¶æµåˆ†ç¦»ã€‚æ•°æ®æ˜¯ä»¥æµæ°´çº¿çš„æ–¹å¼åœ¨é€‰å®šçš„chunker serveré“¾ä¸Šçº¿æ€§çš„ä¼ é€’çš„ã€‚æ¯ä¸ªæœºå™¨çš„æ•´ä¸ªå¯¹å¤–å¸¦å®½éƒ½è¢«ç”¨ä½œä¼ é€’æ•°æ®ã€‚ä¸ºé¿å…ç“¶é¢ˆï¼Œæ¯ä¸ªæœºå™¨åœ¨æ”¶åˆ°æ•°æ®åŽï¼Œå°†å®ƒæ”¶åˆ°æ•°æ®å°½å¿«ä¼ é€’ç»™ç¦»å®ƒæœ€è¿‘çš„æœºå™¨ã€‚ åŽŸå­æ€§çš„record AppendGFSæä¾›äº†ä¸€ä¸ªåŽŸå­æ€§çš„æ·»åŠ æ“ä½œï¼šrecord appendã€‚åœ¨ä¼ ç»Ÿçš„å†™æ“ä½œä¸­ï¼ŒclientæŒ‡å®šè¢«å†™æ•°æ®çš„åç§»ä½ç½®ï¼Œå‘åŒä¸€ä¸ªåŒºé—´çš„å¹¶å‘çš„å†™æ“ä½œæ˜¯ä¸è¿žç»­çš„ï¼šåŒºé—´æœ‰å¯èƒ½åŒ…å«æ¥è‡ªå¤šä¸ªclientçš„æ•°æ®ç¢Žç‰‡ã€‚åœ¨record appendä¸­ï¼Œ clientåªæ˜¯æŒ‡å®šæ•°æ®ã€‚GFSåœ¨å…¶é€‰å®šçš„åç§»å‡ºå°†æ•°æ®è‡³å°‘åŽŸå­æ€§çš„åŠ å…¥æ–‡ä»¶ä¸€æ¬¡ï¼Œå¹¶å°†åç§»è¿”å›žç»™clientã€‚ åœ¨åˆ†å¸ƒå¼çš„åº”ç”¨ä¸­ï¼Œä¸åŒæœºå™¨ä¸Šçš„è®¸å¤šclientå¯èƒ½ä¼šåŒæ—¶å‘ä¸€ä¸ªæ–‡ä»¶æ‰§è¡Œæ·»åŠ æ“ä½œï¼Œæ·»åŠ æ“ä½œè¢«é¢‘ç¹ä½¿ç”¨ã€‚å¦‚æžœç”¨ä¼ ç»Ÿçš„writeæ“ä½œï¼Œå¯èƒ½éœ€è¦é¢å¤–çš„ã€å¤æ‚çš„ã€å¼€é”€è¾ƒå¤§çš„åŒæ­¥ï¼Œä¾‹å¦‚é€šè¿‡åˆ†å¸ƒå¼é”ç®¡ç†ã€‚åœ¨æˆ‘ä»¬çš„å·¥ä½œé‡ä¸­ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸ä»¥å¤šä¸ªç”Ÿäº§è€…å•ä¸ªæ¶ˆè´¹è€…é˜Ÿåˆ—çš„æ–¹å¼æˆ–åŒ…å«ä»Žå¤šä¸ªä¸åŒ clientçš„ç»¼åˆç»“æžœã€‚ record appendå’Œå‰é¢è®²çš„writeæ“ä½œçš„æŽ§åˆ¶æµå·®ä¸å¤šï¼Œåªæ˜¯åœ¨primaryä¸Šå¤šäº†ä¸€äº›é€»è¾‘åˆ¤æ–­ã€‚é¦–å…ˆï¼Œclientå°†æ•°æ®å‘é€åˆ°æ–‡ä»¶æœ€åŽä¸€å—çš„æ‰€æœ‰å‰¯æœ¬ä¸Šã€‚ç„¶åŽå‘primaryå‘é€è¯·æ±‚ã€‚Primaryæ£€æŸ¥æ·»åŠ æ“ä½œæ˜¯å¦ä¼šå¯¼è‡´è¯¥å—è¶…è¿‡æœ€å¤§çš„è§„æ¨¡ï¼ˆ64Mï¼‰ã€‚å¦‚æžœè¿™æ ·ï¼Œå®ƒå°†è¯¥å—æ‰©å……åˆ°æœ€å¤§è§„æ¨¡ï¼Œå¹¶å‘Šè¯‰å…¶å®ƒå‰¯æœ¬åšåŒæ ·çš„äº‹ï¼ŒåŒæ—¶é€šçŸ¥clientè¯¥æ“ä½œéœ€è¦åœ¨ä¸‹ä¸€ä¸ªå—ä¸Šé‡æ–°å°è¯•ã€‚å¦‚æžœè®°å½•æ»¡è¶³æœ€å¤§è§„æ¨¡çš„è¦æ±‚ï¼Œprimaryå°±ä¼šå°†æ•°æ®æ·»åŠ åˆ°å®ƒçš„å‰¯æœ¬ä¸Šï¼Œå¹¶å‘Šè¯‰å…¶å®ƒçš„å‰¯æœ¬åœ¨åœ¨åŒæ ·çš„åç§»å¤„å†™æ•°æ®ï¼Œæœ€åŽprimaryå‘clientæŠ¥å‘Šå†™æ“ä½œæˆåŠŸã€‚å¦‚æžœåœ¨ä»»ä½•ä¸€ä¸ªå‰¯æœ¬ä¸Šrecord appendæ“ä½œå¤±è´¥ï¼Œclientå°†é‡æ–°å°è¯•è¯¥æ“ä½œã€‚è¿™æ—¶å€™ï¼ŒåŒä¸€ä¸ªå—çš„å‰¯æœ¬å¯èƒ½åŒ…å«ä¸åŒçš„æ•°æ®ï¼Œå› ä¸ºæœ‰çš„å¯èƒ½å¤åˆ¶äº†å…¨éƒ¨çš„æ•°æ®ï¼Œæœ‰çš„å¯èƒ½åªå¤åˆ¶äº†éƒ¨åˆ†ã€‚GFSä¸èƒ½ä¿è¯æ‰€æœ‰çš„å‰¯æœ¬æ¯ä¸ªå­—èŠ‚éƒ½æ˜¯ä¸€æ ·çš„ã€‚å®ƒåªä¿è¯æ¯ä¸ªæ•°æ®ä½œä¸ºä¸€ä¸ªåŽŸå­å•å…ƒè¢«å†™è¿‡è‡³å°‘ä¸€æ¬¡ã€‚è¿™ä¸ªæ˜¯è¿™æ ·å¾—å‡ºçš„ï¼šæ“ä½œè¦æ˜¯æˆåŠŸï¼Œæ•°æ®å¿…é¡»åœ¨æ‰€æœ‰çš„å‰¯æœ¬ä¸Šçš„åŒæ ·çš„åç§»å¤„è¢«å†™è¿‡ã€‚è¿›ä¸€æ­¥ï¼Œä»Žè¿™ä»¥åŽï¼Œæ‰€æœ‰çš„å‰¯æœ¬è‡³å°‘å’Œè®°å½•ä¸€æ ·é•¿ï¼Œæ‰€ä»¥åŽç»­çš„è®°å½•å°†è¢«æŒ‡å®šåˆ°æ›´é«˜çš„åç§»å¤„æˆ–è€…ä¸€ä¸ªä¸åŒçš„å—ä¸Šï¼Œå³ä½¿å¦ä¸€ä¸ªå‰¯æœ¬æˆäº†primaryã€‚æ ¹æ®ä¸€è‡´æ€§ä¿è¯ï¼ŒæˆåŠŸçš„record appendæ“ä½œçš„åŒºé—´æ˜¯å·²å®šä¹‰çš„ã€‚è€Œå—åˆ°å¹²æ‰°çš„åŒºé—´æ˜¯ä¸ä¸€è‡´çš„ã€‚ å¿«ç…§ï¼ˆsnapshotï¼‰å¿«ç…§æ“ä½œå‡ ä¹Žåœ¨çž¬é—´æž„é€ ä¸€ä¸ªæ–‡ä»¶å’Œç›®å½•æ ‘çš„å‰¯æœ¬ï¼ŒåŒæ—¶å°†æ­£åœ¨è¿›è¡Œçš„å…¶ä»–ä¿®æ”¹æ“ä½œå¯¹å®ƒçš„å½±å“å‡è‡³æœ€å°ã€‚ æˆ‘ä»¬ä½¿ç”¨copy-on-writeæŠ€æœ¯æ¥å®žçŽ°snapshotã€‚å½“masterå—åˆ°ä¸€ä¸ªsnapshotè¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆå°†è¦snapshotçš„æ–‡ä»¶ä¸Šå—ä¸Šçš„leaseã€‚è¿™ä½¿å¾—ä»»ä½•ä¸€ä¸ªå‘è¿™äº›å—å†™æ•°æ®çš„æ“ä½œéƒ½å¿…é¡»å’Œmasteräº¤äº’ä»¥æ‰¾åˆ°æ‹¥æœ‰leaseçš„å‰¯æœ¬ã€‚è¿™å°±ç»™masterä¸€ä¸ªåˆ›å»ºè¿™ä¸ªå—çš„å‰¯æœ¬çš„æœºä¼šã€‚ å‰¯æœ¬è¢«æ’¤é”€æˆ–ç»ˆæ­¢åŽï¼Œmasteråœ¨ç£ç›˜ä¸Šç™»è®°æ‰§è¡Œçš„æ“ä½œï¼Œç„¶åŽå¤åˆ¶æºæ–‡ä»¶æˆ–ç›®å½•æ ‘çš„metadataä»¥å¯¹å®ƒçš„å†…å­˜çŠ¶æ€å®žæ–½ç™»è®°çš„æ“ä½œã€‚è¿™ä¸ªæ–°åˆ›å»ºçš„snapshotæ–‡ä»¶å’Œæºæ–‡ä»¶ï¼ˆå…¶metadataï¼‰æŒ‡å‘ç›¸åŒçš„å—ï¼ˆchunkï¼‰ã€‚ Snapshotä¹‹åŽï¼Œå®¢æˆ·ç¬¬ä¸€æ¬¡å‘chunk cå†™çš„æ—¶å€™ï¼Œå®ƒå‘ä¸€ä¸ªè¯·æ±‚ç»™masterä»¥æ‰¾åˆ°æ‹¥æœ‰leaseçš„å‰¯æœ¬ã€‚masteræ³¨æ„åˆ°chunk cçš„å¼•ç”¨è®°æ•°æ¯”1å¤§ï¼Œå®ƒå»¶è¿Ÿå¯¹ç”¨æˆ·çš„å“åº”ï¼Œé€‰æ‹©ä¸€ä¸ªchunk handle Câ€™,ç„¶åŽè¦æ±‚æ¯ä¸€æœ‰chunk cçš„å‰¯æœ¬çš„chunk serveråˆ›å»ºä¸€ä¸ªå—Câ€™ã€‚æ¯ä¸ªchunk serveråœ¨æœ¬åœ°åˆ›å»ºchunk Câ€™é¿å…äº†ç½‘ç»œå¼€é”€ã€‚ä»Žè¿™ä»¥åŽå’Œå¯¹åˆ«çš„å—çš„æ“ä½œæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ MASTERæ“ä½œMASTERæ‰§è¡Œæ‰€æœ‰åå­—ç©ºé—´çš„æ“ä½œï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä»–è¿˜åœ¨ç³»ç»ŸèŒƒå›´ç®¡ç†æ•°æ®å—çš„å¤åˆ¶ï¼šå†³å®šæ•°æ®å—çš„æ”¾ç½®æ–¹æ¡ˆï¼Œäº§ç”Ÿæ–°æ•°æ®å—å¹¶å°†å…¶å¤‡ä»½ï¼Œå’Œå…¶ä»–ç³»ç»ŸèŒƒå›´çš„æ“ä½œååŒæ¥ç¡®ä¿æ•°æ®å¤‡ä»½çš„å®Œæ•´æ€§ï¼Œåœ¨æ‰€æœ‰çš„æ•°æ®å—æœåŠ¡å™¨ä¹‹é—´å¹³è¡¡è´Ÿè½½å¹¶æ”¶å›žæ²¡æœ‰ä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚ åå­—ç©ºé—´ç®¡ç†å’ŒåŠ é”ä¸Žä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼ŒGFSæ²¡æœ‰ä¸Žæ¯ä¸ªç›®å½•ç›¸å…³çš„èƒ½åˆ—å‡ºå…¶æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®ç»“æž„ï¼Œå®ƒä¹Ÿä¸æ”¯æŒåˆ«åï¼ˆunixä¸­çš„ç¡¬è¿žæŽ¥æˆ–ç¬¦å·è¿žæŽ¥ï¼‰ï¼Œä¸ç®¡æ˜¯å¯¹æ–‡ä»¶æˆ–æ˜¯ç›®å½•ã€‚GFSçš„åå­—ç©ºé—´é€»è¾‘ä¸Šæ˜¯ä»Žæ–‡ä»¶å…ƒæ•°æ®åˆ°è·¯å¾„åæ˜ å°„çš„ä¸€ä¸ªæŸ¥ç”¨è¡¨ã€‚ MASTERåœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œå‰éƒ½è¦èŽ·å¾—ä¸€ç³»åˆ—é”ï¼Œä¾‹å¦‚ï¼Œå®ƒè¦å¯¹/d1/d2â€¦/dn/leafæ‰§è¡Œæ“ä½œï¼Œåˆ™å®ƒå¿…é¡»èŽ·å¾—/d1ï¼Œ/d1/d2ï¼Œâ€¦ï¼Œ /d1/d2/â€¦/dnçš„è¯»é”ï¼Œ/d1/d2â€¦/dn/leafçš„è¯»é”æˆ–å†™é”ï¼ˆå…¶ä¸­leafå¯ä»¥ä½¿æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯ç›®å½•ï¼‰ã€‚MASTERæ“ä½œçš„å¹¶è¡Œæ€§å’Œæ•°æ®çš„ä¸€è‡´æ€§å°±æ˜¯é€šè¿‡è¿™äº›é”æ¥å®žçŽ°çš„ã€‚ å¤‡ä»½å­˜å‚¨æ”¾ç½®ç­–ç•¥ä¸€ä¸ªGFSé›†ç¾¤æ–‡ä»¶ç³»ç»Ÿå¯èƒ½æ˜¯å¤šå±‚åˆ†å¸ƒçš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æˆåƒä¸Šä¸‡ä¸ªæ–‡ä»¶å—æœåŠ¡å™¨åˆ†å¸ƒäºŽä¸åŒçš„æœºæž¶ä¸Šï¼Œè€Œè¿™äº›æ–‡ä»¶å—æœåŠ¡å™¨åˆè¢«åˆ†å¸ƒäºŽä¸åŒæœºæž¶ä¸Šçš„å®¢æˆ·æ¥è®¿é—®ã€‚å› æ­¤ï¼Œä¸åŒæœºæž¶ä¸Šçš„ä¸¤å°æœºå™¨ä¹‹é—´çš„é€šä¿¡å¯èƒ½é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªäº¤æ¢æœºã€‚æ•°æ®å—å†—ä½™é…ç½®ç­–ç•¥è¦è¾¾åˆ°è¿žä¸ªç›®çš„ï¼šæœ€å¤§çš„æ•°æ®å¯é æ€§å’Œå¯ç”¨æ€§ï¼Œæœ€å¤§çš„ç½‘ç»œå¸¦å®½åˆ©ç”¨çŽ‡ã€‚å› æ­¤ï¼Œå¦‚æžœä»…ä»…æŠŠæ•°æ®çš„æ‹·è´ç½®äºŽä¸åŒçš„æœºå™¨ä¸Šå¾ˆéš¾æ»¡è¶³è¿™ä¸¤ä¸ªè¦æ±‚ï¼Œå¿…é¡»åœ¨ä¸åŒçš„æœºæž¶ä¸Šè¿›è¡Œæ•°æ®å¤‡ä»½ã€‚è¿™æ ·å³ä½¿æ•´ä¸ªæœºæž¶è¢«æ¯æˆ–æ˜¯æŽ‰çº¿ï¼Œä¹Ÿèƒ½ç¡®ä¿æ•°æ®çš„æ­£å¸¸ä½¿ç”¨ã€‚è¿™ä¹Ÿä½¿æ•°æ®ä¼ è¾“ï¼Œå°¤å…¶æ˜¯è¯»æ•°æ®ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¸¦å®½ï¼Œè®¿é—®åˆ°å¤šä¸ªæœºæž¶ï¼Œè€Œå†™æ“ä½œï¼Œåˆ™ä¸å¾—ä¸æ¶‰åŠåˆ°æ›´å¤šçš„æœºæž¶ã€‚ äº§ç”Ÿã€é‡å¤åˆ¶ã€é‡å¹³è¡¡æ•°æ®å—å½“MASTERäº§ç”Ÿæ–°çš„æ•°æ®å—æ—¶ï¼Œå¦‚ä½•æ”¾ç½®æ–°æ•°æ®å—ï¼Œè¦è€ƒè™‘å¦‚ä¸‹å‡ ä¸ªå› ç´ ï¼šï¼ˆ1ï¼‰å°½é‡æ”¾ç½®åœ¨ç£ç›˜åˆ©ç”¨çŽ‡ä½Žçš„æ•°æ®å—æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ï¼Œæ…¢æ…¢åœ°å„æœåŠ¡å™¨çš„ç£ç›˜åˆ©ç”¨çŽ‡å°±ä¼šè¾¾åˆ°å¹³è¡¡ã€‚ï¼ˆ2ï¼‰å°½é‡æŽ§åˆ¶åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„â€œæ–°åˆ›å»ºâ€çš„æ¬¡æ•°ã€‚ï¼ˆ3ï¼‰ç”±äºŽä¸Šä¸€å°èŠ‚è®¨è®ºçš„åŽŸå› ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ•°æ®å—æ”¾ç½®äºŽä¸åŒçš„æœºæž¶ä¸Šã€‚ MASTERåœ¨å¯ç”¨çš„æ•°æ®å—å¤‡ä»½ä½ŽäºŽç”¨æˆ·è®¾å®šçš„æ•°ç›®æ—¶éœ€è¦è¿›è¡Œé‡å¤åˆ¶ã€‚è¿™ç§æƒ…å†µæºäºŽå¤šç§åŽŸå› ï¼šæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œæ•°æ®è¢«ç ´åï¼Œç£ç›˜è¢«ç ´åï¼Œæˆ–è€…å¤‡ä»½æ•°ç›®è¢«ä¿®æ”¹ã€‚æ¯ä¸ªè¢«éœ€è¦é‡å¤åˆ¶çš„æ•°æ®å—çš„ä¼˜å…ˆçº§æ ¹æ®ä»¥ä¸‹å‡ é¡¹ç¡®å®šï¼šç¬¬ä¸€æ˜¯çŽ°åœ¨çš„æ•°ç›®è·ç›®æ ‡çš„è·ç¦»ï¼Œå¯¹äºŽèƒ½é˜»å¡žç”¨æˆ·ç¨‹åºçš„æ•°æ®å—ï¼Œæˆ‘ä»¬ä¹Ÿæé«˜å®ƒçš„ä¼˜å…ˆçº§ã€‚æœ€åŽï¼Œ MASTERæŒ‰ç…§äº§ç”Ÿæ•°æ®å—çš„åŽŸåˆ™å¤åˆ¶æ•°æ®å—ï¼Œå¹¶æŠŠå®ƒä»¬æ”¾åˆ°ä¸åŒçš„æœºæž¶å†…çš„æœåŠ¡å™¨ä¸Šã€‚ MASTERå‘¨æœŸæ€§çš„å¹³è¡¡å„æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½ï¼šå®ƒæ£€æŸ¥chunkåˆ†å¸ƒå’Œè´Ÿè½½å¹³è¡¡ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥å¡«å……ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨è€Œä¸æ˜¯æŠŠå…¶ä»–çš„å†…å®¹ç»Ÿç»Ÿæ”¾ç½®åˆ°å®ƒä¸Šé¢å¸¦æ¥å¤§é‡çš„å†™æ•°æ®ã€‚æ•°æ®å—æ”¾ç½®çš„åŽŸåˆ™ä¸Žä¸Šé¢è®¨è®ºçš„ç›¸åŒï¼Œæ­¤å¤–ï¼ŒMASTERè¿˜å†³å®šé‚£äº›æ•°æ®å—è¦è¢«ç§»é™¤ï¼ŒåŽŸåˆ™ä¸Šä»–ä¼šæ¸…é™¤é‚£äº›ç©ºé—²ç©ºé—´ä½ŽäºŽå¹³å‡å€¼çš„é‚£äº›æœåŠ¡å™¨ã€‚ åžƒåœ¾æ”¶é›†åœ¨ä¸€ä¸ªæ–‡ä»¶è¢«åˆ é™¤ä¹‹åŽï¼ŒGFSå¹¶ä¸ç«‹å³æ”¶å›žç£ç›˜ç©ºé—´ï¼Œè€Œæ˜¯ç­‰åˆ°åžƒåœ¾æ”¶é›†ç¨‹åºåœ¨æ–‡ä»¶å’Œæ•°æ®å—çº§çš„çš„æ£€æŸ¥ä¸­æ”¶å›žã€‚ å½“ä¸€ä¸ªæ–‡ä»¶è¢«åº”ç”¨ç¨‹åºåˆ é™¤ä¹‹åŽï¼ŒMASTERä¼šç«‹å³è®°å½•ä¸‹è¿™äº›å˜åŒ–ï¼Œä½†æ–‡ä»¶æ‰€å ç”¨çš„èµ„æºå´ä¸ä¼šè¢«ç«‹å³æ”¶å›žï¼Œè€Œæ˜¯é‡æ–°ç»™æ–‡ä»¶å‘½äº†ä¸€ä¸ªéšè—çš„åå­—ï¼Œå¹¶é™„ä¸Šäº†åˆ é™¤çš„æ—¶é—´æˆ³ã€‚åœ¨MASTERå®šæœŸæ£€æŸ¥åå­—ç©ºé—´æ—¶ï¼Œå®ƒåˆ é™¤è¶…è¿‡ä¸‰å¤©ï¼ˆå¯ä»¥è®¾å®šï¼‰çš„éšè—çš„æ–‡ä»¶ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¯ä»¥ä»¥ä¸€ä¸ªæ–°çš„åå­—æ¥è¯»æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä»¥å‰çš„åå­—æ¢å¤ã€‚å½“éšè—çš„æ–‡ä»¶åœ¨åå­—ç©ºé—´ä¸­è¢«åˆ é™¤ä»¥åŽï¼Œå®ƒåœ¨å†…å­˜ä¸­çš„å…ƒæ•°æ®å³è¢«æ“¦é™¤ï¼Œè¿™å°±æœ‰æ•ˆåœ°åˆ‡æ–­äº†ä»–å’Œæ‰€æœ‰æ•°æ®å—çš„è”ç³»ã€‚ åœ¨ä¸€ä¸ªç›¸ä¼¼çš„å®šæœŸçš„åå­—ç©ºé—´æ£€æŸ¥ä¸­ï¼ŒMASTERç¡®è®¤å­¤å„¿æ•°æ®å—ï¼ˆä¸å±žäºŽä»»ä½•æ–‡ä»¶ï¼‰å¹¶æ“¦é™¤ä»–çš„å…ƒæ•°æ®ï¼Œåœ¨å’ŒMASTERçš„å¿ƒè·³ä¿¡æ¯äº¤æ¢ä¸­ï¼Œæ¯ä¸ªæœåŠ¡å™¨æŠ¥å‘Šä»–æ‰€æ‹¥æœ‰çš„æ•°æ®å—ï¼ŒMASTERè¿”å›žå…ƒæ•°æ®ä¸åœ¨å†…å­˜çš„æ•°æ®å—ï¼ŒæœåŠ¡å™¨å³å¯ä»¥åˆ é™¤è¿™äº›æ•°æ®å—ã€‚ è¿‡æ—¶æ•°æ®çš„æŽ¢æµ‹åœ¨æ•°æ®æ›´æ–°æ—¶å¦‚æžœæœåŠ¡å™¨åœæœºäº†ï¼Œé‚£ä¹ˆä»–æ‰€ä¿å­˜çš„æ•°æ®å¤‡ä»½å°±ä¼šè¿‡æ—¶ã€‚å¯¹æ¯ä¸ªæ•°æ®å—ï¼ŒMASTERè®¾ç½®äº†ä¸€ä¸ªç‰ˆæœ¬å·æ¥åŒºåˆ«æ›´æ–°è¿‡çš„æ•°æ®å—å’Œè¿‡æ—¶çš„æ•°æ®å—ã€‚ å½“MASTERæŽˆæƒä¸€ä¸ªæ–°çš„leaseæ—¶ï¼Œä»–ä¼šå¢žåŠ æ•°æ®å—çš„ç‰ˆæœ¬å·å¹¶ä¼šé€šçŸ¥æ›´æ–°æ•°æ®å¤‡ä»½ã€‚MASTERå’Œå¤‡ä»½éƒ½ä¼šè®°å½•ä¸‹å½“å‰çš„ç‰ˆæœ¬å·ï¼Œå¦‚æžœä¸€ä¸ªå¤‡ä»½å½“æ—¶ä¸å¯ç”¨ï¼Œé‚£ä¹ˆä»–çš„ç‰ˆæœ¬å·ä¸å¯èƒ½æé«˜ï¼Œå½“chunk serveré‡æ–°å¯åŠ¨å¹¶å‘MASTERæŠ¥å‘Šä»–çš„æ•°æ®å—é›†æ—¶ï¼ŒMASTERå°±ä¼šå‘çŽ°è¿‡æ—¶çš„æ•°æ®ã€‚ MASTERåœ¨å®šæœŸçš„åžƒåœ¾æ”¶é›†ç¨‹åºä¸­æ¸…é™¤è¿‡æ—¶çš„å¤‡ä»½ï¼Œåœ¨æ­¤ä»¥å‰ï¼Œå¤„äºŽæ•ˆçŽ‡è€ƒè™‘ï¼Œåœ¨å„å®¢æˆ·åŠè‹±å¤§ä½¿ï¼Œä»–ä¼šè®¤ä¸ºæ ¹æœ¬ä¸å­˜åœ¨è¿‡æ—¶çš„æ•°æ®ã€‚ä½œä¸ºå¦ä¸€ä¸ªå®‰å…¨æŽªæ–½ï¼Œ MASTERåœ¨ç»™å®¢æˆ·åŠå…³äºŽæ•°æ®å—çš„åº”ç­”æˆ–æ˜¯å¦å¤–ä¸€ä¸ªè¯»å–æ•°æ®çš„æœåŠ¡å™¨æ•°æ®æ˜¯éƒ½ä¼šå¸¦ä¸Šç‰ˆæœ¬ä¿¡æ¯ï¼Œåœ¨æ“ä½œå‰å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¼šéªŒè¯ç‰ˆæœ¬ä¿¡æ¯ä»¥ç¡®ä¿å¾—åˆ°çš„æ˜¯æœ€æ–°çš„æ•°æ®ã€‚ å®¹é”™å’Œè¯Šæ–­é«˜å¯é æ€§å¿«é€Ÿæ¢å¤ä¸ç®¡å¦‚ä½•ç»ˆæ­¢æœåŠ¡ï¼ŒMASTERå’Œæ•°æ®å—æœåŠ¡å™¨éƒ½ä¼šåœ¨å‡ ç§’é’Ÿå†…æ¢å¤çŠ¶æ€å’Œè¿è¡Œã€‚å®žé™…ä¸Šï¼Œæˆ‘ä»¬ä¸å¯¹æ­£å¸¸ç»ˆæ­¢å’Œä¸æ­£å¸¸ç»ˆæ­¢è¿›è¡ŒåŒºåˆ†ï¼ŒæœåŠ¡å™¨è¿›ç¨‹éƒ½ä¼šè¢«åˆ‡æ–­è€Œç»ˆæ­¢ã€‚å®¢æˆ·æœºå’Œå…¶ä»–çš„æœåŠ¡å™¨ä¼šç»åŽ†ä¸€ä¸ªå°å°çš„ä¸­æ–­ï¼Œç„¶åŽå®ƒä»¬çš„ç‰¹å®šè¯·æ±‚è¶…æ—¶ï¼Œé‡æ–°è¿žæŽ¥é‡å¯çš„æœåŠ¡å™¨ï¼Œé‡æ–°è¯·æ±‚ã€‚ æ•°æ®å—å¤‡ä»½å¦‚ä¸Šæ–‡æ‰€è®¨è®ºçš„ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½ä¼šè¢«å¤‡ä»½åˆ°æ”¾åˆ°ä¸åŒæœºæž¶ä¸Šçš„ä¸åŒæœåŠ¡å™¨ä¸Šã€‚å¯¹ä¸åŒçš„åå­—ç©ºé—´ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®ä¸åŒçš„å¤‡ä»½çº§åˆ«ã€‚åœ¨æ•°æ®å—æœåŠ¡å™¨æŽ‰çº¿æˆ–æ˜¯æ•°æ®è¢«ç ´åæ—¶ï¼ŒMASTERä¼šæŒ‰ç…§éœ€è¦æ¥å¤åˆ¶æ•°æ®å—ã€‚ MASTERå¤‡ä»½ä¸ºç¡®ä¿å¯é æ€§ï¼ŒMASTERçš„çŠ¶æ€ã€æ“ä½œè®°å½•å’Œæ£€æŸ¥ç‚¹éƒ½åœ¨å¤šå°æœºå™¨ä¸Šè¿›è¡Œäº†å¤‡ä»½ã€‚ä¸€ä¸ªæ“ä½œåªæœ‰åœ¨æ•°æ®å—æœåŠ¡å™¨ç¡¬ç›˜ä¸Šåˆ·æ–°å¹¶è¢«è®°å½•åœ¨MASTERå’Œå…¶å¤‡ä»½çš„ä¸Šä¹‹åŽæ‰ç®—æ˜¯æˆåŠŸçš„ã€‚å¦‚æžœMASTERæˆ–æ˜¯ç¡¬ç›˜å¤±è´¥ï¼Œç³»ç»Ÿç›‘è§†å™¨ä¼šå‘çŽ°å¹¶é€šè¿‡æ”¹å˜åŸŸåå¯åŠ¨å®ƒçš„ä¸€ä¸ªå¤‡ä»½æœºï¼Œè€Œå®¢æˆ·æœºåˆ™ä»…ä»…æ˜¯ä½¿ç”¨è§„èŒƒçš„åç§°æ¥è®¿é—®ï¼Œå¹¶ä¸ä¼šå‘çŽ°MASTERçš„æ”¹å˜ã€‚ æ•°æ®å®Œæ•´æ€§æ¯ä¸ªæ•°æ®å—æœåŠ¡å™¨éƒ½åˆ©ç”¨æ ¡éªŒå’Œæ¥æ£€éªŒå­˜å‚¨æ•°æ®çš„å®Œæ•´æ€§ã€‚åŽŸå› ï¼šæ¯ä¸ªæœåŠ¡å™¨éšæ—¶éƒ½æœ‰å‘ç”Ÿå´©æºƒçš„å¯èƒ½æ€§ï¼Œå¹¶ä¸”åœ¨ä¸¤ä¸ªæœåŠ¡å™¨é—´æ¯”è¾ƒæ•°æ®å—ä¹Ÿæ˜¯ä¸çŽ°å®žçš„ï¼ŒåŒæ—¶ï¼Œåœ¨ä¸¤å°æœåŠ¡å™¨é—´æ‹·è´æ•°æ®å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ æ¯ä¸ªChunkæŒ‰64kBçš„å¤§å°åˆ†æˆå—ï¼Œæ¯ä¸ªå—æœ‰32ä½çš„æ ¡éªŒå’Œï¼Œæ ¡éªŒå’Œå’Œæ—¥å¿—å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå’Œç”¨æˆ·æ•°æ®åˆ†å¼€ã€‚ åœ¨è¯»æ•°æ®æ—¶ï¼ŒæœåŠ¡å™¨é¦–å…ˆæ£€æŸ¥ä¸Žè¢«è¯»å†…å®¹ç›¸å…³éƒ¨åˆ†çš„æ ¡éªŒå’Œï¼Œå› æ­¤ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¼ æ’­é”™è¯¯çš„æ•°æ®ã€‚å¦‚æžœæ‰€æ£€æŸ¥çš„å†…å®¹å’Œæ ¡éªŒå’Œä¸ç¬¦ï¼ŒæœåŠ¡å™¨å°±ä¼šç»™æ•°æ®è¯·æ±‚è€…è¿”å›žä¸€ä¸ªé”™è¯¯çš„ä¿¡æ¯ï¼Œå¹¶æŠŠè¿™ä¸ªæƒ…å†µæŠ¥å‘Šç»™MASTERã€‚å®¢æˆ·æœºå°±ä¼šè¯»å…¶ä»–çš„æœåŠ¡å™¨æ¥èŽ·å–æ•°æ®ï¼Œè€ŒMASTERåˆ™ä¼šä»Žå…¶ä»–çš„æ‹·è´æ¥å¤åˆ¶æ•°æ®ï¼Œç­‰åˆ°ä¸€ä¸ªæ–°çš„æ‹·è´å®Œæˆæ—¶ï¼ŒMASTERå°±ä¼šé€šçŸ¥æŠ¥å‘Šé”™è¯¯çš„æœåŠ¡å™¨åˆ é™¤å‡ºé”™çš„æ•°æ®å—ã€‚ é™„åŠ å†™æ•°æ®æ—¶çš„æ ¡éªŒå’Œè®¡ç®—ä¼˜åŒ–äº†ï¼Œå› ä¸ºè¿™æ˜¯ä¸»è¦çš„å†™æ“ä½œã€‚æˆ‘ä»¬åªæ˜¯æ›´æ–°å¢žåŠ éƒ¨åˆ†çš„æ ¡éªŒå’Œï¼Œå³ä½¿æœ«å°¾éƒ¨åˆ†çš„æ ¡éªŒå’Œæ•°æ®å·²è¢«æŸåè€Œæˆ‘ä»¬æ²¡æœ‰æ£€æŸ¥å‡ºæ¥ï¼Œæ–°çš„æ ¡éªŒå’Œä¸Žæ•°æ®ä¼šä¸ç›¸ç¬¦ï¼Œè¿™ç§å†²çªåœ¨ä¸‹æ¬¡ä½¿ç”¨æ—¶å°†ä¼šè¢«æ£€æŸ¥å‡ºæ¥ã€‚ ç›¸åï¼Œå¦‚æžœæ˜¯è¦†ç›–çŽ°æœ‰æ•°æ®çš„å†™ï¼Œåœ¨å†™ä»¥å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥ç¬¬ä¸€å’Œæœ€åŽä¸€ä¸ªæ•°æ®å—ï¼Œç„¶åŽæ‰èƒ½æ‰§è¡Œå†™æ“ä½œï¼Œæœ€åŽè®¡ç®—å’Œè®°å½•æ ¡éªŒå’Œã€‚å¦‚æžœæˆ‘ä»¬åœ¨è¦†ç›–ä»¥å‰ä¸å…ˆæ£€æŸ¥é¦–ä½æ•°æ®å—ï¼Œè®¡ç®—å‡ºçš„æ ¡éªŒå’Œåˆ™ä¼šå› ä¸ºæ²¡è¢«è¦†ç›–çš„æ•°æ®è€Œäº§ç”Ÿé”™è¯¯ã€‚ åœ¨ç©ºé—²æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥ä¸æ´»è·ƒçš„æ•°æ®å—çš„æ ¡éªŒå’Œï¼Œè¿™æ ·å¯ä»¥æ£€æŸ¥å‡ºä¸ç»å¸¸è¯»çš„æ•°æ®çš„é”™è¯¯ã€‚ä¸€æ—¦é”™è¯¯è¢«æ£€æŸ¥å‡ºæ¥ï¼ŒæœåŠ¡å™¨ä¼šæ‹·è´ä¸€ä¸ªæ­£ç¡®çš„æ•°æ®å—æ¥ä»£æ›¿é”™è¯¯çš„ã€‚ è¯Šæ–­å·¥å…·å¹¿æ³›è€Œç»†è‡´çš„è¯Šæ–­æ—¥å¿—ä»¥å¾®å°çš„ä»£ä»·æ¢å–äº†åœ¨é—®é¢˜éš”ç¦»ã€è¯Šæ–­ã€æ€§èƒ½åˆ†æžæ–¹é¢èµ·åˆ°äº†é‡å¤§çš„ä½œç”¨ã€‚GFSæœåŠ¡å™¨ç”¨æ—¥å¿—æ¥è®°å½•æ˜¾è‘—çš„äº‹ä»¶ï¼ˆä¾‹å¦‚æœåŠ¡å™¨åœæœºå’Œå¯åŠ¨ï¼‰å’Œè¿œç¨‹çš„åº”ç­”ã€‚è¿œç¨‹æ—¥å¿—è®°å½•æœºå™¨ä¹‹é—´çš„è¯·æ±‚å’Œåº”ç­”ï¼Œé€šè¿‡æ”¶é›†ä¸åŒæœºå™¨ä¸Šçš„æ—¥å¿—è®°å½•ï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œåˆ†æžæ¢å¤ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæ•´åœ°é‡çŽ°æ´»åŠ¨çš„åœºæ™¯ï¼Œå¹¶ç”¨æ­¤æ¥è¿›è¡Œé”™è¯¯åˆ†æžã€‚ æµ‹é‡æµ‹è¯•çŽ¯å¢ƒä¸€å°ä¸»æŽ§æœºï¼Œä¸¤å°ä¸»æŽ§æœºå¤‡ä»½ï¼Œ16å°æ•°æ®å—æœåŠ¡å™¨ï¼Œ16å°å®¢æˆ·æœºã€‚ æ¯å°æœºå™¨ï¼š2å—PIII1.4Gå¤„ç†å™¨ï¼Œ2Gå†…å­˜ï¼Œ2å—80G5400rpmçš„ç¡¬ç›˜ï¼Œ1å—100Mbpså…¨åŒå·¥ç½‘å¡ 19å°æœåŠ¡å™¨è¿žæŽ¥åˆ°ä¸€ä¸ªHP2524äº¤æ¢æœºä¸Šï¼Œ16å°å®¢æˆ·æœºä¿©æŽ¥åˆ°é¢†å¤–ä¸€å°äº¤æ¢æœºä¸Šï¼Œä¸¤å°äº¤æ¢æœºé€šè¿‡1Gçš„é“¾è·¯ç›¸è¿žã€‚]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[ã€Šä¸‰ä½“ã€‹è¯»åŽæ„Ÿ]]></title>
      <url>%2F2017%2F01%2F16%2Fthree-body%2F</url>
      <content type="text"><![CDATA[äººç‰©å¶æ–‡æ´å¤§å²ç½—è¾‘æ‰˜é©¬æ–¯ãƒ»ç»´å¾·ç¨‹å¿ƒäº‘å¤©æ˜Žä¸‰ä½“äººæ­Œè€… æˆ‘æ¯ç­ä½ ï¼Œä¸Žä½ æœ‰ä½•å…³ç³» äº‹ä»¶å¶æ–‡æ´å‘å°„ä¿¡å·ç»™ä¸‰ä½“äººè®¾ç½®é¢å£è€…è®¾ç½®æ‰§å‰‘äººæ°´æ»´æ¯ç­äººç±»æ˜Ÿèˆ°äººç±»æ˜Ÿèˆ°é»‘æš—æˆ˜å½¹ä¸‰ä½“æ¯ç­å¤ªé˜³ç³»æ¯ç­äº‘å¤©æ˜Žèµ é€æ’æ˜Ÿç»™ç¨‹å¿ƒäº‘å¤©æ˜Žåˆ¶é€ å°æ˜Ÿçƒç¨‹å¿ƒå½’è¿˜å°æ˜Ÿçƒç»™å®‡å®™åè¯é»‘æš—æ£®æž—]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[å¯¹è®¢å•ç³»ç»Ÿçš„ä¸€äº›æ€è€ƒ]]></title>
      <url>%2F2017%2F01%2F12%2Forder-system%2F</url>
      <content type="text"><![CDATA[è®¢å•æ˜¯ä»€ä¹ˆ è®¢å•æ˜¯äº¤æ˜“çš„å¿«ç…§ä¿¡æ¯ï¼Œç”¨äºŽè®°å½•äº¤æ˜“å‘ç”Ÿæ—¶çš„ç›¸å…³ä¿¡æ¯ è®¢å•ä¸€èˆ¬åŒ…å«å“ªäº›ä¿¡æ¯ ç”¨æˆ·ï¼šå•†å“æˆ–æœåŠ¡çš„æ¶ˆè´¹è€… å•†å®¶ï¼šå•†å“æˆ–æœåŠ¡çš„æä¾›è€… ç‰©å“ï¼šäº¤æ˜“æ¶‰åŠçš„å•†å“æˆ–æœåŠ¡çš„åç§°ã€å±žæ€§åŠæè¿°ä¿¡æ¯ ä»·æ ¼ï¼šç‰©å“çš„ä»·æ ¼ï¼Œæ ¹æ®éœ€è¦å¯ä»¥åˆ†ä¸ºåŽŸå§‹ä»·æ ¼ã€å•ä½ä»·æ ¼ã€æœ€ç»ˆä»·æ ¼ç­‰ ä¼˜æƒ ï¼šå•†å®¶æä¾›ç»™ç”¨æˆ·çš„ç”¨äºŽå‡å…ä»·æ ¼çš„è¡Œä¸ºæè¿°ï¼Œä¸€èˆ¬åŒ…å«æŠ˜æ‰£ã€ä»£é‡‘åˆ¸ã€æŠµæ‰£åˆ¸ç­‰å„ç§ç±»åž‹ æ—¶é—´ï¼šä¸€èˆ¬åŒ…å«äº¤æ˜“å‘ç”Ÿä¸Žç»“æŸæ—¶é—´ã€æ”¯ä»˜å‘ç”Ÿä¸Žç»“æŸæ—¶é—´ã€ç‰©å“å‘è´§ä¸Žå®Œæˆæ—¶é—´ç­‰ æ”¯ä»˜æµæ°´å·ï¼šå‡¡æ˜¯æ¶‰åŠæ”¯ä»˜è¡Œä¸ºçš„è®¢å•ï¼Œä¸€èˆ¬éƒ½éœ€è¦ä¸Žæ”¯ä»˜æµæ°´å·ç›¸å…³è”ï¼Œæ”¯ä»˜æµæ°´å·ä¸€èˆ¬ç”±å…¶ä»–ç³»ç»Ÿç»´æŠ¤ï¼Œè®°å½•æ”¯ä»˜æ¸ é“ã€è´¦æˆ·å˜æ›´ç­‰ä¿¡æ¯ è®¢å•çš„å¸¸è§çŠ¶æ€ä¸Žä¸»è¦æµç¨‹ åˆ›å»ºï¼šç”¨æˆ·é€šè¿‡å‰å°å”®å–é¡µé¢æˆ–APIå‘èµ·ä¸‹å•è¯·æ±‚ï¼Œè®¢å•ç³»ç»Ÿæ ¹æ®è¯·æ±‚å†…å®¹åˆ›å»ºæ–°çš„è®¢å•ï¼Œæ­¤æ—¶è®¢å•çš„çŠ¶æ€ä¸ºâ€œåˆå§‹åŒ–â€ æ”¯ä»˜ï¼šè‹¥è®¢å•æœ€ç»ˆéœ€è¦æ”¯ä»˜çš„é‡‘é¢ä¸ä¸º0ï¼Œåˆ™ä¸€èˆ¬ç”±ç”¨æˆ·é€šè¿‡å‰å°å”®å–é¡µé¢æˆ–APIå‘èµ·æ”¯ä»˜è¯·æ±‚ï¼Œè®¢å•ç³»ç»Ÿè°ƒç”¨å¤–éƒ¨æ”¯ä»˜ç³»ç»Ÿå‘èµ·æ”¯ä»˜ï¼Œè‹¥æ”¯ä»˜è¯·æ±‚æ˜¯åŒæ­¥çš„ï¼Œåˆ™å¯æ ¹æ®æ”¯ä»˜æˆåŠŸä¸Žå¤±è´¥å†³å®šè®¢å•æ–°çš„çŠ¶æ€ï¼Œè‹¥æ”¯ä»˜è¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œä¸€èˆ¬éœ€è¦å…ˆå°†è®¢å•çŠ¶æ€åˆ‡æ¢ä¸ºâ€œæ”¯ä»˜ä¸­â€ï¼ŒåŽç»­é€šè¿‡è®¢å•ç³»ç»Ÿè½®è¯¢æˆ–æ”¯ä»˜ç³»ç»Ÿå›žè°ƒçš„æ–¹å¼èŽ·å–æ”¯ä»˜ç»“æžœ å‘è´§ï¼šå·²æ”¯ä»˜çš„è®¢å•æˆ–è€…ä¸éœ€è¦æ”¯ä»˜çš„è®¢å•ï¼Œç³»ç»Ÿå¯ç›´æŽ¥è¿›è¡Œå‘è´§ï¼Œå‘è´§ç»“æžœä¸€èˆ¬ç”±è®¢å•ç³»ç»Ÿè½®è¯¢æˆ–å¤–éƒ¨ç³»ç»Ÿå›žè°ƒè¿›è¡Œæ›´æ–° é€€æ¬¾ï¼šç”¨æˆ·é€šè¿‡å‰å°ç®¡ç†é¡µé¢æˆ–APIå‘èµ·é€€æ¬¾è¯·æ±‚ï¼Œä¸€èˆ¬ä»…å½“è®¢å•å¤„äºŽâ€œå‘è´§å®Œæˆâ€æˆ–â€œå‘è´§å¤±è´¥â€æ—¶æ‰å¯è¿›è¡Œé€€æ¬¾ æŸ¥è¯¢ï¼šç”¨æˆ·é€šè¿‡å‰å°å”®å–é¡µé¢æˆ–APIï¼ŒæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„å•ä¸ªæˆ–å¤šä¸ªè®¢å• å–æ¶ˆï¼šå¤„äºŽâ€œåˆå§‹åŒ–â€çŠ¶æ€çš„è®¢å•ï¼Œä¸€èˆ¬å¯ç”±ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆï¼Œè‹¥è®¢å•è¶…è¿‡ä¸€å®šæ—¶é—´æœªæ”¯ä»˜ï¼Œç³»ç»Ÿä¹Ÿå¯è‡ªåŠ¨å–æ¶ˆ åˆ é™¤ï¼šå¯¹äºŽâ€œå·²å–æ¶ˆâ€æˆ–â€œå·²é€€æ¬¾â€çŠ¶æ€çš„è®¢å•ï¼Œç”¨æˆ·å¯é€šè¿‡å‰å°ç®¡ç†é¡µé¢æˆ–APIè¿›è¡Œåˆ é™¤ï¼ŒåŽç»­æŸ¥è¯¢è¯·æ±‚æ— æ³•èŽ·å–â€œå·²åˆ é™¤â€çŠ¶æ€çš„è®¢å• è®¢å•ç³»ç»Ÿçš„å®‰å…¨é—®é¢˜ æƒé™æ ¡éªŒï¼šç”¨æˆ·ä»»ä½•æ“ä½œéƒ½éœ€è¦å…ˆé‰´æƒï¼Œç”¨æˆ·ä»…èƒ½æ“ä½œè‡ªå·±çš„è®¢å• æ“ä½œé¢‘çŽ‡é™åˆ¶ï¼šç³»ç»Ÿé’ˆå¯¹ç”¨æˆ·ç‰¹å®šæ“ä½œå¿…é¡»æœ‰é¢‘çŽ‡é™åˆ¶ï¼Œè‹¥å‘çŽ°å¼‚å¸¸è¯·æ±‚éœ€è¦èƒ½ä¸»åŠ¨æ‹’ç» é€šç”¨å‚æ•°æ ¡éªŒï¼šå¯¹æ¯ä¸€ä¸ªè®¢å•ç›¸å…³çš„é€šç”¨å‚æ•°éƒ½éœ€è¦åšç±»åž‹ä¸Žå–å€¼èŒƒå›´çš„åŸºç¡€æ ¡éªŒï¼ŒåŒæ—¶éœ€è¦è€ƒè™‘å‚æ•°ä¸Žä¸šåŠ¡é€»è¾‘çš„ç›¸å…³æ ¡éªŒ ä¸šåŠ¡å‚æ•°æ ¡éªŒï¼šé€šå¸¸ç”¨æˆ·è´­ä¹°çš„å•†å“éƒ½ä¼šæœ‰ç‰¹å®šçš„å±žæ€§ï¼Œè¿™äº›å±žæ€§å¿…é¡»æ˜¯åˆæ³•ä¸”æœ‰æ•ˆçš„ï¼Œä¸èƒ½ä¿¡ä»»å‰å°å¸¦è¿‡æ¥çš„ä»»ä½•å‚æ•° æ“ä½œæ—¥å¿—ï¼šç”¨æˆ·åœ¨ä½•æ—¶è¿›è¡Œäº†ä½•ç§æ“ä½œï¼Œç³»ç»Ÿéƒ½éœ€è¦è®°å½•ä¸‹æ¥ æ•°æ®å¤‡ä»½ï¼šè®¢å•æ•°æ®åº“éœ€è¦é¿å…å•ç‚¹é—®é¢˜ è®¢å•ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜è®¢å•å·çš„ç”Ÿæˆ è®¢å•serveré€šå¸¸éœ€è¦åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œä½†è®¢å•å·å¿…é¡»æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™å°±è¦æ±‚æœ‰ç‰¹å®šçš„ç®—æ³•ç”¨äºŽå¤„ç†è®¢å•å·çš„ç”Ÿæˆè§„åˆ™ï¼Œä¸€èˆ¬å¯ä»¥è€ƒè™‘æ—¶é—´æˆ³ã€éšæœºæ•°ã€æœºå™¨IDç­‰å› ç´ çš„ç»„åˆ è¯»å†™åˆ†ç¦» æ™®é€šçš„è®¢å•ç³»ç»Ÿä¸€èˆ¬æ˜¯è¯»å¤šå†™å°‘ï¼Œå¯¹äºŽå¸¸è§çš„æ•°æ®åº“ä¸€ä¸»å¤šå¤‡éƒ¨ç½²æ–¹å¼ï¼Œå†™è¯·æ±‚ç”±ä¸»åº“å¤„ç†ï¼Œè¯»è¯·æ±‚åˆ™åˆ†æ•£åˆ°å„ä¸ªä»Žåº“å¤„ç† ç¼“å­˜ ä¸ºå‡è½»æ•°æ®åº“çš„åŽ‹åŠ›ï¼Œå¯è€ƒè™‘å¼•å…¥ç¼“å­˜ï¼Œä½†ç¼“å­˜ä¼šå¢žåŠ ç³»ç»Ÿå¤æ‚åº¦ï¼Œé‡ç‚¹éœ€è¦è€ƒè™‘ç¼“å­˜çš„æ›´æ–°é—®é¢˜ æ•°æ®å¤§ç»“ç‚¹ å¯¹äºŽto Bçš„è®¢å•serverï¼Œå¯èƒ½10%çš„ç”¨æˆ·è¦†ç›–äº†90%çš„è®¢å•ï¼Œè¿™ç§æƒ…å†µä¸‹è®¢å•è¡¨åˆ†å¸ƒæ˜¯æžä¸å‡åŒ€çš„ï¼Œå³ä½¿å‘½ä¸­ç´¢å¼•ï¼Œæ•°æ®åº“å¤„ç†é€Ÿåº¦ä»ç„¶ä¸æ»¡è¶³è¦æ±‚ï¼Œè¿™ç§æƒ…å†µä¸‹éœ€è¦æ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œå¼•å…¥ç¼“å­˜æˆ–ç‰¹æ®Šé€»è¾‘å¤„ç†è¿™äº›å¤§ç»“ç‚¹ åˆ†å¸ƒå¼äº‹åŠ¡ è®¢å•serverä¸Žæ•°æ®åº“ä¸€èˆ¬æ˜¯ç‹¬ç«‹éƒ¨ç½²çš„ï¼Œä¸åŒserverä¹‹é—´é€šè¿‡ç½‘ç»œè°ƒç”¨è¿›è¡Œé€šä¿¡ï¼Œå¿…ç„¶ä¼šå‡ºçŽ°å„ç±»å¼‚å¸¸æƒ…å†µï¼Œæ­¤æ—¶å¯å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè§£å†³å„ä¸ªserverä¹‹é—´çŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä½†åˆ†å¸ƒå¼äº‹åŠ¡ä¼šå¢žåŠ ç³»ç»Ÿå¤æ‚åº¦ï¼ŒåŒæ—¶å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œéœ€è¦æ ¹æ®å®žé™…åœºæ™¯åšå¥½è¯„ä¼° å…¶ä»–éœ€è¦è€ƒè™‘çš„ç‚¹ æŽ¥å£å¯é‡å…¥ï¼šè®¢å•serverå¯¹å¤–æä¾›çš„æŽ¥å£å¿…é¡»æ˜¯å¯é‡å…¥çš„ï¼Œç½‘ç»œè¶…æ—¶é‡è¯•æ˜¯å¿…ç„¶ä¼šå‡ºçŽ°çš„]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[rediså˜é•¿å­—ç¬¦ä¸²(simple dynamic strings)å­¦ä¹ ç¬”è®°]]></title>
      <url>%2F2016%2F10%2F31%2Fredis-data-structure-sds%2F</url>
      <content type="text"><![CDATA[ä¸»è¦æ–‡ä»¶ sds.h sds.c ç»“æž„1234567struct sdshdr &#123; int len; // bufå·²å ç”¨é•¿åº¦ int free; // bufå¯ä½¿ç”¨é•¿åº¦ char buf[]; // å®žé™…æ•°æ®&#125;;typedef char *sds; çŸ¥è¯†ç‚¹flexible array member sdsç»“æž„ä¸€èˆ¬æŒ‡å‘sdshdr-&gt;bufï¼Œå¯ä»¥é€šè¿‡sdså½“å‰åœ°å€è®¡ç®—å¾—åˆ°sdshdråœ°å€12const sds s;struct sdshdr *hdr = (void*)(s - (sizeof(struct sdssdr))); æŽ¥å£è¯´æ˜ŽèŽ·å–bufçš„å·²å ç”¨é•¿åº¦å®šä¹‰1static inline size_t sdslen(const sds s); æµç¨‹ æ ¹æ®sdså½“å‰åœ°å€èŽ·å–sdshdråœ°å€ï¼ŒèŽ·å–lenå…ƒç´ çš„å€¼ èŽ·å–bufçš„å¯ä½¿ç”¨é•¿åº¦å®šä¹‰1static inline size_t sdsavail(const sds s); æµç¨‹ æ ¹æ®sdså½“å‰åœ°å€èŽ·å–sdshdråœ°å€ï¼ŒèŽ·å–freeå…ƒç´ çš„å€¼ åˆ›å»ºä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„sdsï¼Œæ”¯æŒåˆå§‹åŒ–å®šä¹‰1sds sdsnewlen(const void *init, size_t initlen); æµç¨‹ æ ¹æ®ä¼ å…¥çš„é•¿åº¦åˆ›å»ºä¸€ä¸ªå˜é•¿å­—ç¬¦ä¸²ï¼Œæ€»å ç”¨ç©ºé—´ä¸ºsizeof(struct sdshdr)+initlen+1ï¼Œå†æ ¹æ®éœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼Œlenè®¾ç½®ä¸ºinitlenï¼Œfreeè®¾ç½®ä¸º0 åˆ›å»ºä¸€ä¸ªåŒ…å«ç©ºä¸²çš„sdså®šä¹‰1sds sdsempty(void); æµç¨‹ è°ƒç”¨sdsnewlen(â€œâ€, 0) æ ¹æ®æŒ‡å®šåˆå§‹åŒ–å€¼åˆ›å»ºsdså®šä¹‰1sds sdsnew(const char *init); æµç¨‹ è°ƒç”¨sdsnewlen(init, initlen)ï¼Œå…¶ä¸­initlenä¸ºæŒ‡å®šåˆå§‹åŒ–å€¼çš„é•¿åº¦ï¼Œè‹¥åˆå§‹åŒ–å€¼ä¸ºNULLï¼Œåˆ™é•¿åº¦ä¸º0 å¤åˆ¶sdså®šä¹‰1sds sdsdup(const sds s); æµç¨‹ è°ƒç”¨sdsnewlen(s, sdslen(s)) é‡Šæ”¾sdså®šä¹‰1void sdsfree(sds s); æµç¨‹ è‹¥ä¼ å…¥çš„sdsä¸ºNULLï¼Œåˆ™ç›´æŽ¥è¿”å›žã€‚å¦åˆ™å…ˆæ‰¾åˆ°sdshdrçš„èµ·å§‹åœ°å€ï¼Œç„¶åŽé‡Šæ”¾å…¶å¯¹åº”å†…å­˜ æ ¹æ®bufçš„å®žé™…é•¿åº¦æ›´æ–°sdshdrçš„å±žæ€§å®šä¹‰1void sdsupdatelen(sds s); æµç¨‹ æ ¹æ®sdsè®¡ç®—å¾—åˆ°sdshdrçš„èµ·å§‹åœ°å€ï¼Œè®¡ç®—bufçš„å®žé™…é•¿åº¦ï¼Œlenä¸Žfreeçš„å€¼å¯¹åº”è°ƒæ•´ æ¸…é™¤sdsçš„å†…å®¹ï¼Œä½¿å…¶åªåŒ…å«\0å®šä¹‰1void sdsclear(sds s); æµç¨‹ æ ¹æ®sdsè®¡ç®—å¾—åˆ°sdshdrçš„èµ·å§‹åœ°å€ï¼Œlenè®¾ç½®ä¸º0ï¼Œfreeå¯¹åº”å¢žåŠ lençš„åŽŸé•¿åº¦ å¯¹sdsçš„bufè¿›è¡Œæ‰©å±•å®šä¹‰1sds sdsMakeRoomFor(sds s, size_t addlen); æµç¨‹ è‹¥å½“å‰freeé•¿åº¦è¶…è¿‡æ‰©å±•é•¿åº¦ï¼Œåˆ™æ— éœ€æ“ä½œï¼Œå¦åˆ™æ ¹æ®æ–°é•¿åº¦ä¸ŽSDS_MAX_PREALLOCçš„å…³ç³»å†³å®šæ‰©å±•åŽçš„é•¿åº¦ï¼Œæœ€åŽæ›´æ–°sdsçš„freeå…ƒç´  é‡Šæ”¾sdså¤šä½™çš„å†…å­˜å®šä¹‰1sds sdsRemoveFreeSpace(sds s); æµç¨‹ æ ¹æ®sdsè®¡ç®—å¾—åˆ°sdshdrçš„èµ·å§‹åœ°å€ï¼Œè®¡ç®—å‡ºå®žé™…æ‰€éœ€å†…å­˜å¤§å°ï¼Œé‡Šæ”¾å…¶ä½™çš„å†…å­˜ï¼Œå¹¶å°†freeå…ƒç´ ç½®0 è®¡ç®—sdså ç”¨çš„æ€»å†…å­˜å¤§å°å®šä¹‰1size_t sdsAllocSize(sds s); æµç¨‹ æ ¹æ®sdsè®¡ç®—å¾—åˆ°sdshdrçš„èµ·å§‹åœ°å€ï¼Œæ€»é•¿åº¦=bufæŒ‡é’ˆå¤§å°+å·²å ç”¨é•¿åº¦+å¯ä½¿ç”¨é•¿åº¦+1 sds bufçš„å³ç«¯å¢žåŠ /å‡å°‘æŒ‡å®šé•¿åº¦å®šä¹‰1void sdsIncrLen(sds s, int incr); æµç¨‹ è‹¥æŒ‡å®šé•¿åº¦ä¸ºæ­£ï¼Œåˆ™freeå¯ç”¨é•¿åº¦å¿…é¡»ä¸å°äºŽè¯¥å€¼ã€‚å˜æ›´bufå†…å®¹ï¼Œå°†æ–°é•¿åº¦çš„ç»“å°¾è®¾ç½®ä¸º\0ï¼ŒåŒæ—¶æ›´æ–°lenä¸Žfreeå…ƒç´  å°†sds bufæ‰©å±•è‡³æŒ‡å®šé•¿åº¦ï¼Œæ‰©å±•éƒ¨åˆ†è®¾ç½®ä¸º\0å®šä¹‰1sds sdsgrowzero(sds s, size_t len); æµç¨‹ è‹¥å½“å‰å·²å ç”¨é•¿åº¦ä¸å°äºŽä¼ å…¥çš„æŒ‡å®šé•¿åº¦ï¼Œåˆ™æ— éœ€æ“ä½œï¼Œå¦åˆ™è°ƒç”¨sdsMakeRoomForæ‰©å±•é•¿åº¦ï¼Œå¹¶å°†æ‰©å±•çš„éƒ¨åˆ†ç½®ä¸º\0ï¼ŒåŒæ—¶æ›´æ–°lenä¸Žfreeå…ƒç´  æ‰©å±•sdsé•¿åº¦å¹¶æ‹¼æŽ¥å­—ç¬¦ä¸²å®šä¹‰1sds sdscatlen(sds s, const void *t, size_t len); æµç¨‹ è°ƒç”¨sdsMakeRoomForæ‰©å±•lené•¿åº¦ï¼Œå°†tæ‹¼æŽ¥è‡³ç»“å°¾ï¼ŒåŒæ—¶æ›´æ–°lenä¸Žfreeå…ƒç´  åœ¨sdsæœ«å°¾æ‹¼æŽ¥å­—ç¬¦ä¸²å®šä¹‰1sds sdscat(sds s, const char *t); æµç¨‹ è°ƒç”¨return sdscatlen(s, t, strlen(t)) åœ¨sdsæœ«å°¾æ‹¼æŽ¥å¦ä¸€ä¸ªsdså®šä¹‰1sds sdscatsds(sds s, const sds t); æµç¨‹ è°ƒç”¨sdscatlen(s, t, sdslen(t)) æ‹·è´å­—ç¬¦ä¸²è‡³sdsï¼ŒæŒ‡å®šå¯¹åº”é•¿åº¦å®šä¹‰1sds sdscpylen(sds s, const char *t, size_t len); æµç¨‹ è‹¥sdsé•¿åº¦ä¸å¤Ÿï¼Œåˆ™è°ƒç”¨sdsMakeRoomForæ‰©å±•å®ƒçš„é•¿åº¦ã€‚å¤åˆ¶å­—ç¬¦ä¸²è‡³bufä¹‹åŽï¼Œå¯¹åº”æ›´æ–°lenä¸Žfreeå…ƒç´  æ‹·è´å­—ç¬¦ä¸²è‡³sdså®šä¹‰1sds sdscpy(sds s, const char *t); æµç¨‹ è°ƒç”¨sdscpylen(s, t, strlen(t)) ä»Žsdsä¸¤ç«¯åˆ é™¤ç‰¹å®šå­—ç¬¦å®šä¹‰1sds sdstrim(sds s, const char *cset); æµç¨‹ ä»Žå¤´éƒ¨å’Œå°¾éƒ¨åˆ†åˆ«éåŽ†sds bufï¼ŒèŽ·å–ä¸æ»¡è¶³æ¡ä»¶çš„æ–°å¤´éƒ¨å’Œå°¾éƒ¨çš„ä½ç½®ï¼Œå°†æ–°å¤´éƒ¨å’Œå°¾éƒ¨çš„å­—ç¬¦å¤åˆ¶åˆ°bufä¸­ï¼Œå¹¶æ›´æ–°lenå’Œfreeå…ƒç´  æŒ‡å®šå¤´éƒ¨å’Œå°¾éƒ¨çš„ä½ç½®æˆªå–sdså®šä¹‰1sds sdsrange(sds s, int start, int end); æµç¨‹ æ ¹æ®æŒ‡å®šçš„å¤´éƒ¨å’Œå°¾éƒ¨çš„ä½ç½®ï¼Œç»è¿‡éƒ¨åˆ†è¾¹ç•Œè®¡ç®—ï¼Œæˆªå–å¾—åˆ°æ–°çš„sds å°†sdsçš„å­—æ¯è½¬æ¢ä¸ºå°å†™å½¢å¼å®šä¹‰1void sdstolower(sds s); æµç¨‹ éåŽ†sds bufï¼ŒæŠŠå­—æ¯é€ä¸ªè½¬æ¢ä¸ºå°å†™å½¢å¼ å°†sdsçš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™å½¢å¼å®šä¹‰1void sdstoupper(sds s); æµç¨‹ éåŽ†sds bufï¼ŒæŠŠå­—æ¯é€ä¸ªè½¬æ¢ä¸ºå¤§å†™å½¢å¼ æ¯”è¾ƒä¸¤ä¸ªsdsçš„å¤§å°å®šä¹‰1int sdscmp(const sds s1, const sds s2); æµç¨‹ èŽ·å–ä¸¤ä¸ªsdså¯¹åº”çš„sdshdrï¼Œä»Žè€Œå¾—åˆ°å„è‡ªçš„é•¿åº¦ï¼Œä½¿ç”¨memcmpé€ä¸ªå­—èŠ‚æ¯”è¾ƒ å°†å­—ç¬¦ä¸²åˆ†å‰²æˆå¤šä¸ªsdså®šä¹‰1sds *sdssplitlen(const char *s, int len, const char *sep, int seplen, int *count); æµç¨‹ ä»Žå¤´è‡³å°¾æ‰«æsds bufï¼Œæ ¹æ®åˆ†å‰²ä¸²ï¼Œç”Ÿæˆå¤šä¸ªå¯¹åº”çš„sds é‡Šæ”¾åˆ†éš”å¾—åˆ°çš„sdså®šä¹‰1void sdsfreesplitres(sds *tokens, int count); æµç¨‹ å¯¹tokensæŒ‡å‘çš„sdsé€ä¸ªè°ƒç”¨sdsfreeé‡Šæ”¾ç©ºé—´ å°†long longåž‹æ•´æ•°è½¬æ¢ä¸ºå¯¹åº”çš„sdså®šä¹‰1sds sdsfromlonglong(long long value); æµç¨‹ ä½¿ç”¨é•¿åº¦ä¸º32çš„å­—ç¬¦ä¸²ï¼Œä»Žvalueä½Žä½è‡³é«˜ä½é€ä¸ªèŽ·å–å¯¹åº”çš„10è¿›åˆ¶æ•°å­—ï¼Œè½¬æ¢æˆå¯¹åº”å­—ç¬¦å­˜å…¥å…¶ä¸­ï¼Œè‹¥valueä¸ºè´Ÿï¼Œåˆ™å¯¹åº”å¢žåŠ è´Ÿå·ï¼Œæœ€åŽè°ƒç”¨sdsnewlenæ ¹æ®è¯¥å­—ç¬¦ä¸²æœ‰æ•ˆä½ç”Ÿæˆsds åœ¨sdsåŽé¢æ‹¼æŽ¥reprè½¬æ¢ä¹‹åŽçš„å­—ç¬¦ä¸²å®šä¹‰1sds sdscatrepr(sds s, const char *p, size_t len); æµç¨‹ åœ¨sdsä¹‹åŽæ‹¼æŽ¥ä¸€ä¸ªåŒå¼•å·ï¼Œä¹‹åŽæŒ‰æŒ‡å®šé•¿åº¦å’Œå­—ç¬¦ä¸²è¿›è¡Œreprè½¬æ¢å’Œæ‹¼æŽ¥ï¼Œæœ€åŽå†æ‹¼æŽ¥ä¸€ä¸ªåŒå¼•å· åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸º16è¿›åˆ¶ç›¸å…³å­—ç¬¦å®šä¹‰1int is_hex_digit(char c); æµç¨‹ åˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸º0~9æˆ–a~fæˆ–A~F å°†16è¿›åˆ¶ç›¸å…³å­—ç¬¦è½¬æ¢ä¸ºå¯¹åº”æ•´æ•°å€¼å®šä¹‰1int hex_digit_to_int(char c); æµç¨‹ å°†0~9å­—ç¬¦åˆ†åˆ«è½¬ä¸ºæ•°å­—0~9ï¼Œå°†a~fæˆ–A~Få¯¹åº”è½¬ä¸ºæ•°å­—10~15 å°†å‘½ä»¤è¡Œå‚æ•°è½¬æ¢æˆå¤šä¸ªsdså®šä¹‰1sds *sdssplitargs(const char *line, int *argc); æµç¨‹ é€ä¸ªéåŽ†lineæŒ‡å‘çš„å‘½ä»¤è¡Œå‚æ•°å­—ç¬¦ä¸²ï¼Œæ ¹æ®å­—ç¬¦ä¸²åˆ†éš”ç¬¦ï¼ŒåŒæ—¶è€ƒè™‘ç‰¹æ®Šå­—ç¬¦ä¸Ž16è¿›åˆ¶ç­‰æƒ…å½¢ï¼Œå¾—åˆ°å¤šä¸ªsds é‡Šæ”¾å‘½ä»¤è¡Œå‚æ•°è½¬æ¢ä¹‹åŽå¾—åˆ°çš„sdså¯¹åº”çš„ç©ºé—´å®šä¹‰1void sdssplitargs_free(sds *argv, int argc); æµç¨‹ éåŽ†ä¼ å…¥çš„sdsï¼Œé€ä¸ªè°ƒç”¨sdsfreeé‡Šæ”¾ç©ºé—´ å°†sdsçš„å­—ç¬¦æ ¹æ®è§„åˆ™æ›¿æ¢ä¸ºåˆ«çš„å­—ç¬¦å®šä¹‰1sds sdsmapchars(sds s, const char *from, const char *to, size_t setlen); æµç¨‹ éåŽ†sds bufçš„æ¯ä¸ªå­—ç¬¦ï¼Œè‹¥è¯¥å­—ç¬¦åœ¨é›†åˆfromä¸­ï¼Œåˆ™å¯¹åº”è½¬æ¢ä¸ºé›†åˆtoä¸­çš„å­—ç¬¦ å°†sdsä¸Žå‚æ•°åˆ—è¡¨æŒ‰æŒ‡å®šæ ¼å¼ç”Ÿæˆçš„å­—ç¬¦ä¸²æ‹¼æŽ¥å®šä¹‰1sds sdscatvprintf(sds s, const char *fmt, va_list ap); æµç¨‹ ä»¥16ä¸ºèµ·å§‹é•¿åº¦ï¼Œæ ¹æ®å®žé™…å®¹çº³å‚æ•°åˆ—è¡¨ç”Ÿæˆçš„å­—ç¬¦ä¸²æ‰€éœ€è¦çš„é•¿åº¦ä¸æ–­ç¿»å€ï¼Œæœ€åŽå°†è°ƒç”¨sdscatè¿›è¡Œæ‹¼æŽ¥ å°†sdsä¸Žå˜é•¿å‚æ•°æŒ‰æŒ‡å®šæ ¼å¼ç”Ÿæˆçš„å­—ç¬¦ä¸²æ‹¼æŽ¥å®šä¹‰1sds sdscatprintf(sds s, const char *fmt, ...); æµç¨‹ å°†å˜é•¿å‚æ•°è½¬æ¢ä¸ºva_listæ ¼å¼ï¼Œè°ƒç”¨sdscatvprintfè¿›è¡Œæ‹¼æŽ¥]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[PHPè½»é‡æ¡†æž¶åˆ†äº«]]></title>
      <url>%2F2016%2F10%2F11%2Fphp-lightweight-framework%2F</url>
      <content type="text"><![CDATA[èƒŒæ™¯è¯´æ˜Ž è¿‘æœŸéœ€è¦å°†ä¹‹å‰åŠŸèƒ½è¾ƒå¤æ‚çš„åŽå°æœåŠ¡æ¨¡å—æ‹†æˆå°æ¨¡å—ï¼Œè¯¥æ¨¡å—é‡‡ç”¨äº†å‰äººå¼€å‘çš„åŸºäºŽMVCçš„phpè‡ªç ”æ¡†æž¶ï¼Œæ¡†æž¶æœ¬èº«é›†æˆäº†è¾ƒå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬æŽ¥å£å‚æ•°ç»Ÿä¸€æ ¡éªŒã€å¼‚æž„æ•°æ®åº“æŽ¥å£æŠ½è±¡å°è£…ç­‰ ç”±äºŽåŽ†å²æ‚ ä¹…ä¸”ç¼ºä¹æ–‡æ¡£è¯´æ˜Žï¼Œéšç€éœ€æ±‚ä¸Žç‰ˆæœ¬è¿­ä»£ï¼Œä»£ç ç»“æž„å˜å¾—æ¯”è¾ƒæ··ä¹±ï¼Œç»´æŠ¤æˆæœ¬éšä¹‹å¢žåŠ  ç”±äºŽæ¡†æž¶æœ¬èº«çš„è®¾è®¡é™åˆ¶ï¼Œæ— æ³•æ”¯æŒæ–°ç‰ˆæœ¬PHPï¼ˆå¦‚5.6ï¼‰çš„éƒ¨åˆ†ç‰¹æ€§ï¼Œå¼•å…¥ä¸€äº›æ–°çš„æ¦‚å¿µä¸ŽæŠ€æœ¯å˜å¾—å›°éš¾ æ–°æ¨¡å—åŠŸèƒ½ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦é›†æˆè¾ƒå¤šç‰¹æ€§ æ¡†æž¶ä»‹ç»ä¸»è¦ç‰¹æ€§ åè®®å¯å®šåˆ¶ï¼ˆæŽ¨èjsonï¼‰ å¼•å…¥ORMï¼Œä¸éœ€è¦è‡ªå·±å°è£…DBåŸºç¡€æ“ä½œ é…ç½®æ–‡ä»¶ä½¿ç”¨YAMLæ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒé«˜ é€‚åˆæ­å»ºåŽå°ç®€å•æœåŠ¡ æ–¹ä¾¿ä¸Žå¸¸è§web serveré›†æˆï¼ˆæŽ¨ènginxï¼‰ æ¡†æž¶ç»“æž„1234567891011121314151617181920212223242526272829303132333435363738common # å…¬å…±ç›®å½• |- Constants.php # å¸¸é‡ |- Errors.php # é”™è¯¯ç ä¸Žé”™è¯¯ä¿¡æ¯ |- ...configs # é…ç½®ç›®å½• |- db.yaml # æ•°æ®åº“é…ç½® |- log.yaml # æ—¥å¿—é…ç½® |- ...models # æ¨¡åž‹ç›®å½• |- ...services # æœåŠ¡ç›®å½• |- ...controllers # æŽ§åˆ¶å™¨ç›®å½• |- ...libraries # åº“ç›®å½• |- Configuration.php # é…ç½®è§£æžç±» |- HttpRequest.php # HTTPå¤„ç†ç±» |- DbConnection.php # DBå¤„ç†ç±» |- Log.php # æ—¥å¿—å¤„ç†ç±» |- ...logs # æ—¥å¿—ç›®å½• |- ...scripts # ç¦»çº¿è„šæœ¬ç›®å½• |- ...tests # æµ‹è¯•ç›®å½• |- controllers # æŽ§åˆ¶å™¨æµ‹è¯•ç›®å½• |- ... |- services # æœåŠ¡æµ‹è¯•ç›®å½• |- ... |- models # æ¨¡åž‹æµ‹è¯•ç›®å½• |- ... |- ...vendor # åŒ…ç®¡ç†ç›®å½• |- ...composer.lock # composeré”æ–‡ä»¶composer.json # composeré…ç½®æ–‡ä»¶phpunit.xml # PHPå•å…ƒæµ‹è¯•é…ç½®æ–‡ä»¶index.php # è¯·æ±‚å…¥å£ç±» ç›®å½•ä¸Žæ–‡ä»¶è¯´æ˜Ž index.php: è¯·æ±‚å…¥å£æ–‡ä»¶ï¼Œè´Ÿè´£è§£æžè¯·æ±‚åŒ…ï¼Œé€‰æ‹©åˆé€‚æŽ¥å£å¤„ç†è¯·æ±‚ï¼Œç»„è£…è¿”å›žåŒ… common: å­˜æ”¾é¡¹ç›®å…¬å…±æ–‡ä»¶ï¼Œå¦‚å¸¸é‡ã€é”™è¯¯ç ä¸Žé”™è¯¯ä¿¡æ¯ç­‰ configs: å­˜æ”¾é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå¦‚æ•°æ®åº“é…ç½®ã€æ—¥å¿—é…ç½®ã€ä¸šåŠ¡é…ç½®ç­‰ models: æ¯ä¸ªæ•°æ®è¡¨å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å°è£…äº†å¯¹åº”æ•°æ®è¡¨çš„ORMæ“ä½œï¼ˆä¾èµ–illuminate/databaseåŒ…ï¼‰ services: æ¯ä¸€ç±»æœåŠ¡å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å°è£…äº†é’ˆå¯¹ä¸€ä¸ªæˆ–å¤šä¸ªORMçš„æ“ä½œï¼Œéœ€è¦åœ¨è¿™ä¸€å±‚å¤„ç†äº‹åŠ¡ controllers: å­˜æ”¾æŽ¥å£æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªå¤–éƒ¨è°ƒç”¨æŽ¥å£ï¼Œéœ€è¦åœ¨è¿™ä¸€å±‚åšå¥½æŽ¥å£å‚æ•°æ ¡éªŒ libraries: å­˜æ”¾é¡¹ç›®åº“æ–‡ä»¶ï¼Œå¦‚æ—¥å¿—æ“ä½œã€æ•°æ®åº“æ“ä½œã€é…ç½®è§£æžç­‰ scriptes: å­˜æ”¾æ‰€æœ‰ç¦»çº¿è„šæœ¬ tests: å­˜æ”¾æ‰€æœ‰æµ‹è¯•ç±» phpunit.xml: å•å…ƒæµ‹è¯•é…ç½®æ–‡ä»¶ï¼Œç”¨äºŽæ‰§è¡Œtestsç›®å½•ä¸‹çš„æµ‹è¯•ç±» logs: å­˜æ”¾æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ vendor: å­˜æ”¾æ‰€æœ‰é¡¹ç›®ä¾èµ–çš„åŒ… composer.json: åŒ…ç®¡ç†é…ç½®æ–‡ä»¶ composer.lock: åŒ…ç®¡ç†æ“ä½œé” ç¤ºä¾‹é¡¹ç›® å•†å“åº“å­˜ç®¡ç†æ¨¡å—]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è®¾è®¡åˆ†äº«]]></title>
      <url>%2F2016%2F10%2F09%2Fasync-task-manage-module%2F</url>
      <content type="text"><![CDATA[æž„å»ºæ¨¡å—çš„èƒŒæ™¯ä¸šåŠ¡å‘å±• ä¸šåŠ¡åˆšæŽ¨å‡ºçš„æ—¶å€™ï¼Œäº§å“è€ƒè™‘çš„æ˜¯å¦‚ä½•è®©ç”¨æˆ·ä½¿ç”¨æˆ‘ä»¬çš„èµ„æºï¼Œå› æ­¤åªè¦æä¾›é’ˆå¯¹èµ„æºçš„åŸºæœ¬æ“ä½œï¼ˆè´­ä¹°ã€ç»­è´¹ã€å‡çº§ç­‰ï¼‰å³å¯ éšç€äº’è”ç½‘çš„å‘å±•ä¸Žä¸šåŠ¡å‘å±•ï¼Œç”¨æˆ·å¯¹äºŽèµ„æºçš„éœ€æ±‚é‡å¢žåŠ ï¼Œå› æ­¤å‡ºçŽ°äº†åŒæ—¶è´­ä¹°å¤§æ‰¹é‡çš„èµ„æºï¼ŒåŒæ—¶æ“ä½œå¤§æ‰¹é‡èµ„æºçš„æƒ…å†µï¼Œç”±äºŽå“åº”æ—¶é—´è¾ƒé•¿ï¼Œç”¨æˆ·ä½“éªŒéžå¸¸ä¸å¥½ ä¸šåŠ¡æžæ´»åŠ¨çš„æ—¶å€™ï¼Œå¯èƒ½å‡ºçŽ°è¾ƒå¤šå®¢æˆ·åŒæ—¶è´­ä¹°èµ„æºçš„æƒ…å†µï¼Œå¯¹æ­£å¸¸æœåŠ¡é€ æˆå½±å“ï¼Œç”¨æˆ·ä½“éªŒåŒæ ·è¾ƒå·® åŽå°æœåŠ¡æ¼”è¿› å¤§éƒ¨åˆ†åŽå°æœåŠ¡æä¾›çš„æŽ¥å£åœ¨è®¾è®¡ä¹‹åˆï¼Œä¸»è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•å®Œæˆä¸šåŠ¡åŠŸèƒ½ï¼Œå¯¹äºŽæŽ¥å£æ€§èƒ½ä¸Žæ“ä½œé€»è¾‘ä¼˜åŒ–è€ƒè™‘çš„ç›¸å¯¹æ¯”è¾ƒå°‘ ä¸šåŠ¡é€»è¾‘å˜æ›´æˆ–å‘å±•ï¼Œå¯¼è‡´æŽ¥å£é€»è¾‘æ„ˆå‘å¤æ‚ï¼Œæ¨¡å—é—´çš„ç½‘ç»œè°ƒç”¨æ¬¡æ•°å¢žåŠ ï¼ŒåŒæ—¶åŽå°å­˜å‚¨çš„æ•°æ®é‡ä¹Ÿé€æ¸å¢žåŠ ï¼ŒæŽ¥å£è€—æ—¶éšä¹‹å¢žåŠ  å…ˆé’ˆå¯¹å•ä¸ªèµ„æºçš„æ“ä½œæŽ¥å£é€æ¸æ´ç”Ÿå‡ºæ‰¹é‡æ“ä½œæŽ¥å£ï¼Œä»¥åº”å¯¹ç”¨æˆ·çš„æ‰¹é‡æ“ä½œè¯·æ±‚ å¤§å¤šæ•°æ‰¹é‡æŽ¥å£å®žé™…æ˜¯ä¼ªæ‰¹é‡ï¼ŒåŽå°å®žé™…é€»è¾‘åŸºæœ¬æ˜¯ä¸²è¡Œçš„ å¸¸è§„çš„æŽ¥å£æ€§èƒ½ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ•°æ®ç¼“å­˜ã€é€»è¾‘ä¼˜åŒ–ã€ç½‘ç»œè°ƒç”¨é‡‡ç”¨å¹¶å‘å¤„ç†ç­‰ï¼Œè™½ç„¶èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘æŽ¥å£è€—æ—¶ï¼Œä½†éƒ¨åˆ†ä¼˜åŒ–ä½¿å¾—æŽ¥å£é€»è¾‘åè€Œå˜å¤æ‚äº†ï¼ŒåŒæ—¶éƒ¨åˆ†æŽ¥å£è€—æ—¶ä¾ç„¶è¾¾ä¸åˆ°è¦æ±‚ï¼Œéšç€æ‰¹é‡å¤„ç†çš„æ•°é‡çš„å¢žåŠ ï¼ŒæŽ¥å£æ€§èƒ½ä¼˜åŒ–å¸¦æ¥çš„æ”¶ç›Šæ„ˆå‘ä¸æ˜Žæ˜¾ ä¸šåŠ¡æžæ´»åŠ¨æ—¶ï¼ŒæŽ¥å£è¯·æ±‚é‡æš´æ¶¨ï¼Œéƒ¨åˆ†è€—æ—¶æŽ¥å£çš„æ€§èƒ½é—®é¢˜ä¼šè¢«æ”¾å¤§ï¼Œä¸¥é‡æ—¶å¯èƒ½ä¼šè€—å°½æœåŠ¡å™¨èµ„æºï¼Œå½±å“æ­£å¸¸ä¸šåŠ¡æµç¨‹ è¯·æ±‚å¼‚æ­¥åŒ–çš„æ€è·¯ä»€ä¹ˆæ˜¯è¯·æ±‚å¼‚æ­¥åŒ– åŽå°æœåŠ¡æ”¶åˆ°è¯·æ±‚ä¹‹åŽï¼Œä¸ç«‹å³å¤„ç†è¯·æ±‚ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚è®°å½•ä¸‹æ¥ åŽå°æœåŠ¡è·Ÿè°ƒç”¨æ–¹çº¦å®šèŽ·å–è¯·æ±‚æ‰§è¡Œç»“æžœçš„æ–¹å¼ åŽå°æœåŠ¡å¼‚æ­¥æ‰§è¡Œå¯¹åº”çš„è¯·æ±‚ï¼Œå¹¶è®°å½•æ‰§è¡Œç»“æžœ è°ƒç”¨æ–¹é€šè¿‡è½®è¯¢æˆ–å…¶ä»–æ–¹å¼èŽ·å–æ‰§è¡Œç»“æžœ ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥åŒ– ç½‘ç»œè°ƒç”¨éœ€è¦åšè¶…æ—¶å¤„ç†ï¼Œè°ƒç”¨æ–¹ä¸å¯èƒ½æ— é™æœŸç­‰å¾…åŽå°æœåŠ¡çš„å“åº”ï¼ŒåŒæ—¶ç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œå¼‚æ­¥å¯ä»¥ä½¿è°ƒç”¨æ–¹å³æ—¶èŽ·å¾—å“åº”ï¼Œå¯¹æ­¤åšå‡ºç›¸åº”çš„ç”¨æˆ·æç¤ºä¸Žäº¤äº’ å¼‚æ­¥æ‰§è¡Œè¯·æ±‚çš„é¢‘çŽ‡å¯ä»¥è°ƒæ•´ï¼Œå¯¹äºŽæ´»åŠ¨æ—¶æŽ¥å£è¯·æ±‚é‡æš´æ¶¨çš„æƒ…å½¢ï¼Œå¯ä»¥é™ä½Žè¯·æ±‚çš„æ‰§è¡Œé¢‘çŽ‡ï¼Œä¿è¯ä¸»çº¿ä¸šåŠ¡æ­£å¸¸è¿è¡Œ ä¸ºæŽ¥å£æ€§èƒ½ä¼˜åŒ–å¸¦æ¥ä¸€ç§æ–°çš„æ–¹å¼ï¼Œä¸å†éœ€è¦ç‰ºç‰²ä»£ç å¯ç»´æŠ¤æ€§ä¸Žæ‰©å±•æ€§æ¥åšæ€§èƒ½ä¼˜åŒ– è¯·æ±‚å¼‚æ­¥åŒ–ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ è°ƒç”¨æ–¹é€»è¾‘éœ€è¦æ”¹å˜ï¼ŒåŽŸæ¥çš„ç›´æŽ¥è¯·æ±‚å“åº”çš„æ–¹å¼éœ€è¦å˜æ›´ä¸ºè½®è¯¢çš„æ–¹å¼ï¼Œè‹¥è°ƒç”¨æ–¹è¾ƒå¤šï¼Œæ”¹é€ æˆæœ¬ä¼šç›¸å¯¹è¾ƒé«˜ éœ€è¦é¢å¤–çš„é€»è¾‘ä¸Žå­˜å‚¨æ¥å¤„ç†å¯¹åº”çš„å¼‚æ­¥è¯·æ±‚ä¸Žå“åº” å¯èƒ½å¼•å…¥å¤–éƒ¨æ¨¡å—ï¼Œç³»ç»Ÿæž¶æž„å¤æ‚åº¦ä¸Šå‡ å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—çš„å¼•å…¥ä¸ºä»€ä¹ˆéœ€è¦åšç‹¬ç«‹çš„æ¨¡å— åŽå°æœåŠ¡æ¶‰åŠçš„æ¨¡å—æ¯”è¾ƒå¤šï¼Œåœ¨å¾®æœåŠ¡æ¯”è¾ƒç››è¡Œçš„ä»Šå¤©ï¼Œæ¯ä¸€ç±»ç›¸å¯¹ç‹¬ç«‹çš„åŠŸèƒ½éƒ½å¯èƒ½è¢«å°è£…ä¸ºä¸€ä¸ªæœåŠ¡æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å„è‡ªå®žçŽ°è‡ªå·±çš„å¼‚æ­¥ä»»åŠ¡ç®¡ç†é€»è¾‘ï¼Œæ”¹é€ æˆæœ¬è¾ƒé«˜ï¼ŒåŒæ—¶ä¹Ÿä¸å¥½ç»´æŠ¤ ç‹¬ç«‹çš„æ¨¡å—å¯ä»¥æŠ½è±¡å‡ºå¼‚æ­¥ä»»åŠ¡ç›¸å…³çš„APIï¼Œè§„èŒƒä»»åŠ¡çš„å¤„ç†æµç¨‹ï¼Œå¯¹å„ä¸ªè°ƒç”¨æ–¹ä¿æŒç»Ÿä¸€ æ¨¡å—çš„å‡ ç§è®¾è®¡æ€è·¯å­è¿›ç¨‹åŒæ­¥å¤„ç†+è„šæœ¬è§¦å‘ä»»åŠ¡æ£€æŸ¥ ä¸»è¦æµç¨‹ åŽå°æœåŠ¡æ¨¡å—æ¯æ¬¡æ”¶åˆ°è¯·æ±‚ç›´æŽ¥ï¼Œå°±æŠŠè¯·æ±‚å¯¹åº”å¤„ç†ä¹‹åŽï¼Œè°ƒç”¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—åˆ›å»ºä»»åŠ¡çš„æŽ¥å£ å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—æ”¶åˆ°åˆ›å»ºè¯·æ±‚ï¼Œç”Ÿæˆä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼ŒæŠŠè¯·æ±‚ä¿¡æ¯å†™å…¥å­˜å‚¨ï¼ŒåŒæ—¶forkå­è¿›ç¨‹å›žè°ƒåŽå°æœåŠ¡å¤„ç†å¯¹åº”è¯·æ±‚ï¼Œä¸»è¿›ç¨‹åˆ™ç›´æŽ¥è¿”å›žä»»åŠ¡æ ‡è¯†ç»™åŽå°æœåŠ¡æ¨¡å—ï¼ŒåŽå°æœåŠ¡å¯¹åº”å°†ä»»åŠ¡æ ‡è¯†è¿”å›žç»™è°ƒç”¨æ–¹ å­è¿›ç¨‹åŒæ­¥ç­‰å¾…åŽå°æœåŠ¡çš„å¤„ç†ç»“æžœï¼Œå¹¶å°†ç»“æžœè®°å½•åˆ°å­˜å‚¨ä¸­ è°ƒç”¨æ–¹æ ¹æ®ä»»åŠ¡æ ‡è¯†ï¼Œä¸æ–­ä»Žå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è½®è¯¢å¤„ç†ç»“æžœ ç¦»çº¿è„šæœ¬ä¸»è¦ç”¨äºŽè§¦å‘ä»»åŠ¡æ£€æŸ¥ï¼Œé˜²æ­¢éƒ¨åˆ†ä»»åŠ¡ç”±äºŽå­è¿›ç¨‹åˆ›å»ºå¤±è´¥æˆ–è€…å…¶ä»–åŽŸå› æœªå¤„ç† ç‰¹ç‚¹ è¯·æ±‚å¤„ç†åŠæ—¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹å¯ä¿è¯æ¯ä¸ªè¯·æ±‚åˆ›å»ºä¹‹åŽç«‹å³è¢«å¤„ç† æ— æ³•é™æµï¼Œè‹¥åŒæ—¶äº§ç”Ÿçš„ä»»åŠ¡è¾ƒå¤šï¼Œå¯èƒ½å¯¼è‡´å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—æ‰€åœ¨æœºå™¨èµ„æºä¸è¶³ï¼Œæˆ–è€…åŽå°æœåŠ¡åŽ‹åŠ›è¾ƒå¤§ åŽå°æœåŠ¡å¤„ç†æŽ¥å£éœ€è¦æ”¯æŒå¯é‡å…¥ï¼Œé˜²æ­¢å› ä¸ºç½‘ç»œç­‰åŽŸå› å¯¼è‡´çŠ¶æ€ä¸åŒæ­¥ è„šæœ¬å®šæ—¶å¤„ç†ä»»åŠ¡ ä¸»è¦æµç¨‹ åŽå°æœåŠ¡æ¨¡å—æ¯æ¬¡æ”¶åˆ°è¯·æ±‚ç›´æŽ¥ï¼Œå°±æŠŠè¯·æ±‚å¯¹åº”å¤„ç†ä¹‹åŽï¼Œè°ƒç”¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—åˆ›å»ºä»»åŠ¡çš„æŽ¥å£ å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—æ”¶åˆ°åˆ›å»ºè¯·æ±‚ï¼Œç”Ÿæˆä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼ŒæŠŠè¯·æ±‚ä¿¡æ¯å†™å…¥å­˜å‚¨ä¹‹åŽç›´æŽ¥è¿”å›žè¯¥æ ‡è¯†ç»™åŽå°æœåŠ¡æ¨¡å—ï¼ŒåŽå°æœåŠ¡å¯¹åº”è¿”å›žç»™è°ƒç”¨æ–¹ ç¦»çº¿è„šæœ¬è§¦å‘å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è°ƒç”¨åŽå°æœåŠ¡æ¨¡å—åŒæ­¥èŽ·å–å¤„ç†ç»“æžœï¼Œå¹¶æ›´æ–°åˆ°å­˜å‚¨ä¸­ è°ƒç”¨æ–¹æ ¹æ®ä»»åŠ¡æ ‡è¯†ï¼Œä¸æ–­ä»Žå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è½®è¯¢å¤„ç†ç»“æžœ ç‰¹ç‚¹ è¯·æ±‚å¤„ç†æœ‰ä¸€å®šå»¶æ—¶ï¼Œè‹¥ä»»åŠ¡è¾ƒå¤šå¯èƒ½å¯¼è‡´ä»»åŠ¡å †ç§¯ å¯ä»¥éƒ¨ç½²å¤šä¸ªç¦»çº¿è„šæœ¬ï¼Œä½†æ˜¯å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è‡ªèº«è´Ÿè½½ä¼šå¯¹åº”ä¸Šå‡ å¯ä»¥é™æµï¼Œæ¯”å¦‚ç¦»çº¿è„šæœ¬å¤šä¹…æ‰§è¡Œä¸€æ¬¡ï¼Œé™åˆ¶æ¯æ¬¡å¤„ç†å¤šå°‘ä¸ªä»»åŠ¡ç­‰ åŽå°æœåŠ¡å¤„ç†æŽ¥å£éœ€è¦æ”¯æŒå¯é‡å…¥ï¼Œé˜²æ­¢å› ä¸ºç½‘ç»œç­‰åŽŸå› å¯¼è‡´çŠ¶æ€ä¸åŒæ­¥ æ¶ˆæ¯é˜Ÿåˆ—+è„šæœ¬è§¦å‘ä»»åŠ¡æ£€æŸ¥ ä¸»è¦æµç¨‹ åŽå°æœåŠ¡æ¨¡å—æ¯æ¬¡æ”¶åˆ°è¯·æ±‚ç›´æŽ¥ï¼Œå°±æŠŠè¯·æ±‚å¯¹åº”å¤„ç†ä¹‹åŽï¼Œè°ƒç”¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—åˆ›å»ºä»»åŠ¡çš„æŽ¥å£ å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—æ”¶åˆ°åˆ›å»ºè¯·æ±‚ï¼Œç”Ÿæˆä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼ŒæŠŠè¯·æ±‚ä¿¡æ¯å†™å…¥å­˜å‚¨ä¹‹åŽï¼Œæ·»åŠ ä¸€æ¡æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åŽè¿”å›žä»»åŠ¡æ ‡è¯†ç»™åŽå°æœåŠ¡æ¨¡å—ï¼ŒåŽå°æœåŠ¡å¯¹åº”è¿”å›žç»™è°ƒç”¨æ–¹ æ¶ˆæ¯é˜Ÿåˆ—æ ¹æ®é¢„é…ç½®çš„ç­–ç•¥å°†æ¶ˆæ¯æŽ¨é€è‡³åŽå°æœåŠ¡æ¨¡å—ï¼ˆæ­¤å¤„ä»…è€ƒè™‘æŽ¨é€æ¨¡å¼ï¼‰ï¼ŒåŽå°æœåŠ¡æ¨¡å—æ”¶åˆ°æ¶ˆæ¯ä¹‹åŽå¯¹åº”è¿›è¡Œå¤„ç†ï¼Œç„¶åŽå°†å¤„ç†ç»“æžœæ›´æ–°è‡³å¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å— è°ƒç”¨æ–¹æ ¹æ®ä»»åŠ¡æ ‡è¯†ï¼Œä¸æ–­ä»Žå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—è½®è¯¢å¤„ç†ç»“æžœ ç¦»çº¿è„šæœ¬ä¸»è¦ç”¨äºŽè§¦å‘ä»»åŠ¡æ£€æŸ¥ï¼Œé˜²æ­¢éƒ¨åˆ†ä»»åŠ¡æ¶ˆæ¯æ·»åŠ å¤±è´¥æˆ–è€…å…¶ä»–åŽŸå› æœªå¤„ç† ç‰¹ç‚¹ å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŽå°æœåŠ¡éœ€è¦åœ¨æ¶ˆæ¯é˜Ÿåˆ—é…ç½®å¯¹åº”ç­–ç•¥ä¸ŽæŽ¥å£ è¯·æ±‚å¤„ç†æœ‰ä¸€å®šå»¶æ—¶ï¼Œå–å†³äºŽæ¶ˆæ¯é˜Ÿåˆ—æŽ¨é€ç­–ç•¥ ä»»åŠ¡å †ç§¯çš„é—®é¢˜ç†è®ºä¸Šå¯ä»¥é€šè¿‡é…ç½®åˆç†çš„æ¶ˆæ¯é˜Ÿåˆ—æŽ¨é€ç­–ç•¥è§£å†³ é™æµå¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æŽ¨é€ç­–ç•¥å®žçŽ° è‹¥æ¶ˆæ¯é˜Ÿåˆ—ä¸ŽåŽå°æœåŠ¡é€šä¿¡å‡ºçŽ°é—®é¢˜ï¼Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—æ— æ³•åŠæ—¶æ„ŸçŸ¥ï¼Œå¯èƒ½éœ€è¦å¢žåŠ å¯¹è´¦æœºåˆ¶ åŽå°æœåŠ¡å¤„ç†æŽ¥å£éœ€è¦æ”¯æŒå¯é‡å…¥ï¼Œé˜²æ­¢å› ä¸ºç½‘ç»œç­‰åŽŸå› å¯¼è‡´çŠ¶æ€ä¸åŒæ­¥]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[linuxç³»ç»Ÿè°ƒç”¨åˆ—è¡¨]]></title>
      <url>%2F2016%2F09%2F28%2Flinux-system-call%2F</url>
      <content type="text"><![CDATA[è¿›ç¨‹æŽ§åˆ¶ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° fork åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ clone æŒ‰æŒ‡å®šæ¡ä»¶åˆ›å»ºå­è¿›ç¨‹ execve è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ exit ä¸­æ­¢è¿›ç¨‹ _exit ç«‹å³ä¸­æ­¢å½“å‰è¿›ç¨‹ getdtablesize è¿›ç¨‹æ‰€èƒ½æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•° getpgid èŽ·å–æŒ‡å®šè¿›ç¨‹ç»„æ ‡è¯†å· setpgid è®¾ç½®æŒ‡å®šè¿›ç¨‹ç»„æ ‡å¿—å· getpgrp èŽ·å–å½“å‰è¿›ç¨‹ç»„æ ‡è¯†å· setpgrp è®¾ç½®å½“å‰è¿›ç¨‹ç»„æ ‡å¿—å· getpid èŽ·å–è¿›ç¨‹æ ‡è¯†å· getppid èŽ·å–çˆ¶è¿›ç¨‹æ ‡è¯†å· getpriority èŽ·å–è°ƒåº¦ä¼˜å…ˆçº§ setpriority è®¾ç½®è°ƒåº¦ä¼˜å…ˆçº§ modify_ldt è¯»å†™è¿›ç¨‹çš„æœ¬åœ°æè¿°è¡¨ nanosleep ä½¿è¿›ç¨‹ç¡çœ æŒ‡å®šçš„æ—¶é—´ nice æ”¹å˜åˆ†æ—¶è¿›ç¨‹çš„ä¼˜å…ˆçº§ pause æŒ‚èµ·è¿›ç¨‹ï¼Œç­‰å¾…ä¿¡å· personality è®¾ç½®è¿›ç¨‹è¿è¡ŒåŸŸ prctl å¯¹è¿›ç¨‹è¿›è¡Œç‰¹å®šæ“ä½œ ptrace è¿›ç¨‹è·Ÿè¸ª sched_get_priority_max å–å¾—é™æ€ä¼˜å…ˆçº§çš„ä¸Šé™ sched_get_priority_min å–å¾—é™æ€ä¼˜å…ˆçº§çš„ä¸‹é™ sched_getparam å–å¾—è¿›ç¨‹çš„è°ƒåº¦å‚æ•° sched_getscheduler å–å¾—æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥ sched_rr_get_interval å–å¾—æŒ‰RRç®—æ³•è°ƒåº¦çš„å®žæ—¶è¿›ç¨‹çš„æ—¶é—´ç‰‡é•¿åº¦ sched_setparam è®¾ç½®è¿›ç¨‹çš„è°ƒåº¦å‚æ•° sched_setscheduler è®¾ç½®æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥å’Œå‚æ•° sched_yield è¿›ç¨‹ä¸»åŠ¨è®©å‡ºå¤„ç†å™¨,å¹¶å°†è‡ªå·±ç­‰å€™è°ƒåº¦é˜Ÿåˆ—é˜Ÿå°¾ vfork åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä»¥ä¾›æ‰§è¡Œæ–°ç¨‹åºï¼Œå¸¸ä¸Žexecveç­‰åŒæ—¶ä½¿ç”¨ wait ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ wait3 å‚è§wait waitpid ç­‰å¾…æŒ‡å®šå­è¿›ç¨‹ç»ˆæ­¢ wait4 å‚è§waitpid capget èŽ·å–è¿›ç¨‹æƒé™ capset è®¾ç½®è¿›ç¨‹æƒé™ getsid èŽ·å–ä¼šæ™¤æ ‡è¯†å· setsid è®¾ç½®ä¼šæ™¤æ ‡è¯†å· æ–‡ä»¶ç³»ç»ŸæŽ§åˆ¶æ–‡ä»¶è¯»å†™æ“ä½œ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° fcntl æ–‡ä»¶æŽ§åˆ¶ open æ‰“å¼€æ–‡ä»¶ creat åˆ›å»ºæ–°æ–‡ä»¶ close å…³é—­æ–‡ä»¶æè¿°å­— read è¯»æ–‡ä»¶ write å†™æ–‡ä»¶ readv ä»Žæ–‡ä»¶è¯»å…¥æ•°æ®åˆ°ç¼“å†²æ•°ç»„ä¸­ writev å°†ç¼“å†²æ•°ç»„é‡Œçš„æ•°æ®å†™å…¥æ–‡ä»¶ pread å¯¹æ–‡ä»¶éšæœºè¯» pwrite å¯¹æ–‡ä»¶éšæœºå†™ lseek ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆ _llseek åœ¨64ä½åœ°å€ç©ºé—´é‡Œç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆ dup å¤åˆ¶å·²æ‰“å¼€çš„æ–‡ä»¶æè¿°å­— dup2 æŒ‰æŒ‡å®šæ¡ä»¶å¤åˆ¶æ–‡ä»¶æè¿°å­— flock æ–‡ä»¶åŠ /è§£é” poll I/Oå¤šè·¯è½¬æ¢ truncate æˆªæ–­æ–‡ä»¶ ftruncate å‚è§truncate umask è®¾ç½®æ–‡ä»¶æƒé™æŽ©ç  fsync æŠŠæ–‡ä»¶åœ¨å†…å­˜ä¸­çš„éƒ¨åˆ†å†™å›žç£ç›˜ æ–‡ä»¶ç³»ç»Ÿæ“ä½œ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° access ç¡®å®šæ–‡ä»¶çš„å¯å­˜å–æ€§ chdir æ”¹å˜å½“å‰å·¥ä½œç›®å½• fchdir å‚è§chdir chmod æ”¹å˜æ–‡ä»¶æ–¹å¼ fchmod å‚è§chmod chown æ”¹å˜æ–‡ä»¶çš„å±žä¸»æˆ–ç”¨æˆ·ç»„ fchown å‚è§chown lchown å‚è§chown chroot æ”¹å˜æ ¹ç›®å½• stat å–æ–‡ä»¶çŠ¶æ€ä¿¡æ¯ lstat å‚è§stat fstat å‚è§stat statfs å–æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ fstatfs å‚è§statfs readdir è¯»å–ç›®å½•é¡¹ getdents è¯»å–ç›®å½•é¡¹ mkdir åˆ›å»ºç›®å½• mknod åˆ›å»ºç´¢å¼•èŠ‚ç‚¹ rmdir åˆ é™¤ç›®å½• rename æ–‡ä»¶æ”¹å link åˆ›å»ºé“¾æŽ¥ symlink åˆ›å»ºç¬¦å·é“¾æŽ¥ unlink åˆ é™¤é“¾æŽ¥ readlink è¯»ç¬¦å·é“¾æŽ¥çš„å€¼ mount å®‰è£…æ–‡ä»¶ç³»ç»Ÿ umount å¸ä¸‹æ–‡ä»¶ç³»ç»Ÿ ustat å–æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ utime æ”¹å˜æ–‡ä»¶çš„è®¿é—®ä¿®æ”¹æ—¶é—´ utimes å‚è§utime quotactl æŽ§åˆ¶ç£ç›˜é…é¢ ç³»ç»ŸæŽ§åˆ¶ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° ioctl I/Oæ€»æŽ§åˆ¶å‡½æ•° _sysctl è¯»/å†™ç³»ç»Ÿå‚æ•° acct å¯ç”¨æˆ–ç¦æ­¢è¿›ç¨‹è®°è´¦ getrlimit èŽ·å–ç³»ç»Ÿèµ„æºä¸Šé™ setrlimit è®¾ç½®ç³»ç»Ÿèµ„æºä¸Šé™ getrusage èŽ·å–ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ uselib é€‰æ‹©è¦ä½¿ç”¨çš„äºŒè¿›åˆ¶å‡½æ•°åº“ ioperm è®¾ç½®ç«¯å£I/Oæƒé™ iopl æ”¹å˜è¿›ç¨‹I/Oæƒé™çº§åˆ« outb ä½Žçº§ç«¯å£æ“ä½œ reboot é‡æ–°å¯åŠ¨ swapon æ‰“å¼€äº¤æ¢æ–‡ä»¶å’Œè®¾å¤‡ swapoff å…³é—­äº¤æ¢æ–‡ä»¶å’Œè®¾å¤‡ bdflush æŽ§åˆ¶bdflushå®ˆæŠ¤è¿›ç¨‹ sysfs å–æ ¸å¿ƒæ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿç±»åž‹ sysinfo å–å¾—ç³»ç»Ÿä¿¡æ¯ adjtimex è°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿ alarm è®¾ç½®è¿›ç¨‹çš„é—¹é’Ÿ getitimer èŽ·å–è®¡æ—¶å™¨å€¼ setitimer è®¾ç½®è®¡æ—¶å™¨å€¼ gettimeofday å–æ—¶é—´å’Œæ—¶åŒº settimeofday è®¾ç½®æ—¶é—´å’Œæ—¶åŒº stime è®¾ç½®ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´ time å–å¾—ç³»ç»Ÿæ—¶é—´ times å–è¿›ç¨‹è¿è¡Œæ—¶é—´ uname èŽ·å–å½“å‰UNIXç³»ç»Ÿçš„åç§°ã€ç‰ˆæœ¬å’Œä¸»æœºç­‰ä¿¡æ¯ vhangup æŒ‚èµ·å½“å‰ç»ˆç«¯ nfsservctl å¯¹NFSå®ˆæŠ¤è¿›ç¨‹è¿›è¡ŒæŽ§åˆ¶ vm86 è¿›å…¥æ¨¡æ‹Ÿ8086æ¨¡å¼ create_module åˆ›å»ºå¯è£…è½½çš„æ¨¡å—é¡¹ delete_module åˆ é™¤å¯è£…è½½çš„æ¨¡å—é¡¹ init_module åˆå§‹åŒ–æ¨¡å— query_module æŸ¥è¯¢æ¨¡å—ä¿¡æ¯ *get_kernel_syms å–å¾—æ ¸å¿ƒç¬¦å·,å·²è¢«query_moduleä»£æ›¿ å†…å­˜ç®¡ç† ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° brk æ”¹å˜æ•°æ®æ®µç©ºé—´çš„åˆ†é… sbrk å‚è§brk mlock å†…å­˜é¡µé¢åŠ é” munlock å†…å­˜é¡µé¢è§£é” mlockall è°ƒç”¨è¿›ç¨‹æ‰€æœ‰å†…å­˜é¡µé¢åŠ é” munlockall è°ƒç”¨è¿›ç¨‹æ‰€æœ‰å†…å­˜é¡µé¢è§£é” mmap æ˜ å°„è™šæ‹Ÿå†…å­˜é¡µ munmap åŽ»é™¤å†…å­˜é¡µæ˜ å°„ mremap é‡æ–°æ˜ å°„è™šæ‹Ÿå†…å­˜åœ°å€ msync å°†æ˜ å°„å†…å­˜ä¸­çš„æ•°æ®å†™å›žç£ç›˜ mprotect è®¾ç½®å†…å­˜æ˜ åƒä¿æŠ¤ getpagesize èŽ·å–é¡µé¢å¤§å° sync å°†å†…å­˜ç¼“å†²åŒºæ•°æ®å†™å›žç¡¬ç›˜ cacheflush å°†æŒ‡å®šç¼“å†²åŒºä¸­çš„å†…å®¹å†™å›žç£ç›˜ ç½‘ç»œç®¡ç† ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° getdomainname å–åŸŸå setdomainname è®¾ç½®åŸŸå gethostid èŽ·å–ä¸»æœºæ ‡è¯†å· sethostid è®¾ç½®ä¸»æœºæ ‡è¯†å· gethostname èŽ·å–æœ¬ä¸»æœºåç§° sethostname è®¾ç½®ä¸»æœºåç§° socketæŽ§åˆ¶ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° socketcall socketç³»ç»Ÿè°ƒç”¨ socket å»ºç«‹socket bind ç»‘å®šsocketåˆ°ç«¯å£ connect è¿žæŽ¥è¿œç¨‹ä¸»æœº accept å“åº”socketè¿žæŽ¥è¯·æ±‚ send é€šè¿‡socketå‘é€ä¿¡æ¯ sendto å‘é€UDPä¿¡æ¯ sendmsg å‚è§send recv é€šè¿‡socketæŽ¥æ”¶ä¿¡æ¯ recvfrom æŽ¥æ”¶UDPä¿¡æ¯ recvmsg å‚è§recv listen ç›‘å¬socketç«¯å£ select å¯¹å¤šè·¯åŒæ­¥I/Oè¿›è¡Œè½®è¯¢ shutdown å…³é—­socketä¸Šçš„è¿žæŽ¥ getsockname å–å¾—æœ¬åœ°socketåå­— getpeername èŽ·å–é€šä¿¡å¯¹æ–¹çš„socketåå­— getsockopt å–ç«¯å£è®¾ç½® setsockopt è®¾ç½®ç«¯å£å‚æ•° sendfile åœ¨æ–‡ä»¶æˆ–ç«¯å£é—´ä¼ è¾“æ•°æ® socketpair åˆ›å»ºä¸€å¯¹å·²è”æŽ¥çš„æ— åsocket ç”¨æˆ·ç®¡ç† ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° getuid èŽ·å–ç”¨æˆ·æ ‡è¯†å· setuid è®¾ç½®ç”¨æˆ·æ ‡å¿—å· getgid èŽ·å–ç»„æ ‡è¯†å· setgid è®¾ç½®ç»„æ ‡å¿—å· getegid èŽ·å–æœ‰æ•ˆç»„æ ‡è¯†å· setegid è®¾ç½®æœ‰æ•ˆç»„æ ‡è¯†å· geteuid èŽ·å–æœ‰æ•ˆç”¨æˆ·æ ‡è¯†å· seteuid è®¾ç½®æœ‰æ•ˆç”¨æˆ·æ ‡è¯†å· setregid åˆ†åˆ«è®¾ç½®çœŸå®žå’Œæœ‰æ•ˆçš„çš„ç»„æ ‡è¯†å· setreuid åˆ†åˆ«è®¾ç½®çœŸå®žå’Œæœ‰æ•ˆçš„ç”¨æˆ·æ ‡è¯†å· getresgid åˆ†åˆ«èŽ·å–çœŸå®žçš„,æœ‰æ•ˆçš„å’Œä¿å­˜è¿‡çš„ç»„æ ‡è¯†å· setresgid åˆ†åˆ«è®¾ç½®çœŸå®žçš„,æœ‰æ•ˆçš„å’Œä¿å­˜è¿‡çš„ç»„æ ‡è¯†å· getresuid åˆ†åˆ«èŽ·å–çœŸå®žçš„,æœ‰æ•ˆçš„å’Œä¿å­˜è¿‡çš„ç”¨æˆ·æ ‡è¯†å· setresuid åˆ†åˆ«è®¾ç½®çœŸå®žçš„,æœ‰æ•ˆçš„å’Œä¿å­˜è¿‡çš„ç”¨æˆ·æ ‡è¯†å· setfsgid è®¾ç½®æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥æ—¶ä½¿ç”¨çš„ç»„æ ‡è¯†å· setfsuid è®¾ç½®æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥æ—¶ä½¿ç”¨çš„ç”¨æˆ·æ ‡è¯†å· getgroups èŽ·å–åŽè¡¥ç»„æ ‡å¿—æ¸…å• setgroups è®¾ç½®åŽè¡¥ç»„æ ‡å¿—æ¸…å• è¿›ç¨‹é—´é€šä¿¡ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° ipc è¿›ç¨‹é—´é€šä¿¡æ€»æŽ§åˆ¶è°ƒç”¨ ä¿¡å· ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° sigaction è®¾ç½®å¯¹æŒ‡å®šä¿¡å·çš„å¤„ç†æ–¹æ³• sigprocmask æ ¹æ®å‚æ•°å¯¹ä¿¡å·é›†ä¸­çš„ä¿¡å·æ‰§è¡Œé˜»å¡ž/è§£é™¤é˜»å¡žç­‰æ“ä½œ sigpending ä¸ºæŒ‡å®šçš„è¢«é˜»å¡žä¿¡å·è®¾ç½®é˜Ÿåˆ— sigsuspend æŒ‚èµ·è¿›ç¨‹ç­‰å¾…ç‰¹å®šä¿¡å· signal å‚è§signal kill å‘è¿›ç¨‹æˆ–è¿›ç¨‹ç»„å‘ä¿¡å· *sigblock å‘è¢«é˜»å¡žä¿¡å·æŽ©ç ä¸­æ·»åŠ ä¿¡å·,å·²è¢«sigprocmaskä»£æ›¿ *siggetmask å–å¾—çŽ°æœ‰é˜»å¡žä¿¡å·æŽ©ç ,å·²è¢«sigprocmaskä»£æ›¿ *sigsetmask ç”¨ç»™å®šä¿¡å·æŽ©ç æ›¿æ¢çŽ°æœ‰é˜»å¡žä¿¡å·æŽ©ç ,å·²è¢«sigprocmaskä»£æ›¿ *sigmask å°†ç»™å®šçš„ä¿¡å·è½¬åŒ–ä¸ºæŽ©ç ,å·²è¢«sigprocmaskä»£æ›¿ *sigpause ä½œç”¨åŒsigsuspend,å·²è¢«sigsuspendä»£æ›¿ sigvec ä¸ºå…¼å®¹BSDè€Œè®¾çš„ä¿¡å·å¤„ç†å‡½æ•°,ä½œç”¨ç±»ä¼¼sigaction ssetmask ANSI Cçš„ä¿¡å·å¤„ç†å‡½æ•°,ä½œç”¨ç±»ä¼¼sigaction æ¶ˆæ¯ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° msgctl æ¶ˆæ¯æŽ§åˆ¶æ“ä½œ msgget èŽ·å–æ¶ˆæ¯é˜Ÿåˆ— msgsnd å‘æ¶ˆæ¯ msgrcv å–æ¶ˆæ¯ ç®¡é“ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° pipe åˆ›å»ºç®¡é“ ä¿¡å·é‡ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° semctl ä¿¡å·é‡æŽ§åˆ¶ semget èŽ·å–ä¸€ç»„ä¿¡å·é‡ semop ä¿¡å·é‡æ“ä½œ å…±äº«å†…å­˜ ç³»ç»Ÿè°ƒç”¨åç§° åŠŸèƒ½æè¿° shmctl æŽ§åˆ¶å…±äº«å†…å­˜ shmget èŽ·å–å…±äº«å†…å­˜ shmat è¿žæŽ¥å…±äº«å†…å­˜ shmdt æ‹†å¸å…±äº«å†…å­˜]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[skiplistè·³è·ƒè¡¨]]></title>
      <url>%2F2016%2F06%2F14%2Fskiplist%2F</url>
      <content type="text"><![CDATA[åŸºæœ¬æƒ…å†µ å¯¹äºŽæœ‰åºé“¾è¡¨ï¼ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦çš†ä¸ºO(n)ï¼Œä¸é€‚ç”¨äºŽé¢‘ç¹çš„ä¸Šè¿°æ“ä½œ å…¶ä»–é€‚åˆäºŽä¸Šè¿°æ“ä½œçš„æ•°æ®ç»“æž„å„æœ‰ä¼˜åŠ£ï¼Œæ¯”å¦‚å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯”è¾ƒèŠ±è´¹ç©ºé—´ï¼Œä½†æŸ¥è¯¢æ•ˆçŽ‡å¯ä»¥ä¿è¯ è·³è·ƒè¡¨å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œç»“åˆéšæœºç‰¹æ€§ï¼Œå¯ä»¥ä¿è¯æŸ¥æ‰¾ã€æ’å…¥ä¸Žåˆ é™¤çš„æ“ä½œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä½ŽäºŽO(n) è·³è·ƒè¡¨çš„ç»“ç‚¹ æ¯ä¸ªç»“ç‚¹åŒ…å«é”®(key)ä¸Žå€¼(value) æ¯ä¸ªç»“ç‚¹å¯åŒ…å«å¤šä¸ªæŒ‡å‘å…¶ä»–ç»“ç‚¹çš„æŒ‡é’ˆï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªï¼Œè‡³å¤šåŒ…å«nä¸ªï¼Œnä¸ºè·³è·ƒè¡¨çš„æœ€å¤§å±‚æ•° è·³è·ƒè¡¨çš„ç»“æž„ é™¤äº†æ™®é€šç»“ç‚¹ä¹‹å¤–ï¼Œè¿˜åŒ…å«å¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹ï¼Œå¹¶ä¸”è·³è·ƒè¡¨çš„æ€»å±‚æ•°ä¸ºn æ¯ä¸€å±‚éƒ½åŒ…å«å¤´å°¾ç»“ç‚¹ å¦‚æžœç»“ç‚¹ä½äºŽç¬¬kå±‚ï¼Œé‚£ä¹ˆå®ƒå¿…å®šä½äºŽç¬¬k-1å±‚ï¼Œç¬¬k-1å±‚çš„ç»“ç‚¹æ•°å¿…å®šä¸å°‘äºŽç¬¬kå±‚ æ¯ä¸ªç»“ç‚¹å‡ä½äºŽç¬¬1å±‚ï¼ŒåŽé¢æ¯ä¸€å±‚çš„ç»“ç‚¹æ•°è¶Šæ¥è¶Šå°‘ï¼Œä½†æ˜¯é™¤äº†é¦–å°¾ç»“ç‚¹ä¹‹å¤–ï¼Œå…¶ä»–ç»“ç‚¹å¿…å®šä¿æŒæœ‰åº è·³è·ƒè¡¨åŒ…å«éšæœºæ€§ï¼Œéšæœºæ€§æŒ‡çš„æ˜¯æ¯ä¸ªç»“ç‚¹æ‰€åœ¨çš„å±‚æ•°æ˜¯åœ¨å®ƒè¢«åŠ å…¥è·³è·ƒè¡¨æ—¶éšæœºç”Ÿæˆçš„ï¼Œè¿™ä¸ªç‰¹æ€§å¯ç”¨äºŽä¿è¯å„ä¸ªæ“ä½œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä½ŽäºŽO(n) è·³è·ƒè¡¨ä¸»è¦æ“ä½œåŠå¤æ‚åº¦åˆ†æžæ’å…¥æ“ä½œè¿‡ç¨‹æè¿° è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå¤´ç»“ç‚¹ï¼Œå½“å‰å±‚æ•°ä¸ºç¬¬nå±‚ éšæœºç”Ÿæˆä¸€ä¸ªæ•´æ•°kï¼Œæ»¡è¶³1&lt;=k&lt;=nï¼Œè¡¨ç¤ºå³å°†æ’å…¥çš„ç»“ç‚¹æ‰€åœ¨çš„æ€»å±‚æ•° å¯¹æ¯”è¦æ’å…¥çš„keyä¸Žå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ç»“ç‚¹çš„keyï¼ˆæŒ‡å½“å‰çš„å±‚çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œä¸‹åŒï¼‰ï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå°ï¼Œåˆ™è½¬æ­¥éª¤4ï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå¤§ï¼Œåˆ™è½¬æ­¥éª¤5ï¼Œå¦‚æžœç­‰äºŽä¸‹ä¸€ç»“ç‚¹çš„keyï¼Œè¯´æ˜Žè¯¥keyå·²å­˜åœ¨ï¼Œç›´æŽ¥æ›¿æ¢ä¸‹ä¸€ç»“ç‚¹çš„valueå¹¶ç»“æŸæœ¬æ¬¡æ“ä½œ æŽ¥æ­¥éª¤3ï¼Œè¯´æ˜Žè¦æ’å…¥çš„ä½ç½®å¿…å®šåœ¨å½“å‰ç»“ç‚¹ä¸Žä¸‹ä¸€ç»“ç‚¹ä¹‹é—´ï¼Œå¦‚æžœkå¤§äºŽç­‰äºŽå½“å‰å±‚æ•°ï¼Œåˆ™è®°å½•å½“å‰ç»“ç‚¹ï¼Œæœ€åŽæ’å…¥æ–°ç»“ç‚¹çš„æ—¶å€™éœ€è¦ç”¨åˆ°è¯¥ä¿¡æ¯ï¼Œå¦‚æžœå½“å‰å±‚æ•°ä¸æ˜¯ç¬¬1å±‚ï¼Œé‚£ä¹ˆå½“å‰å±‚æ•°å‡1ï¼Œè¿”å›žæ­¥éª¤3ç»§ç»­ï¼Œå¦åˆ™è½¬æ­¥éª¤6 æŽ¥æ­¥éª¤3ï¼Œè¯´æ˜Žè¦æ’å…¥çš„ä½ç½®å¿…å®šåœ¨ä¸‹ä¸€ç»“ç‚¹ä¹‹åŽï¼Œå› æ­¤å°†å½“å‰ç»“ç‚¹æŒ‡å‘ä¸‹ä¸€ç»“ç‚¹ï¼Œè¿”å›žæ­¥éª¤3ç»§ç»­ å°†å½“å‰ç»“ç‚¹åŠ å…¥ç¬¬1-kå±‚ï¼Œæ¯ä¸€å±‚æ’å…¥çš„ä½ç½®å·²åœ¨æ­¥éª¤4ä¸­è®°å½•ï¼Œæ“ä½œç»“æŸ å¤æ‚åº¦åˆ†æž æœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«æ‰€æœ‰ç»“ç‚¹ï¼Œé‚£ä¹ˆå¦‚æžœè¦æ’å…¥çš„ä½ç½®æ˜¯å°¾ç»“ç‚¹ä¹‹å‰ï¼Œåˆ™æ—¶é—´å¤æ‚åº¦æ˜¯O(n) ç”±äºŽæ¯ä¸ªç‚¹çš„å±‚æ•°çš„éšæœºæ€§ï¼Œå‡è®¾å®Œå…¨éšæœºåˆ†å¸ƒï¼Œé‚£ä¹ˆå¤§è‡´å¯ä»¥è¿™æ ·ç†è§£ï¼šç¬¬1å±‚åŒ…å«nä¸ªç»“ç‚¹ï¼Œæ¯ä¸ªç»“ç‚¹æœ‰50%çš„æ¦‚çŽ‡å‡ºçŽ°åœ¨ç¬¬2å±‚ï¼Œåˆ™ç¬¬2å±‚å¯èƒ½çš„ç»“ç‚¹æ•°æ˜¯n/2ï¼Œç¬¬nå±‚å¯èƒ½çš„ç»“ç‚¹æ•°æ˜¯ç¬¬n-1å±‚çš„ä¸€åŠ æŸ¥æ‰¾ä½ç½®çš„è¿‡ç¨‹ä¸­ï¼Œå±‚æ•°è¶Šå¤§ï¼Œåˆ™æ¯æ¬¡æ¯”è¾ƒä¹‹åŽè·³è¿‡çš„ç»“ç‚¹æ•°è¶Šå¤šï¼Œå¹³å‡ä¸‹æ¥çœ‹ï¼Œæœ€ç»ˆæ‰§è¡Œæ’å…¥æ“ä½œä¹‹å‰éåŽ†çš„ç»“ç‚¹æ•°è‚¯å®šå°äºŽæ€»çš„ç»“ç‚¹æ•°ï¼Œè€Œæ’å…¥ç»“ç‚¹æ‰€éœ€è¦å˜åŠ¨æŒ‡é’ˆçš„å±‚æ•°kçš„æœŸæœ›å€¼æ˜¯n/2ï¼Œå› æ­¤æ€»çš„å¤æ‚åº¦å¿…å®šä½ŽäºŽO(n) æŸ¥æ‰¾æ“ä½œè¿‡ç¨‹æè¿° è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå¤´ç»“ç‚¹ï¼Œå½“å‰å±‚æ•°ä¸ºç¬¬nå±‚ å¯¹æ¯”è¦æŸ¥æ‰¾çš„keyä¸Žå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ç»“ç‚¹çš„keyï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå°ï¼Œåˆ™è½¬æ­¥éª¤4ï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå¤§ï¼Œåˆ™è½¬æ­¥éª¤4ï¼Œå¦‚æžœç­‰äºŽä¸‹ä¸€ç»“ç‚¹çš„keyï¼Œç›´æŽ¥è¿”å›žä¸‹ä¸€ç»“ç‚¹çš„valueå¹¶ç»“æŸæœ¬æ¬¡æ“ä½œ æŽ¥æ­¥éª¤2ï¼Œè¯´æ˜Žè¦æŸ¥æ‰¾çš„keyçš„ä½ç½®å¿…å®šåœ¨å½“å‰ç»“ç‚¹ä¸Žä¸‹ä¸€ç»“ç‚¹ä¹‹é—´ï¼Œå¦‚æžœå½“å‰å±‚æ•°ä¸æ˜¯ç¬¬1å±‚ï¼Œé‚£ä¹ˆå½“å‰å±‚æ•°å‡1ï¼Œè¿”å›žæ­¥éª¤3ç»§ç»­ï¼Œå¦åˆ™è¯´æ˜Žè¯¥keyä¸å­˜åœ¨è·³è·ƒè¡¨ä¸­ï¼Œè¿”å›žå¯¹åº”ä¿¡æ¯ æŽ¥æ­¥éª¤2ï¼Œè¯´æ˜Žè¦æŸ¥æ‰¾çš„keyçš„ä½ç½®å¿…å®šåœ¨ä¸‹ä¸€ç»“ç‚¹ä¹‹åŽï¼Œå› æ­¤å°†å½“å‰ç»“ç‚¹æŒ‡å‘ä¸‹ä¸€ç»“ç‚¹ï¼Œè¿”å›žæ­¥éª¤2ç»§ç»­ å¤æ‚åº¦åˆ†æž æŸ¥æ‰¾è¿‡ç¨‹çš„æ“ä½œä¸Žæ’å…¥è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ä¸éœ€è¦å˜æ›´è·³è·ƒè¡¨çš„ç»“ç‚¹æŒ‡é’ˆï¼Œå› æ­¤å…¶å¤æ‚åº¦ä¸€æ ·ä½ŽäºŽO(n) åˆ é™¤æ“ä½œè¿‡ç¨‹æè¿° è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå¤´ç»“ç‚¹ï¼Œå½“å‰å±‚æ•°ä¸ºç¬¬nå±‚ å¯¹æ¯”è¦æ’å…¥çš„keyä¸Žå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ç»“ç‚¹çš„keyï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå°ï¼Œåˆ™è½¬æ­¥éª¤3ï¼Œå¦‚æžœæ¯”ä¸‹ä¸€ç»“ç‚¹çš„keyå¤§ï¼Œåˆ™è½¬æ­¥éª¤4ï¼Œå¦‚æžœç­‰äºŽä¸‹ä¸€ç»“ç‚¹çš„keyï¼Œåˆ™å°†å½“å‰ç»“ç‚¹åœ¨æœ¬å±‚çš„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»“ç‚¹çš„ä¸‹ä¸€ç»“ç‚¹ æŽ¥æ­¥éª¤2ï¼Œè¯´æ˜Žè¦åˆ é™¤çš„ä½ç½®å¿…å®šåœ¨å½“å‰ç»“ç‚¹ä¸Žä¸‹ä¸€ç»“ç‚¹ä¹‹é—´ï¼Œå¦‚æžœå½“å‰å±‚æ•°ä¸æ˜¯ç¬¬1å±‚ï¼Œé‚£ä¹ˆå½“å‰å±‚æ•°å‡1ï¼Œè¿”å›žæ­¥éª¤2ç»§ç»­ï¼Œå¦åˆ™ç»“æŸæœ¬æ¬¡æ“ä½œ æŽ¥æ­¥éª¤2ï¼Œè¯´æ˜Žè¦åˆ é™¤çš„ä½ç½®å¿…å®šåœ¨ä¸‹ä¸€ç»“ç‚¹ä¹‹åŽï¼Œå› æ­¤å°†å½“å‰ç»“ç‚¹æŒ‡å‘ä¸‹ä¸€ç»“ç‚¹ï¼Œè¿”å›žæ­¥éª¤2ç»§ç»­ å¦‚æžœéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ç»“ç‚¹å ç”¨çš„ç©ºé—´æˆ–è¿”å›žè¢«åˆ é™¤çš„ç»“ç‚¹çš„valueï¼Œåˆ™éœ€è¦åœ¨æ­¥éª¤2è®°å½•å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶åœ¨éåŽ†ç»“æŸä¹‹åŽåˆ é™¤å®ƒ å¤æ‚åº¦åˆ†æž åˆ é™¤è¿‡ç¨‹ä¸Žæ’å…¥è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯æŠŠå¯¹åº”çš„æŒ‡é’ˆæ“ä½œç›¸åï¼Œå…¶å¤æ‚åº¦ä¸€æ ·ä½ŽäºŽO(n) è·³è·ƒè¡¨çš„pythonå®žçŽ°ç»“ç‚¹ç±»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&quot;&quot;&quot;ç»“ç‚¹ç±»&quot;&quot;&quot;class Node(object): # æž„é€ å‡½æ•° def __init__(self, key, value): if type(key) != KEY_TYPE: raise TypeError self.key = key self.value = value self.forwardNodes = &#123;&#125; self.numForward = 0 # è®¾ç½®æŸä¸€å±‚çš„å‰å‘ç»“ç‚¹ def setForwardNode(self, level, node): if not isinstance(node, Node): raise TypeError if type(level) != int: raise TypeError if level &lt; 0: raise ValueError self.forwardNodes[level] = node self.numForward = len(self.forwardNodes) # èŽ·å–æŸä¸€å±‚çš„å‰å‘ç»“ç‚¹ def getForwardNode(self, level): if type(level) != int: raise TypeError if level &lt; 0: raise ValueError if level not in self.forwardNodes.keys(): raise KeyError return self.forwardNodes[level] # æ‰“å°ç»“ç‚¹ä¿¡æ¯ def dump(self): print(&apos;key: %s&apos; % str(self.key)) print(&apos;value: %s&apos; % str(self.value)) print(&apos;forward nodes: %s&apos; % str(self.forwardNodes)) print(&apos;num forward: %s&apos; % str(self.numForward)) # èŽ·å–å‰å‘ç»“ç‚¹æ•° def numForward(self): return self.numForward # èŽ·å–ç»“ç‚¹çš„é”® def getKey(self): return self.key # èŽ·å–ç»“ç‚¹çš„å€¼ def getValue(self): return self.value # è®¾ç½®ç»“ç‚¹çš„å€¼ def setValue(self, value): self.value = value è·³è·ƒè¡¨ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148&quot;&quot;&quot;è·³è·ƒè¡¨ç±»&quot;&quot;&quot;class SkipList(object): # æž„é€ å‡½æ•° def __init__(self, level = MAX_LEVEL): if type(level) != int: print(type(level)) raise TypeError if level &lt; 1: raise ValueError self.level = int(level) self.nil = Node(-1, -1) self.head = Node(0, 0) for i in xrange(self.level): self.head.setForwardNode(i + 1, self.nil) # æ’å…¥ç»“ç‚¹æ—¶èŽ·å–éšæœºå±‚æ•° def genRandomLevel(self): return random.randint(1, self.level) # æ’å…¥æ–°çš„ç»“ç‚¹ def insert(self, key, value): node = Node(key, value) tmpLevel = self.genRandomLevel() tmpNode = self.head backwardNodes = &#123;&#125; while tmpLevel &gt;= 1: forwardNode = tmpNode.getForwardNode(tmpLevel) if forwardNode == self.nil: backwardNodes[tmpLevel] = tmpNode tmpLevel -= 1 continue if forwardNode.getKey() &lt; key: tmpNode = forwardNode continue elif forwardNode.getKey() &gt; key: backwardNodes[tmpLevel] = tmpNode tmpLevel -= 1 continue # é”®å·²å­˜åœ¨ï¼Œç›´æŽ¥æ›¿æ¢ç»“ç‚¹çš„å€¼å³å¯ forwardNode.setValue(value) return for level in backwardNodes.keys(): node.setForwardNode(level, backwardNodes[level].getForwardNode(level)) backwardNodes[level].setForwardNode(level, node) # æœç´¢æŸä¸ªé”®å¯¹åº”çš„å€¼ def search(self, key): if type(key) != KEY_TYPE: raise TypeError tmpLevel = self.level tmpNode = self.head while tmpLevel &gt;= 1: forwardNode = tmpNode.getForwardNode(tmpLevel) if forwardNode == self.nil: tmpLevel -= 1 continue if forwardNode.getKey() &lt; key: tmpNode = forwardNode continue elif forwardNode.getKey() &gt; key: tmpLevel -= 1 continue # æ‰¾åˆ°å¯¹åº”ç»“ç‚¹åˆ™ç›´æŽ¥è¿”å›žå®ƒçš„å€¼ return forwardNode.getValue() # æ‰¾ä¸åˆ°å¯¹åº”ç»“ç‚¹ï¼Œè¿”å›žNone return None # åˆ é™¤é”®å¯¹åº”çš„ç»“ç‚¹ def delete(self, key): if type(key) != KEY_TYPE: raise TypeError tmpLevel = self.level tmpNode = self.head node = None while tmpLevel &gt;= 1: forwardNode = tmpNode.getForwardNode(tmpLevel) if forwardNode == self.nil: tmpLevel -= 1 continue if forwardNode.getKey() &lt; key: tmpNode = forwardNode continue elif forwardNode.getKey() &gt; key: tmpLevel -= 1 continue # ç»“ç‚¹åœ¨æŸä¸€å±‚å­˜åœ¨æŒ‡é’ˆï¼Œè°ƒæ•´è¯¥å±‚çš„æŒ‡é’ˆ tmpNode.setForwardNode(tmpLevel, forwardNode.getForwardNode(tmpLevel)) node = forwardNode value = forwardNode.getValue() # é”®å¯¹åº”çš„ç»“ç‚¹å­˜åœ¨ï¼Œåˆ™åˆ é™¤ä¹‹ï¼Œå¹¶è¿”å›žå®ƒçš„å€¼ if node is not None: value = node.getValue() del(node) return value # æ‰¾ä¸åˆ°å¯¹åº”çš„ç»“ç‚¹ï¼ŒæŠ›å‡ºå¼‚å¸¸ raise KeyError # æ‰“å°è·³è·ƒè¡¨ def dump(self): tmpLevel = self.level tmpNode = self.head line = &apos;&apos; while tmpLevel &gt;= 1: forwardNode = tmpNode.getForwardNode(tmpLevel) if forwardNode != self.nil: line += &apos;(%s, %s) -&gt; &apos; % (forwardNode.getKey(), forwardNode.getValue()) tmpNode = forwardNode continue print(&apos;level %d: (head) -&gt; %s (tail)&apos; % (tmpLevel, line)) tmpNode = self.head tmpLevel -= 1 line = &apos;&apos; ç®€å•æµ‹è¯•ç±»12345678910111213141516if __name__ == &apos;__main__&apos;: skipList = SkipList() keys = list(range(0, 10)) for key in keys: skipList.insert(key, key) for key in keys: skipList.insert(key, key) skipList.dump() print(&quot;delete 3:&quot;, skipList.delete(3)) skipList.dump() print(&quot;delete 8:&quot;, skipList.delete(8)) skipList.dump() keys = list(range(0, 11)) for key in keys: print(&apos;search key %d&apos; % key) print(skipList.search(key))]]></content>
    </entry>

    
  
  
</search>
